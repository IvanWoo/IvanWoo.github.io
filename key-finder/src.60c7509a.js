parcelRequire=function(e){var r="function"==typeof parcelRequire&&parcelRequire,n="function"==typeof require&&require,i={};function u(e,u){if(e in i)return i[e];var t="function"==typeof parcelRequire&&parcelRequire;if(!u&&t)return t(e,!0);if(r)return r(e,!0);if(n&&"string"==typeof e)return n(e);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return u.register=function(e,r){i[e]=r},i=e(u),u.modules=i,u}(function (require) {function $(a){return a&&a.__esModule?{d:a.default}:{d:a}}var td=function(){return td=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},td.apply(this,arguments)};function za(t,e,r,o){var n,a=arguments.length,$=a<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)$=Reflect.decorate(t,e,r,o);else for(var i=t.length-1;i>=0;i--)(n=t[i])&&($=(a<3?n($):a>3?n(e,r,$):n(e,r))||$);return a>3&&$&&Object.defineProperty(e,r,$),$}function Ic(t){return this instanceof Ic?(this.v=t,this):new Ic(t)}var He=false;function Hc(){if(He)return;He=true}const Ah=(e,o={})=>{const t=Reflect.ownKeys(e),r=Reflect.ownKeys(o),n=Symbol("isa");function p(o){for(let r of t){const t=Object.getOwnPropertyDescriptor(o.prototype,r);!t||t.configurable?Object.defineProperty(o.prototype,r,{value:e[r],writable:!0}):console.log(`not patching: ${o.name}.${r.toString()}`)}return Object.defineProperty(o.prototype,n,{value:!0}),o}for(let i of r)Object.defineProperty(p,i,{value:o[i],enumerable:o.propertyIsEnumerable(i)});return Object.defineProperty(p,Symbol.hasInstance,{value:e=>!!e[n]}),p};const ad=Ah({addWatch(t,s){return this._watches=this._watches||{},!this._watches[t]&&(this._watches[t]=s,!0)},removeWatch(t){if(this._watches)return!!this._watches[t]&&(delete this._watches[t],!0)},notifyWatches(t,s){if(!this._watches)return;const e=this._watches;for(let i in e)e[i](i,t,s)}});const id=(r,o=r=>void 0!==r?": "+r:"")=>class extends Error{constructor(e){super(r(e)+o(e))}};const Ud=id(()=>"illegal state");const pe=e=>{throw new Ud(e)};const Gc=Array.isArray;const Ne=t=>"string"==typeof t;const Re=r=>r&&(r instanceof Float32Array||r instanceof Float64Array||r instanceof Uint32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Int8Array||r instanceof Uint16Array||r instanceof Int16Array||r instanceof Uint8ClampedArray);const ta=t=>Gc(t)?t:Ne(t)?t.length>0?t.split("."):[]:null!=t?[t]:[];const qh=e=>Dc(e);function Dc(e){const t=ta(e),[r,l,n,$]=t;switch(t.length){case 0:return e=>e;case 1:return e=>null!=e?e[r]:void 0;case 2:return e=>null!=e&&null!=(e=e[r])?e[l]:void 0;case 3:return e=>null!=e&&null!=(e=e[r])&&null!=(e=e[l])?e[n]:void 0;case 4:return e=>null!=e&&null!=(e=e[r])&&null!=(e=e[l])&&null!=(e=e[n])?e[$]:void 0;default:return e=>{const r=t.length-1;let l=e;for(let n=0;null!=l&&n<=r;n++)l=l[t[n]];return l};}}function Ac($){const e=ta($),[t,r,o,p]=e;switch(e.length){case 0:return($,e)=>e;case 1:return($,e)=>($=g($),$[t]=e,$);case 2:return($,e)=>{let o;return($=g($))[t]=o=g($[t]),o[r]=e,$};case 3:return($,e)=>{let p,c;return($=g($))[t]=p=g($[t]),p[r]=c=g(p[r]),c[o]=e,$};case 4:return($,e)=>{let c,B,E;return($=g($))[t]=c=g($[t]),c[r]=B=g(c[r]),B[o]=E=g(B[o]),E[p]=e,$};default:let $;for(let t=e.length;--t>=0;)$=Cd(e[t],$);return $;}}const g=$=>Gc($)||Re($)?$.slice():Object.assign({},$);const Cd=($,e)=>(t,r)=>(t=g(t),t[$]=e?e(t[$],r):r,t);const vc=(e,p,$,...t)=>$d(e,p,$,...t);function $d(e,p,$,...t){return Ac(p)(e,$.apply(null,(t.unshift(Dc(p)(e)),t)))}const uc=(e,$,t)=>Ac($)(e,t);let sc=class{constructor(e,t){t&&!t(e)&&pe("initial state value did not validate"),this._value=e,this.valid=t}get value(){return this._value}set value(e){this.reset(e)}deref(){return this._value}equiv(e){return this===e}reset(e){const t=this._value;return this.valid&&!this.valid(e)?t:(this._value=e,this.notifyWatches(t,e),e)}resetIn(e,t){return this.reset(uc(this._value,e,t))}resetInUnsafe(e,t){return this.reset(uc(this._value,e,t))}swap(e,...t){return this.reset(e.apply(null,[this._value,...t]))}swapIn(e,t,...r){return this.reset(vc(this._value,e,t,...r))}swapInUnsafe(e,t,...r){return this.reset(vc(this._value,e,t,...r))}addWatch(e,t){}removeWatch(e){}notifyWatches(e,t){}release(){return delete this._watches,delete this._value,!0}};sc=za([ad],sc);let Ke=0;const Le=()=>Ke++;const mc=Object.getPrototypeOf({}),x=(e,t)=>{let $;return e===t||(null==e?e==t:"function"==typeof e.equiv?e.equiv(t):null==t?e==t:"function"==typeof t.equiv?t.equiv(e):"string"!=typeof e&&"string"!=typeof t&&(null!=($=Object.getPrototypeOf(e))&&$!==mc||null!=($=Object.getPrototypeOf(t))&&$!==mc?"function"!=typeof e&&void 0!==e.length&&"function"!=typeof t&&void 0!==t.length?nf(e,t):e instanceof Set&&t instanceof Set?bg(e,t):e instanceof Map&&t instanceof Map?fg(e,t):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:kg(e,t)))};const nf=(e,t,$=x)=>{let o=e.length;if(o===t.length)for(;--o>=0&&$(e[o],t[o]););return o<0};const bg=(e,t,$=x)=>e.size===t.size&&$([...e.keys()].sort(),[...t.keys()].sort());const fg=(e,t,$=x)=>e.size===t.size&&$([...e].sort(),[...t].sort());const kg=(e,t,$=x)=>{if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let o in e)if(!t.hasOwnProperty(o)||!$(e[o],t[o]))return!1;return!0};function lc(t,e,i,s,r){return new Yg(t,e,i,s,r)}class Yg{constructor(t,e,i,s=!0,r=x){this.parent=t,this.id=`view-${Le()}`,this.tx=i||(t=>t),this.path=ta(e),this.isDirty=!0,this.isLazy=s;const $=qh(this.path),h=this.parent.deref();this.unprocessed=h?$(h):void 0,s||(this.state=this.tx(this.unprocessed),this.unprocessed=void 0),t.addWatch(this.id,(t,e,i)=>{const h=e?$(e):e,o=i?$(i):i;r(o,h)||(s?this.unprocessed=o:this.state=this.tx(o),this.isDirty=!0)})}get value(){return this.deref()}deref(){return this.isDirty&&(this.isLazy&&(this.state=this.tx(this.unprocessed),this.unprocessed=void 0),this.isDirty=!1),this.state}changed(){return this.isDirty}view(){return this.isDirty&&this.isLazy?this.tx(this.unprocessed):this.state}release(){return this.unprocessed=void 0,this.isLazy||(this.state=this.tx(void 0)),this.isDirty=!0,this.parent.removeWatch(this.id)}}const bh=o=>"function"==typeof o;const va=(n,t)=>null!=n&&"function"==typeof n[t];const v=Array.isArray;const Yc=t=>null!=t&&"function"!=typeof t&&void 0!==t.length;const Zc=t=>"string"==typeof t;const $c=e=>null!=e&&"function"==typeof e[Symbol.iterator];const kc=t=>null!=t&&"string"!=typeof t&&"function"==typeof t[Symbol.iterator];const jc=Object.getPrototypeOf,sd=$=>{let r;return null!=$&&"object"==typeof $&&(null===(r=jc($))||null===jc(r))};const hc=Symbol();let Ka,fa;const gc=Object.getPrototypeOf({}),q=(e,t)=>{let $;return e===t||(null==e?e==t:"function"==typeof e.equiv?e.equiv(t):null==t?e==t:"function"==typeof t.equiv?t.equiv(e):"string"!=typeof e&&"string"!=typeof t&&(null!=($=Object.getPrototypeOf(e))&&$!==gc||null!=($=Object.getPrototypeOf(t))&&$!==gc?"function"!=typeof e&&void 0!==e.length&&"function"!=typeof t&&void 0!==t.length?bc(e,t):e instanceof Set&&t instanceof Set?ac(e,t):e instanceof Map&&t instanceof Map?_b(e,t):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:$b(e,t)))};const bc=(e,t,$=q)=>{let o=e.length;if(o===t.length)for(;--o>=0&&$(e[o],t[o]););return o<0};const ac=(e,t,$=q)=>e.size===t.size&&$([...e.keys()].sort(),[...t.keys()].sort());const _b=(e,t,$=q)=>e.size===t.size&&$([...e].sort(),[...t].sort());const $b=(e,t,$=q)=>{if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let o in e)if(!t.hasOwnProperty(o)||!$(e[o],t[o]))return!1;return!0};let Se=[],Ve=[];const _e=r=>Ka&&Ka.length>=r?Ka:Ka=new Int32Array(r),cf=r=>fa&&fa.length>=r?fa:fa=new Int32Array(r),Zb=(r,$,e,a,t)=>{const c=$.length,l=r.linear;if(r.distance=c,0!==t){for(let r=0,e=0;r<c;r++,e+=3)l[e]=a,l[e+1]=r,l[e+2]=$[r];if(3===t){const a=r[e];for(let r=0;r<c;r++)a[r]=$[r]}}return r},xf=(r,$,e=3,a=q)=>{const t={distance:0,adds:{},dels:{},const:{},linear:[]};if(r===$||null==r&&null==$)return t;if(null==r||0===r.length)return Zb(t,$,"adds",1,e);if(null==$||0===$.length)return Zb(t,r,"dels",-1,e);const c=r.length>=$.length;let l,n,h,s;c?(l=$,n=r):(l=r,n=$),h=l.length,s=n.length;const d=h+1,o=s-h,i=o+d,z=h+s+3,J=cf(z).fill(-1,0,z),f=_e(z).fill(-1,0,z),v=Se,u=Ve;v.length=0,u.length=0;const P=(r,$,e)=>{const t=r+d;let c,o;$>e?(c=J[t-1],o=$):(c=J[t+1],o=e);let i=o-r;for(;i<h&&o<s&&a(l[i],n[o]);)i++,o++;return J[t]=u.length/3,u.push(i,o,c),o};let g,p,_=-1;do{for(p=(g=-++_)+d;g<o;g++,p++)f[p]=P(g,f[p-1]+1,f[p+1]);for(p=(g=o+_)+d;g>o;g--,p--)f[p]=P(g,f[p-1]+1,f[p+1]);f[i]=P(o,f[i-1]+1,f[i+1])}while(f[i]!==s);if(t.distance=o+2*_,0!==e){for(_=3*J[i];_>=0;)v.push(_),_=3*u[_+2];3===e?Af(v,u,t,l,n,c):Cf(v,u,t,l,n,c,1===e)}return t};const Af=(r,$,e,a,t,c)=>{const l=e.linear,n=e.const;let h,s,d,o,i=r.length,z=0,J=0;for(c?(h=e.dels,s=e.adds,d=-1,o=1):(h=e.adds,s=e.dels,d=1,o=-1);--i>=0;){const e=r[i],c=$[e],f=$[e+1],v=f-c;for(;z<c||J<f;){const r=J-z;v>r?(l.push(d,J,h[J]=t[J]),J++):v<r?(l.push(o,z,s[z]=a[z]),z++):(l.push(0,z,n[z]=a[z]),z++,J++)}}},Cf=(r,$,e,a,t,c,l)=>{const n=e.linear,h=c?-1:1,s=c?1:-1;let d=r.length,o=0,i=0;for(;--d>=0;){const e=r[d],c=$[e],z=$[e+1],J=z-c;for(;o<c||i<z;){const r=i-o;J>r?(n.push(h,i,t[i]),i++):J<r?(n.push(s,o,a[o]),o++):(l&&n.push(0,o,a[o]),o++,i++)}}};const Gf=(t,e,$=3,i=q)=>t===e?{distance:0}:0===$?Kf(t,e,i):Of(t,e,i);const Kf=(t,e,$)=>{t||(t={}),e||(e={});let i=0;for(let r in t){const f=e[r];(void 0===f||!$(t[r],f))&&i++}for(let r in e)!(r in t)&&i++;return{distance:i}},Of=(t,e,$)=>{t||(t={}),e||(e={});let i=0;const r=[],f=[],s=[];for(let n in t){const r=e[n];void 0===r?(f.push(n),i++):$(t[n],r)||(s.push(n,r),i++)}for(let n in e)n in t||(r.push(n),i++);return{distance:i,adds:r,dels:f,edits:s}};const H=Array.isArray,cg=Math.max,Yb=Object.getPrototypeOf({}),Xb=(()=>{const e=new Array(2048);for(let t=2,r=e.length;t<r;t++)e[t]=t-2;return e})(),lg=e=>{if(e<=Xb.length)return Xb.slice(0,e);const t=new Array(e);for(;--e>=2;)t[e]=e-2;return t},Vb=(e,t,r,$,i,o=0)=>{const n=i[1];if(n.__skip)return;if(!1===n.__diff)return B($),void t.replaceChild(e,r,o,i);const f=$[1];if(f&&f.__skip)return void t.replaceChild(e,r,o,i,!1);let s=n.__impl;if(s&&s!==t)return s.diffTree(e,s,r,$,i,o);const a=xf($,i,1,A);if(0===a.distance)return;const h=a.linear,T=t.getChild(r,o);let l,p,v,K;if(0!==h[0]||$[1].key!==n.key)return B($),void t.replaceChild(e,r,o,i);if((K=$.__release)&&K!==i.__release&&B($),0!==h[3]&&(Rg(t,T,$[1],i[1]),2===a.distance))return;const Q=h.length,d=$.length-1,u=ah(h),c=lg(d+1);for(l=2,p=6;p<Q;l++,p+=3)(v=h[p])&&(-1===v?Kg(e,t,T,$,i,h,p,u,c,d):Mg(e,t,T,h,p,u,c,d));(K=i.__init)&&K!=$.__init&&K.apply(i,[T,...i.__args])};const Kg=(e,t,r,$,i,o,n,f,s,a)=>{const h=o[n+2];if(H(h)){let T=h[1].key;if(void 0!==T&&void 0!==f[T][2]){const o=f[T];T=o[0],Vb(e,t,r,$[T],i[o[2]],s[T])}else{const e=o[n+1];B(h),t.removeChild(r,s[e]),Og(s,a,e)}}else"string"==typeof h&&t.setContent(r,"")},Mg=(e,t,r,$,i,o,n,f)=>{const s=$[i+2];if("string"==typeof s)t.setContent(r,s);else if(H(s)){const a=s[1].key;if(void 0===a||void 0===o[a][0]){const o=$[i+1];t.createTree(e,r,s,n[o]),Qg(n,f,o)}}},Og=(e,t,r)=>{for(;t>r;t--)e[t]=cg(e[t]-1,0)},Qg=(e,t,r)=>{for(;t>=r;t--)e[t]++},Rg=(e,t,r,$)=>{const i=Gf(r,$,3,q);e.removeAttribs(t,i.dels,r);let o,n,f,s=hc;for(o=(f=i.edits).length;(o-=2)>=0;)0===(n=f[o]).indexOf("on")&&e.removeAttribs(t,[n],r),"value"!==n?e.setAttrib(t,n,f[o+1],$):s=f[o+1];for(o=(f=i.adds).length;--o>=0;)"value"!==(n=f[o])?e.setAttrib(t,n,$[n],$):s=$[n];s!==hc&&e.setAttrib(t,"value",s,$)};const B=e=>{if(H(e)){let t;if((t=e[1])&&!1===t.__release)return;for(e.__release&&(e.__release.apply(e.__this,e.__args),delete e.__release),t=e.length;--t>=2;)B(e[t])}};const ah=e=>{let t,r,$;const i={};for(let o=e.length;(o-=3)>=0;)r=e[o+2],H(r)&&void 0!==(t=r[1].key)&&(!($=i[t])&&(i[t]=$=[,,]),$[e[o]+1]=e[o+1]);return i},A=(e,t)=>{let r;return e===t||(null==e?e==t:"function"==typeof e.equiv?e.equiv(t):null==t?e==t:"function"==typeof t.equiv?t.equiv(e):"string"!=typeof e&&"string"!=typeof t&&(null!=(r=Object.getPrototypeOf(e))&&r!==Yb||null!=(r=Object.getPrototypeOf(t))&&r!==Yb?"function"!=typeof e&&void 0!==e.length&&"function"!=typeof t&&void 0!==t.length?bc(e,t,A):e instanceof Set&&t instanceof Set?ac(e,t,A):e instanceof Map&&t instanceof Map?_b(e,t,A):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:!(!1===e.__diff||!1===t.__diff)&&$b(e,t,A)))};const mh="http://www.w3.org/2000/svg";const nh={"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&apos;"};const ph=/^([^\s\.#]+)(?:#([^\s\.#]+))?(?:\.([^\s#]+))?$/;const Mh=new RegExp(`[${Object.keys(nh).join("")}]`,"g");const uh={button:1,option:1,text:1,textarea:1};const Ub=e=>e.split(" ").reduce((e,t)=>(e[t]=!0,e),{}),Nc=Ub("animate animateColor animateMotion animateTransform circle clipPath color-profile defs desc discard ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter font foreignObject g image line linearGradient marker mask metadata mpath path pattern polygon polyline radialGradient rect set stop style svg switch symbol text textPath title tref tspan use view");const Lh=Ub("area base br circle col command ellipse embed hr img input keygen line link meta param path polygon polyline rect source stop track use wbr ?xml");const Rc=t=>{let $,r="";for(let e in t)$=t[e],bh($)&&($=$(t)),null!=$&&(r+=`${e}:${$};`);return r};const Xc=(e,t)=>{if(null==e||!t||!t.length)return e;const r=Object.assign({},e);for(let n of t){const e=r[n];va(e,"deref")&&(r[n]=e.deref())}return r};const Q=v,Tb=kc,Sb=(e,t)=>t.__init&&t.__init.apply(t.__this,[e,...t.__args]),V=(e,t,r,s,$,n=!0)=>{if(Q(s)){const o=s[0];if("function"==typeof o)return V(e,t,r,o.apply(null,[e.ctx,...s.slice(1)]),$);const a=s[1];if(a.__impl)return a.__impl.createTree(e,r,s,$,n);const i=t.createElement(r,o,a,$);if(s.length>2){const r=s.length;for(let $=2;$<r;$++)V(e,t,i,s[$],void 0,n)}return n&&Sb(i,s),i}if(Tb(s)){const o=[];for(let a of s)o.push(V(e,t,r,a,$,n));return o}return null==s?r:t.createTextElement(r,s)};const W=(e,t,r,s,$=0)=>{if(Q(s)){const n=t.getChild(r,$);"function"==typeof s[0]&&W(e,t,r,s[0].apply(null,[e.ctx,...s.slice(1)]),$);const o=s[1];if(o.__impl)return o.__impl.hydrateTree(e,r,s,$);Sb(n,s);for(let e in o)0===e.indexOf("on")&&t.setAttrib(n,e,o[e]);for(let r=s.length,$=2;$<r;$++)W(e,t,n,s[$],$-2)}else if(Tb(s))for(let n of s)W(e,t,r,n,$),$++};const od=(e,t,r,s)=>{const $=Nc[t]?document.createElementNS(mh,t):document.createElement(t);return r&&Bd($,r),Rb(e,$,s)};const qd=(e,t,r)=>Rb(e,document.createTextNode(t),r);const Rb=(e,t,r)=>e?void 0===r?e.appendChild(t):e.insertBefore(t,e.children[r]):t;const wd=(e,t)=>e.children[t];const yd=(e,t,r,s,$,n=!0)=>(t.removeChild(r,s),t.createTree(e,r,$,s,n));const zd=(e,t)=>e.textContent=t;const Bd=(e,t)=>{for(let r in t)Pb(e,r,t[r],t);return e};const Pb=(e,t,r,s)=>{if(t.startsWith("__"))return;const $=0===t.indexOf("on");if($||"function"!=typeof r||(r=r(s)),void 0!==r&&!1!==r)switch(t){case"style":Ld(e,r);break;case"value":Fd(e,r);break;case"accesskey":e.accessKey=r;break;case"contenteditable":e.contentEditable=r;break;case"tabindex":e.tabIndex=r;break;case"align":case"autocapitalize":case"checked":case"dir":case"draggable":case"hidden":case"id":case"lang":case"namespaceURI":case"scrollTop":case"scrollLeft":case"title":e[t]=r;break;default:$?Od(e,t.substr(2),r):e.setAttribute(t,!0===r?"":r);}else null!=e[t]?e[t]=null:e.removeAttribute(t);return e};const Fd=(e,t)=>{let r;switch(e.type){case"text":case"textarea":case"password":case"search":case"number":case"email":case"url":case"tel":case"date":case"datetime-local":case"time":case"week":case"month":if(void 0!==(r=e.value)&&"string"==typeof t){const s=t.length-(r.length-(e.selectionStart||0));e.value=t,e.selectionStart=e.selectionEnd=s;break}default:e.value=t;}};const Kd=(e,t,r)=>{for(let s=t.length;--s>=0;){const $=t[s];0===$.indexOf("on")?Pd(e,$.substr(2),r[$]):e.hasAttribute($)?e.removeAttribute($):e[$]=null}};const Ld=(e,t)=>(e.setAttribute("style",Rc(t)),e);const Od=(e,t,r)=>Q(r)?e.addEventListener(t,...r):e.addEventListener(t,r);const Pd=(e,t,r)=>Q(r)?e.removeEventListener(t,...r):e.removeEventListener(t,r);const Qd=(e,t)=>{const r=e.children[t];void 0!==r&&e.removeChild(r)};const Rd=(r,o=r=>void 0!==r?": "+r:"")=>class extends Error{constructor(e){super(r(e)+o(e))}};const Sd=Rd(()=>"illegal argument(s)");const Td=r=>{throw new Sd(r)};const Z=v,Vd=kc,Wd=sd,Xd=(e,r)=>{let $,i,t,n,a,o=e[0],l=Wd(e[1]);return"string"==typeof o&&($=ph.exec(o))||Td(`${o} is not a valid tag name`),o!==(i=$[1])||!l||r&&!e[1].key?(a=l?Object.assign({},e[1]):{},t=$[2],n=$[3],t&&(a.id=t),n&&(n=n.replace(/\./g," "),a.class?a.class+=" "+n:a.class=n),a.__skip&&e.length<3?[i,a]:[i,a,...e.slice(l?2:1)]):e};const Yd=(e,r)=>m(r,e,e.ctx,[0],!1!==e.keys,!1!==e.span);const m=(e,r,$,i,t,n)=>{if(null!=e){if(Z(e)){if(0===e.length)return;let a,o,l=e[1];if(l&&(o=l.__impl)&&(o=o.normalizeTree))return o(r,e);const s=e[0];if("function"==typeof s)return m(s.apply(null,[$,...e.slice(1)]),r,$,i,t,n);if("function"==typeof s.render){const o=[$,...e.slice(1)];return a=m(s.render.apply(s,o),r,$,i,t,n),Z(a)&&(a.__this=s,a.__init=s.init,a.__release=s.release,a.__args=o),a}if(!1===(l=(a=Xd(e,t))[1]).__normalize)return a;if(t&&void 0===l.key&&(l.key=i.join("-")),a.length>2){const e=a[0],o=[e,l];n=n&&!uh[e];for(let l=2,s=2,x=0,c=a.length;l<c;l++){let e=a[l];if(null!=e){const a=Z(e);if(a&&Z(e[0])||!a&&Vd(e))for(let l of e)void 0!==(l=m(l,r,$,i.concat(x),t,n))&&(o[s++]=l),x++;else void 0!==(e=m(e,r,$,i.concat(x),t,n))&&(o[s++]=e),x++}}return o}return a}return"function"==typeof e?m(e($),r,$,i,t,n):"function"==typeof e.toHiccup?m(e.toHiccup(r.ctx),r,$,i,t,n):"function"==typeof e.deref?m(e.deref(),r,$,i,t,n):n?["span",t?{key:i.join("-")}:{},e.toString()]:e.toString()}};const ce={createTree(e,t,r,$,i){return V(e,this,t,r,$,i)},hydrateTree(e,t,r,$){return W(e,this,t,r,$)},diffTree(e,t,r,$,i){Vb(e,this,t,r,$,i)},normalizeTree:Yd,getElementById:e=>document.getElementById(e),getChild:wd,createElement:od,createTextElement:qd,replaceChild(e,t,r,$,i){yd(e,this,t,r,$,i)},removeChild:Qd,setContent:zd,removeAttribs:Kd,setAttrib:Pb};const ee=(e,o)=>Zc(e)?o.getElementById(e):e;const ie=(e,r={},t=ce)=>{const a=Object.assign({root:"app"},r);let $=[],n=!0;const o=ee(a.root,t),i=()=>{if(n){a.ctx=Xc(r.ctx,a.autoDerefKeys);const f=t.normalizeTree(a,e);null!=f&&(a.hydrate?(t.hydrateTree(a,o,f),a.hydrate=!1):t.diffTree(a,o,$,f),$=f),n&&requestAnimationFrame(i)}};return requestAnimationFrame(i),()=>n=!1};var je,Nb;(function($){$[$.FINE=0]="FINE",$[$.DEBUG=1]="DEBUG",$[$.INFO=2]="INFO",$[$.WARN=3]="WARN",$[$.SEVERE=4]="SEVERE",$[$.NONE=5]="NONE"})(Nb||(je=Nb={},je));const te=Object.freeze({level:Nb.NONE,fine(){},debug(){},info(){},warn(){},severe(){}});const ue=(e,t={})=>{const o=Reflect.ownKeys(e),r=Reflect.ownKeys(t),n=Symbol("isa");function i(t){for(let r of o){const o=Object.getOwnPropertyDescriptor(t.prototype,r);!o||o.configurable?Object.defineProperty(t.prototype,r,{value:e[r],writable:!0}):console.log(`not patching: ${t.name}.${r.toString()}`)}return Object.defineProperty(t.prototype,n,{value:!0}),t}for(let p of r)Object.defineProperty(i,p,{value:t[p],enumerable:t.propertyIsEnumerable(p)});return Object.defineProperty(i,Symbol.hasInstance,{value:e=>!!e[n]}),i};const Fe=ue({addWatch(t,e){return this._watches=this._watches||{},!this._watches[t]&&(this._watches[t]=e,!0)},removeWatch(t){if(this._watches)return!!this._watches[t]&&(delete this._watches[t],!0)},notifyWatches(t,e){if(!this._watches)return;const i=this._watches;for(let h in i)i[h](h,t,e)}});const e="--set-value";const Je="--update-value";const F="--toggle-value";const Ca="--cancel";const Me="--dispatch";const Eb="--dispatch-async";const d="--dispatch-now";const Cb="--delay";const Te="--fetch";const f="--state";const We="--redo";const Xe="--undo";let p=te;const Ab=(r,o=r=>void 0!==r?": "+r:"")=>class extends Error{constructor(s){super(r(s)+o(s))}};const ff=Ab(()=>"illegal argument(s)");const gf=r=>{throw new ff(r)};const hf=Ab(()=>"illegal state");const jf=r=>{throw new hf(r)};const yb=Array.isArray;const pf=t=>"string"==typeof t;const rf=r=>r&&(r instanceof Float32Array||r instanceof Float64Array||r instanceof Uint32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Int8Array||r instanceof Uint16Array||r instanceof Int16Array||r instanceof Uint8ClampedArray);const rb=t=>yb(t)?t:pf(t)?t.length>0?t.split("."):[]:null!=t?[t]:[];function qb(e){const t=rb(e),[r,l,n,$]=t;switch(t.length){case 0:return e=>e;case 1:return e=>null!=e?e[r]:void 0;case 2:return e=>null!=e&&null!=(e=e[r])?e[l]:void 0;case 3:return e=>null!=e&&null!=(e=e[r])&&null!=(e=e[l])?e[n]:void 0;case 4:return e=>null!=e&&null!=(e=e[r])&&null!=(e=e[l])&&null!=(e=e[n])?e[$]:void 0;default:return e=>{const r=t.length-1;let l=e;for(let n=0;null!=l&&n<=r;n++)l=l[t[n]];return l};}}const Bf=$=>L($);function L($){const e=rb($),[t,r,o,p]=e;switch(e.length){case 0:return($,e)=>e;case 1:return($,e)=>($=h($),$[t]=e,$);case 2:return($,e)=>{let o;return($=h($))[t]=o=h($[t]),o[r]=e,$};case 3:return($,e)=>{let p,c;return($=h($))[t]=p=h($[t]),p[r]=c=h(p[r]),c[o]=e,$};case 4:return($,e)=>{let c,C,G;return($=h($))[t]=c=h($[t]),c[r]=C=h(c[r]),C[o]=G=h(C[o]),G[p]=e,$};default:let $;for(let t=e.length;--t>=0;)$=Hf(e[t],$);return $;}}const h=$=>yb($)||rf($)?$.slice():Object.assign({},$);const Hf=($,e)=>(t,r)=>(t=h(t),t[$]=e?e(t[$],r):r,t);const N=(e,$,t,...r)=>Lf(e,$,t,...r);function Lf(e,$,t,...r){return L($)(e,t.apply(null,(r.unshift(qb($)(e)),r)))}const ia=(e,$,t)=>L($)(e,t);const Wf=(e,$)=>ag(e,$);function ag(e,$){const r=qb(e),t=L(e);return(e,...a)=>t(e,$.apply(null,(a.unshift(r(e)),a)))}let pb=class{constructor(e,t){t&&!t(e)&&jf("initial state value did not validate"),this._value=e,this.valid=t}get value(){return this._value}set value(e){this.reset(e)}deref(){return this._value}equiv(e){return this===e}reset(e){const t=this._value;return this.valid&&!this.valid(e)?t:(this._value=e,this.notifyWatches(t,e),e)}resetIn(e,t){return this.reset(ia(this._value,e,t))}resetInUnsafe(e,t){return this.reset(ia(this._value,e,t))}swap(e,...t){return this.reset(e.apply(null,[this._value,...t]))}swapIn(e,t,...r){return this.reset(N(this._value,e,t,...r))}swapInUnsafe(e,t,...r){return this.reset(N(this._value,e,t,...r))}addWatch(e,t){}removeWatch(e){}notifyWatches(e,t){}release(){return delete this._watches,delete this._value,!0}};pb=za([Fe],pb);const kb=o=>"function"==typeof o;const dg=(n,t)=>null!=n&&"function"==typeof n[t];const O=Array.isArray;const gg=i=>i instanceof Promise;class hg{constructor(t,e){this.handlers={},this.effects={},this.eventQueue=[],this.priorities=[],this.addBuiltIns(),t&&this.addHandlers(t),e&&this.addEffects(e)}addBuiltIns(){this.addEffects({[Me]:[t=>this.dispatch(t),-999],[Eb]:[([t,e,r,s],i,$)=>{const o=this.effects[t];if(o){const t=o(e,i,$);gg(t)?t.then(t=>this.dispatch([r,t])).catch(t=>this.dispatch([s,t])):p.warn("async effect did not return Promise")}else p.warn(`skipping invalid async effect: ${t}`)},-999],[Cb]:[([t,e])=>new Promise(r=>setTimeout(()=>r(e),t)),1e3],[Te]:[t=>fetch(t).then(t=>{if(!t.ok)throw new Error(t.statusText);return t}),1e3]})}addHandler(t,e){const r=this.interceptorsFromSpec(e);r.length>0?(this.handlers[t]&&(this.removeHandler(t),p.warn(`overriding handler for ID: ${t}`)),this.handlers[t]=r):gf(`no handlers in spec for ID: ${t}`)}addHandlers(t){for(let e in t)this.addHandler(e,t[e])}addEffect(t,e,r=1){this.effects[t]&&(this.removeEffect(t),p.warn(`overriding effect for ID: ${t}`)),this.effects[t]=e;const s=[t,r],i=this.priorities;for(let $=0;$<i.length;$++)if(s[1]<i[$][1])return void i.splice($,0,s);i.push(s)}addEffects(t){for(let e in t){const r=t[e];O(r)?this.addEffect(e,r[0],r[1]):this.addEffect(e,r)}}instrumentWith(t,e){const r=t.map(jb),s=this.handlers;for(let i of e||Object.keys(s)){const t=s[i];t&&(s[i]=r.concat(t))}}removeHandler(t){delete this.handlers[t]}removeHandlers(t){for(let e of t)this.removeHandler(e)}removeEffect(t){delete this.effects[t];const e=this.priorities;for(let r=e.length-1;r>=0;r--)if(t===e[r][0])return void e.splice(r,1)}removeEffects(t){for(let e of t)this.removeEffect(e)}context(){return this.currCtx}dispatch(...t){this.eventQueue.push(...t)}dispatchNow(...t){(this.currQueue||this.eventQueue).push(...t)}dispatchLater(t,e=17){setTimeout(()=>this.dispatch(t),e)}processQueue(t){if(this.eventQueue.length>0){this.currQueue=[...this.eventQueue],this.eventQueue.length=0,t=this.currCtx=t||{};for(let e of this.currQueue)this.processEvent(t,e);return this.currQueue=this.currCtx=void 0,this.processEffects(t),!0}return!1}processEvent(t,e){const r=this.handlers[e[0]];r?this.processForward(t,r,e)&&this.processReverse(t,r,e):p.warn(`missing handler for event type: ${e[0].toString()}`)}processForward(t,e,r){let s=!1;for(let i=0,$=e.length;i<$&&!t[Ca];i++){const $=e[i];$.pre&&this.mergeEffects(t,$.pre(t[f],r,this,t)),s=s||!!$.post}return s}processReverse(t,e,r){for(let s=e.length;--s>=0&&!t[Ca];){const i=e[s];i.post&&this.mergeEffects(t,i.post(t[f],r,this,t))}}processEffects(t){const e=this.effects;for(let r of this.priorities){const s=r[0],i=t[s];void 0!==i&&this.processEffect(t,e,s,i)}}processEffect(t,e,r,s){const i=e[r];if(r!==f)for(let $ of s)i($,this,t);else i(s,this,t)}mergeEffects(t,e){if(e)for(let r in e){const s=e[r];if(null!=s)if(r===f||r===Ca)t[r]=s;else if(r===d){if(O(s[0]))for(let t of s)t&&this.dispatchNow(t);else this.dispatchNow(s);}else if(t[r]||(t[r]=[]),O(s[0]))for(let e of s)void 0!==e&&t[r].push(e);else t[r].push(s)}}interceptorsFromSpec(t){return O(t)?t.map(jb):kb(t)?[{pre:t}]:[t]}}class ig extends hg{constructor(t,e,r){super(e,r),this.state=t||new pb({})}deref(){return this.state.deref()}addBuiltIns(){super.addBuiltIns(),this.addHandlers({[e]:(t,[e,[r,s]])=>({[f]:ia(t,r,s)}),[Je]:(t,[e,[r,s,...i]])=>({[f]:N(t,r,s,...i)}),[F]:(t,[e,r])=>({[f]:N(t,r,t=>!t)}),[Xe]:eb("undo"),[We]:eb("redo")}),this.addEffects({[f]:[t=>this.state.reset(t),-1e3]})}processQueue(t){if(this.eventQueue.length>0){const e=this.state.deref();this.currQueue=[...this.eventQueue],this.eventQueue.length=0,t=this.currCtx=Object.assign(Object.assign({},t),{[f]:e});for(let r of this.currQueue)this.processEvent(t,r);return this.currQueue=this.currCtx=void 0,this.processEffects(t),this.state.deref()!==e}return!1}}const jb=t=>kb(t)?{pre:t}:t,eb=t=>(e,[r,s],i,$)=>{const o=s?s[0]:"history";if(dg($[o],t)){const e=$[o][t]();return{[f]:i.state.deref(),[d]:s?void 0!==e?s[1]:s[2]:void 0}}p.warn("no history in context")};const ng=(e,$)=>{const t=Bf(e);return(e,[r,o])=>({[f]:t(e,$?$(o):o)})};const pg=(e,$)=>{const t=Wf(e,$);return(e,[$,...r])=>({[f]:t(e,...r)})};const w="route-changed";var rg=(Hc(),{});const Kh=Symbol();const tg=()=>{};const Jg="*";const pa=void 0===rg?(r,$="assertion failed")=>{if("function"==typeof r&&!r()||!r)throw new Error("function"==typeof $?$():$)}:tg;const Lg=(e,t={})=>{const o=Reflect.ownKeys(e),r=Reflect.ownKeys(t),n=Symbol("isa");function p(t){for(let r of o){const o=Object.getOwnPropertyDescriptor(t.prototype,r);!o||o.configurable?Object.defineProperty(t.prototype,r,{value:e[r],writable:!0}):console.log(`not patching: ${t.name}.${r.toString()}`)}return Object.defineProperty(t.prototype,n,{value:!0}),t}for(let i of r)Object.defineProperty(p,i,{value:t[i],enumerable:t.propertyIsEnumerable(i)});return Object.defineProperty(p,Symbol.hasInstance,{value:e=>!!e[n]}),p};const _a=(i,t)=>{if(i)for(let e,r=0,s=i.length;r<s;r++)if((e=i[r])[0].call(e[1],t),t.canceled)return};const Ng=Lg({addListener(i,t,e){let r=(this._listeners=this._listeners||{})[i];return!r&&(r=this._listeners[i]=[]),-1===this.__listener(r,t,e)&&(r.push([t,e]),!0)},removeListener(i,t,e){let r;if(!(r=this._listeners))return!1;const s=r[i];if(s){const n=this.__listener(s,t,e);if(-1!==n)return s.splice(n,1),!s.length&&delete r[i],!0}return!1},notify(i){let t;if(!(t=this._listeners))return!1;void 0===i.target&&(i.target=this),_a(t[i.id],i),_a(t[Jg],i)},__listener(i,t,e){let r=i.length;for(;--r>=0;){const s=i[r];if(s[0]===t&&s[1]===e)break}return r}});const ra=t=>"string"==typeof t;const Ya=Object.getPrototypeOf({}),s=(e,t)=>{let $;return e===t||(null==e?e==t:"function"==typeof e.equiv?e.equiv(t):null==t?e==t:"function"==typeof t.equiv?t.equiv(e):"string"!=typeof e&&"string"!=typeof t&&(null!=($=Object.getPrototypeOf(e))&&$!==Ya||null!=($=Object.getPrototypeOf(t))&&$!==Ya?"function"!=typeof e&&void 0!==e.length&&"function"!=typeof t&&void 0!==t.length?Tg(e,t):e instanceof Set&&t instanceof Set?Ug(e,t):e instanceof Map&&t instanceof Map?Vg(e,t):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:Xg(e,t)))};const Tg=(e,t,$=s)=>{let o=e.length;if(o===t.length)for(;--o>=0&&$(e[o],t[o]););return o<0};const Ug=(e,t,$=s)=>e.size===t.size&&$([...e.keys()].sort(),[...t.keys()].sort());const Vg=(e,t,$=s)=>e.size===t.size&&$([...e].sort(),[...t].sort());const Xg=(e,t,$=s)=>{if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let o in e)if(!t.hasOwnProperty(o)||!$(e[o],t[o]))return!1;return!0};const Xa=(r,e=r=>void 0!==r?": "+r:"")=>class extends Error{constructor(o){super(r(o)+e(o))}};const Zg=Xa(()=>"illegal argument(s)");const $g=r=>{throw new Zg(r)};const _g=Xa(()=>"illegal arity");const Wa=r=>{throw new _g(r)};let Va=class{constructor(t){if(t.authenticator=t.authenticator||((t,i,r)=>({id:t.id,title:t.title,params:r})),t.prefix=void 0===t.prefix?"/":t.prefix,t.separator=t.separator||"/",this.config=t,pa(void 0!==this.routeForID(this.config.defaultRouteID),`missing config for default route: '${this.config.defaultRouteID}'`),t.initialRouteID){const i=this.routeForID(t.initialRouteID);pa(void 0!==i,`missing config for initial route: ${this.config.initialRouteID}`),pa(!dh(i),"initial route MUST not be parametric")}}addListener(t,i,r){}removeListener(t,i,r){}notify(t){}start(){if(this.config.initialRouteID){const t=this.routeForID(this.config.initialRouteID);this.current={id:t.id,title:t.title,params:{}},this.notify({id:w,value:this.current})}}route(t){"#"===t.charAt(0)&&(t=t.substr(1)),t=t.substr(this.config.prefix.length);const i=this.config.routes,r=t.split(this.config.separator);let e;for(let o=0,a=i.length;o<a;o++){const t=i[o],a=this.matchRoute(r,t);if(a){e=a;break}}if(!e){if(!this.handleRouteFailure())return;const t=this.routeForID(this.config.defaultRouteID);e={id:t.id,title:t.title,params:{}}}return s(e,this.current)||(this.current=e,this.notify({id:w,value:e})),e}format(...t){let i,[r,e,o]=t;switch(t.length){case 3:i={id:r,params:e};break;case 2:ra(r)?i={id:r,params:e}:(o=e,i=r);break;case 1:i=ra(r)?{id:r}:r;break;default:Wa(t.length);}const a=this.routeForID(i.id);if(a){const t=i.params||{};return(o?"#":"")+this.config.prefix+a.match.map(i=>"?"===i.charAt(0)?null!=(i=t[i.substr(1)])?i:"NULL":i).join(this.config.separator)}$g(`invalid route ID: ${i.id}`)}routeForID(t){return this.config.routes.find(i=>i.id===t)}matchRoute(t,i){const r=i.match,e=r.length;if(t.length===e){const o={};for(let i=0;i<e;i++){const e=r[i];if("?"===e.charAt(0))o[e.substr(1)]=t[i];else if(t[i]!==e)return}if(i.validate&&!this.validateRouteParams(o,i.validate))return;return i.auth?this.config.authenticator(i,t,o):{id:i.id,title:i.title,params:o}}}validateRouteParams(t,i){for(let r in i)if(void 0!==t[r]){const e=i[r];if(e.coerce&&(t[r]=e.coerce(t[r])),e.check&&!e.check(t[r]))return!1}return!0}handleRouteFailure(){return!0}};Va=za([Ng],Va);const dh=t=>t.match.some(t=>"?"===t.charAt(0));class eh extends Va{constructor(t){super(t),this.useFragment=!1!==t.useFragment,this.ignoreHashChange=!1}start(){if(window.addEventListener("popstate",this.handlePopChange()),this.useFragment&&window.addEventListener("hashchange",this.handleHashChange()),this.config.initialRouteID){const t=this.routeForID(this.config.initialRouteID);this.route(this.format({id:t.id,title:t.title}))}else this.route(this.useFragment?location.hash:location.pathname)}release(){window.removeEventListener("popstate",this.popHandler),this.useFragment&&window.removeEventListener("hashchange",this.hashHandler)}route(t,e=!0){const i=this.current,r=super.route(t);return r&&!s(r,i)&&(this.currentPath=this.format(r),e&&history.pushState(this.currentPath,r.title||window.document.title||"",this.currentPath)),r}routeTo(t){this.useFragment&&(location.hash=t),this.route(t)}format(...t){let e;switch(t.length){case 2:e={id:t[0],params:t[1]};break;case 1:e=ra(t[0])?{id:t[0]}:t[0];break;default:Wa(t.length);}return super.format(e,this.useFragment)}handlePopChange(){return this.popHandler=this.popHandler||(t=>{this.route(t.state||(this.useFragment?location.hash:location.pathname),!1)}).bind(this)}handleHashChange(){return this.hashHandler=this.hashHandler||(t=>{if(!this.ignoreHashChange){const e=t.newURL.substr(t.newURL.indexOf("#"));e!==this.currentPath&&this.route(e,!1)}}).bind(this)}handleRouteFailure(){return this.ignoreHashChange=!0,location.hash=this.format({id:this.routeForID(this.config.defaultRouteID).id}),this.ignoreHashChange=!1,!0}}const gh=([o,p,$],t)=>["option",{value:o,disabled:!!$,selected:o===t},p];const jh=(o,p,$,t)=>["select",p,...$.map(o=>gh(o,t))];function*lh($,r){const e=u($)(k()),t=e[1],s=e[2];for(let i of r){const $=s([],i);if(n($))return void(yield*Y(t($.deref())));$.length&&(yield*$)}yield*Y(t([]))}function*xa($,r){const e=u($)([Ua,Ua,($,r)=>r])[2];for(let t of r){let $=e(ya,t);if(n($))return void(($=Y($.deref()))!==ya&&(yield $));$!==ya&&(yield $)}}const ya=Symbol();const Ua=()=>{};const u=r=>va(r,"xform")?r.xform():r;class t{constructor(e){this.value=e}deref(){return this.value}}const yh=e=>new t(e);const n=e=>e instanceof t;const Mc=e=>e instanceof t?e:new t(e);const Y=e=>e instanceof t?e.deref():e;function k($){return $?[...$]:Wc(()=>[],($,r)=>($.push(r),$))}const Pc=(r,e=r=>void 0!==r?": "+r:"")=>class extends Error{constructor(o){super(r(o)+e(o))}};const Qc=Pc(()=>"illegal arity");const Sa=r=>{throw new Qc(r)};const Sc=e=>2===e.length?[void 0,e[1]]:3===e.length?[e[1],e[2]]:Sa(e.length);function Tc(...e){const r=e[0],$=r[0],u=r[1],t=r[2],c=null==(e=Sc(e))[0]?$():e[0],o=e[1];return Y(u(va(o,"$reduce")?o.$reduce(t,c):Yc(o)?Uc(t,c,o):Vc(t,c,o)))}const Uc=(e,r,$)=>{for(let u=0,t=$.length;u<t;u++)if(r=e(r,$[u]),n(r)){r=r.deref();break}return r},Vc=(e,r,$)=>{for(let u of $)if(r=e(r,u),n(r)){r=r.deref();break}return r},Wc=(e,r)=>[e,e=>e,r];const Ra=($,r,e=xa)=>{const t=r.length-1;return $c(r[t])?r.length>1?e($.apply(null,r.slice(0,t)),r[t]):e($(),r[0]):void 0};function j(...e){let r,$;switch(e.length){case 4:$=e[3],r=e[2];break;case 3:$=e[2];break;case 2:return a(r=>j(e[0],e[1],r));default:Sa(e.length);}return Tc(u(e[0])(e[1]),r,$)}function a(t,r){return r?xa(a(t),r):r=>{const $=r[2];return Ja(r,(r,e)=>$(r,t(e)))}}const Ja=($,o)=>[$[0],$[1],o];const _c=e=>{const{1:r,2:$}=u(e)(k());let t=!1;return e=>{if(!t){let p=$([],e);return(t=n(p))&&(p=r(p.deref())),1===p.length?p[0]:p.length>0?p:void 0}}};function Qa(...e){let[r,$,t,o,u,c,p,n,s,a]=e;switch(e.length){case 0:dd(0);case 1:return r;case 2:return(...e)=>r($(...e));case 3:return(...e)=>r($(t(...e)));case 4:return(...e)=>r($(t(o(...e))));case 5:return(...e)=>r($(t(o(u(...e)))));case 6:return(...e)=>r($(t(o(u(c(...e))))));case 7:return(...e)=>r($(t(o(u(c(p(...e)))))));case 8:return(...e)=>r($(t(o(u(c(p(n(...e))))))));case 9:return(...e)=>r($(t(o(u(c(p(n(s(...e)))))))));case 10:default:const G=(...e)=>r($(t(o(u(c(p(n(s(a(...e))))))))));return 10===e.length?G:Qa(G,...e.slice(10));}}const bd=(r,o=r=>void 0!==r?": "+r:"")=>class extends Error{constructor(e){super(r(e)+o(e))}};const cd=bd(()=>"illegal arity");const dd=r=>{throw new cd(r)};function ed(...e){const[r,t,n,u,s,a,c,$]=e;switch(e.length){case 1:return e=>[r(e)];case 2:return e=>[r(e),t(e)];case 3:return e=>[r(e),t(e),n(e)];case 4:return e=>[r(e),t(e),n(e),u(e)];case 5:return e=>[r(e),t(e),n(e),u(e),s(e)];case 6:return e=>[r(e),t(e),n(e),u(e),s(e),a(e)];case 7:return e=>[r(e),t(e),n(e),u(e),s(e),a(e),c(e)];case 8:return e=>[r(e),t(e),n(e),u(e),s(e),a(e),c(e),$(e)];default:return r=>{let t=new Array(e.length);for(let n=e.length;--n>=0;)t[n]=e[n](r);return t};}}function fd(e,t,r){return new gd(e,t,r)}class gd{constructor(e,t,r){void 0===e?(e=0,t=1/0):void 0===t&&(t=e,e=0),r=void 0===r?e<t?1:-1:r,this.from=e,this.to=t,this.step=r}*[Symbol.iterator](){const e=this.step,t=this.to;let r=this.from;if(e>0)for(;r<t;)yield r,r+=e;else if(e<0)for(;r>t;)yield r,r+=e}$reduce(e,t){const r=this.step;if(r>0)for(let o=this.from,$=this.to;o<$&&!n(t);o+=r)t=e(t,o);else for(let o=this.from,$=this.to;o>$&&!n(t);o+=r)t=e(t,o);return t}}function*hd(...o){const t=o.map(o=>o[Symbol.iterator]());for(;;){const o=[];for(let e of t){let t=e.next();if(t.done)return;o.push(t.value)}yield o}}function La(r,$){return $?xa(La(r),$):$=>{const e=$[2];return Ja($,($,t)=>r(t)?e($,t):$)}}const jd=(r,o=r=>void 0!==r?": "+r:"")=>class extends Error{constructor(e){super(r(e)+o(e))}};const kd=jd(()=>"illegal argument(s)");const ld=r=>{throw new kd(r)};const md=e=>((null==e||!e[Symbol.iterator])&&ld(`value is not iterable: ${e}`),e);const nd=r=>v(r)?r:[...md(r)];const Oa=1/4294967295;class pd{float(t=1){return this.int()*Oa*t}norm(t=1){return 2*(this.int()*Oa-.5)*t}minmax(t,$){return this.float()*($-t)+t}gaussian(t=10,$=-.5,r=1){let a=0,n=t;for(;n-->0;)a+=this.float(r);return a/t+$}}const Ma=Math.random;class rd extends pd{int(){return 4294967295*Ma()>>>0}float($=1){return Ma()*$}norm($=1){return 2*(Ma()-.5)*$}}const Mb=new rd;var Bh=(Hc(),{});const Jh=Symbol();const vd=()=>{};const Pa=void 0===Bh?(r,$="assertion failed")=>{if("function"==typeof r&&!r()||!r)throw new Error("function"==typeof $?$():$)}:vd;const xd=(e,t,r=Mb)=>{const $=e.length;Pa($>0,"no choices given");const o=e.map(t?(e,r)=>[e,t[r]]:e=>[e,1]).sort((e,t)=>t[1]-e[1]),m=o.reduce((e,t)=>e+t[1],0);return Pa(m>0,"no choices given"),()=>{const e=r.float(m);let t=m;for(let r=0;r<$;r++)if((t-=o[r][1])<=e)return o[r][0]}};function aa(...e){return e=e.map(u),Qa.apply(null,e)}function _(e,r){return r?lh(_(e),r):r=>{const $=r[2];let g=e;return Ja(r,(e,r)=>--g>0?$(e,r):0===g?Mc($(e,r)):yh(e))}}function Ad(...$){return a(ed.apply(null,$.map(_c)))}function Fa(...$){const e=Ra(Fa,$);if(e)return e;const[r,p]=$,t=Object.keys(r);return aa(Ad.apply(null,t.map($=>r[$])),Ta(t,p))}function Ta(...r){const $=r.length>2&&Ra(Ta,r);if($)return $;let e=r[0];if(v(e)&&(e=e.reduce((r,$,e)=>(r[$]=e,r),{})),r[1]){const $=Object.keys(e);return a(t=>j(aa(a(r=>[r,t[e[r]]]),La(r=>void 0!==r[1])),r[1],$))}return a(Dd(e))}const Dd=e=>{const r=Object.keys(e),[t,n,o]=r,[s,c,$]=r.map(r=>e[r]);switch(r.length){case 3:return e=>{const r={};let a;return void 0!==(a=e[$])&&(r[o]=a),void 0!==(a=e[c])&&(r[n]=a),void 0!==(a=e[s])&&(r[t]=a),r};case 2:return e=>{const r={};let o;return void 0!==(o=e[c])&&(r[n]=o),void 0!==(o=e[s])&&(r[t]=o),r};case 1:return e=>{const r={};let n=e[s];return void 0!==n&&(r[t]=n),r};default:return t=>{let n,o;const s={};for(let c=r.length-1;c>=0;c--)n=r[c],void 0!==(o=t[e[n]])&&(s[n]=o);return s};}};function*Ed(e,$=1/0){for(;$-->0;)yield e()}const Lc=($,e,r=Mb)=>Ed(e?xd(nd($),e,r):()=>$[0|r.float($.length)]);function*Gd(e,o=1/0){for(;o-->0;)yield e}const Hd=t=>{const e=Object.assign({element:"h1",attribs:{},subElement:"small",subAttribs:{}},t);return(t,s,r)=>[e.element,e.attribs,s,r?[e.subElement,e.subAttribs,r]:void 0]};const Id={anim:100,pad:1,margin:0,vertical:!1,bgOn:{fill:"#000"},bgOff:{fill:"#999"},fgOn:{fill:"#fff"},fgOff:{fill:"#fff"}};const Jd=(s={})=>{const t=Object.assign(Object.assign({w:10,h:10},Id),s),{w:e,h:i,pad:g,margin:a,vertical:n}=t,c=2*a,b=g+a,O=n?e+2*g:2*(e+g),f=n?2*(i+g):i+2*g,r={width:O+c,height:f+c},l={transition:`all ${t.anim}ms ease-out`},$=Object.assign(Object.assign({},t.bgOn),{width:O,height:f,x:a,y:a}),j=Object.assign(Object.assign({},$),t.bgOff),o=Object.assign(Object.assign(Object.assign({},n?{x:b,y:b}:{x:O+a-g-e,y:b}),t.fgOn),{style:l,width:e,height:i}),h=Object.assign(Object.assign(Object.assign({},o),n?{y:f+a-g-i}:{x:b}),t.fgOff);return(s,t,e)=>["svg",Object.assign(Object.assign({},r),t),["rect",e?$:j],["rect",e?o:h]]};var wa,y={};!function(e){function t(){if(t.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");(t.prototype._singleton=this)._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._nrpnBuffer=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],this._nrpnEventsEnabled=!0,this._nrpnTypes=["entry","increment","decrement"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,nrpn:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_NRPN_MESSAGES:{value:{entrymsb:6,entrylsb:38,increment:96,decrement:97,paramlsb:98,parammsb:99,nullactiveparameter:127},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1},octaveOffset:{value:0,writable:!0,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return void 0!==this.interface}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this.interface||!this.interface.sysexEnabled)}.bind(this)},nrpnEventsEnabled:{enumerable:!0,get:function(){return!!this._nrpnEventsEnabled}.bind(this),set:function(e){return this._nrpnEventsEnabled=e,this._nrpnEventsEnabled}},nrpnTypes:{enumerable:!0,get:function(){return this._nrpnTypes}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}var n=new t;function r(e){var t=this;this._userHandlers={channel:{},system:{}},this._midiInput=e,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return t._midiInput.connection}},id:{enumerable:!0,get:function(){return t._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return t._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return t._midiInput.name}},state:{enumerable:!0,get:function(){return t._midiInput.state}},type:{enumerable:!0,get:function(){return t._midiInput.type}}}),this._initializeUserHandlers(),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}function i(e){var t=this;this._midiOutput=e,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return t._midiOutput.connection}},id:{enumerable:!0,get:function(){return t._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return t._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return t._midiOutput.name}},state:{enumerable:!0,get:function(){return t._midiOutput.state}},type:{enumerable:!0,get:function(){return t._midiOutput.type}}})}t.prototype.enable=function(e,t){this.enabled||(this.supported?navigator.requestMIDIAccess({sysex:t}).then(function(t){var n,r=[],i=[];this.interface=t,this._resetInterfaceUserHandlers(),this.interface.onstatechange=function(e){r.push(e)};for(var o=t.inputs.values(),a=o.next();a&&!a.done;a=o.next())i.push(a.value.open());for(var s=t.outputs.values(),u=s.next();u&&!u.done;u=s.next())i.push(u.value.open());function h(){clearTimeout(n),this._updateInputsAndOutputs(),this.interface.onstatechange=this._onInterfaceStateChange.bind(this),"function"==typeof e&&e.call(this),r.forEach(function(e){this._onInterfaceStateChange(e)}.bind(this))}n=setTimeout(h.bind(this),200),Promise&&Promise.all(i).catch(function(e){}).then(h.bind(this))}.bind(this),function(t){"function"==typeof e&&e.call(this,t)}.bind(this)):"function"==typeof e&&e(new Error("The Web MIDI API is not supported by your browser.")))},t.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this.interface&&(this.interface.onstatechange=void 0),this.interface=void 0,this._inputs=[],this._outputs=[],this._nrpnEventsEnabled=!0,this._resetInterfaceUserHandlers()},t.prototype.addListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if("function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(e)))throw new TypeError("The specified event type is not supported.");return this._userHandlers[e].push(t),this},t.prototype.hasListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if("function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(e)))throw new TypeError("The specified event type is not supported.");for(var n=0;n<this._userHandlers[e].length;n++)if(this._userHandlers[e][n]===t)return!0;return!1},t.prototype.removeListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(void 0!==t&&"function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(0<=this._midiInterfaceEvents.indexOf(e)){if(t)for(var n=0;n<this._userHandlers[e].length;n++)this._userHandlers[e][n]===t&&this._userHandlers[e].splice(n,1);else this._userHandlers[e]=[];}else{if(void 0!==e)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},t.prototype.toMIDIChannels=function(e){var t;if("all"===e||void 0===e)t=["all"];else{if("none"===e)return[];t=Array.isArray(e)?e:[e]}return-1<t.indexOf("all")&&(t=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),t.map(function(e){return parseInt(e)}).filter(function(e){return 1<=e&&e<=16})},t.prototype.getInputById=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");e=String(e);for(var t=0;t<this.inputs.length;t++)if(this.inputs[t].id===e)return this.inputs[t];return!1},t.prototype.getOutputById=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");e=String(e);for(var t=0;t<this.outputs.length;t++)if(this.outputs[t].id===e)return this.outputs[t];return!1},t.prototype.getInputByName=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.inputs.length;t++)if(~this.inputs[t].name.indexOf(e))return this.inputs[t];return!1},t.prototype.getOctave=function(e){if(null!=e&&0<=e&&e<=127)return Math.floor(Math.floor(e)/12-1)+Math.floor(n.octaveOffset)},t.prototype.getOutputByName=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.outputs.length;t++)if(~this.outputs[t].name.indexOf(e))return this.outputs[t];return!1},t.prototype.guessNoteNumber=function(e){var t=!1;if(e&&e.toFixed&&0<=e&&e<=127?t=Math.round(e):0<=parseInt(e)&&parseInt(e)<=127?t=parseInt(e):("string"==typeof e||e instanceof String)&&(t=this.noteNameToNumber(e)),!1===t)throw new Error("Invalid input value ("+e+").");return t},t.prototype.noteNameToNumber=function(e){"string"!=typeof e&&(e="");var t=e.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!t)throw new RangeError("Invalid note name.");var r=n._semitones[t[1].toUpperCase()],i=12*(parseInt(t[3])+1-Math.floor(n.octaveOffset))+r;if(-1<t[2].toLowerCase().indexOf("b")?i-=t[2].length:-1<t[2].toLowerCase().indexOf("#")&&(i+=t[2].length),i<0||127<i)throw new RangeError("Invalid note name or note outside valid range.");return i},t.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},t.prototype._updateInputs=function(){for(var e=0;e<this._inputs.length;e++){for(var t=!0,n=this.interface.inputs.values(),i=n.next();i&&!i.done;i=n.next())if(this._inputs[e]._midiInput===i.value){t=!1;break}t&&this._inputs.splice(e,1)}this.interface&&this.interface.inputs.forEach(function(e){for(var t=!0,n=0;n<this._inputs.length;n++)this._inputs[n]._midiInput===e&&(t=!1);t&&this._inputs.push(new r(e))}.bind(this))},t.prototype._updateOutputs=function(){for(var e=0;e<this._outputs.length;e++){for(var t=!0,n=this.interface.outputs.values(),r=n.next();r&&!r.done;r=n.next())if(this._outputs[e]._midiOutput===r.value){t=!1;break}t&&this._outputs.splice(e,1)}this.interface&&this.interface.outputs.forEach(function(e){for(var t=!0,n=0;n<this._outputs.length;n++)this._outputs[n]._midiOutput===e&&(t=!1);t&&this._outputs.push(new i(e))}.bind(this))},t.prototype._onInterfaceStateChange=function(e){this._updateInputsAndOutputs();var t={timestamp:e.timeStamp,type:e.port.state};this.interface&&"connected"===e.port.state?"output"===e.port.type?t.port=this.getOutputById(e.port.id):"input"===e.port.type&&(t.port=this.getInputById(e.port.id)):t.port={connection:"closed",id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this._userHandlers[e.port.state].forEach(function(e){e(t)})},t.prototype._resetInterfaceUserHandlers=function(){for(var e=0;e<this._midiInterfaceEvents.length;e++)this._userHandlers[this._midiInterfaceEvents[e]]=[]},r.prototype.on=r.prototype.addListener=function(e,t,r){var i=this;if(void 0===t&&(t="all"),Array.isArray(t)||(t=[t]),t.forEach(function(e){if("all"!==e&&!(1<=e&&e<=16))throw new RangeError("The 'channel' parameter is invalid.")}),"function"!=typeof r)throw new TypeError("The 'listener' parameter must be a function.");if(void 0!==n.MIDI_SYSTEM_MESSAGES[e])this._userHandlers.system[e]||(this._userHandlers.system[e]=[]),this._userHandlers.system[e].push(r);else{if(void 0===n.MIDI_CHANNEL_MESSAGES[e])throw new TypeError("The specified event type is not supported.");if(-1<t.indexOf("all")){t=[];for(var o=1;o<=16;o++)t.push(o)}this._userHandlers.channel[e]||(this._userHandlers.channel[e]=[]),t.forEach(function(t){i._userHandlers.channel[e][t]||(i._userHandlers.channel[e][t]=[]),i._userHandlers.channel[e][t].push(r)})}return this},r.prototype.hasListener=function(e,t,r){var i=this;if("function"!=typeof r)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===t&&(t="all"),t.constructor!==Array&&(t=[t]),void 0!==n.MIDI_SYSTEM_MESSAGES[e]){for(var o=0;o<this._userHandlers.system[e].length;o++)if(this._userHandlers.system[e][o]===r)return!0}else if(void 0!==n.MIDI_CHANNEL_MESSAGES[e]){if(-1<t.indexOf("all")){t=[];for(var a=1;a<=16;a++)t.push(a)}return!!this._userHandlers.channel[e]&&t.every(function(t){var n=i._userHandlers.channel[e][t];return n&&-1<n.indexOf(r)})}return!1},r.prototype.removeListener=function(e,t,r){var i=this;if(void 0!==r&&"function"!=typeof r)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===t&&(t="all"),t.constructor!==Array&&(t=[t]),void 0!==n.MIDI_SYSTEM_MESSAGES[e]){if(void 0===r)this._userHandlers.system[e]=[];else for(var o=0;o<this._userHandlers.system[e].length;o++)this._userHandlers.system[e][o]===r&&this._userHandlers.system[e].splice(o,1);}else if(void 0!==n.MIDI_CHANNEL_MESSAGES[e]){if(-1<t.indexOf("all")){t=[];for(var a=1;a<=16;a++)t.push(a)}if(!this._userHandlers.channel[e])return this;t.forEach(function(t){var n=i._userHandlers.channel[e][t];if(n)if(void 0===r)i._userHandlers.channel[e][t]=[];else for(var o=0;o<n.length;o++)n[o]===r&&n.splice(o,1)})}else{if(void 0!==e)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},r.prototype._initializeUserHandlers=function(){for(var e in n.MIDI_CHANNEL_MESSAGES)n.MIDI_CHANNEL_MESSAGES.hasOwnProperty(e)&&(this._userHandlers.channel[e]={});for(var t in n.MIDI_SYSTEM_MESSAGES)n.MIDI_SYSTEM_MESSAGES.hasOwnProperty(t)&&(this._userHandlers.system[t]=[])},r.prototype._onMidiMessage=function(e){if(0<this._userHandlers.system.midimessage.length){var t={target:this,data:e.data,timestamp:e.timeStamp,type:"midimessage"};this._userHandlers.system.midimessage.forEach(function(e){e(t)})}e.data[0]<240?(this._parseChannelEvent(e),this._parseNrpnEvent(e)):e.data[0]<=255&&this._parseSystemEvent(e)},r.prototype._parseNrpnEvent=function(e){var t,r,i=e.data[0]>>4,o=15&e.data[0],a=1+o;if(1<e.data.length&&(t=e.data[1],r=2<e.data.length?e.data[2]:void 0),n.nrpnEventsEnabled&&i===n.MIDI_CHANNEL_MESSAGES.controlchange&&(t>=n.MIDI_NRPN_MESSAGES.increment&&t<=n.MIDI_NRPN_MESSAGES.parammsb||t===n.MIDI_NRPN_MESSAGES.entrymsb||t===n.MIDI_NRPN_MESSAGES.entrylsb)){var s={target:this,type:"controlchange",data:e.data,timestamp:e.timeStamp,channel:a,controller:{number:t,name:this.getCcNameByNumber(t)},value:r};if(s.controller.number===n.MIDI_NRPN_MESSAGES.parammsb&&s.value!=n.MIDI_NRPN_MESSAGES.nullactiveparameter)n._nrpnBuffer[o]=[],n._nrpnBuffer[o][0]=s;else if(1===n._nrpnBuffer[o].length&&s.controller.number===n.MIDI_NRPN_MESSAGES.paramlsb)n._nrpnBuffer[o].push(s);else if(2!==n._nrpnBuffer[o].length||s.controller.number!==n.MIDI_NRPN_MESSAGES.increment&&s.controller.number!==n.MIDI_NRPN_MESSAGES.decrement&&s.controller.number!==n.MIDI_NRPN_MESSAGES.entrymsb){if(3===n._nrpnBuffer[o].length&&n._nrpnBuffer[o][2].number===n.MIDI_NRPN_MESSAGES.entrymsb&&s.controller.number===n.MIDI_NRPN_MESSAGES.entrylsb)n._nrpnBuffer[o].push(s);else if(3<=n._nrpnBuffer[o].length&&n._nrpnBuffer[o].length<=4&&s.controller.number===n.MIDI_NRPN_MESSAGES.parammsb&&s.value===n.MIDI_NRPN_MESSAGES.nullactiveparameter)n._nrpnBuffer[o].push(s);else if(4<=n._nrpnBuffer[o].length&&n._nrpnBuffer[o].length<=5&&s.controller.number===n.MIDI_NRPN_MESSAGES.paramlsb&&s.value===n.MIDI_NRPN_MESSAGES.nullactiveparameter){n._nrpnBuffer[o].push(s);var u=[];n._nrpnBuffer[o].forEach(function(e){u.push(e.data)});var h=n._nrpnBuffer[o][0].value<<7|n._nrpnBuffer[o][1].value,l=n._nrpnBuffer[o][2].value;6===n._nrpnBuffer[o].length&&(l=n._nrpnBuffer[o][2].value<<7|n._nrpnBuffer[o][3].value);var p="";switch(n._nrpnBuffer[o][2].controller.number){case n.MIDI_NRPN_MESSAGES.entrymsb:p=n._nrpnTypes[0];break;case n.MIDI_NRPN_MESSAGES.increment:p=n._nrpnTypes[1];break;case n.MIDI_NRPN_MESSAGES.decrement:p=n._nrpnTypes[2];break;default:throw new Error("The NPRN type was unidentifiable.");}var c={timestamp:s.timestamp,channel:s.channel,type:"nrpn",data:u,controller:{number:h,type:p,name:"Non-Registered Parameter "+h},value:l};n._nrpnBuffer[o]=[],this._userHandlers.channel[c.type]&&this._userHandlers.channel[c.type][c.channel]&&this._userHandlers.channel[c.type][c.channel].forEach(function(e){e(c)})}else n._nrpnBuffer[o]=[];}else n._nrpnBuffer[o].push(s)}},r.prototype._parseChannelEvent=function(e){var t,r,i=e.data[0]>>4,o=1+(15&e.data[0]);1<e.data.length&&(t=e.data[1],r=2<e.data.length?e.data[2]:void 0);var a={target:this,data:e.data,timestamp:e.timeStamp,channel:o};i===n.MIDI_CHANNEL_MESSAGES.noteoff||i===n.MIDI_CHANNEL_MESSAGES.noteon&&0===r?(a.type="noteoff",a.note={number:t,name:n._notes[t%12],octave:n.getOctave(t)},a.velocity=r/127,a.rawVelocity=r):i===n.MIDI_CHANNEL_MESSAGES.noteon?(a.type="noteon",a.note={number:t,name:n._notes[t%12],octave:n.getOctave(t)},a.velocity=r/127,a.rawVelocity=r):i===n.MIDI_CHANNEL_MESSAGES.keyaftertouch?(a.type="keyaftertouch",a.note={number:t,name:n._notes[t%12],octave:n.getOctave(t)},a.value=r/127):i===n.MIDI_CHANNEL_MESSAGES.controlchange&&0<=t&&t<=119?(a.type="controlchange",a.controller={number:t,name:this.getCcNameByNumber(t)},a.value=r):i===n.MIDI_CHANNEL_MESSAGES.channelmode&&120<=t&&t<=127?(a.type="channelmode",a.controller={number:t,name:this.getChannelModeByNumber(t)},a.value=r):i===n.MIDI_CHANNEL_MESSAGES.programchange?(a.type="programchange",a.value=t):i===n.MIDI_CHANNEL_MESSAGES.channelaftertouch?(a.type="channelaftertouch",a.value=t/127):i===n.MIDI_CHANNEL_MESSAGES.pitchbend?(a.type="pitchbend",a.value=((r<<7)+t-8192)/8192):a.type="unknownchannelmessage",this._userHandlers.channel[a.type]&&this._userHandlers.channel[a.type][o]&&this._userHandlers.channel[a.type][o].forEach(function(e){e(a)})},r.prototype.getCcNameByNumber=function(e){if(!(0<=(e=Math.floor(e))&&e<=119))throw new RangeError("The control change number must be between 0 and 119.");for(var t in n.MIDI_CONTROL_CHANGE_MESSAGES)if(n.MIDI_CONTROL_CHANGE_MESSAGES.hasOwnProperty(t)&&e===n.MIDI_CONTROL_CHANGE_MESSAGES[t])return t},r.prototype.getChannelModeByNumber=function(e){if(!(120<=(e=Math.floor(e))&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var t in n.MIDI_CHANNEL_MODE_MESSAGES)if(n.MIDI_CHANNEL_MODE_MESSAGES.hasOwnProperty(t)&&e===n.MIDI_CHANNEL_MODE_MESSAGES[t])return t},r.prototype._parseSystemEvent=function(e){var t=e.data[0],r={target:this,data:e.data,timestamp:e.timeStamp};t===n.MIDI_SYSTEM_MESSAGES.sysex?r.type="sysex":t===n.MIDI_SYSTEM_MESSAGES.timecode?r.type="timecode":t===n.MIDI_SYSTEM_MESSAGES.songposition?r.type="songposition":t===n.MIDI_SYSTEM_MESSAGES.songselect?(r.type="songselect",r.song=e.data[1]):t===n.MIDI_SYSTEM_MESSAGES.tuningrequest?r.type="tuningrequest":t===n.MIDI_SYSTEM_MESSAGES.clock?r.type="clock":t===n.MIDI_SYSTEM_MESSAGES.start?r.type="start":t===n.MIDI_SYSTEM_MESSAGES.continue?r.type="continue":t===n.MIDI_SYSTEM_MESSAGES.stop?r.type="stop":t===n.MIDI_SYSTEM_MESSAGES.activesensing?r.type="activesensing":t===n.MIDI_SYSTEM_MESSAGES.reset?r.type="reset":r.type="unknownsystemmessage",this._userHandlers.system[r.type]&&this._userHandlers.system[r.type].forEach(function(e){e(r)})},i.prototype.send=function(e,t,n){if(!(128<=e&&e<=255))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");void 0===t&&(t=[]),Array.isArray(t)||(t=[t]);var r=[];return t.forEach(function(e){var t=Math.floor(e);if(!(0<=t&&t<=255))throw new RangeError("Data bytes must be integers between 0 (0x00) and 255 (0xFF).");r.push(t)}),this._midiOutput.send([e].concat(r),parseFloat(n)||0),this},i.prototype.sendSysex=function(e,t,r){if(!n.sysexEnabled)throw new Error("Sysex message support must first be activated.");return r=r||{},e=[].concat(e),t.forEach(function(e){if(e<0||127<e)throw new RangeError("The data bytes of a sysex message must be integers between 0 (0x00) and 127 (0x7F).")}),t=e.concat(t,n.MIDI_SYSTEM_MESSAGES.sysexend),this.send(n.MIDI_SYSTEM_MESSAGES.sysex,t,this._parseTimeParameter(r.time)),this},i.prototype.sendTimecodeQuarterFrame=function(e,t){return t=t||{},this.send(n.MIDI_SYSTEM_MESSAGES.timecode,e,this._parseTimeParameter(t.time)),this},i.prototype.sendSongPosition=function(e,t){t=t||{};var r=(e=Math.floor(e)||0)>>7&127,i=127&e;return this.send(n.MIDI_SYSTEM_MESSAGES.songposition,[r,i],this._parseTimeParameter(t.time)),this},i.prototype.sendSongSelect=function(e,t){if(t=t||{},!(0<=(e=Math.floor(e))&&e<=127))throw new RangeError("The song number must be between 0 and 127.");return this.send(n.MIDI_SYSTEM_MESSAGES.songselect,[e],this._parseTimeParameter(t.time)),this},i.prototype.sendTuningRequest=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendClock=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendStart=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendContinue=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.continue,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendStop=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendActiveSensing=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.activesensing,[],this._parseTimeParameter(e.time)),this},i.prototype.sendReset=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(e.time)),this},i.prototype.stopNote=function(e,t,r){if("all"===e)return this.sendChannelMode("allnotesoff",0,t,r);var i=64;return(r=r||{}).rawVelocity?!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=127&&(i=r.velocity):!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=1&&(i=127*r.velocity),this._convertNoteToArray(e).forEach(function(e){n.toMIDIChannels(t).forEach(function(t){this.send((n.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(t-1),[e,Math.round(i)],this._parseTimeParameter(r.time))}.bind(this))}.bind(this)),this},i.prototype.playNote=function(e,t,r){var i,o=64;if((r=r||{}).rawVelocity?!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=127&&(o=r.velocity):!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=1&&(o=127*r.velocity),i=this._parseTimeParameter(r.time),this._convertNoteToArray(e).forEach(function(e){n.toMIDIChannels(t).forEach(function(t){this.send((n.MIDI_CHANNEL_MESSAGES.noteon<<4)+(t-1),[e,Math.round(o)],i)}.bind(this))}.bind(this)),!isNaN(r.duration)){r.duration<=0&&(r.duration=0);var a=64;r.rawVelocity?!isNaN(r.release)&&0<=r.release&&r.release<=127&&(a=r.release):!isNaN(r.release)&&0<=r.release&&r.release<=1&&(a=127*r.release),this._convertNoteToArray(e).forEach(function(e){n.toMIDIChannels(t).forEach(function(t){this.send((n.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(t-1),[e,Math.round(a)],(i||n.time)+r.duration)}.bind(this))}.bind(this))}return this},i.prototype.sendKeyAftertouch=function(e,t,r,i){var o=this;if(i=i||{},t<1||16<t)throw new RangeError("The channel must be between 1 and 16.");(isNaN(r)||r<0||1<r)&&(r=.5);var a=Math.round(127*r);return this._convertNoteToArray(e).forEach(function(e){n.toMIDIChannels(t).forEach(function(t){o.send((n.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(t-1),[e,a],o._parseTimeParameter(i.time))})}),this},i.prototype.sendControlChange=function(e,t,r,i){if(i=i||{},"string"==typeof e){if(void 0===(e=n.MIDI_CONTROL_CHANGE_MESSAGES[e]))throw new TypeError("Invalid controller name.")}else if(!(0<=(e=Math.floor(e))&&e<=119))throw new RangeError("Controller numbers must be between 0 and 119.");if(!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("Controller value must be between 0 and 127.");return n.toMIDIChannels(r).forEach(function(r){this.send((n.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(r-1),[e,t],this._parseTimeParameter(i.time))}.bind(this)),this},i.prototype._selectRegisteredParameter=function(e,t,r){var i=this;if(e[0]=Math.floor(e[0]),!(0<=e[0]&&e[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(e[1]=Math.floor(e[1]),!(0<=e[1]&&e[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return n.toMIDIChannels(t).forEach(function(){i.sendControlChange(101,e[0],t,{time:r}),i.sendControlChange(100,e[1],t,{time:r})}),this},i.prototype._selectNonRegisteredParameter=function(e,t,r){var i=this;if(e[0]=Math.floor(e[0]),!(0<=e[0]&&e[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(e[1]=Math.floor(e[1]),!(0<=e[1]&&e[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return n.toMIDIChannels(t).forEach(function(){i.sendControlChange(99,e[0],t,{time:r}),i.sendControlChange(98,e[1],t,{time:r})}),this},i.prototype._setCurrentRegisteredParameter=function(e,t,r){var i=this;if((e=[].concat(e))[0]=Math.floor(e[0]),!(0<=e[0]&&e[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return n.toMIDIChannels(t).forEach(function(){i.sendControlChange(6,e[0],t,{time:r})}),e[1]=Math.floor(e[1]),0<=e[1]&&e[1]<=127&&n.toMIDIChannels(t).forEach(function(){i.sendControlChange(38,e[1],t,{time:r})}),this},i.prototype._deselectRegisteredParameter=function(e,t){var r=this;return n.toMIDIChannels(e).forEach(function(){r.sendControlChange(101,127,e,{time:t}),r.sendControlChange(100,127,e,{time:t})}),this},i.prototype.setRegisteredParameter=function(e,t,r,i){var o=this;if(i=i||{},!Array.isArray(e)){if(!n.MIDI_REGISTERED_PARAMETER[e])throw new Error("The specified parameter is not available.");e=n.MIDI_REGISTERED_PARAMETER[e]}return n.toMIDIChannels(r).forEach(function(){o._selectRegisteredParameter(e,r,i.time),o._setCurrentRegisteredParameter(t,r,i.time),o._deselectRegisteredParameter(r,i.time)}),this},i.prototype.setNonRegisteredParameter=function(e,t,r,i){var o=this;if(i=i||{},!(0<=e[0]&&e[0]<=127&&0<=e[1]&&e[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return t=[].concat(t),n.toMIDIChannels(r).forEach(function(){o._selectNonRegisteredParameter(e,r,i.time),o._setCurrentRegisteredParameter(t,r,i.time),o._deselectRegisteredParameter(r,i.time)}),this},i.prototype.incrementRegisteredParameter=function(e,t,r){var i=this;if(r=r||{},!Array.isArray(e)){if(!n.MIDI_REGISTERED_PARAMETER[e])throw new Error("The specified parameter is not available.");e=n.MIDI_REGISTERED_PARAMETER[e]}return n.toMIDIChannels(t).forEach(function(){i._selectRegisteredParameter(e,t,r.time),i.sendControlChange(96,0,t,{time:r.time}),i._deselectRegisteredParameter(t,r.time)}),this},i.prototype.decrementRegisteredParameter=function(e,t,r){if(r=r||{},!Array.isArray(e)){if(!n.MIDI_REGISTERED_PARAMETER[e])throw new TypeError("The specified parameter is not available.");e=n.MIDI_REGISTERED_PARAMETER[e]}return n.toMIDIChannels(t).forEach(function(){this._selectRegisteredParameter(e,t,r.time),this.sendControlChange(97,0,t,{time:r.time}),this._deselectRegisteredParameter(t,r.time)}.bind(this)),this},i.prototype.setPitchBendRange=function(e,t,r,i){var o=this;if(i=i||{},!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The cents value must be between 0 and 127");return n.toMIDIChannels(r).forEach(function(){o.setRegisteredParameter("pitchbendrange",[e,t],r,{time:i.time})}),this},i.prototype.setModulationRange=function(e,t,r,i){var o=this;if(i=i||{},!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The cents value must be between 0 and 127");return n.toMIDIChannels(r).forEach(function(){o.setRegisteredParameter("modulationrange",[e,t],r,{time:i.time})}),this},i.prototype.setMasterTuning=function(e,t,r){var i=this;if(r=r||{},(e=parseFloat(e)||0)<=-65||64<=e)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var o=Math.floor(e)+64,a=e-Math.floor(e),s=(a=Math.round((a+1)/2*16383))>>7&127,u=127&a;return n.toMIDIChannels(t).forEach(function(){i.setRegisteredParameter("channelcoarsetuning",o,t,{time:r.time}),i.setRegisteredParameter("channelfinetuning",[s,u],t,{time:r.time})}),this},i.prototype.setTuningProgram=function(e,t,r){var i=this;if(r=r||{},!(0<=(e=Math.floor(e))&&e<=127))throw new RangeError("The program value must be between 0 and 127");return n.toMIDIChannels(t).forEach(function(){i.setRegisteredParameter("tuningprogram",e,t,{time:r.time})}),this},i.prototype.setTuningBank=function(e,t,r){var i=this;if(r=r||{},!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("The bank value must be between 0 and 127");return n.toMIDIChannels(t).forEach(function(){i.setRegisteredParameter("tuningbank",e,t,{time:r.time})}),this},i.prototype.sendChannelMode=function(e,t,r,i){if(i=i||{},"string"==typeof e){if(!(e=n.MIDI_CHANNEL_MODE_MESSAGES[e]))throw new TypeError("Invalid channel mode message name.")}else if(!(120<=(e=Math.floor(e))&&e<=127))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if((t=Math.floor(t)||0)<0||127<t)throw new RangeError("Value must be an integer between 0 and 127.");return n.toMIDIChannels(r).forEach(function(r){this.send((n.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(r-1),[e,t],this._parseTimeParameter(i.time))}.bind(this)),this},i.prototype.sendProgramChange=function(e,t,r){var i=this;if(r=r||{},e=Math.floor(e),isNaN(e)||e<0||127<e)throw new RangeError("Program numbers must be between 0 and 127.");return n.toMIDIChannels(t).forEach(function(t){i.send((n.MIDI_CHANNEL_MESSAGES.programchange<<4)+(t-1),[e],i._parseTimeParameter(r.time))}),this},i.prototype.sendChannelAftertouch=function(e,t,r){var i=this;r=r||{},e=parseFloat(e),(isNaN(e)||e<0||1<e)&&(e=.5);var o=Math.round(127*e);return n.toMIDIChannels(t).forEach(function(e){i.send((n.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(e-1),[o],i._parseTimeParameter(r.time))}),this},i.prototype.sendPitchBend=function(e,t,r){var i=this;if(r=r||{},isNaN(e)||e<-1||1<e)throw new RangeError("Pitch bend value must be between -1 and 1.");var o=Math.round((e+1)/2*16383),a=o>>7&127,s=127&o;return n.toMIDIChannels(t).forEach(function(e){i.send((n.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(e-1),[s,a],i._parseTimeParameter(r.time))}),this},i.prototype._parseTimeParameter=function(e){var t,r=parseFloat(e);return"string"==typeof e&&"+"===e.substring(0,1)?r&&0<r&&(t=n.time+r):r>n.time&&(t=r),t},i.prototype._convertNoteToArray=function(e){var t=[];return Array.isArray(e)||(e=[e]),e.forEach(function(e){t.push(n.guessNoteNumber(e))}),t},"function"==typeof wa&&"object"==typeof wa.amd?wa([],function(){return n}):y?y=n:e.WebMidi||(e.WebMidi=n)}(y);const Md="route-to";const Nd="toggle-debug";const T="toggle-key-state";const R="set-key-state";const Za="reset-key-state";const $a="set-random-key-state";const qa="set-highlights";const ab="reset-highlights";const bb="set-size";const cb="toggle-view-config";const db="set-midi-devices";const z="set-midi-file";const fb="set-midi-file-error";const Zd="set-comparison";const gb=e=>{var $iFCn$$interop$default=$(y);$iFCn$$interop$default.d.inputs.forEach(i=>i.addListener("noteon","all",$=>{e.dispatch([T,$.note.number%12]),console.log(`Received 'noteon' message (${$.note.name+$.note.octave}) from ${i.name}`)}))},_d=e=>{var $iFCn$$interop$default=$(y);$iFCn$$interop$default.d.enable(i=>{i?console.log("WebMidi could not be enabled.",i):(console.log("WebMidi enabled!"),e.dispatch([db,$iFCn$$interop$default.d.inputs.map(e=>e.name)]),gb(e))})};const ae=(e,i)=>{var $iFCn$$interop$default=$(y);$iFCn$$interop$default.d.inputs.forEach(e=>e.removeListener()),"All Devices"!==i?$iFCn$$interop$default.d.getInputByName(i).addListener("noteon","all",$=>{e.dispatch([T,$.note.number%12]),console.log(`Received 'noteon' message (${$.note.name+$.note.octave}) from ${i}`)}):gb(e)},be=e=>{const i=e.views,$=e.bus;return()=>{const e=i.enabledMidi.deref();let n=i.midiDevices.deref();return["div",e?["span.mid-gray.bg-washed-green.pa1","Web MIDI is available"]:["span.mid-gray.bg-washed-red.pa1","Web MIDI is unavailable"],["span.ml2",n.length>=1?[jh,{onchange:e=>ae($,e.target.value)},j(a(e=>[e,e]),k(),["All Devices",...n])]:[]]]}};const hb="route-to";class de{constructor(t){this.config=t,this.state=new sc(t.initialState||{}),this.ctx={bus:new ig(this.state,t.events,t.effects),views:{},ui:t.ui},this.addViews(this.config.views),this.router=new eh(t.router),this.router.addListener(w,t=>this.ctx.bus.dispatch([w,t.value])),this.ctx.bus.addHandlers({[w]:ng("route"),[Md]:(t,[e,i])=>({[hb]:i})}),this.ctx.bus.addEffect(hb,([t,e])=>this.router.routeTo(this.router.format(t,e))),this.addViews({route:"route",routeComponent:["route.id",t=>(this.config.components[t]||(()=>["div",`missing component for route: ${t}`]))(this.ctx)]})}addViews(t){const e=this.ctx.views;for(let i in t){const r=t[i];e[i]=v(r)?lc(this.state,r[0],r[1]):lc(this.state,r)}}start(){_d(this.ctx.bus),window.addEventListener("resize",()=>{this.ctx.bus.dispatch([bb])}),this.router.start(),ie(()=>{if(this.ctx.bus.processQueue())return this.rootComponent()},{root:this.config.domRoot,ctx:this.ctx})}rootComponent(){this.ctx.views.debug.deref(),this.ctx.ui;return["div",["div",this.ctx.views.routeComponent]]}}const ib=(t,n,$={})=>(o,s)=>["a",Object.assign(Object.assign({},$),{onclick:t,disabled:s}),n];const fe=t=>{const o=t.ui,$=ib(o=>{o.preventDefault(),t.bus.dispatch([Za])},"Clear",o.toolbar.button),r=ib(o=>{o.preventDefault(),t.bus.dispatch([$a])},"Random",o.toolbar.button);return()=>["div.mv4",[$],[r]]};const ge={anim:100,pad:1,margin:0,hlOn:{fill:"#E83015"},bgOn:{fill:"#CCCCCC"},bgOff:{fill:"#CCCCCC"},fgOn:{fill:"#E83015"},fgOff:{fill:"#fff"},floor:1},he=["filter",{id:"blur"},["feGaussianBlur",{in:"SourceGraphic",stdDeviation:".25"}]],ma=(s={})=>{const i=Object.assign(Object.assign({r:5},ge),s),{r:e,pad:t,margin:n,glyph:a,floor:g}=i,c=e*Math.pow(.5,2),l=e+t,O=l+n,r=2*l+2*n,f={width:r,height:r*g},b={transition:`all ${i.anim}ms ease-out`},o={cx:O,cy:O},$=Object.assign(Object.assign(Object.assign({},i.hlOn),o),{r:l}),j=Object.assign(Object.assign(Object.assign({},i.bgOn),o),{style:b,r:e}),C=Object.assign(Object.assign({},j),i.bgOff),E=Object.assign(Object.assign(Object.assign({},i.fgOn),o),{style:b,r:c}),G=Object.assign(Object.assign({},E),i.fgOff),h=Object.assign(Object.assign({},i.fgOn),{x:"50%",y:"50%","text-anchor":"middle","alignment-baseline":"central",font:"bold sans-serif","font-size":.5*r,style:b}),p=Object.assign(Object.assign({},h),i.fgOff);return(s,i,e,t)=>["svg",Object.assign(Object.assign({},f),i),he,["g",["circle",t?$:{}],["circle",e?j:C],a?["text",e?h:p,a]:["circle",e?E:G]]]};const ka={anim:0,r:16,pad:2},ke=Object.assign(Object.assign({},ka),{glyph:"C"}),le=Object.assign(Object.assign({},ka),{bgOn:{fill:"#000"},bgOff:{fill:"#000"},floor:2}),me=i=>{const t=i.views,$=t.size.deref(),e=Math.min(36,.9*$[0]/13),s={r:e/2*(8/9),pad:e/2*(1/9)},r=t.highlights.deref();return["div.mb4",...t.keyState.deref().map((t,$)=>[4===$?"div.dib.mr4":"div.dib",[0===$?ma(Object.assign(Object.assign({},ke),s)):[2,4,5,7,9,11].includes($)?ma(Object.assign(Object.assign({},ka),s)):ma(Object.assign(Object.assign({},le),s)),{class:"pointer mr0",onclick:t=>{t.preventDefault(),i.bus.dispatch([T,$])}},t,r.includes($)]])]};const ne=t=>t[Symbol.iterator]();function*oe(e,r){let t,$={},i=ne(e);for(;!(t=i.next()).done;){let e=r?r(t.value):t.value,i=JSON.stringify(e),o=$[i];o?o[1]++:$[i]=[e,1]}yield*Object.keys($).map(e=>$[e])}const lb=(n,t)=>null!=n&&"function"==typeof n[t];const qe=r=>null!=r&&"function"!=typeof r&&void 0!==r.length;const re=s=>s instanceof Map;const se=t=>t instanceof Set;class mb{constructor(e){this.value=e}deref(){return this.value}}const nb=e=>e instanceof mb;const ve=e=>e instanceof mb?e.deref():e;const we=(r,o=r=>void 0!==r?": "+r:"")=>class extends Error{constructor(e){super(r(e)+o(e))}};const xe=we(()=>"illegal arity");const ye=r=>{throw new xe(r)};const ze=e=>2===e.length?[void 0,e[1]]:3===e.length?[e[1],e[2]]:ye(e.length);function Ae(...e){const r=e[0],$=r[0],t=r[1],c=r[2],u=null==(e=ze(e))[0]?$():e[0],o=e[1];return ve(t(lb(o,"$reduce")?o.$reduce(c,u):qe(o)?Be(c,u,o):Ce(c,u,o)))}const Be=(e,r,$)=>{for(let t=0,c=$.length;t<c;t++)if(r=e(r,$[t]),nb(r)){r=r.deref();break}return r},Ce=(e,r,$)=>{for(let t of $)if(r=e(r,t),nb(r)){r=r.deref();break}return r};function De($,e){if(re($))for(let t of e)$.set(t[0],t[1]);else for(let t of e)$.add(t);return $}const Ee=(e,$)=>lb(e,"empty")?e.empty():new(e[Symbol.species]||$);const ob=e=>se(e)?e:new Set(e);const Ge=(e,$,r)=>r?Ae(e(),r):[()=>null,e=>e||new Set,(e,r)=>e?$(e,ob(r)):ob(r)];const ja=(e,t,r)=>{if(r=r||Ee(e,Set),e===t)return De(r,e);if(t.size<e.size)return ja(t,e,r);for(let $ of t)e.has($)&&r.add($);return r};function Ie(e){return Ge(Ie,ja,e)}function ea($){return"object"==typeof $&&"string"==typeof $.name}function da($){return"object"==typeof $&&"number"==typeof $.step&&"number"==typeof $.alt}const sb=[0,2,4,-1,1,3,5],tb=sb.map($=>Math.floor(7*$/12));function ub($){const{step:t,alt:e,oct:r,dir:o=1}=$,p=sb[t]+7*e;return void 0===r?[o*p]:[o*p,o*(r-tb[t]-4*e)]}const Oe=[3,0,4,1,5,2,6];function Pe($){const[t,e,r]=$,o=Oe[Qe(t)],p=Math.floor((t+1)/7);return void 0===e?{step:o,alt:p,dir:r}:{step:o,alt:p,oct:e+4*p+tb[o],dir:r}}function Qe($){const t=($+1)%7;return t<0?7+t:t}const vb={empty:!0,name:"",pc:"",acc:""},wb={},xb=($,t)=>Array(t+1).join($),Ue=$=>"CDEFGAB".charAt($),ca=$=>$<0?xb("b",-$):xb("#",$),zb=$=>"b"===$[0]?-$.length:$.length;function l($){return"string"==typeof $?wb[$]||(wb[$]=af($)):da($)?l(bf($)):ea($)?l($.name):vb}const Ye=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function Ze($){const t=Ye.exec($);return[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]}function $e($){return l(Pe($))}const Bb=[0,2,4,5,7,9,11];function af($){const t=Ze($);if(""===t[0]||""!==t[3])return vb;const e=t[0],r=t[1],o=t[2],p=(e.charCodeAt(0)+3)%7,u=zb(r),a=o.length?+o:void 0,n=ub({step:p,alt:u,oct:a}),c=e+r+o,z=e+r,V=(Bb[p]+u+120)%12,s=void 0===a?-100:a,i=Bb[p]+u+12*(s+1),l=i>=0&&i<=127?i:null;return{empty:!1,acc:r,alt:u,chroma:V,coord:n,freq:void 0===a?null:440*Math.pow(2,(i-69)/12),height:i,letter:e,midi:l,name:c,oct:a,pc:z,step:p}}function bf($){const{step:t,alt:e,oct:r}=$,o=Ue(t);if(!o)return"";const p=o+ca(e);return r||0===r?p+r:p}const Ga={empty:!0,name:"",acc:""},df=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$");function ef($){const t=df.exec(`${$}`);return null===t?["",""]:t[1]?[t[1],t[2]]:[t[4],t[3]]}const Db={};function G($){return"string"==typeof $?Db[$]||(Db[$]=kf($)):da($)?G(mf($)):ea($)?G($.name):Ga}const Fb=[0,2,4,5,7,9,11],Gb="PMMPPMM";function kf($){const t=ef($);if(""===t[0])return Ga;const e=+t[0],r=t[1],o=(Math.abs(e)-1)%7,p=Gb[o];if("M"===p&&"P"===r)return Ga;const u="M"===p?"majorable":"perfectable",a=""+e+r,n=e<0?-1:1,c=8===e||-8===e?e:n*(o+1),z=lf(u,r),V=Math.floor((Math.abs(e)-1)/7);return{empty:!1,name:a,num:e,q:r,step:o,alt:z,dir:n,type:u,simple:c,semitones:n*(Fb[o]+z+12*V),chroma:(n*(Fb[o]+z)%12+12)%12,coord:ub({step:o,alt:z,oct:V,dir:n}),oct:V}}function lf($,t){return"M"===t&&"majorable"===$||"P"===t&&"perfectable"===$?0:"m"===t&&"majorable"===$?-1:/^A+$/.test(t)?t.length:/^d+$/.test(t)?-1*("perfectable"===$?t.length:t.length+1):0}function mf($){const{step:t,alt:e,oct:r=0,dir:o}=$;return o?(o<0?"-":"")+(t+1+7*r)+of("M"===Gb[t]?"majorable":"perfectable",e):""}const Hb=($,t)=>Array(Math.abs(t)+1).join($);function of($,t){return 0===t?"majorable"===$?"M":"P":-1===t&&"majorable"===$?"m":t>0?Hb("A",t):Hb("d","perfectable"===$?t:t+1)}function Ib($,t){const e=l($),r=G(t);if(e.empty||r.empty)return"";const o=e.coord,p=r.coord;return $e(1===o.length?[o[0]+p[0]]:[o[0]+p[0],o[1]+p[1]]).name}function qf($){return+$>=0&&+$<=127}function Jb($){if(qf($))return+$;const o=l($);return o.empty?null:o.midi}const Ih=Math.log(2),Nh=Math.log(440);const uf="C C# D D# E F F# G G# A A# B".split(" "),vf="C Db D Eb E F Gb G Ab A Bb B".split(" ");function wf($,o={}){$=Math.round($);const r=(!0===o.sharps?uf:vf)[$%12];return o.pitchClass?r:r+(Math.floor($/12)-1)}const Kb=$=>o=>{const r=l(o);if(r.empty)return"";const t=$?r.alt>0:r.alt<0,v=null===r.midi;return wf(r.midi||r.chroma,{sharps:t,pitchClass:v})},yf=Kb(!0),Gh=Kb(!1);const Lb={empty:!0,name:"",chordType:""},Na={};function ba($){return"string"==typeof $?Na[$]||(Na[$]=Jf($)):"number"==typeof $?ba(sa[$]||""):da($)?Df($):ea($)?ba($.name):Lb}function Df($){return ba(ca($.alt)+sa[$.step])}const Ef=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/;function Ff($){return Ef.exec($)||["","","",""]}const Ob="I II III IV V VI VII",sa=Ob.split(" "),Fh=Ob.toLowerCase().split(" ");function Jf($){const[r,e,a,t]=Ff($);if(!a)return Lb;const o=a.toUpperCase(),R=sa.indexOf(o),n=zb(e);return{empty:!1,name:r,roman:a,interval:G({step:R,alt:n,dir:1}).name,acc:e,chordType:t,alt:n,step:R,major:a===o,oct:0,dir:1}}const Qb=t=>(i,a="")=>i.map((i,r)=>"-"!==i?t[r]+a+i:"");function X(t,i,a,r){return o=>{const $=t.split(" "),e=$.map(t=>ba(t).interval||""),n=e.map(t=>Ib(o,t)),m=Qb(n);return{tonic:o,grades:$,intervals:e,scale:n,chords:m(i.split(" ")),chordsHarmonicFunction:a.split(" "),chordScales:m(r.split(",")," ")}}}const Mf=(t,i)=>{const a=l(t),r=l(i);return a.empty||r.empty?0:r.coord[0]-a.coord[0]},Nf=X("I II III IV V VI VII","maj7 m7 m7 maj7 7 m7 m7b5","T SD T SD D T D","major,dorian,phrygian,lydian,mixolydian,minor,locrian"),Eh=X("I II bIII IV V bVI bVII","m7 m7b5 maj7 m7 m7 maj7 7","T SD T SD D SD SD","minor,locrian,major,dorian,phrygian,lydian,mixolydian"),Dh=X("I II bIII IV V bVI VII","mmaj7 m7b5 +maj7 m7 7 maj7 mo7","T SD T SD D SD D","harmonic minor,locrian 6,major augmented,lydian diminished,phrygian dominant,lydian #9,ultralocrian"),Hh=X("I II bIII IV V VI VII","m6 m7 +maj7 7 7 m7b5 m7b5","T SD T SD D - -","melodic minor,dorian b2,lydian augmented,lydian dominant,mixolydian b6,locrian #2,altered");function Rf(t){const i=Nf(t),a=Mf("C",t),r=Qb(i.scale);return{...i,type:"major",minorRelative:Ib(t,"-3m"),alteration:a,keySignature:ca(a),secondaryDominants:r("- VI7 VII7 I7 II7 III7 -".split(" ")),secondaryDominantsMinorRelative:r("- IIIm7b5 IV#m7 Vm7 VIm7 VIIm7b5 -".split(" ")),substituteDominants:r("- bIII7 IV7 bV7 bVI7 bVII7 -".split(" ")),substituteDominantsMinorRelative:r("- IIIm7 Im7 IIbm7 VIm7 IVm7 -".split(" "))}}var Sf={};function Tf(e){var r=new c(e),t=r.readChunk();if("MThd"!=t.id)throw"Bad MIDI file.  Expected 'MHdr', got: '"+t.id+"'";for(var a=Uf(t.data),n=[],s=0;!r.eof()&&s<a.numTracks;s++){var o=r.readChunk();if("MTrk"!=o.id)throw"Bad MIDI file.  Expected 'MTrk', got: '"+o.id+"'";var i=Vf(o.data);n.push(i)}return{header:a,tracks:n}}function Uf(e){var r=new c(e),t={format:r.readUInt16(),numTracks:r.readUInt16()},a=r.readUInt16();return 32768&a?(t.framesPerSecond=256-(a>>8),t.ticksPerFrame=255&a):t.ticksPerBeat=a,t}function Vf(e){for(var r,t=new c(e),a=[];!t.eof();){var n=s();a.push(n)}return a;function s(){var e={};e.deltaTime=t.readVarInt();var a=t.readUInt8();if(240==(240&a)){if(255!==a){if(240==a){e.type="sysEx";s=t.readVarInt();return e.data=t.readBytes(s),e}if(247==a){e.type="endSysEx";s=t.readVarInt();return e.data=t.readBytes(s),e}throw"Unrecognised MIDI event type byte: "+a}e.meta=!0;var n=t.readUInt8(),s=t.readVarInt();switch(n){case 0:if(e.type="sequenceNumber",2!==s)throw"Expected length for sequenceNumber event is 2, got "+s;return e.number=t.readUInt16(),e;case 1:return e.type="text",e.text=t.readString(s),e;case 2:return e.type="copyrightNotice",e.text=t.readString(s),e;case 3:return e.type="trackName",e.text=t.readString(s),e;case 4:return e.type="instrumentName",e.text=t.readString(s),e;case 5:return e.type="lyrics",e.text=t.readString(s),e;case 6:return e.type="marker",e.text=t.readString(s),e;case 7:return e.type="cuePoint",e.text=t.readString(s),e;case 32:if(e.type="channelPrefix",1!=s)throw"Expected length for channelPrefix event is 1, got "+s;return e.channel=t.readUInt8(),e;case 33:if(e.type="portPrefix",1!=s)throw"Expected length for portPrefix event is 1, got "+s;return e.port=t.readUInt8(),e;case 47:if(e.type="endOfTrack",0!=s)throw"Expected length for endOfTrack event is 0, got "+s;return e;case 81:if(e.type="setTempo",3!=s)throw"Expected length for setTempo event is 3, got "+s;return e.microsecondsPerBeat=t.readUInt24(),e;case 84:if(e.type="smpteOffset",5!=s)throw"Expected length for smpteOffset event is 5, got "+s;var o=t.readUInt8();return e.frameRate={0:24,32:25,64:29,96:30}[96&o],e.hour=31&o,e.min=t.readUInt8(),e.sec=t.readUInt8(),e.frame=t.readUInt8(),e.subFrame=t.readUInt8(),e;case 88:if(e.type="timeSignature",4!=s)throw"Expected length for timeSignature event is 4, got "+s;return e.numerator=t.readUInt8(),e.denominator=1<<t.readUInt8(),e.metronome=t.readUInt8(),e.thirtyseconds=t.readUInt8(),e;case 89:if(e.type="keySignature",2!=s)throw"Expected length for keySignature event is 2, got "+s;return e.key=t.readInt8(),e.scale=t.readUInt8(),e;case 127:return e.type="sequencerSpecific",e.data=t.readBytes(s),e;default:return e.type="unknownMeta",e.data=t.readBytes(s),e.metatypeByte=n,e;}}else{var i;if(0==(128&a)){if(null===r)throw"Running status byte encountered before status byte";i=a,a=r,e.running=!0}else i=t.readUInt8(),r=a;var d=a>>4;switch(e.channel=15&a,d){case 8:return e.type="noteOff",e.noteNumber=i,e.velocity=t.readUInt8(),e;case 9:var u=t.readUInt8();return e.type=0===u?"noteOff":"noteOn",e.noteNumber=i,e.velocity=u,0===u&&(e.byte9=!0),e;case 10:return e.type="noteAftertouch",e.noteNumber=i,e.amount=t.readUInt8(),e;case 11:return e.type="controller",e.controllerType=i,e.value=t.readUInt8(),e;case 12:return e.type="programChange",e.programNumber=i,e;case 13:return e.type="channelAftertouch",e.amount=i,e;case 14:return e.type="pitchBend",e.value=i+(t.readUInt8()<<7)-8192,e;default:throw"Unrecognised MIDI event type: "+d;}}}}function c(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}c.prototype.eof=function(){return this.pos>=this.bufferLen},c.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e},c.prototype.readInt8=function(){var e=this.readUInt8();return 128&e?e-256:e},c.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},c.prototype.readInt16=function(){var e=this.readUInt16();return 32768&e?e-65536:e},c.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},c.prototype.readInt24=function(){var e=this.readUInt24();return 8388608&e?e-16777216:e},c.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},c.prototype.readBytes=function(e){var r=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,r},c.prototype.readString=function(e){var r=this.readBytes(e);return String.fromCharCode.apply(null,r)},c.prototype.readVarInt=function(){for(var e=0;!this.eof();){var r=this.readUInt8();if(!(128&r))return e+r;e+=127&r,e<<=7}return e},c.prototype.readChunk=function(){var e=this.readString(4),r=this.readUInt32();return{id:e,length:r,data:this.readBytes(r)}},Sf=Tf;var Xf={};function Yf(t,e){if("object"!=typeof t)throw"Invalid MIDI data";e=e||{};var r,n=t.header||{},i=t.tracks||[],a=i.length,w=new b;for(Zf(w,n,a),r=0;r<a;r++)$f(w,i[r],e);return w.buffer}function Zf(t,e,r){var n=null==e.format?1:e.format,i=128;e.timeDivision?i=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?i=-(255&e.framesPerSecond)<<8|255&e.ticksPerFrame:e.ticksPerBeat&&(i=32767&e.ticksPerBeat);var a=new b;a.writeUInt16(n),a.writeUInt16(r),a.writeUInt16(i),t.writeChunk("MThd",a.buffer)}function $f(t,e,r){var n,i=new b,a=e.length,w=null;for(n=0;n<a;n++)!1!==r.running&&(r.running||e[n].running)||(w=null),w=_f(i,e[n],w,r.useByte9ForNoteOff);t.writeChunk("MTrk",i.buffer)}function _f(t,e,r,n){var i=e.type,a=e.deltaTime,w=e.text||"",I=e.data||[],o=null;switch(t.writeVarInt(a),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(w.length),t.writeString(w);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(w.length),t.writeString(w);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(w.length),t.writeString(w);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(w.length),t.writeString(w);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(w.length),t.writeString(w);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(w.length),t.writeString(w);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(w.length),t.writeString(w);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var U=31&e.hour|{24:0,25:32,29:64,30:96}[e.frameRate];t.writeUInt8(U),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var s=255&Math.floor(Math.log(e.denominator)/Math.LN2);t.writeUInt8(s),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(I.length),t.writeBytes(I);break;case"unknownMeta":null!=e.metatypeByte&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(I.length),t.writeBytes(I));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(I.length),t.writeBytes(I);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(I.length),t.writeBytes(I);break;case"noteOff":(o=(!1!==n&&e.byte9||n&&0==e.velocity?144:128)|e.channel)!==r&&t.writeUInt8(o),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":(o=144|e.channel)!==r&&t.writeUInt8(o),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":(o=160|e.channel)!==r&&t.writeUInt8(o),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":(o=176|e.channel)!==r&&t.writeUInt8(o),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":(o=192|e.channel)!==r&&t.writeUInt8(o),t.writeUInt8(e.programNumber);break;case"channelAftertouch":(o=208|e.channel)!==r&&t.writeUInt8(o),t.writeUInt8(e.amount);break;case"pitchBend":(o=224|e.channel)!==r&&t.writeUInt8(o);var c=8192+e.value,$=127&c,l=c>>7&127;t.writeUInt8($),t.writeUInt8(l);break;default:throw"Unrecognized event type: "+i;}return o}function b(){this.buffer=[]}b.prototype.writeUInt8=function(t){this.buffer.push(255&t)},b.prototype.writeInt8=b.prototype.writeUInt8,b.prototype.writeUInt16=function(t){var e=t>>8&255,r=255&t;this.writeUInt8(e),this.writeUInt8(r)},b.prototype.writeInt16=b.prototype.writeUInt16,b.prototype.writeUInt24=function(t){var e=t>>16&255,r=t>>8&255,n=255&t;this.writeUInt8(e),this.writeUInt8(r),this.writeUInt8(n)},b.prototype.writeInt24=b.prototype.writeUInt24,b.prototype.writeUInt32=function(t){var e=t>>24&255,r=t>>16&255,n=t>>8&255,i=255&t;this.writeUInt8(e),this.writeUInt8(r),this.writeUInt8(n),this.writeUInt8(i)},b.prototype.writeInt32=b.prototype.writeUInt32,b.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))},b.prototype.writeString=function(t){var e,r=t.length,n=[];for(e=0;e<r;e++)n.push(t.codePointAt(e));this.writeBytes(n)},b.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,r=[];for(r.push(127&e),e>>=7;e;){var n=127&e|128;r.push(n),e>>=7}this.writeBytes(r.reverse())}},b.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)},Xf=Yf;var Da={};function Wb(r,e,$){void 0===$&&($="ticks");var o=0,t=r.length,s=t;if(t>0&&r[t-1][$]<=e)return t-1;for(;o<s;){var a=Math.floor(o+(s-o)/2),i=r[a],n=r[a+1];if(i[$]===e){for(var v=a;v<r.length;v++){r[v][$]===e&&(a=v)}return a}if(i[$]<e&&n[$]>e)return a;i[$]>e?s=a:i[$]<e&&(o=a+1)}return-1}Object.defineProperty(Da,"__esModule",{value:!0});var J=Wb;function eg(r,e,$){if(void 0===$&&($="ticks"),r.length){var o=Wb(r,e[$],$);r.splice(o+1,0,e)}else r.push(e)}Da.search=J;var I=eg;Da.insert=I;var ua={};Object.defineProperty(ua,"__esModule",{value:!0});var E=new WeakMap,oa=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];ua.keySignatureKeys=oa;var jg=function(){function t(t){var e=this;this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",E.set(this,480),t&&(E.set(this,t.header.ticksPerBeat),t.tracks[0].forEach(function(t){t.meta&&("timeSignature"===t.type?e.timeSignatures.push({ticks:t.absoluteTime,timeSignature:[t.numerator,t.denominator]}):"setTempo"===t.type?e.tempos.push({bpm:6e7/t.microsecondsPerBeat,ticks:t.absoluteTime}):"keySignature"===t.type?e.keySignatures.push({key:oa[t.key+7],scale:0===t.scale?"major":"minor",ticks:t.absoluteTime}):"trackName"===t.type?e.name=t.text:"endOfTrack"!==t.type&&e.meta.push({text:t.text,ticks:t.absoluteTime,type:t.type}))}),this.update())}return t.prototype.update=function(){var t=this,e=0,i=0;this.tempos.sort(function(t,e){return t.ticks-e.ticks}),this.tempos.forEach(function(r,s){var a=s>0?t.tempos[s-1].bpm:t.tempos[0].bpm,n=r.ticks/t.ppq-i,p=60/a*n;r.time=p+e,e=r.time,i+=n}),this.timeSignatures.sort(function(t,e){return t.ticks-e.ticks}),this.timeSignatures.forEach(function(e,i){var r=i>0?t.timeSignatures[i-1]:t.timeSignatures[0],s=(e.ticks-r.ticks)/t.ppq/r.timeSignature[0]/(r.timeSignature[1]/4);r.measures=r.measures||0,e.measures=s+r.measures})},t.prototype.ticksToSeconds=function(t){var e=J(this.tempos,t);if(-1!==e){var i=this.tempos[e],r=i.time,s=(t-i.ticks)/this.ppq;return r+60/i.bpm*s}return .5*(t/this.ppq)},t.prototype.ticksToMeasures=function(t){var e=J(this.timeSignatures,t);if(-1!==e){var i=this.timeSignatures[e],r=(t-i.ticks)/this.ppq;return i.measures+r/(i.timeSignature[0]/i.timeSignature[1])/4}return t/this.ppq/4},Object.defineProperty(t.prototype,"ppq",{get:function(){return E.get(this)},enumerable:!0,configurable:!0}),t.prototype.secondsToTicks=function(t){var e=J(this.tempos,t,"time");if(-1!==e){var i=this.tempos[e],r=(t-i.time)/(60/i.bpm);return Math.round(i.ticks+r*this.ppq)}var s=t/.5;return Math.round(s*this.ppq)},t.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(t){return{bpm:t.bpm,ticks:t.ticks}}),timeSignatures:this.timeSignatures}},t.prototype.fromJSON=function(t){this.name=t.name,this.tempos=t.tempos.map(function(t){return Object.assign({},t)}),this.timeSignatures=t.timeSignatures.map(function(t){return Object.assign({},t)}),this.keySignatures=t.keySignatures.map(function(t){return Object.assign({},t)}),this.meta=t.meta.map(function(t){return Object.assign({},t)}),E.set(this,t.ppq),this.update()},t.prototype.setTempo=function(t){this.tempos=[{bpm:t,ticks:0}],this.update()},t}(),na=jg;ua.Header=na;var la={};function mg(r){if(!Array.isArray(r))throw new TypeError("Expected value to be an array");return cc(r)}function cc(r){return ec(r,[])}function og(r,t){if(!Array.isArray(r))throw new TypeError("Expected value to be an array");return dc(r,t)}function dc(r,t){if("number"!=typeof t)throw new TypeError("Expected the depth to be a number");return fc(r,[],t)}function ec(r,t){for(var e=0;e<r.length;e++){var $=r[e];Array.isArray($)?ec($,t):t.push($)}return t}function fc(r,t,e){e--;for(var $=0;$<r.length;$++){var a=r[$];e>-1&&Array.isArray(a)?fc(a,t,e):t.push(a)}return t}(la=mg).from=cc,la.depth=og,la.fromDepth=dc;var i={},Ha=i&&i.__spreadArrays||function(){for(var e=0,a=0,r=arguments.length;a<r;a++)e+=arguments[a].length;var t=Array(e),o=0;for(a=0;a<r;a++)for(var n=arguments[a],$=0,i=n.length;$<i;$++,o++)t[o]=n[$];return t},ug=i&&i.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0});var vg=ug(la);function wg(e,a){return[{absoluteTime:e.ticks,channel:a,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(127*e.velocity)},{absoluteTime:e.ticks+e.durationTicks,channel:a,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(127*e.noteOffVelocity)}]}function xg(e){return vg.default(e.notes.map(function(a){return wg(a,e.channel)}))}function yg(e,a){return{absoluteTime:e.ticks,channel:a,controllerType:e.number,deltaTime:0,type:"controller",value:e.value}}function zg(e){for(var a=[],r=0;r<127;r++)e.controlChanges.hasOwnProperty(r)&&e.controlChanges[r].forEach(function(r){a.push(yg(r,e.channel))});return a}function Ag(e,a){return{absoluteTime:e.ticks,channel:a,deltaTime:0,type:"pitchBend",value:e.value}}function Bg(e){var a=[];return e.pitchBends.forEach(function(r){a.push(Ag(r,e.channel))}),a}function Cg(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}function Dg(e){return{absoluteTime:0,deltaTime:0,meta:!0,text:e,type:"trackName"}}function Eg(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}function Fg(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function Gg(e){var a=oa.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:a+7,meta:!0,scale:"major"===e.scale?0:1,type:"keySignature"}}function Hg(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,text:e.text,type:e.type}}function Ig(e){var a={header:{format:1,numTracks:e.tracks.length+1,ticksPerBeat:e.header.ppq},tracks:Ha([Ha([{absoluteTime:0,deltaTime:0,meta:!0,text:e.header.name,type:"trackName"}],e.header.keySignatures.map(function(e){return Gg(e)}),e.header.meta.map(function(e){return Hg(e)}),e.header.tempos.map(function(e){return Eg(e)}),e.header.timeSignatures.map(function(e){return Fg(e)}))],e.tracks.map(function(e){return Ha([Dg(e.name),Cg(e)],xg(e),zg(e),Bg(e))}))};return a.tracks=a.tracks.map(function(e){e=e.sort(function(e,a){return e.absoluteTime-a.absoluteTime});var a=0;return e.forEach(function(e){e.deltaTime=e.absoluteTime-a,a=e.absoluteTime,delete e.absoluteTime}),e.push({deltaTime:0,meta:!0,type:"endOfTrack"}),e}),new Uint8Array(Xf(a))}var ic=Ig;i.encode=ic;var P={};Object.defineProperty(P,"__esModule",{value:!0});var C={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"};P.controlChangeNames=C;var D=Object.keys(C).reduce(function(e,t){return e[C[t]]=t,e},{});P.controlChangeIds=D;var ga=new WeakMap,nc=new WeakMap,Pg=function(){function e(e,t){ga.set(this,t),nc.set(this,e.controllerType),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(e.prototype,"number",{get:function(){return nc.get(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return C[this.number]?C[this.number]:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return ga.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=ga.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},e}(),oc=Pg;P.ControlChange=oc;var pc={};Object.defineProperty(pc,"__esModule",{value:!0});function Sg(){return new Proxy({},{get:function(r,e){return r[e]?r[e]:D.hasOwnProperty(e)?r[D[e]]:void 0},set:function(r,e,o){return D.hasOwnProperty(e)?r[D[e]]=o:r[e]=o,!0}})}var qc=Sg;pc.createControlChanges=qc;var rc={};Object.defineProperty(rc,"__esModule",{value:!0});var Ea=new WeakMap,Wg=function(){function e(e,t){Ea.set(this,t),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(e.prototype,"time",{get:function(){return Ea.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=Ea.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},e}(),tc=Wg;rc.PitchBend=tc;var M={};Object.defineProperty(M,"__esModule",{value:!0});var Aa=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];M.instrumentByPatchID=Aa;var wc=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];M.InstrumentFamilyByID=wc;var xc={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};M.DrumKitByPatchID=xc;var yc={};Object.defineProperty(yc,"__esModule",{value:!0});var zc=new WeakMap,ch=function(){function e(e,t){if(this.number=0,zc.set(this,t),this.number=0,e){var r=e.find(function(e){return"programChange"===e.type});r&&(this.number=r.programNumber)}}return Object.defineProperty(e.prototype,"name",{get:function(){return this.percussion?xc[this.number]:Aa[this.number]},set:function(e){var t=Aa.indexOf(e);-1!==t&&(this.number=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"family",{get:function(){return this.percussion?"drums":wc[Math.floor(this.number/8)]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"percussion",{get:function(){return 9===zc.get(this).channel},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{family:this.family,name:this.name,number:this.number}},e.prototype.fromJSON=function(e){this.number=e.number},e}(),ha=ch;yc.Instrument=ha;var Bc={};function fh(t){var i=Math.floor(t/12)-1;return Cc(t)+i.toString()}function Cc(t){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t%12]}function hh(t){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(t)}Object.defineProperty(Bc,"__esModule",{value:!0});var ih=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,i={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(e){var r=t.exec(e),o=r[1],a=r[2];return i[o.toLowerCase()]+12*(parseInt(a,10)+1)}}(),o=new WeakMap,kh=function(){function t(t,i,e){o.set(this,e),this.midi=t.midi,this.velocity=t.velocity,this.noteOffVelocity=i.velocity,this.ticks=t.ticks,this.durationTicks=i.ticks-t.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return fh(this.midi)},set:function(t){this.midi=ih(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(t){var i=t-this.octave;this.midi+=12*i},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return Cc(this.midi)},set:function(t){this.midi=12*(this.octave+1)+hh(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var t=o.get(this);return t.ticksToSeconds(this.ticks+this.durationTicks)-t.ticksToSeconds(this.ticks)},set:function(t){var i=o.get(this).secondsToTicks(this.time+t);this.durationTicks=i-this.ticks},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return o.get(this).ticksToSeconds(this.ticks)},set:function(t){var i=o.get(this);this.ticks=i.secondsToTicks(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){return o.get(this).ticksToMeasures(this.ticks)},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}(),Ec=kh;Bc.Note=Ec;var Fc={};Object.defineProperty(Fc,"__esModule",{value:!0});var S=new WeakMap,oh=function(){function e(e,t){var n=this;if(this.name="",this.notes=[],this.controlChanges=qc(),this.pitchBends=[],S.set(this,t),e){var r=e.find(function(e){return"trackName"===e.type});this.name=r?r.text:""}if(this.instrument=new ha(e,this),this.channel=0,e){for(var i=e.filter(function(e){return"noteOn"===e.type}),a=e.filter(function(e){return"noteOff"===e.type}),o=function(){var e=i.shift();s.channel=e.channel;var t=a.findIndex(function(t){return t.noteNumber===e.noteNumber&&t.absoluteTime>=e.absoluteTime});if(-1!==t){var n=a.splice(t,1)[0];s.addNote({durationTicks:n.absoluteTime-e.absoluteTime,midi:e.noteNumber,noteOffVelocity:n.velocity/127,ticks:e.absoluteTime,velocity:e.velocity/127})}},s=this;i.length;)o();e.filter(function(e){return"controller"===e.type}).forEach(function(e){n.addCC({number:e.controllerType,ticks:e.absoluteTime,value:e.value/127})}),e.filter(function(e){return"pitchBend"===e.type}).forEach(function(e){n.addPitchBend({ticks:e.absoluteTime,value:e.value/Math.pow(2,13)})})}}return e.prototype.addNote=function(e){var t=S.get(this),n=new Ec({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},t);return Object.assign(n,e),I(this.notes,n,"ticks"),this},e.prototype.addCC=function(e){var t=S.get(this),n=new oc({controllerType:e.number},t);return delete e.number,Object.assign(n,e),Array.isArray(this.controlChanges[n.number])||(this.controlChanges[n.number]=[]),I(this.controlChanges[n.number],n,"ticks"),this},e.prototype.addPitchBend=function(e){var t=S.get(this),n=new tc({},t);return Object.assign(n,e),I(this.pitchBends,n,"ticks"),this},Object.defineProperty(e.prototype,"duration",{get:function(){var e=this.notes[this.notes.length-1];return e?e.time+e.duration:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){var e=this.notes[this.notes.length-1];return e?e.ticks+e.durationTicks:0},enumerable:!0,configurable:!0}),e.prototype.fromJSON=function(e){var t=this;for(var n in this.name=e.name,this.channel=e.channel,this.instrument=new ha(void 0,this),this.instrument.fromJSON(e.instrument),e.controlChanges)e.controlChanges[n]&&e.controlChanges[n].forEach(function(e){t.addCC({number:e.number,ticks:e.ticks,value:e.value})});e.notes.forEach(function(e){t.addNote({durationTicks:e.durationTicks,midi:e.midi,ticks:e.ticks,velocity:e.velocity})})},e.prototype.toJSON=function(){for(var e={},t=0;t<127;t++)this.controlChanges.hasOwnProperty(t)&&(e[t]=this.controlChanges[t].map(function(e){return e.toJSON()}));return{channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(e){return e.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(e){return e.toJSON()})}},e}(),K=oh;Fc.Track=K;var r={},rh=r&&r.__awaiter||function(r,e,t,a){return new(t||(t=Promise))(function(n,o){function i(r){try{u(a.next(r))}catch(e){o(e)}}function c(r){try{u(a.throw(r))}catch(e){o(e)}}function u(r){var e;r.done?n(r.value):(e=r.value,e instanceof t?e:new t(function(r){r(e)})).then(i,c)}u((a=a.apply(r,e||[])).next())})},sh=r&&r.__generator||function(r,e){var t,a,n,o,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,a&&(n=2&o[0]?a.return:o[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,o[1])).done)return n;switch(a=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,a=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){i.label=o[1];break}if(6===o[0]&&i.label<n[1]){i.label=n[1],n=o;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(o);break}n[2]&&i.ops.pop(),i.trys.pop();continue;}o=e.call(r,i)}catch(c){o=[6,c],a=0}finally{t=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}};Object.defineProperty(r,"__esModule",{value:!0});var th=function(){function r(r){var e=this,t=null;r&&(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),(t=Sf(r)).tracks.forEach(function(r){var e=0;r.forEach(function(r){e+=r.deltaTime,r.absoluteTime=e})}),t.tracks=vh(t.tracks)),this.header=new na(t),this.tracks=[],r&&(this.tracks=t.tracks.map(function(r){return new K(r,e.header)}),1===t.header.format&&0===this.tracks[0].duration&&this.tracks.shift())}return r.fromUrl=function(e){return rh(this,void 0,void 0,function(){var t;return sh(this,function(a){switch(a.label){case 0:return[4,fetch(e)];case 1:return(t=a.sent()).ok?[4,t.arrayBuffer()]:[3,3];case 2:return[2,new r(a.sent())];case 3:throw new Error("could not load "+e);}})})},Object.defineProperty(r.prototype,"name",{get:function(){return this.header.name},set:function(r){this.header.name=r},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"duration",{get:function(){var r=this.tracks.map(function(r){return r.duration});return Math.max.apply(Math,r)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"durationTicks",{get:function(){var r=this.tracks.map(function(r){return r.durationTicks});return Math.max.apply(Math,r)},enumerable:!0,configurable:!0}),r.prototype.addTrack=function(){var r=new K(void 0,this.header);return this.tracks.push(r),r},r.prototype.toArray=function(){return ic(this)},r.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(r){return r.toJSON()})}},r.prototype.fromJSON=function(r){var e=this;this.header=new na,this.header.fromJSON(r.header),this.tracks=r.tracks.map(function(r){var t=new K(void 0,e.header);return t.fromJSON(r),t})},r.prototype.clone=function(){var e=new r;return e.fromJSON(this.toJSON()),e},r}(),Jc=th;function vh(r){for(var e=[],t=0;t<r.length;t++)for(var a=e.length,n=new Map,o=Array(16).fill(0),i=0,c=r[t];i<c.length;i++){var u=c[i],s=a,$=u.channel;if(void 0!==$){"programChange"===u.type&&(o[$]=u.programNumber);var f=o[$]+" "+$;n.has(f)?s=n.get(f):(s=a+n.size,n.set(f,s))}e[s]||e.push([]),e[s].push(u)}return e}r.Midi=Jc;const wh=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],xh=j(a($=>Rf($)),k(),wh),Kc=j(Fa({raw:a($=>$),tonicMidi:a($=>Jb($.tonic+"2")%12),majorKey:a($=>$.tonic),minorKey:a($=>yf($.minorRelative).toLowerCase()),normalizedMidis:a($=>j(a($=>Jb($+"2")%12),k(),$.scale))}),k(),xh);const zh=$=>{const r=j(aa(a(r=>$[r]?r:null),La($=>null!==$)),k(),fd(12)),t=j(aa(a($=>ja(new Set($.normalizedMidis),new Set(r))),a($=>Array.from($))),k(),Kc);let e=j(Fa({majorKey:a($=>$[0].majorKey),minorKey:a($=>$[0].minorKey),normalizedMidis:a($=>$[0].normalizedMidis),common:a($=>$[1]),similarity:a($=>$[1].length/r.length+(r.includes($[0].tonicMidi)?.1:0))}),k(),hd(Kc,t));return e=e.sort(($,r)=>r.similarity-$.similarity)};const Ba=[...Gd(!1,12)];const Ch=[..._(12,Lc([!0,!1],[.5,.5]))];const Qf=$=>{let r=new Jc($).tracks;r.sort(($,r)=>r.notes.length-$.notes.length);const t=r[0],e=j(a($=>$[0]%12),k(),_(7,oe(t.notes.map($=>$.midi))));return Array.from(new Set(e))};const Pf=e=>{const t=e.views,i=t.size.deref(),r=Math.min(400*1.1,.9*i[0]),o=t.viewConfig.deref(),s=zh(t.keyState.deref()),a={width:r,height:r/35,rx:5,fill:"#e2e2e2"};return["div.dib",...s.map((t,i)=>["div.mv2.mr2",{onmouseover:i=>{i.preventDefault(),e.bus.dispatch([qa,t.normalizedMidis])},onmouseleave:t=>{t.preventDefault(),e.bus.dispatch([ab])}},["div.flex",["div",t.majorKey,o.showSmall?["small"," maj"]:[]],o.showMinor?["div",["span.red"," \u30FB "],t.minorKey,o.showSmall?["small"," min"]:[]]:[]],["div",["svg",{width:1.1*r,height:r/35},["g",["rect",a],t.common.length>0?["rect",Object.assign(Object.assign({},a),{width:(t.similarity-.1)*r,fill:"#000"})]:[]]]]])]};const U=r=>{r.preventDefault()},If=(r,e)=>{U(e);const t=e.dataTransfer.files;if(t&&t.length>0){const e=new FileReader,$=t[0];e.onload=e=>{if("audio/midi"===$.type){r.dispatch([z,$.name]);const t=Qf(e.target.result);r.dispatch([R,Ba.map((r,e)=>!!t.includes(e))])}else r.dispatch([fb])},e.readAsArrayBuffer($)}},zf=r=>{const e=r.bus,t=r.views,$=t.midiFile.deref(),a=t.size.deref();return["div.mt2.mb4.ba.b--dotted.bw1.dib.pa4.v-mid.tc",{ondrop:r=>{r.target.classList.remove("dragover"),If(e,r)},ondragenter:r=>{r.target.classList.add("dragover"),U(r)},ondragleave:r=>{r.target.classList.remove("dragover"),U(r)},ondragover:r=>U(r),style:{width:`${Math.min(400*1.1,.9*a[0])}px`}},$]};const tf={w:16,h:8,pad:2,margin:0},sf=Jd(Object.assign(Object.assign({},tf),{vertical:!1})),ud=e=>{const i=e.views.viewConfig.deref();return["div",Object.entries(i).map(([i,$])=>["div.mv2",[sf,{class:"pointer mr2",onclick:()=>e.bus.dispatch([cb,i])},$],i])]};const sg=Hd({element:"h2",attribs:{class:"#000"}}),Oc=e=>()=>["div",[sg,"OP-Z KEY FINDER"],[be,e],[fe,e],["div.mb2",[me,e],[Pf,e]],[zf,e],["div.db",["details",["summary","View Config"],[ud,e]]]];const Ia={id:"home",match:["home"]};const qg={router:{useFragment:!0,defaultRouteID:Ia.id,routes:[Ia]},events:{[Nd]:pg("debug",$=>1^$),[T]:[($,[o,i])=>({[d]:[F,["keyState",i]]})],[R]:[($,[o,i])=>({[d]:[e,["keyState",i]]})],[Za]:[()=>({[d]:[R,Ba]})],[$a]:[()=>({[d]:[R,[..._(12,Lc([!0,!1],[.5,.5]))]]})],[qa]:[($,[o,i])=>({[d]:[e,["highlights",i]]})],[ab]:[()=>({[d]:[qa,[]]})],[bb]:[()=>({[d]:[e,["size",[window.innerWidth,window.innerHeight]]]})],[cb]:[($,[o,i])=>({[d]:[F,["viewConfig",i]]})],[db]:[($,[o,i])=>({[d]:[[F,"enabledMidi"],[e,["midiDevices",i]]]})],[z]:[($,[o,i])=>({[d]:[[e,["midiFile",i]]]})],[fb]:[()=>({[d]:[z,"INVALID MIDI FILE..."],[Eb]:[Cb,[500,"DROP MIDI FILE HERE..."],z,z]})],[Zd]:[($,[o,i])=>({[d]:[[e,["comparison",i]]]})]},effects:{},components:{[Ia.id]:Oc},domRoot:"app",initialState:{enabledMidi:!1,midiDevices:[],midiFile:"DROP MIDI FILE HERE...",keyState:Ba,highlights:[],size:[window.innerWidth,window.innerHeight],viewConfig:{showMinor:!0,showSmall:!0},route:{},debug:1},views:{enabledMidi:"enabledMidi",midiDevices:"midiDevices",midiFile:"midiFile",keyState:"keyState",highlights:"highlights",size:"size",viewConfig:"viewConfig",json:["",$=>JSON.stringify($,null,2)],debug:"debug"},ui:{root:{class:"flex-ns sans-serif ma0"},toolbar:{button:{class:"mr3 pv2 ph2 bg-black white f4"}},code:{class:"ma0 ml4 pa2 f7 bg-light-gray code overflow-x-hidden"},column:{content:[{class:"w-90-ns ma2"},{class:"w-50-ns ma2"}],debug:[{class:"w-10-ns ma2 close"},{class:"w-50-ns ma2 open"}]},debugToggle:{class:"toggle pointer"}}};new de(qg).start();return{"B6dB":{}};});