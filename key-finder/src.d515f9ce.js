parcelRequire=function(e){var r="function"==typeof parcelRequire&&parcelRequire,n="function"==typeof require&&require,i={};function u(e,u){if(e in i)return i[e];var t="function"==typeof parcelRequire&&parcelRequire;if(!u&&t)return t(e,!0);if(r)return r(e,!0);if(n&&"string"==typeof e)return n(e);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return u.register=function(e,r){i[e]=r},i=e(u),u.modules=i,u}(function (require) {function U(a){return a&&a.__esModule?{d:a.default}:{d:a}}var nc={};const v=Symbol();const T=()=>{};const Rb=void 0===nc?(r,$="assertion failed")=>{if("function"==typeof r&&!r()||!r)throw new Error("function"==typeof $?$():$)}:T;let ka,qa;const Qb=Object.getPrototypeOf({}),m=(e,t)=>{let $;return e===t||(null==e?e==t:"function"==typeof e.equiv?e.equiv(t):null==t?e==t:"function"==typeof t.equiv?t.equiv(e):"string"!=typeof e&&"string"!=typeof t&&(null!=($=Object.getPrototypeOf(e))&&$!==Qb||null!=($=Object.getPrototypeOf(t))&&$!==Qb?"function"!=typeof e&&void 0!==e.length&&"function"!=typeof t&&void 0!==t.length?Mb(e,t):e instanceof Set&&t instanceof Set?Kb(e,t):e instanceof Map&&t instanceof Map?Jb(e,t):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:Ib(e,t)))};const Mb=(e,t,$=m)=>{let o=e.length;if(o===t.length)for(;--o>=0&&$(e[o],t[o]););return o<0};const Kb=(e,t,$=m)=>e.size===t.size&&$([...e.keys()].sort(),[...t.keys()].sort());const Jb=(e,t,$=m)=>e.size===t.size&&$([...e].sort(),[...t].sort());const Ib=(e,t,$=m)=>{if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let o in e)if(!t.hasOwnProperty(o)||!$(e[o],t[o]))return!1;return!0};let bf=[],Wb=[];const Yb=r=>ka&&ka.length>=r?ka:ka=new Int32Array(r),cc=r=>qa&&qa.length>=r?qa:qa=new Int32Array(r),Fb=(r,$,e,a,t)=>{const c=$.length,l=r.linear;if(r.distance=c,0!==t){for(let r=0,e=0;r<c;r++,e+=3)l[e]=a,l[e+1]=r,l[e+2]=$[r];if(3===t){const a=r[e];for(let r=0;r<c;r++)a[r]=$[r]}}return r},gd=(r,$,e=3,a=m)=>{const t={distance:0,adds:{},dels:{},const:{},linear:[]};if(r===$||null==r&&null==$)return t;if(null==r||0===r.length)return Fb(t,$,"adds",1,e);if(null==$||0===$.length)return Fb(t,r,"dels",-1,e);const c=r.length>=$.length;let l,n,h,s;c?(l=$,n=r):(l=r,n=$),h=l.length,s=n.length;const d=h+1,o=s-h,i=o+d,z=h+s+3,J=cc(z).fill(-1,0,z),f=Yb(z).fill(-1,0,z),v=bf,u=Wb;v.length=0,u.length=0;const P=(r,$,e)=>{const t=r+d;let c,o;$>e?(c=J[t-1],o=$):(c=J[t+1],o=e);let i=o-r;for(;i<h&&o<s&&a(l[i],n[o]);)i++,o++;return J[t]=u.length/3,u.push(i,o,c),o};let g,p,_=-1;do{for(p=(g=-++_)+d;g<o;g++,p++)f[p]=P(g,f[p-1]+1,f[p+1]);for(p=(g=o+_)+d;g>o;g--,p--)f[p]=P(g,f[p-1]+1,f[p+1]);f[i]=P(o,f[i-1]+1,f[i+1])}while(f[i]!==s);if(t.distance=o+2*_,0!==e){for(_=3*J[i];_>=0;)v.push(_),_=3*u[_+2];3===e?od(v,u,t,l,n,c):ud(v,u,t,l,n,c,1===e)}return t};const od=(r,$,e,a,t,c)=>{const l=e.linear,n=e.const;let h,s,d,o,i=r.length,z=0,J=0;for(c?(h=e.dels,s=e.adds,d=-1,o=1):(h=e.adds,s=e.dels,d=1,o=-1);--i>=0;){const e=r[i],c=$[e],f=$[e+1],v=f-c;for(;z<c||J<f;){const r=J-z;v>r?(l.push(d,J,h[J]=t[J]),J++):v<r?(l.push(o,z,s[z]=a[z]),z++):(l.push(0,z,n[z]=a[z]),z++,J++)}}},ud=(r,$,e,a,t,c,l)=>{const n=e.linear,h=c?-1:1,s=c?1:-1;let d=r.length,o=0,i=0;for(;--d>=0;){const e=r[d],c=$[e],z=$[e+1],J=z-c;for(;o<c||i<z;){const r=i-o;J>r?(n.push(h,i,t[i]),i++):J<r?(n.push(s,o,a[o]),o++):(l&&n.push(0,o,a[o]),o++,i++)}}};const Id=(t,e,$=3,i=m)=>t===e?{distance:0}:0===$?Kd(t,e,i):te(t,e,i);const Kd=(t,e,$)=>{t||(t={}),e||(e={});let i=0;for(let r in t){const f=e[r];(void 0===f||!$(t[r],f))&&i++}for(let r in e)!(r in t)&&i++;return{distance:i}},te=(t,e,$)=>{t||(t={}),e||(e={});let i=0;const r=[],f=[],s=[];for(let n in t){const r=e[n];void 0===r?(f.push(n),i++):$(t[n],r)||(s.push(n,r),i++)}for(let n in e)n in t||(r.push(n),i++);return{distance:i,adds:r,dels:f,edits:s}};const I=Array.isArray,gf=Math.max,Cb=Object.getPrototypeOf({}),xb=(()=>{const e=new Array(2048);for(let t=2,r=e.length;t<r;t++)e[t]=t-2;return e})(),Zb=e=>{if(e<=xb.length)return xb.slice(0,e);const t=new Array(e);for(;--e>=2;)t[e]=e-2;return t},wb=(e,t,r,$,i,o=0)=>{const n=i[1];if(n.__skip)return;if(!1===n.__diff)return q($),void t.replaceChild(e,r,o,i);const f=$[1];if(f&&f.__skip)return void t.replaceChild(e,r,o,i,!1);let s=n.__impl;if(s&&s!==t)return s.diffTree(e,s,r,$,i,o);const a=gd($,i,1,w);if(0===a.distance)return;const h=a.linear,T=t.getChild(r,o);let l,p,v,K;if(0!==h[0]||$[1].key!==n.key)return q($),void t.replaceChild(e,r,o,i);if((K=$.__release)&&K!==i.__release&&q($),0!==h[3]&&(Gc(t,T,$[1],i[1]),2===a.distance))return;const Q=h.length,d=$.length-1,u=dd(h),c=Zb(d+1);for(l=2,p=6;p<Q;l++,p+=3)(v=h[p])&&(-1===v?ec(e,t,T,$,i,h,p,u,c,d):gc(e,t,T,h,p,u,c,d));(K=i.__init)&&K!=$.__init&&K.apply(i,[T,...i.__args])};const ec=(e,t,r,$,i,o,n,f,s,a)=>{const h=o[n+2];if(I(h)){let T=h[1].key;if(void 0!==T&&void 0!==f[T][2]){const o=f[T];T=o[0],wb(e,t,r,$[T],i[o[2]],s[T])}else{const e=o[n+1];q(h),t.removeChild(r,s[e]),jc(s,a,e)}}else"string"==typeof h&&t.setContent(r,"")},gc=(e,t,r,$,i,o,n,f)=>{const s=$[i+2];if("string"==typeof s)t.setContent(r,s);else if(I(s)){const a=s[1].key;if(void 0===a||void 0===o[a][0]){const o=$[i+1];t.createTree(e,r,s,n[o]),sc(n,f,o)}}},jc=(e,t,r)=>{for(;t>r;t--)e[t]=gf(e[t]-1,0)},sc=(e,t,r)=>{for(;t>=r;t--)e[t]++},Gc=(e,t,r,$)=>{const i=Id(r,$,3,m);e.removeAttribs(t,i.dels,r);let o,n,f,s=v;for(o=(f=i.edits).length;(o-=2)>=0;)0===(n=f[o]).indexOf("on")&&e.removeAttribs(t,[n],r),"value"!==n?e.setAttrib(t,n,f[o+1],$):s=f[o+1];for(o=(f=i.adds).length;--o>=0;)"value"!==(n=f[o])?e.setAttrib(t,n,$[n],$):s=$[n];s!==v&&e.setAttrib(t,"value",s,$)};const q=e=>{if(I(e)){let t;if((t=e[1])&&!1===t.__release)return;for(e.__release&&(e.__release.apply(e.__this,e.__args),delete e.__release),t=e.length;--t>=2;)q(e[t])}};const dd=e=>{let t,r,$;const i={};for(let o=e.length;(o-=3)>=0;)r=e[o+2],I(r)&&void 0!==(t=r[1].key)&&(!($=i[t])&&(i[t]=$=[,,]),$[e[o]+1]=e[o+1]);return i},w=(e,t)=>{let r;return e===t||(null==e?e==t:"function"==typeof e.equiv?e.equiv(t):null==t?e==t:"function"==typeof t.equiv?t.equiv(e):"string"!=typeof e&&"string"!=typeof t&&(null!=(r=Object.getPrototypeOf(e))&&r!==Cb||null!=(r=Object.getPrototypeOf(t))&&r!==Cb?"function"!=typeof e&&void 0!==e.length&&"function"!=typeof t&&void 0!==t.length?Mb(e,t,w):e instanceof Set&&t instanceof Set?Kb(e,t,w):e instanceof Map&&t instanceof Map?Jb(e,t,w):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:!(!1===e.__diff||!1===t.__diff)&&Ib(e,t,w)))};const hd=o=>"function"==typeof o;const E=(n,t)=>null!=n&&"function"==typeof n[t];const D=Array.isArray;const Ad=t=>null!=t&&"function"!=typeof t&&void 0!==t.length;const Cd=t=>"string"==typeof t;const Gd=e=>null!=e&&"function"==typeof e[Symbol.iterator];const Hd=$=>$ instanceof Map;const ub=t=>null!=t&&"string"!=typeof t&&"function"==typeof t[Symbol.iterator];const ob=Object.getPrototypeOf,Ld=$=>{let r;return null!=$&&"object"==typeof $&&(null===(r=ob($))||null===ob(r))};const Pd=t=>t instanceof Set;const Qd="http://www.w3.org/2000/svg";const ie={"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&apos;"};const le=/^([^\s\.#]+)(?:#([^\s\.#]+))?(?:\.([^\s#]+))?$/;const zf=new RegExp(`[${Object.keys(ie).join("")}]`,"g");const re={button:1,option:1,text:1,textarea:1};const nb=e=>e.split(" ").reduce((e,t)=>(e[t]=!0,e),{}),ve=nb("animate animateColor animateMotion animateTransform circle clipPath color-profile defs desc discard ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter font foreignObject g image line linearGradient marker mask metadata mpath path pattern polygon polyline radialGradient rect set stop style svg switch symbol text textPath title tref tspan use view");const yf=nb("area base br circle col command ellipse embed hr img input keygen line link meta param path polygon polyline rect source stop track use wbr ?xml");const ye=t=>{let $,r="";for(let e in t)$=t[e],hd($)&&($=$(t)),null!=$&&(r+=`${e}:${$};`);return r};const Ne=(e,t)=>{if(null==e||!t||!t.length)return e;const r=Object.assign({},e);for(let n of t){const e=r[n];E(e,"deref")&&(r[n]=e.deref())}return r};const mb=(r,o=r=>void 0!==r?": "+r:"")=>class extends Error{constructor(s){super(r(s)+o(s))}};const ef=mb(()=>"illegal argument(s)");const lb=r=>{throw new ef(r)};const hf=mb(()=>"illegal arity");const la=r=>{throw new hf(r)};const A=D,jb=ub,ib=(e,t)=>t.__init&&t.__init.apply(t.__this,[e,...t.__args]),z=(e,t,r,s,$,n=!0)=>{if(A(s)){const o=s[0];if("function"==typeof o)return z(e,t,r,o.apply(null,[e.ctx,...s.slice(1)]),$);const a=s[1];if(a.__impl)return a.__impl.createTree(e,r,s,$,n);const i=t.createElement(r,o,a,$);if(s.length>2){const r=s.length;for(let $=2;$<r;$++)z(e,t,i,s[$],void 0,n)}return n&&ib(i,s),i}if(jb(s)){const o=[];for(let a of s)o.push(z(e,t,r,a,$,n));return o}return null==s?r:t.createTextElement(r,s)};const G=(e,t,r,s,$=0)=>{if(A(s)){const n=t.getChild(r,$);"function"==typeof s[0]&&G(e,t,r,s[0].apply(null,[e.ctx,...s.slice(1)]),$);const o=s[1];if(o.__impl)return o.__impl.hydrateTree(e,r,s,$);ib(n,s);for(let e in o)0===e.indexOf("on")&&t.setAttrib(n,e,o[e]);for(let r=s.length,$=2;$<r;$++)G(e,t,n,s[$],$-2)}else if(jb(s))for(let n of s)G(e,t,r,n,$),$++};const hc=(e,t,r,s)=>{const $=ve[t]?document.createElementNS(Qd,t):document.createElement(t);return r&&qc($,r),db(e,$,s)};const ic=(e,t,r)=>db(e,document.createTextNode(t),r);const db=(e,t,r)=>e?void 0===r?e.appendChild(t):e.insertBefore(t,e.children[r]):t;const kc=(e,t)=>e.children[t];const oc=(e,t,r,s,$,n=!0)=>(t.removeChild(r,s),t.createTree(e,r,$,s,n));const pc=(e,t)=>e.textContent=t;const qc=(e,t)=>{for(let r in t)cb(e,r,t[r],t);return e};const cb=(e,t,r,s)=>{if(t.startsWith("__"))return;const $=0===t.indexOf("on");if($||"function"!=typeof r||(r=r(s)),void 0!==r&&!1!==r)switch(t){case"style":yc(e,r);break;case"value":tc(e,r);break;case"accesskey":e.accessKey=r;break;case"contenteditable":e.contentEditable=r;break;case"tabindex":e.tabIndex=r;break;case"align":case"autocapitalize":case"checked":case"dir":case"draggable":case"hidden":case"id":case"lang":case"namespaceURI":case"scrollTop":case"scrollLeft":case"title":e[t]=r;break;default:$?Bc(e,t.substr(2),r):e.setAttribute(t,!0===r?"":r);}else null!=e[t]?e[t]=null:e.removeAttribute(t);return e};const tc=(e,t)=>{let r;switch(e.type){case"text":case"textarea":case"password":case"search":case"number":case"email":case"url":case"tel":case"date":case"datetime-local":case"time":case"week":case"month":if(void 0!==(r=e.value)&&"string"==typeof t){const s=t.length-(r.length-(e.selectionStart||0));e.value=t,e.selectionStart=e.selectionEnd=s;break}default:e.value=t;}};const uc=(e,t,r)=>{for(let s=t.length;--s>=0;){const $=t[s];0===$.indexOf("on")?Ec(e,$.substr(2),r[$]):e.hasAttribute($)?e.removeAttribute($):e[$]=null}};const yc=(e,t)=>(e.setAttribute("style",ye(t)),e);const Bc=(e,t,r)=>A(r)?e.addEventListener(t,...r):e.addEventListener(t,r);const Ec=(e,t,r)=>A(r)?e.removeEventListener(t,...r):e.removeEventListener(t,r);const Fc=(e,t)=>{const r=e.children[t];void 0!==r&&e.removeChild(r)};const P=D,Hc=ub,Lc=Ld,Nc=(e,r)=>{let $,i,t,n,a,o=e[0],l=Lc(e[1]);return"string"==typeof o&&($=le.exec(o))||lb(`${o} is not a valid tag name`),o!==(i=$[1])||!l||r&&!e[1].key?(a=l?Object.assign({},e[1]):{},t=$[2],n=$[3],t&&(a.id=t),n&&(n=n.replace(/\./g," "),a.class?a.class+=" "+n:a.class=n),a.__skip&&e.length<3?[i,a]:[i,a,...e.slice(l?2:1)]):e};const Pc=(e,r)=>k(r,e,e.ctx,[0],!1!==e.keys,!1!==e.span);const k=(e,r,$,i,t,n)=>{if(null!=e){if(P(e)){if(0===e.length)return;let a,o,l=e[1];if(l&&(o=l.__impl)&&(o=o.normalizeTree))return o(r,e);const s=e[0];if("function"==typeof s)return k(s.apply(null,[$,...e.slice(1)]),r,$,i,t,n);if("function"==typeof s.render){const o=[$,...e.slice(1)];return a=k(s.render.apply(s,o),r,$,i,t,n),P(a)&&(a.__this=s,a.__init=s.init,a.__release=s.release,a.__args=o),a}if(!1===(l=(a=Nc(e,t))[1]).__normalize)return a;if(t&&void 0===l.key&&(l.key=i.join("-")),a.length>2){const e=a[0],o=[e,l];n=n&&!re[e];for(let l=2,s=2,x=0,c=a.length;l<c;l++){let e=a[l];if(null!=e){const a=P(e);if(a&&P(e[0])||!a&&Hc(e))for(let l of e)void 0!==(l=k(l,r,$,i.concat(x),t,n))&&(o[s++]=l),x++;else void 0!==(e=k(e,r,$,i.concat(x),t,n))&&(o[s++]=e),x++}}return o}return a}return"function"==typeof e?k(e($),r,$,i,t,n):"function"==typeof e.toHiccup?k(e.toHiccup(r.ctx),r,$,i,t,n):"function"==typeof e.deref?k(e.deref(),r,$,i,t,n):n?["span",t?{key:i.join("-")}:{},e.toString()]:e.toString()}};const Vc={createTree(e,t,r,$,i){return z(e,this,t,r,$,i)},hydrateTree(e,t,r,$){return G(e,this,t,r,$)},diffTree(e,t,r,$,i){wb(e,this,t,r,$,i)},normalizeTree:Pc,getElementById:e=>document.getElementById(e),getChild:kc,createElement:hc,createTextElement:ic,replaceChild(e,t,r,$,i){oc(e,this,t,r,$,i)},removeChild:Fc,setContent:pc,removeAttribs:uc,setAttrib:cb};const Xc=(e,o)=>Cd(e)?o.getElementById(e):e;const Yc=(e,r={},t=Vc)=>{const a=Object.assign({root:"app"},r);let $=[],n=!0;const o=Xc(a.root,t),i=()=>{if(n){a.ctx=Ne(r.ctx,a.autoDerefKeys);const f=t.normalizeTree(a,e);null!=f&&(a.hydrate?(t.hydrateTree(a,o,f),a.hydrate=!1):t.diffTree(a,o,$,f),$=f),n&&requestAnimationFrame(i)}};return requestAnimationFrame(i),()=>n=!1};const Zc=([o,p,$],t)=>["option",{value:o,disabled:!!$,selected:o===t},p];const $c=(o,p,$,t)=>["select",p,...$.map(o=>Zc(o,t))];function*cd($,r){const e=u($)(h()),t=e[1],s=e[2];for(let i of r){const $=s([],i);if(l($))return void(yield*B(t($.deref())));$.length&&(yield*$)}yield*B(t([]))}function*ga($,r){const e=u($)([T,T,($,r)=>r])[2];for(let t of r){let $=e(v,t);if(l($))return void(($=B($.deref()))!==v&&(yield $));$!==v&&(yield $)}}const u=r=>E(r,"xform")?r.xform():r;class r{constructor(e){this.value=e}deref(){return this.value}}const kd=e=>new r(e);const l=e=>e instanceof r;const pd=e=>e instanceof r?e:new r(e);const B=e=>e instanceof r?e.deref():e;function h($){return $?[...$]:bb(()=>[],($,r)=>($.push(r),$))}const Bd=e=>2===e.length?[void 0,e[1]]:3===e.length?[e[1],e[2]]:la(e.length);function Q(...e){const r=e[0],$=r[0],u=r[1],t=r[2],c=null==(e=Bd(e))[0]?$():e[0],o=e[1];return B(u(E(o,"$reduce")?o.$reduce(t,c):Ad(o)?Dd(t,c,o):Fd(t,c,o)))}const Dd=(e,r,$)=>{for(let u=0,t=$.length;u<t;u++)if(r=e(r,$[u]),l(r)){r=r.deref();break}return r},Fd=(e,r,$)=>{for(let u of $)if(r=e(r,u),l(r)){r=r.deref();break}return r},bb=(e,r)=>[e,e=>e,r];const ab=($,r,e=ga)=>{const t=r.length-1;return Gd(r[t])?r.length>1?e($.apply(null,r.slice(0,t)),r[t]):e($(),r[0]):void 0};function g(...e){let r,$;switch(e.length){case 4:$=e[3],r=e[2];break;case 3:$=e[2];break;case 2:return b(r=>g(e[0],e[1],r));default:la(e.length);}return Q(u(e[0])(e[1]),r,$)}function b(t,r){return r?ga(b(t),r):r=>{const $=r[2];return V(r,(r,e)=>$(r,t(e)))}}const V=($,o)=>[$[0],$[1],o];const Nd=e=>{const{1:r,2:$}=u(e)(h());let t=!1;return e=>{if(!t){let p=$([],e);return(t=l(p))&&(p=r(p.deref())),1===p.length?p[0]:p.length>0?p:void 0}}};function W($){return $?Q(W(),$):bb(()=>new Set,($,e)=>$.add(e))}function _a(...e){let[r,$,t,o,u,c,p,n,s,a]=e;switch(e.length){case 0:la(0);case 1:return r;case 2:return(...e)=>r($(...e));case 3:return(...e)=>r($(t(...e)));case 4:return(...e)=>r($(t(o(...e))));case 5:return(...e)=>r($(t(o(u(...e)))));case 6:return(...e)=>r($(t(o(u(c(...e))))));case 7:return(...e)=>r($(t(o(u(c(p(...e)))))));case 8:return(...e)=>r($(t(o(u(c(p(n(...e))))))));case 9:return(...e)=>r($(t(o(u(c(p(n(s(...e)))))))));case 10:default:const G=(...e)=>r($(t(o(u(c(p(n(s(a(...e))))))))));return 10===e.length?G:_a(G,...e.slice(10));}}function Rd(...e){const[r,t,n,u,s,a,c,$]=e;switch(e.length){case 1:return e=>[r(e)];case 2:return e=>[r(e),t(e)];case 3:return e=>[r(e),t(e),n(e)];case 4:return e=>[r(e),t(e),n(e),u(e)];case 5:return e=>[r(e),t(e),n(e),u(e),s(e)];case 6:return e=>[r(e),t(e),n(e),u(e),s(e),a(e)];case 7:return e=>[r(e),t(e),n(e),u(e),s(e),a(e),c(e)];case 8:return e=>[r(e),t(e),n(e),u(e),s(e),a(e),c(e),$(e)];default:return r=>{let t=new Array(e.length);for(let n=e.length;--n>=0;)t[n]=e[n](r);return t};}}function Sd(e,t,r){return new Td(e,t,r)}class Td{constructor(e,t,r){void 0===e?(e=0,t=1/0):void 0===t&&(t=e,e=0),r=void 0===r?e<t?1:-1:r,this.from=e,this.to=t,this.step=r}*[Symbol.iterator](){const e=this.step,t=this.to;let r=this.from;if(e>0)for(;r<t;)yield r,r+=e;else if(e<0)for(;r>t;)yield r,r+=e}$reduce(e,t){const r=this.step;if(r>0)for(let o=this.from,$=this.to;o<$&&!l(t);o+=r)t=e(t,o);else for(let o=this.from,$=this.to;o>$&&!l(t);o+=r)t=e(t,o);return t}}function*he(...o){const t=o.map(o=>o[Symbol.iterator]());for(;;){const o=[];for(let e of t){let t=e.next();if(t.done)return;o.push(t.value)}yield o}}function $a(r,$){return $?ga($a(r),$):$=>{const e=$[2];return V($,($,t)=>r(t)?e($,t):$)}}const je=e=>((null==e||!e[Symbol.iterator])&&lb(`value is not iterable: ${e}`),e);const ke=r=>D(r)?r:[...je(r)];const Za=1/4294967295;class me{float(t=1){return this.int()*Za*t}norm(t=1){return 2*(this.int()*Za-.5)*t}minmax(t,$){return this.float()*($-t)+t}gaussian(t=10,$=-.5,r=1){let a=0,n=t;for(;n-->0;)a+=this.float(r);return a/t+$}}const _=Math.random;class pe extends me{int(){return 4294967295*_()>>>0}float($=1){return _()*$}norm($=1){return 2*(_()-.5)*$}}const Xa=new pe;const se=(e,t,r=Xa)=>{const $=e.length;Rb($>0,"no choices given");const o=e.map(t?(e,r)=>[e,t[r]]:e=>[e,1]).sort((e,t)=>t[1]-e[1]),m=o.reduce((e,t)=>e+t[1],0);return Rb(m>0,"no choices given"),()=>{const e=r.float(m);let t=m;for(let r=0;r<$;r++)if((t-=o[r][1])<=e)return o[r][0]}};function Wa(...e){return e=e.map(u),_a.apply(null,e)}function ba(e,r){return r?cd(ba(e),r):r=>{const $=r[2];let g=e;return V(r,(e,r)=>--g>0?$(e,r):0===g?pd($(e,r)):kd(e))}}function we(...$){return b(Rd.apply(null,$.map(Nd)))}function ca(...$){const e=ab(ca,$);if(e)return e;const[r,p]=$,t=Object.keys(r);return Wa(we.apply(null,t.map($=>r[$])),Va(t,p))}function Va(...r){const $=r.length>2&&ab(Va,r);if($)return $;let e=r[0];if(D(e)&&(e=e.reduce((r,$,e)=>(r[$]=e,r),{})),r[1]){const $=Object.keys(e);return b(t=>g(Wa(b(r=>[r,t[e[r]]]),$a(r=>void 0!==r[1])),r[1],$))}return b(ze(e))}const ze=e=>{const r=Object.keys(e),[t,n,o]=r,[s,c,$]=r.map(r=>e[r]);switch(r.length){case 3:return e=>{const r={};let a;return void 0!==(a=e[$])&&(r[o]=a),void 0!==(a=e[c])&&(r[n]=a),void 0!==(a=e[s])&&(r[t]=a),r};case 2:return e=>{const r={};let o;return void 0!==(o=e[c])&&(r[n]=o),void 0!==(o=e[s])&&(r[t]=o),r};case 1:return e=>{const r={};let n=e[s];return void 0!==n&&(r[t]=n),r};default:return t=>{let n,o;const s={};for(let c=r.length-1;c>=0;c--)n=r[c],void 0!==(o=t[e[n]])&&(s[n]=o);return s};}};function*Ae(e,$=1/0){for(;$-->0;)yield e()}const Be=($,e,r=Xa)=>Ae(e?se(ke($),e,r):()=>$[0|r.float($.length)]);function*De(e,o=1/0){for(;o-->0;)yield e}const Ee=t=>{const e=Object.assign({element:"h1",attribs:{},subElement:"small",subAttribs:{}},t);return(t,s,r)=>[e.element,e.attribs,s,r?[e.subElement,e.subAttribs,r]:void 0]};const Ge={anim:100,pad:1,margin:0,vertical:!1,bgOn:{fill:"#000"},bgOff:{fill:"#999"},fgOn:{fill:"#fff"},fgOff:{fill:"#fff"}};const Je=(s={})=>{const t=Object.assign(Object.assign({w:10,h:10},Ge),s),{w:e,h:i,pad:g,margin:a,vertical:n}=t,c=2*a,b=g+a,O=n?e+2*g:2*(e+g),f=n?2*(i+g):i+2*g,r={width:O+c,height:f+c},l={transition:`all ${t.anim}ms ease-out`},$=Object.assign(Object.assign({},t.bgOn),{width:O,height:f,x:a,y:a}),j=Object.assign(Object.assign({},$),t.bgOff),o=Object.assign(Object.assign(Object.assign({},n?{x:b,y:b}:{x:O+a-g-e,y:b}),t.fgOn),{style:l,width:e,height:i}),h=Object.assign(Object.assign(Object.assign({},o),n?{y:f+a-g-i}:{x:b}),t.fgOff);return(s,t,e)=>["svg",Object.assign(Object.assign({},r),t),["rect",e?$:j],["rect",e?o:h]]};var Le=function(){return Le=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},Le.apply(this,arguments)};function Me(t,e,r,o){var n,a=arguments.length,$=a<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)$=Reflect.decorate(t,e,r,o);else for(var i=t.length-1;i>=0;i--)(n=t[i])&&($=(a<3?n($):a>3?n(e,r,$):n(e,r))||$);return a>3&&$&&Object.defineProperty(e,r,$),$}function Ua(t){return this instanceof Ua?(this.v=t,this):new Ua(t)}const Pe=(e,o={})=>{const t=Reflect.ownKeys(e),r=Reflect.ownKeys(o),n=Symbol("isa");function p(o){for(let r of t){const t=Object.getOwnPropertyDescriptor(o.prototype,r);!t||t.configurable?Object.defineProperty(o.prototype,r,{value:e[r],writable:!0}):console.log(`not patching: ${o.name}.${r.toString()}`)}return Object.defineProperty(o.prototype,n,{value:!0}),o}for(let i of r)Object.defineProperty(p,i,{value:o[i],enumerable:o.propertyIsEnumerable(i)});return Object.defineProperty(p,Symbol.hasInstance,{value:e=>!!e[n]}),p};const Qe=Pe({addWatch(t,s){return this._watches=this._watches||{},!this._watches[t]&&(this._watches[t]=s,!0)},removeWatch(t){if(this._watches)return!!this._watches[t]&&(delete this._watches[t],!0)},notifyWatches(t,s){if(!this._watches)return;const e=this._watches;for(let i in e)e[i](i,t,s)}});const Ue=(r,o=r=>void 0!==r?": "+r:"")=>class extends Error{constructor(e){super(r(e)+o(e))}};const Ye=Ue(()=>"illegal state");const $e=e=>{throw new Ye(e)};const Ta=Array.isArray;const cf=t=>"string"==typeof t;const df=r=>r&&(r instanceof Float32Array||r instanceof Float64Array||r instanceof Uint32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Int8Array||r instanceof Uint16Array||r instanceof Int16Array||r instanceof Uint8ClampedArray);const Ra=t=>Ta(t)?t:cf(t)?t.length>0?t.split("."):[]:null!=t?[t]:[];function ff(e){const t=Ra(e),[r,l,n,$]=t;switch(t.length){case 0:return e=>e;case 1:return e=>null!=e?e[r]:void 0;case 2:return e=>null!=e&&null!=(e=e[r])?e[l]:void 0;case 3:return e=>null!=e&&null!=(e=e[r])&&null!=(e=e[l])?e[n]:void 0;case 4:return e=>null!=e&&null!=(e=e[r])&&null!=(e=e[l])&&null!=(e=e[n])?e[$]:void 0;default:return e=>{const r=t.length-1;let l=e;for(let n=0;null!=l&&n<=r;n++)l=l[t[n]];return l};}}function Pa($){const e=Ra($),[t,r,o,p]=e;switch(e.length){case 0:return($,e)=>e;case 1:return($,e)=>($=a($),$[t]=e,$);case 2:return($,e)=>{let o;return($=a($))[t]=o=a($[t]),o[r]=e,$};case 3:return($,e)=>{let p,c;return($=a($))[t]=p=a($[t]),p[r]=c=a(p[r]),c[o]=e,$};case 4:return($,e)=>{let c,C,G;return($=a($))[t]=c=a($[t]),c[r]=C=a(c[r]),C[o]=G=a(C[o]),G[p]=e,$};default:let $;for(let t=e.length;--t>=0;)$=kf(e[t],$);return $;}}const a=$=>Ta($)||df($)?$.slice():Object.assign({},$);const kf=($,e)=>(t,r)=>(t=a(t),t[$]=e?e(t[$],r):r,t);const Na=(e,$,t,...r)=>Xb(e,$,t,...r);function Xb(e,$,t,...r){return Pa($)(e,t.apply(null,(r.unshift(ff($)(e)),r)))}const Ia=(e,$,t)=>Pa($)(e,t);let Ca=class{constructor(e,t){t&&!t(e)&&$e("initial state value did not validate"),this._value=e,this.valid=t}get value(){return this._value}set value(e){this.reset(e)}deref(){return this._value}equiv(e){return this===e}reset(e){const t=this._value;return this.valid&&!this.valid(e)?t:(this._value=e,this.notifyWatches(t,e),e)}resetIn(e,t){return this.reset(Ia(this._value,e,t))}resetInUnsafe(e,t){return this.reset(Ia(this._value,e,t))}swap(e,...t){return this.reset(e.apply(null,[this._value,...t]))}swapIn(e,t,...r){return this.reset(Na(this._value,e,t,...r))}swapInUnsafe(e,t,...r){return this.reset(Na(this._value,e,t,...r))}addWatch(e,t){}removeWatch(e){}notifyWatches(e,t){}release(){return delete this._watches,delete this._value,!0}};Ca=Me([Qe],Ca);const $b=t=>t[Symbol.iterator]();function*_b(e,r){let t,$={},i=$b(e);for(;!(t=i.next()).done;){let e=r?r(t.value):t.value,i=JSON.stringify(e),o=$[i];o?o[1]++:$[i]=[e,1]}yield*Object.keys($).map(e=>$[e])}function ac($,e){if(Hd($))for(let t of e)$.set(t[0],t[1]);else for(let t of e)$.add(t);return $}const bc=(e,$)=>E(e,"empty")?e.empty():new(e[Symbol.species]||$);const Aa=e=>Pd(e)?e:new Set(e);const dc=(e,$,r)=>r?Q(e(),r):[()=>null,e=>e||new Set,(e,r)=>e?$(e,Aa(r)):Aa(r)];const na=(e,t,r)=>{if(r=r||bc(e,Set),e===t)return ac(r,e);if(t.size<e.size)return na(t,e,r);for(let $ of t)e.has($)&&r.add($);return r};function fc(e){return dc(fc,na,e)}function oa($){return"object"==typeof $&&"string"==typeof $.name}function pa($){return"object"==typeof $&&"number"==typeof $.step&&"number"==typeof $.alt}const ya=[0,2,4,-1,1,3,5],wa=ya.map($=>Math.floor(7*$/12));function ta($){const{step:t,alt:e,oct:r,dir:o=1}=$,p=ya[t]+7*e;return void 0===r?[o*p]:[o*p,o*(r-wa[t]-4*e)]}const lc=[3,0,4,1,5,2,6];function mc($){const[t,e,r]=$,o=lc[Qc(t)],p=Math.floor((t+1)/7);return void 0===e?{step:o,alt:p,dir:r}:{step:o,alt:p,oct:e+4*p+wa[o],dir:r}}function Qc($){const t=($+1)%7;return t<0?7+t:t}const gb={empty:!0,name:"",pc:"",acc:""},ua={},va=($,t)=>Array(t+1).join($),rc=$=>"CDEFGAB".charAt($),ra=$=>$<0?va("b",-$):va("#",$),xa=$=>"b"===$[0]?-$.length:$.length;function j($){return"string"==typeof $?ua[$]||(ua[$]=zc($)):pa($)?j(Ac($)):oa($)?j($.name):gb}const vc=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function wc($){const t=vc.exec($);return[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]}function xc($){return j(mc($))}const za=[0,2,4,5,7,9,11];function zc($){const t=wc($);if(""===t[0]||""!==t[3])return gb;const e=t[0],r=t[1],o=t[2],p=(e.charCodeAt(0)+3)%7,u=xa(r),a=o.length?+o:void 0,n=ta({step:p,alt:u,oct:a}),c=e+r+o,z=e+r,V=(za[p]+u+120)%12,s=void 0===a?-100:a,i=za[p]+u+12*(s+1),l=i>=0&&i<=127?i:null;return{empty:!1,acc:r,alt:u,chroma:V,coord:n,freq:void 0===a?null:440*Math.pow(2,(i-69)/12),height:i,letter:e,midi:l,name:c,oct:a,pc:z,step:p}}function Ac($){const{step:t,alt:e,oct:r}=$,o=rc(t);if(!o)return"";const p=o+ra(e);return r||0===r?p+r:p}const ma={empty:!0,name:"",acc:""},Cc=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$");function Dc($){const t=Cc.exec(`${$}`);return null===t?["",""]:t[1]?[t[1],t[2]]:[t[4],t[3]]}const Ba={};function O($){return"string"==typeof $?Ba[$]||(Ba[$]=Ic($)):pa($)?O(Kc($)):oa($)?O($.name):ma}const Da=[0,2,4,5,7,9,11],Ea="PMMPPMM";function Ic($){const t=Dc($);if(""===t[0])return ma;const e=+t[0],r=t[1],o=(Math.abs(e)-1)%7,p=Ea[o];if("M"===p&&"P"===r)return ma;const u="M"===p?"majorable":"perfectable",a=""+e+r,n=e<0?-1:1,c=8===e||-8===e?e:n*(o+1),z=Jc(u,r),V=Math.floor((Math.abs(e)-1)/7);return{empty:!1,name:a,num:e,q:r,step:o,alt:z,dir:n,type:u,simple:c,semitones:n*(Da[o]+z+12*V),chroma:(n*(Da[o]+z)%12+12)%12,coord:ta({step:o,alt:z,oct:V,dir:n}),oct:V}}function Jc($,t){return"M"===t&&"majorable"===$||"P"===t&&"perfectable"===$?0:"m"===t&&"majorable"===$?-1:/^A+$/.test(t)?t.length:/^d+$/.test(t)?-1*("perfectable"===$?t.length:t.length+1):0}function Kc($){const{step:t,alt:e,oct:r=0,dir:o}=$;return o?(o<0?"-":"")+(t+1+7*r)+Mc("M"===Ea[t]?"majorable":"perfectable",e):""}const Fa=($,t)=>Array(Math.abs(t)+1).join($);function Mc($,t){return 0===t?"majorable"===$?"M":"P":-1===t&&"majorable"===$?"m":t>0?Fa("A",t):Fa("d","perfectable"===$?t:t+1)}function Ga($,t){const e=j($),r=O(t);if(e.empty||r.empty)return"";const o=e.coord,p=r.coord;return xc(1===o.length?[o[0]+p[0]]:[o[0]+p[0],o[1]+p[1]]).name}function Oc($){return+$>=0&&+$<=127}function Ha($){if(Oc($))return+$;const o=j($);return o.empty?null:o.midi}const xf=Math.log(2),wf=Math.log(440);const Sc="C C# D D# E F F# G G# A A# B".split(" "),Tc="C Db D Eb E F Gb G Ab A Bb B".split(" ");function Uc($,o={}){$=Math.round($);const r=(!0===o.sharps?Sc:Tc)[$%12];return o.pitchClass?r:r+(Math.floor($/12)-1)}const Ja=$=>o=>{const r=j(o);if(r.empty)return"";const t=$?r.alt>0:r.alt<0,v=null===r.midi;return Uc(r.midi||r.chroma,{sharps:t,pitchClass:v})},Wc=Ja(!0),vf=Ja(!1);const La={empty:!0,name:"",chordType:""},Ma={};function M($){return"string"==typeof $?Ma[$]||(Ma[$]=fd($)):"number"==typeof $?M(ha[$]||""):pa($)?_c($):oa($)?M($.name):La}function _c($){return M(ra($.alt)+ha[$.step])}const ad=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/;function bd($){return ad.exec($)||["","","",""]}const Oa="I II III IV V VI VII",ha=Oa.split(" "),uf=Oa.toLowerCase().split(" ");function fd($){const[r,e,a,t]=bd($);if(!a)return La;const o=a.toUpperCase(),R=ha.indexOf(o),n=xa(e);return{empty:!1,name:r,roman:a,interval:O({step:R,alt:n,dir:1}).name,acc:e,chordType:t,alt:n,step:R,major:a===o,oct:0,dir:1}}const Qa=t=>(i,a="")=>i.map((i,r)=>"-"!==i?t[r]+a+i:"");function K(t,i,a,r){return o=>{const $=t.split(" "),e=$.map(t=>M(t).interval||""),n=e.map(t=>Ga(o,t)),m=Qa(n);return{tonic:o,grades:$,intervals:e,scale:n,chords:m(i.split(" ")),chordsHarmonicFunction:a.split(" "),chordScales:m(r.split(",")," ")}}}const id=(t,i)=>{const a=j(t),r=j(i);return a.empty||r.empty?0:r.coord[0]-a.coord[0]},jd=K("I II III IV V VI VII","maj7 m7 m7 maj7 7 m7 m7b5","T SD T SD D T D","major,dorian,phrygian,lydian,mixolydian,minor,locrian"),tf=K("I II bIII IV V bVI bVII","m7 m7b5 maj7 m7 m7 maj7 7","T SD T SD D SD SD","minor,locrian,major,dorian,phrygian,lydian,mixolydian"),sf=K("I II bIII IV V bVI VII","mmaj7 m7b5 +maj7 m7 7 maj7 mo7","T SD T SD D SD D","harmonic minor,locrian 6,major augmented,lydian diminished,phrygian dominant,lydian #9,ultralocrian"),rf=K("I II bIII IV V VI VII","m6 m7 +maj7 7 7 m7b5 m7b5","T SD T SD D - -","melodic minor,dorian b2,lydian augmented,lydian dominant,mixolydian b6,locrian #2,altered");function nd(t){const i=jd(t),a=id("C",t),r=Qa(i.scale);return{...i,type:"major",minorRelative:Ga(t,"-3m"),alteration:a,keySignature:ra(a),secondaryDominants:r("- VI7 VII7 I7 II7 III7 -".split(" ")),secondaryDominantsMinorRelative:r("- IIIm7b5 IV#m7 Vm7 VIm7 VIIm7b5 -".split(" ")),substituteDominants:r("- bIII7 IV7 bV7 bVI7 bVII7 -".split(" ")),substituteDominantsMinorRelative:r("- IIIm7 Im7 IIbm7 VIm7 IVm7 -".split(" "))}}var fa,s={};!function(e){function t(){if(t.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");(t.prototype._singleton=this)._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._nrpnBuffer=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],this._nrpnEventsEnabled=!0,this._nrpnTypes=["entry","increment","decrement"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,nrpn:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_NRPN_MESSAGES:{value:{entrymsb:6,entrylsb:38,increment:96,decrement:97,paramlsb:98,parammsb:99,nullactiveparameter:127},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1},octaveOffset:{value:0,writable:!0,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return void 0!==this.interface}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this.interface||!this.interface.sysexEnabled)}.bind(this)},nrpnEventsEnabled:{enumerable:!0,get:function(){return!!this._nrpnEventsEnabled}.bind(this),set:function(e){return this._nrpnEventsEnabled=e,this._nrpnEventsEnabled}},nrpnTypes:{enumerable:!0,get:function(){return this._nrpnTypes}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}var n=new t;function r(e){var t=this;this._userHandlers={channel:{},system:{}},this._midiInput=e,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return t._midiInput.connection}},id:{enumerable:!0,get:function(){return t._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return t._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return t._midiInput.name}},state:{enumerable:!0,get:function(){return t._midiInput.state}},type:{enumerable:!0,get:function(){return t._midiInput.type}}}),this._initializeUserHandlers(),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}function i(e){var t=this;this._midiOutput=e,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return t._midiOutput.connection}},id:{enumerable:!0,get:function(){return t._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return t._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return t._midiOutput.name}},state:{enumerable:!0,get:function(){return t._midiOutput.state}},type:{enumerable:!0,get:function(){return t._midiOutput.type}}})}t.prototype.enable=function(e,t){this.enabled||(this.supported?navigator.requestMIDIAccess({sysex:t}).then(function(t){var n,r=[],i=[];this.interface=t,this._resetInterfaceUserHandlers(),this.interface.onstatechange=function(e){r.push(e)};for(var o=t.inputs.values(),a=o.next();a&&!a.done;a=o.next())i.push(a.value.open());for(var s=t.outputs.values(),u=s.next();u&&!u.done;u=s.next())i.push(u.value.open());function h(){clearTimeout(n),this._updateInputsAndOutputs(),this.interface.onstatechange=this._onInterfaceStateChange.bind(this),"function"==typeof e&&e.call(this),r.forEach(function(e){this._onInterfaceStateChange(e)}.bind(this))}n=setTimeout(h.bind(this),200),Promise&&Promise.all(i).catch(function(e){}).then(h.bind(this))}.bind(this),function(t){"function"==typeof e&&e.call(this,t)}.bind(this)):"function"==typeof e&&e(new Error("The Web MIDI API is not supported by your browser.")))},t.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this.interface&&(this.interface.onstatechange=void 0),this.interface=void 0,this._inputs=[],this._outputs=[],this._nrpnEventsEnabled=!0,this._resetInterfaceUserHandlers()},t.prototype.addListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if("function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(e)))throw new TypeError("The specified event type is not supported.");return this._userHandlers[e].push(t),this},t.prototype.hasListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if("function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(e)))throw new TypeError("The specified event type is not supported.");for(var n=0;n<this._userHandlers[e].length;n++)if(this._userHandlers[e][n]===t)return!0;return!1},t.prototype.removeListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(void 0!==t&&"function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(0<=this._midiInterfaceEvents.indexOf(e)){if(t)for(var n=0;n<this._userHandlers[e].length;n++)this._userHandlers[e][n]===t&&this._userHandlers[e].splice(n,1);else this._userHandlers[e]=[];}else{if(void 0!==e)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},t.prototype.toMIDIChannels=function(e){var t;if("all"===e||void 0===e)t=["all"];else{if("none"===e)return[];t=Array.isArray(e)?e:[e]}return-1<t.indexOf("all")&&(t=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),t.map(function(e){return parseInt(e)}).filter(function(e){return 1<=e&&e<=16})},t.prototype.getInputById=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");e=String(e);for(var t=0;t<this.inputs.length;t++)if(this.inputs[t].id===e)return this.inputs[t];return!1},t.prototype.getOutputById=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");e=String(e);for(var t=0;t<this.outputs.length;t++)if(this.outputs[t].id===e)return this.outputs[t];return!1},t.prototype.getInputByName=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.inputs.length;t++)if(~this.inputs[t].name.indexOf(e))return this.inputs[t];return!1},t.prototype.getOctave=function(e){if(null!=e&&0<=e&&e<=127)return Math.floor(Math.floor(e)/12-1)+Math.floor(n.octaveOffset)},t.prototype.getOutputByName=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.outputs.length;t++)if(~this.outputs[t].name.indexOf(e))return this.outputs[t];return!1},t.prototype.guessNoteNumber=function(e){var t=!1;if(e&&e.toFixed&&0<=e&&e<=127?t=Math.round(e):0<=parseInt(e)&&parseInt(e)<=127?t=parseInt(e):("string"==typeof e||e instanceof String)&&(t=this.noteNameToNumber(e)),!1===t)throw new Error("Invalid input value ("+e+").");return t},t.prototype.noteNameToNumber=function(e){"string"!=typeof e&&(e="");var t=e.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!t)throw new RangeError("Invalid note name.");var r=n._semitones[t[1].toUpperCase()],i=12*(parseInt(t[3])+1-Math.floor(n.octaveOffset))+r;if(-1<t[2].toLowerCase().indexOf("b")?i-=t[2].length:-1<t[2].toLowerCase().indexOf("#")&&(i+=t[2].length),i<0||127<i)throw new RangeError("Invalid note name or note outside valid range.");return i},t.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},t.prototype._updateInputs=function(){for(var e=0;e<this._inputs.length;e++){for(var t=!0,n=this.interface.inputs.values(),i=n.next();i&&!i.done;i=n.next())if(this._inputs[e]._midiInput===i.value){t=!1;break}t&&this._inputs.splice(e,1)}this.interface&&this.interface.inputs.forEach(function(e){for(var t=!0,n=0;n<this._inputs.length;n++)this._inputs[n]._midiInput===e&&(t=!1);t&&this._inputs.push(new r(e))}.bind(this))},t.prototype._updateOutputs=function(){for(var e=0;e<this._outputs.length;e++){for(var t=!0,n=this.interface.outputs.values(),r=n.next();r&&!r.done;r=n.next())if(this._outputs[e]._midiOutput===r.value){t=!1;break}t&&this._outputs.splice(e,1)}this.interface&&this.interface.outputs.forEach(function(e){for(var t=!0,n=0;n<this._outputs.length;n++)this._outputs[n]._midiOutput===e&&(t=!1);t&&this._outputs.push(new i(e))}.bind(this))},t.prototype._onInterfaceStateChange=function(e){this._updateInputsAndOutputs();var t={timestamp:e.timeStamp,type:e.port.state};this.interface&&"connected"===e.port.state?"output"===e.port.type?t.port=this.getOutputById(e.port.id):"input"===e.port.type&&(t.port=this.getInputById(e.port.id)):t.port={connection:"closed",id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this._userHandlers[e.port.state].forEach(function(e){e(t)})},t.prototype._resetInterfaceUserHandlers=function(){for(var e=0;e<this._midiInterfaceEvents.length;e++)this._userHandlers[this._midiInterfaceEvents[e]]=[]},r.prototype.on=r.prototype.addListener=function(e,t,r){var i=this;if(void 0===t&&(t="all"),Array.isArray(t)||(t=[t]),t.forEach(function(e){if("all"!==e&&!(1<=e&&e<=16))throw new RangeError("The 'channel' parameter is invalid.")}),"function"!=typeof r)throw new TypeError("The 'listener' parameter must be a function.");if(void 0!==n.MIDI_SYSTEM_MESSAGES[e])this._userHandlers.system[e]||(this._userHandlers.system[e]=[]),this._userHandlers.system[e].push(r);else{if(void 0===n.MIDI_CHANNEL_MESSAGES[e])throw new TypeError("The specified event type is not supported.");if(-1<t.indexOf("all")){t=[];for(var o=1;o<=16;o++)t.push(o)}this._userHandlers.channel[e]||(this._userHandlers.channel[e]=[]),t.forEach(function(t){i._userHandlers.channel[e][t]||(i._userHandlers.channel[e][t]=[]),i._userHandlers.channel[e][t].push(r)})}return this},r.prototype.hasListener=function(e,t,r){var i=this;if("function"!=typeof r)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===t&&(t="all"),t.constructor!==Array&&(t=[t]),void 0!==n.MIDI_SYSTEM_MESSAGES[e]){for(var o=0;o<this._userHandlers.system[e].length;o++)if(this._userHandlers.system[e][o]===r)return!0}else if(void 0!==n.MIDI_CHANNEL_MESSAGES[e]){if(-1<t.indexOf("all")){t=[];for(var a=1;a<=16;a++)t.push(a)}return!!this._userHandlers.channel[e]&&t.every(function(t){var n=i._userHandlers.channel[e][t];return n&&-1<n.indexOf(r)})}return!1},r.prototype.removeListener=function(e,t,r){var i=this;if(void 0!==r&&"function"!=typeof r)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===t&&(t="all"),t.constructor!==Array&&(t=[t]),void 0!==n.MIDI_SYSTEM_MESSAGES[e]){if(void 0===r)this._userHandlers.system[e]=[];else for(var o=0;o<this._userHandlers.system[e].length;o++)this._userHandlers.system[e][o]===r&&this._userHandlers.system[e].splice(o,1);}else if(void 0!==n.MIDI_CHANNEL_MESSAGES[e]){if(-1<t.indexOf("all")){t=[];for(var a=1;a<=16;a++)t.push(a)}if(!this._userHandlers.channel[e])return this;t.forEach(function(t){var n=i._userHandlers.channel[e][t];if(n)if(void 0===r)i._userHandlers.channel[e][t]=[];else for(var o=0;o<n.length;o++)n[o]===r&&n.splice(o,1)})}else{if(void 0!==e)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},r.prototype._initializeUserHandlers=function(){for(var e in n.MIDI_CHANNEL_MESSAGES)n.MIDI_CHANNEL_MESSAGES.hasOwnProperty(e)&&(this._userHandlers.channel[e]={});for(var t in n.MIDI_SYSTEM_MESSAGES)n.MIDI_SYSTEM_MESSAGES.hasOwnProperty(t)&&(this._userHandlers.system[t]=[])},r.prototype._onMidiMessage=function(e){if(0<this._userHandlers.system.midimessage.length){var t={target:this,data:e.data,timestamp:e.timeStamp,type:"midimessage"};this._userHandlers.system.midimessage.forEach(function(e){e(t)})}e.data[0]<240?(this._parseChannelEvent(e),this._parseNrpnEvent(e)):e.data[0]<=255&&this._parseSystemEvent(e)},r.prototype._parseNrpnEvent=function(e){var t,r,i=e.data[0]>>4,o=15&e.data[0],a=1+o;if(1<e.data.length&&(t=e.data[1],r=2<e.data.length?e.data[2]:void 0),n.nrpnEventsEnabled&&i===n.MIDI_CHANNEL_MESSAGES.controlchange&&(t>=n.MIDI_NRPN_MESSAGES.increment&&t<=n.MIDI_NRPN_MESSAGES.parammsb||t===n.MIDI_NRPN_MESSAGES.entrymsb||t===n.MIDI_NRPN_MESSAGES.entrylsb)){var s={target:this,type:"controlchange",data:e.data,timestamp:e.timeStamp,channel:a,controller:{number:t,name:this.getCcNameByNumber(t)},value:r};if(s.controller.number===n.MIDI_NRPN_MESSAGES.parammsb&&s.value!=n.MIDI_NRPN_MESSAGES.nullactiveparameter)n._nrpnBuffer[o]=[],n._nrpnBuffer[o][0]=s;else if(1===n._nrpnBuffer[o].length&&s.controller.number===n.MIDI_NRPN_MESSAGES.paramlsb)n._nrpnBuffer[o].push(s);else if(2!==n._nrpnBuffer[o].length||s.controller.number!==n.MIDI_NRPN_MESSAGES.increment&&s.controller.number!==n.MIDI_NRPN_MESSAGES.decrement&&s.controller.number!==n.MIDI_NRPN_MESSAGES.entrymsb){if(3===n._nrpnBuffer[o].length&&n._nrpnBuffer[o][2].number===n.MIDI_NRPN_MESSAGES.entrymsb&&s.controller.number===n.MIDI_NRPN_MESSAGES.entrylsb)n._nrpnBuffer[o].push(s);else if(3<=n._nrpnBuffer[o].length&&n._nrpnBuffer[o].length<=4&&s.controller.number===n.MIDI_NRPN_MESSAGES.parammsb&&s.value===n.MIDI_NRPN_MESSAGES.nullactiveparameter)n._nrpnBuffer[o].push(s);else if(4<=n._nrpnBuffer[o].length&&n._nrpnBuffer[o].length<=5&&s.controller.number===n.MIDI_NRPN_MESSAGES.paramlsb&&s.value===n.MIDI_NRPN_MESSAGES.nullactiveparameter){n._nrpnBuffer[o].push(s);var u=[];n._nrpnBuffer[o].forEach(function(e){u.push(e.data)});var h=n._nrpnBuffer[o][0].value<<7|n._nrpnBuffer[o][1].value,l=n._nrpnBuffer[o][2].value;6===n._nrpnBuffer[o].length&&(l=n._nrpnBuffer[o][2].value<<7|n._nrpnBuffer[o][3].value);var p="";switch(n._nrpnBuffer[o][2].controller.number){case n.MIDI_NRPN_MESSAGES.entrymsb:p=n._nrpnTypes[0];break;case n.MIDI_NRPN_MESSAGES.increment:p=n._nrpnTypes[1];break;case n.MIDI_NRPN_MESSAGES.decrement:p=n._nrpnTypes[2];break;default:throw new Error("The NPRN type was unidentifiable.");}var c={timestamp:s.timestamp,channel:s.channel,type:"nrpn",data:u,controller:{number:h,type:p,name:"Non-Registered Parameter "+h},value:l};n._nrpnBuffer[o]=[],this._userHandlers.channel[c.type]&&this._userHandlers.channel[c.type][c.channel]&&this._userHandlers.channel[c.type][c.channel].forEach(function(e){e(c)})}else n._nrpnBuffer[o]=[];}else n._nrpnBuffer[o].push(s)}},r.prototype._parseChannelEvent=function(e){var t,r,i=e.data[0]>>4,o=1+(15&e.data[0]);1<e.data.length&&(t=e.data[1],r=2<e.data.length?e.data[2]:void 0);var a={target:this,data:e.data,timestamp:e.timeStamp,channel:o};i===n.MIDI_CHANNEL_MESSAGES.noteoff||i===n.MIDI_CHANNEL_MESSAGES.noteon&&0===r?(a.type="noteoff",a.note={number:t,name:n._notes[t%12],octave:n.getOctave(t)},a.velocity=r/127,a.rawVelocity=r):i===n.MIDI_CHANNEL_MESSAGES.noteon?(a.type="noteon",a.note={number:t,name:n._notes[t%12],octave:n.getOctave(t)},a.velocity=r/127,a.rawVelocity=r):i===n.MIDI_CHANNEL_MESSAGES.keyaftertouch?(a.type="keyaftertouch",a.note={number:t,name:n._notes[t%12],octave:n.getOctave(t)},a.value=r/127):i===n.MIDI_CHANNEL_MESSAGES.controlchange&&0<=t&&t<=119?(a.type="controlchange",a.controller={number:t,name:this.getCcNameByNumber(t)},a.value=r):i===n.MIDI_CHANNEL_MESSAGES.channelmode&&120<=t&&t<=127?(a.type="channelmode",a.controller={number:t,name:this.getChannelModeByNumber(t)},a.value=r):i===n.MIDI_CHANNEL_MESSAGES.programchange?(a.type="programchange",a.value=t):i===n.MIDI_CHANNEL_MESSAGES.channelaftertouch?(a.type="channelaftertouch",a.value=t/127):i===n.MIDI_CHANNEL_MESSAGES.pitchbend?(a.type="pitchbend",a.value=((r<<7)+t-8192)/8192):a.type="unknownchannelmessage",this._userHandlers.channel[a.type]&&this._userHandlers.channel[a.type][o]&&this._userHandlers.channel[a.type][o].forEach(function(e){e(a)})},r.prototype.getCcNameByNumber=function(e){if(!(0<=(e=Math.floor(e))&&e<=119))throw new RangeError("The control change number must be between 0 and 119.");for(var t in n.MIDI_CONTROL_CHANGE_MESSAGES)if(n.MIDI_CONTROL_CHANGE_MESSAGES.hasOwnProperty(t)&&e===n.MIDI_CONTROL_CHANGE_MESSAGES[t])return t},r.prototype.getChannelModeByNumber=function(e){if(!(120<=(e=Math.floor(e))&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var t in n.MIDI_CHANNEL_MODE_MESSAGES)if(n.MIDI_CHANNEL_MODE_MESSAGES.hasOwnProperty(t)&&e===n.MIDI_CHANNEL_MODE_MESSAGES[t])return t},r.prototype._parseSystemEvent=function(e){var t=e.data[0],r={target:this,data:e.data,timestamp:e.timeStamp};t===n.MIDI_SYSTEM_MESSAGES.sysex?r.type="sysex":t===n.MIDI_SYSTEM_MESSAGES.timecode?r.type="timecode":t===n.MIDI_SYSTEM_MESSAGES.songposition?r.type="songposition":t===n.MIDI_SYSTEM_MESSAGES.songselect?(r.type="songselect",r.song=e.data[1]):t===n.MIDI_SYSTEM_MESSAGES.tuningrequest?r.type="tuningrequest":t===n.MIDI_SYSTEM_MESSAGES.clock?r.type="clock":t===n.MIDI_SYSTEM_MESSAGES.start?r.type="start":t===n.MIDI_SYSTEM_MESSAGES.continue?r.type="continue":t===n.MIDI_SYSTEM_MESSAGES.stop?r.type="stop":t===n.MIDI_SYSTEM_MESSAGES.activesensing?r.type="activesensing":t===n.MIDI_SYSTEM_MESSAGES.reset?r.type="reset":r.type="unknownsystemmessage",this._userHandlers.system[r.type]&&this._userHandlers.system[r.type].forEach(function(e){e(r)})},i.prototype.send=function(e,t,n){if(!(128<=e&&e<=255))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");void 0===t&&(t=[]),Array.isArray(t)||(t=[t]);var r=[];return t.forEach(function(e){var t=Math.floor(e);if(!(0<=t&&t<=255))throw new RangeError("Data bytes must be integers between 0 (0x00) and 255 (0xFF).");r.push(t)}),this._midiOutput.send([e].concat(r),parseFloat(n)||0),this},i.prototype.sendSysex=function(e,t,r){if(!n.sysexEnabled)throw new Error("Sysex message support must first be activated.");return r=r||{},e=[].concat(e),t.forEach(function(e){if(e<0||127<e)throw new RangeError("The data bytes of a sysex message must be integers between 0 (0x00) and 127 (0x7F).")}),t=e.concat(t,n.MIDI_SYSTEM_MESSAGES.sysexend),this.send(n.MIDI_SYSTEM_MESSAGES.sysex,t,this._parseTimeParameter(r.time)),this},i.prototype.sendTimecodeQuarterFrame=function(e,t){return t=t||{},this.send(n.MIDI_SYSTEM_MESSAGES.timecode,e,this._parseTimeParameter(t.time)),this},i.prototype.sendSongPosition=function(e,t){t=t||{};var r=(e=Math.floor(e)||0)>>7&127,i=127&e;return this.send(n.MIDI_SYSTEM_MESSAGES.songposition,[r,i],this._parseTimeParameter(t.time)),this},i.prototype.sendSongSelect=function(e,t){if(t=t||{},!(0<=(e=Math.floor(e))&&e<=127))throw new RangeError("The song number must be between 0 and 127.");return this.send(n.MIDI_SYSTEM_MESSAGES.songselect,[e],this._parseTimeParameter(t.time)),this},i.prototype.sendTuningRequest=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendClock=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendStart=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendContinue=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.continue,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendStop=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendActiveSensing=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.activesensing,[],this._parseTimeParameter(e.time)),this},i.prototype.sendReset=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(e.time)),this},i.prototype.stopNote=function(e,t,r){if("all"===e)return this.sendChannelMode("allnotesoff",0,t,r);var i=64;return(r=r||{}).rawVelocity?!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=127&&(i=r.velocity):!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=1&&(i=127*r.velocity),this._convertNoteToArray(e).forEach(function(e){n.toMIDIChannels(t).forEach(function(t){this.send((n.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(t-1),[e,Math.round(i)],this._parseTimeParameter(r.time))}.bind(this))}.bind(this)),this},i.prototype.playNote=function(e,t,r){var i,o=64;if((r=r||{}).rawVelocity?!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=127&&(o=r.velocity):!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=1&&(o=127*r.velocity),i=this._parseTimeParameter(r.time),this._convertNoteToArray(e).forEach(function(e){n.toMIDIChannels(t).forEach(function(t){this.send((n.MIDI_CHANNEL_MESSAGES.noteon<<4)+(t-1),[e,Math.round(o)],i)}.bind(this))}.bind(this)),!isNaN(r.duration)){r.duration<=0&&(r.duration=0);var a=64;r.rawVelocity?!isNaN(r.release)&&0<=r.release&&r.release<=127&&(a=r.release):!isNaN(r.release)&&0<=r.release&&r.release<=1&&(a=127*r.release),this._convertNoteToArray(e).forEach(function(e){n.toMIDIChannels(t).forEach(function(t){this.send((n.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(t-1),[e,Math.round(a)],(i||n.time)+r.duration)}.bind(this))}.bind(this))}return this},i.prototype.sendKeyAftertouch=function(e,t,r,i){var o=this;if(i=i||{},t<1||16<t)throw new RangeError("The channel must be between 1 and 16.");(isNaN(r)||r<0||1<r)&&(r=.5);var a=Math.round(127*r);return this._convertNoteToArray(e).forEach(function(e){n.toMIDIChannels(t).forEach(function(t){o.send((n.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(t-1),[e,a],o._parseTimeParameter(i.time))})}),this},i.prototype.sendControlChange=function(e,t,r,i){if(i=i||{},"string"==typeof e){if(void 0===(e=n.MIDI_CONTROL_CHANGE_MESSAGES[e]))throw new TypeError("Invalid controller name.")}else if(!(0<=(e=Math.floor(e))&&e<=119))throw new RangeError("Controller numbers must be between 0 and 119.");if(!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("Controller value must be between 0 and 127.");return n.toMIDIChannels(r).forEach(function(r){this.send((n.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(r-1),[e,t],this._parseTimeParameter(i.time))}.bind(this)),this},i.prototype._selectRegisteredParameter=function(e,t,r){var i=this;if(e[0]=Math.floor(e[0]),!(0<=e[0]&&e[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(e[1]=Math.floor(e[1]),!(0<=e[1]&&e[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return n.toMIDIChannels(t).forEach(function(){i.sendControlChange(101,e[0],t,{time:r}),i.sendControlChange(100,e[1],t,{time:r})}),this},i.prototype._selectNonRegisteredParameter=function(e,t,r){var i=this;if(e[0]=Math.floor(e[0]),!(0<=e[0]&&e[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(e[1]=Math.floor(e[1]),!(0<=e[1]&&e[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return n.toMIDIChannels(t).forEach(function(){i.sendControlChange(99,e[0],t,{time:r}),i.sendControlChange(98,e[1],t,{time:r})}),this},i.prototype._setCurrentRegisteredParameter=function(e,t,r){var i=this;if((e=[].concat(e))[0]=Math.floor(e[0]),!(0<=e[0]&&e[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return n.toMIDIChannels(t).forEach(function(){i.sendControlChange(6,e[0],t,{time:r})}),e[1]=Math.floor(e[1]),0<=e[1]&&e[1]<=127&&n.toMIDIChannels(t).forEach(function(){i.sendControlChange(38,e[1],t,{time:r})}),this},i.prototype._deselectRegisteredParameter=function(e,t){var r=this;return n.toMIDIChannels(e).forEach(function(){r.sendControlChange(101,127,e,{time:t}),r.sendControlChange(100,127,e,{time:t})}),this},i.prototype.setRegisteredParameter=function(e,t,r,i){var o=this;if(i=i||{},!Array.isArray(e)){if(!n.MIDI_REGISTERED_PARAMETER[e])throw new Error("The specified parameter is not available.");e=n.MIDI_REGISTERED_PARAMETER[e]}return n.toMIDIChannels(r).forEach(function(){o._selectRegisteredParameter(e,r,i.time),o._setCurrentRegisteredParameter(t,r,i.time),o._deselectRegisteredParameter(r,i.time)}),this},i.prototype.setNonRegisteredParameter=function(e,t,r,i){var o=this;if(i=i||{},!(0<=e[0]&&e[0]<=127&&0<=e[1]&&e[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return t=[].concat(t),n.toMIDIChannels(r).forEach(function(){o._selectNonRegisteredParameter(e,r,i.time),o._setCurrentRegisteredParameter(t,r,i.time),o._deselectRegisteredParameter(r,i.time)}),this},i.prototype.incrementRegisteredParameter=function(e,t,r){var i=this;if(r=r||{},!Array.isArray(e)){if(!n.MIDI_REGISTERED_PARAMETER[e])throw new Error("The specified parameter is not available.");e=n.MIDI_REGISTERED_PARAMETER[e]}return n.toMIDIChannels(t).forEach(function(){i._selectRegisteredParameter(e,t,r.time),i.sendControlChange(96,0,t,{time:r.time}),i._deselectRegisteredParameter(t,r.time)}),this},i.prototype.decrementRegisteredParameter=function(e,t,r){if(r=r||{},!Array.isArray(e)){if(!n.MIDI_REGISTERED_PARAMETER[e])throw new TypeError("The specified parameter is not available.");e=n.MIDI_REGISTERED_PARAMETER[e]}return n.toMIDIChannels(t).forEach(function(){this._selectRegisteredParameter(e,t,r.time),this.sendControlChange(97,0,t,{time:r.time}),this._deselectRegisteredParameter(t,r.time)}.bind(this)),this},i.prototype.setPitchBendRange=function(e,t,r,i){var o=this;if(i=i||{},!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The cents value must be between 0 and 127");return n.toMIDIChannels(r).forEach(function(){o.setRegisteredParameter("pitchbendrange",[e,t],r,{time:i.time})}),this},i.prototype.setModulationRange=function(e,t,r,i){var o=this;if(i=i||{},!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The cents value must be between 0 and 127");return n.toMIDIChannels(r).forEach(function(){o.setRegisteredParameter("modulationrange",[e,t],r,{time:i.time})}),this},i.prototype.setMasterTuning=function(e,t,r){var i=this;if(r=r||{},(e=parseFloat(e)||0)<=-65||64<=e)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var o=Math.floor(e)+64,a=e-Math.floor(e),s=(a=Math.round((a+1)/2*16383))>>7&127,u=127&a;return n.toMIDIChannels(t).forEach(function(){i.setRegisteredParameter("channelcoarsetuning",o,t,{time:r.time}),i.setRegisteredParameter("channelfinetuning",[s,u],t,{time:r.time})}),this},i.prototype.setTuningProgram=function(e,t,r){var i=this;if(r=r||{},!(0<=(e=Math.floor(e))&&e<=127))throw new RangeError("The program value must be between 0 and 127");return n.toMIDIChannels(t).forEach(function(){i.setRegisteredParameter("tuningprogram",e,t,{time:r.time})}),this},i.prototype.setTuningBank=function(e,t,r){var i=this;if(r=r||{},!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("The bank value must be between 0 and 127");return n.toMIDIChannels(t).forEach(function(){i.setRegisteredParameter("tuningbank",e,t,{time:r.time})}),this},i.prototype.sendChannelMode=function(e,t,r,i){if(i=i||{},"string"==typeof e){if(!(e=n.MIDI_CHANNEL_MODE_MESSAGES[e]))throw new TypeError("Invalid channel mode message name.")}else if(!(120<=(e=Math.floor(e))&&e<=127))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if((t=Math.floor(t)||0)<0||127<t)throw new RangeError("Value must be an integer between 0 and 127.");return n.toMIDIChannels(r).forEach(function(r){this.send((n.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(r-1),[e,t],this._parseTimeParameter(i.time))}.bind(this)),this},i.prototype.sendProgramChange=function(e,t,r){var i=this;if(r=r||{},e=Math.floor(e),isNaN(e)||e<0||127<e)throw new RangeError("Program numbers must be between 0 and 127.");return n.toMIDIChannels(t).forEach(function(t){i.send((n.MIDI_CHANNEL_MESSAGES.programchange<<4)+(t-1),[e],i._parseTimeParameter(r.time))}),this},i.prototype.sendChannelAftertouch=function(e,t,r){var i=this;r=r||{},e=parseFloat(e),(isNaN(e)||e<0||1<e)&&(e=.5);var o=Math.round(127*e);return n.toMIDIChannels(t).forEach(function(e){i.send((n.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(e-1),[o],i._parseTimeParameter(r.time))}),this},i.prototype.sendPitchBend=function(e,t,r){var i=this;if(r=r||{},isNaN(e)||e<-1||1<e)throw new RangeError("Pitch bend value must be between -1 and 1.");var o=Math.round((e+1)/2*16383),a=o>>7&127,s=127&o;return n.toMIDIChannels(t).forEach(function(e){i.send((n.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(e-1),[s,a],i._parseTimeParameter(r.time))}),this},i.prototype._parseTimeParameter=function(e){var t,r=parseFloat(e);return"string"==typeof e&&"+"===e.substring(0,1)?r&&0<r&&(t=n.time+r):r>n.time&&(t=r),t},i.prototype._convertNoteToArray=function(e){var t=[];return Array.isArray(e)||(e=[e]),e.forEach(function(e){t.push(n.guessNoteNumber(e))}),t},"function"==typeof fa&&"object"==typeof fa.amd?fa([],function(){return n}):s?s=n:e.WebMidi||(e.WebMidi=n)}(s);var qd={};function rd(e){var r=new d(e),t=r.readChunk();if("MThd"!=t.id)throw"Bad MIDI file.  Expected 'MHdr', got: '"+t.id+"'";for(var a=sd(t.data),n=[],s=0;!r.eof()&&s<a.numTracks;s++){var o=r.readChunk();if("MTrk"!=o.id)throw"Bad MIDI file.  Expected 'MTrk', got: '"+o.id+"'";var i=td(o.data);n.push(i)}return{header:a,tracks:n}}function sd(e){var r=new d(e),t={format:r.readUInt16(),numTracks:r.readUInt16()},a=r.readUInt16();return 32768&a?(t.framesPerSecond=256-(a>>8),t.ticksPerFrame=255&a):t.ticksPerBeat=a,t}function td(e){for(var r,t=new d(e),a=[];!t.eof();){var n=s();a.push(n)}return a;function s(){var e={};e.deltaTime=t.readVarInt();var a=t.readUInt8();if(240==(240&a)){if(255!==a){if(240==a){e.type="sysEx";s=t.readVarInt();return e.data=t.readBytes(s),e}if(247==a){e.type="endSysEx";s=t.readVarInt();return e.data=t.readBytes(s),e}throw"Unrecognised MIDI event type byte: "+a}e.meta=!0;var n=t.readUInt8(),s=t.readVarInt();switch(n){case 0:if(e.type="sequenceNumber",2!==s)throw"Expected length for sequenceNumber event is 2, got "+s;return e.number=t.readUInt16(),e;case 1:return e.type="text",e.text=t.readString(s),e;case 2:return e.type="copyrightNotice",e.text=t.readString(s),e;case 3:return e.type="trackName",e.text=t.readString(s),e;case 4:return e.type="instrumentName",e.text=t.readString(s),e;case 5:return e.type="lyrics",e.text=t.readString(s),e;case 6:return e.type="marker",e.text=t.readString(s),e;case 7:return e.type="cuePoint",e.text=t.readString(s),e;case 32:if(e.type="channelPrefix",1!=s)throw"Expected length for channelPrefix event is 1, got "+s;return e.channel=t.readUInt8(),e;case 33:if(e.type="portPrefix",1!=s)throw"Expected length for portPrefix event is 1, got "+s;return e.port=t.readUInt8(),e;case 47:if(e.type="endOfTrack",0!=s)throw"Expected length for endOfTrack event is 0, got "+s;return e;case 81:if(e.type="setTempo",3!=s)throw"Expected length for setTempo event is 3, got "+s;return e.microsecondsPerBeat=t.readUInt24(),e;case 84:if(e.type="smpteOffset",5!=s)throw"Expected length for smpteOffset event is 5, got "+s;var o=t.readUInt8();return e.frameRate={0:24,32:25,64:29,96:30}[96&o],e.hour=31&o,e.min=t.readUInt8(),e.sec=t.readUInt8(),e.frame=t.readUInt8(),e.subFrame=t.readUInt8(),e;case 88:if(e.type="timeSignature",4!=s)throw"Expected length for timeSignature event is 4, got "+s;return e.numerator=t.readUInt8(),e.denominator=1<<t.readUInt8(),e.metronome=t.readUInt8(),e.thirtyseconds=t.readUInt8(),e;case 89:if(e.type="keySignature",2!=s)throw"Expected length for keySignature event is 2, got "+s;return e.key=t.readInt8(),e.scale=t.readUInt8(),e;case 127:return e.type="sequencerSpecific",e.data=t.readBytes(s),e;default:return e.type="unknownMeta",e.data=t.readBytes(s),e.metatypeByte=n,e;}}else{var i;if(0==(128&a)){if(null===r)throw"Running status byte encountered before status byte";i=a,a=r,e.running=!0}else i=t.readUInt8(),r=a;var d=a>>4;switch(e.channel=15&a,d){case 8:return e.type="noteOff",e.noteNumber=i,e.velocity=t.readUInt8(),e;case 9:var u=t.readUInt8();return e.type=0===u?"noteOff":"noteOn",e.noteNumber=i,e.velocity=u,0===u&&(e.byte9=!0),e;case 10:return e.type="noteAftertouch",e.noteNumber=i,e.amount=t.readUInt8(),e;case 11:return e.type="controller",e.controllerType=i,e.value=t.readUInt8(),e;case 12:return e.type="programChange",e.programNumber=i,e;case 13:return e.type="channelAftertouch",e.amount=i,e;case 14:return e.type="pitchBend",e.value=i+(t.readUInt8()<<7)-8192,e;default:throw"Unrecognised MIDI event type: "+d;}}}}function d(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}d.prototype.eof=function(){return this.pos>=this.bufferLen},d.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e},d.prototype.readInt8=function(){var e=this.readUInt8();return 128&e?e-256:e},d.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},d.prototype.readInt16=function(){var e=this.readUInt16();return 32768&e?e-65536:e},d.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},d.prototype.readInt24=function(){var e=this.readUInt24();return 8388608&e?e-16777216:e},d.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},d.prototype.readBytes=function(e){var r=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,r},d.prototype.readString=function(e){var r=this.readBytes(e);return String.fromCharCode.apply(null,r)},d.prototype.readVarInt=function(){for(var e=0;!this.eof();){var r=this.readUInt8();if(!(128&r))return e+r;e+=127&r,e<<=7}return e},d.prototype.readChunk=function(){var e=this.readString(4),r=this.readUInt32();return{id:e,length:r,data:this.readBytes(r)}},qd=rd;var vd={};function wd(t,e){if("object"!=typeof t)throw"Invalid MIDI data";e=e||{};var r,n=t.header||{},i=t.tracks||[],a=i.length,w=new c;for(xd(w,n,a),r=0;r<a;r++)yd(w,i[r],e);return w.buffer}function xd(t,e,r){var n=null==e.format?1:e.format,i=128;e.timeDivision?i=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?i=-(255&e.framesPerSecond)<<8|255&e.ticksPerFrame:e.ticksPerBeat&&(i=32767&e.ticksPerBeat);var a=new c;a.writeUInt16(n),a.writeUInt16(r),a.writeUInt16(i),t.writeChunk("MThd",a.buffer)}function yd(t,e,r){var n,i=new c,a=e.length,w=null;for(n=0;n<a;n++)!1!==r.running&&(r.running||e[n].running)||(w=null),w=zd(i,e[n],w,r.useByte9ForNoteOff);t.writeChunk("MTrk",i.buffer)}function zd(t,e,r,n){var i=e.type,a=e.deltaTime,w=e.text||"",I=e.data||[],o=null;switch(t.writeVarInt(a),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(w.length),t.writeString(w);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(w.length),t.writeString(w);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(w.length),t.writeString(w);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(w.length),t.writeString(w);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(w.length),t.writeString(w);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(w.length),t.writeString(w);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(w.length),t.writeString(w);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var U=31&e.hour|{24:0,25:32,29:64,30:96}[e.frameRate];t.writeUInt8(U),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var s=255&Math.floor(Math.log(e.denominator)/Math.LN2);t.writeUInt8(s),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(I.length),t.writeBytes(I);break;case"unknownMeta":null!=e.metatypeByte&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(I.length),t.writeBytes(I));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(I.length),t.writeBytes(I);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(I.length),t.writeBytes(I);break;case"noteOff":(o=(!1!==n&&e.byte9||n&&0==e.velocity?144:128)|e.channel)!==r&&t.writeUInt8(o),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":(o=144|e.channel)!==r&&t.writeUInt8(o),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":(o=160|e.channel)!==r&&t.writeUInt8(o),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":(o=176|e.channel)!==r&&t.writeUInt8(o),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":(o=192|e.channel)!==r&&t.writeUInt8(o),t.writeUInt8(e.programNumber);break;case"channelAftertouch":(o=208|e.channel)!==r&&t.writeUInt8(o),t.writeUInt8(e.amount);break;case"pitchBend":(o=224|e.channel)!==r&&t.writeUInt8(o);var c=8192+e.value,$=127&c,l=c>>7&127;t.writeUInt8($),t.writeUInt8(l);break;default:throw"Unrecognized event type: "+i;}return o}function c(){this.buffer=[]}c.prototype.writeUInt8=function(t){this.buffer.push(255&t)},c.prototype.writeInt8=c.prototype.writeUInt8,c.prototype.writeUInt16=function(t){var e=t>>8&255,r=255&t;this.writeUInt8(e),this.writeUInt8(r)},c.prototype.writeInt16=c.prototype.writeUInt16,c.prototype.writeUInt24=function(t){var e=t>>16&255,r=t>>8&255,n=255&t;this.writeUInt8(e),this.writeUInt8(r),this.writeUInt8(n)},c.prototype.writeInt24=c.prototype.writeUInt24,c.prototype.writeUInt32=function(t){var e=t>>24&255,r=t>>16&255,n=t>>8&255,i=255&t;this.writeUInt8(e),this.writeUInt8(r),this.writeUInt8(n),this.writeUInt8(i)},c.prototype.writeInt32=c.prototype.writeUInt32,c.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))},c.prototype.writeString=function(t){var e,r=t.length,n=[];for(e=0;e<r;e++)n.push(t.codePointAt(e));this.writeBytes(n)},c.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,r=[];for(r.push(127&e),e>>=7;e;){var n=127&e|128;r.push(n),e>>=7}this.writeBytes(r.reverse())}},c.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)},vd=wd;var $={};function Ya(r,e,$){void 0===$&&($="ticks");var o=0,t=r.length,s=t;if(t>0&&r[t-1][$]<=e)return t-1;for(;o<s;){var a=Math.floor(o+(s-o)/2),i=r[a],n=r[a+1];if(i[$]===e){for(var v=a;v<r.length;v++){r[v][$]===e&&(a=v)}return a}if(i[$]<e&&n[$]>e)return a;i[$]>e?s=a:i[$]<e&&(o=a+1)}return-1}Object.defineProperty($,"__esModule",{value:!0});var x=Ya;function Ed(r,e,$){if(void 0===$&&($="ticks"),r.length){var o=Ya(r,e[$],$);r.splice(o+1,0,e)}else r.push(e)}$.search=x;var F=Ed;$.insert=F;var X={};Object.defineProperty(X,"__esModule",{value:!0});var C=new WeakMap,R=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];X.keySignatureKeys=R;var Jd=function(){function t(t){var e=this;this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",C.set(this,480),t&&(C.set(this,t.header.ticksPerBeat),t.tracks[0].forEach(function(t){t.meta&&("timeSignature"===t.type?e.timeSignatures.push({ticks:t.absoluteTime,timeSignature:[t.numerator,t.denominator]}):"setTempo"===t.type?e.tempos.push({bpm:6e7/t.microsecondsPerBeat,ticks:t.absoluteTime}):"keySignature"===t.type?e.keySignatures.push({key:R[t.key+7],scale:0===t.scale?"major":"minor",ticks:t.absoluteTime}):"trackName"===t.type?e.name=t.text:"endOfTrack"!==t.type&&e.meta.push({text:t.text,ticks:t.absoluteTime,type:t.type}))}),this.update())}return t.prototype.update=function(){var t=this,e=0,i=0;this.tempos.sort(function(t,e){return t.ticks-e.ticks}),this.tempos.forEach(function(r,s){var a=s>0?t.tempos[s-1].bpm:t.tempos[0].bpm,n=r.ticks/t.ppq-i,p=60/a*n;r.time=p+e,e=r.time,i+=n}),this.timeSignatures.sort(function(t,e){return t.ticks-e.ticks}),this.timeSignatures.forEach(function(e,i){var r=i>0?t.timeSignatures[i-1]:t.timeSignatures[0],s=(e.ticks-r.ticks)/t.ppq/r.timeSignature[0]/(r.timeSignature[1]/4);r.measures=r.measures||0,e.measures=s+r.measures})},t.prototype.ticksToSeconds=function(t){var e=x(this.tempos,t);if(-1!==e){var i=this.tempos[e],r=i.time,s=(t-i.ticks)/this.ppq;return r+60/i.bpm*s}return .5*(t/this.ppq)},t.prototype.ticksToMeasures=function(t){var e=x(this.timeSignatures,t);if(-1!==e){var i=this.timeSignatures[e],r=(t-i.ticks)/this.ppq;return i.measures+r/(i.timeSignature[0]/i.timeSignature[1])/4}return t/this.ppq/4},Object.defineProperty(t.prototype,"ppq",{get:function(){return C.get(this)},enumerable:!0,configurable:!0}),t.prototype.secondsToTicks=function(t){var e=x(this.tempos,t,"time");if(-1!==e){var i=this.tempos[e],r=(t-i.time)/(60/i.bpm);return Math.round(i.ticks+r*this.ppq)}var s=t/.5;return Math.round(s*this.ppq)},t.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(t){return{bpm:t.bpm,ticks:t.ticks}}),timeSignatures:this.timeSignatures}},t.prototype.fromJSON=function(t){this.name=t.name,this.tempos=t.tempos.map(function(t){return Object.assign({},t)}),this.timeSignatures=t.timeSignatures.map(function(t){return Object.assign({},t)}),this.keySignatures=t.keySignatures.map(function(t){return Object.assign({},t)}),this.meta=t.meta.map(function(t){return Object.assign({},t)}),C.set(this,t.ppq),this.update()},t.prototype.setTempo=function(t){this.tempos=[{bpm:t,ticks:0}],this.update()},t}(),aa=Jd;X.Header=aa;var Z={};function Md(r){if(!Array.isArray(r))throw new TypeError("Expected value to be an array");return eb(r)}function eb(r){return Vb(r,[])}function Od(r,t){if(!Array.isArray(r))throw new TypeError("Expected value to be an array");return fb(r,t)}function fb(r,t){if("number"!=typeof t)throw new TypeError("Expected the depth to be a number");return hb(r,[],t)}function Vb(r,t){for(var e=0;e<r.length;e++){var $=r[e];Array.isArray($)?Vb($,t):t.push($)}return t}function hb(r,t,e){e--;for(var $=0;$<r.length;$++){var a=r[$];e>-1&&Array.isArray(a)?hb(a,t,e):t.push(a)}return t}(Z=Md).from=eb,Z.depth=Od,Z.fromDepth=fb;var i={},S=i&&i.__spreadArrays||function(){for(var e=0,a=0,r=arguments.length;a<r;a++)e+=arguments[a].length;var t=Array(e),o=0;for(a=0;a<r;a++)for(var n=arguments[a],$=0,i=n.length;$<i;$++,o++)t[o]=n[$];return t},Ud=i&&i.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0});var Vd=Ud(Z);function Wd(e,a){return[{absoluteTime:e.ticks,channel:a,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(127*e.velocity)},{absoluteTime:e.ticks+e.durationTicks,channel:a,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(127*e.noteOffVelocity)}]}function Xd(e){return Vd.default(e.notes.map(function(a){return Wd(a,e.channel)}))}function Yd(e,a){return{absoluteTime:e.ticks,channel:a,controllerType:e.number,deltaTime:0,type:"controller",value:e.value}}function Zd(e){for(var a=[],r=0;r<127;r++)e.controlChanges.hasOwnProperty(r)&&e.controlChanges[r].forEach(function(r){a.push(Yd(r,e.channel))});return a}function $d(e,a){return{absoluteTime:e.ticks,channel:a,deltaTime:0,type:"pitchBend",value:e.value}}function _d(e){var a=[];return e.pitchBends.forEach(function(r){a.push($d(r,e.channel))}),a}function ae(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}function be(e){return{absoluteTime:0,deltaTime:0,meta:!0,text:e,type:"trackName"}}function ce(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}function de(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function ee(e){var a=R.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:a+7,meta:!0,scale:"major"===e.scale?0:1,type:"keySignature"}}function fe(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,text:e.text,type:e.type}}function ge(e){var a={header:{format:1,numTracks:e.tracks.length+1,ticksPerBeat:e.header.ppq},tracks:S([S([{absoluteTime:0,deltaTime:0,meta:!0,text:e.header.name,type:"trackName"}],e.header.keySignatures.map(function(e){return ee(e)}),e.header.meta.map(function(e){return fe(e)}),e.header.tempos.map(function(e){return ce(e)}),e.header.timeSignatures.map(function(e){return de(e)}))],e.tracks.map(function(e){return S([be(e.name),ae(e)],Xd(e),Zd(e),_d(e))}))};return a.tracks=a.tracks.map(function(e){e=e.sort(function(e,a){return e.absoluteTime-a.absoluteTime});var a=0;return e.forEach(function(e){e.deltaTime=e.absoluteTime-a,a=e.absoluteTime,delete e.absoluteTime}),e.push({deltaTime:0,meta:!0,type:"endOfTrack"}),e}),new Uint8Array(vd(a))}var kb=ge;i.encode=kb;var t={};Object.defineProperty(t,"__esModule",{value:!0});var o={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"};t.controlChangeNames=o;var p=Object.keys(o).reduce(function(e,t){return e[o[t]]=t,e},{});t.controlChangeIds=p;var ea=new WeakMap,pb=new WeakMap,ne=function(){function e(e,t){ea.set(this,t),pb.set(this,e.controllerType),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(e.prototype,"number",{get:function(){return pb.get(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return o[this.number]?o[this.number]:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return ea.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=ea.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},e}(),qb=ne;t.ControlChange=qb;var rb={};Object.defineProperty(rb,"__esModule",{value:!0});function qe(){return new Proxy({},{get:function(r,e){return r[e]?r[e]:p.hasOwnProperty(e)?r[p[e]]:void 0},set:function(r,e,o){return p.hasOwnProperty(e)?r[p[e]]=o:r[e]=o,!0}})}var sb=qe;rb.createControlChanges=sb;var tb={};Object.defineProperty(tb,"__esModule",{value:!0});var da=new WeakMap,ue=function(){function e(e,t){da.set(this,t),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(e.prototype,"time",{get:function(){return da.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=da.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},e}(),vb=ue;tb.PitchBend=vb;var H={};Object.defineProperty(H,"__esModule",{value:!0});var ja=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];H.instrumentByPatchID=ja;var yb=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];H.InstrumentFamilyByID=yb;var zb={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};H.DrumKitByPatchID=zb;var Ab={};Object.defineProperty(Ab,"__esModule",{value:!0});var Bb=new WeakMap,Ce=function(){function e(e,t){if(this.number=0,Bb.set(this,t),this.number=0,e){var r=e.find(function(e){return"programChange"===e.type});r&&(this.number=r.programNumber)}}return Object.defineProperty(e.prototype,"name",{get:function(){return this.percussion?zb[this.number]:ja[this.number]},set:function(e){var t=ja.indexOf(e);-1!==t&&(this.number=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"family",{get:function(){return this.percussion?"drums":yb[Math.floor(this.number/8)]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"percussion",{get:function(){return 9===Bb.get(this).channel},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{family:this.family,name:this.name,number:this.number}},e.prototype.fromJSON=function(e){this.number=e.number},e}(),ia=Ce;Ab.Instrument=ia;var Db={};function Fe(t){var i=Math.floor(t/12)-1;return Eb(t)+i.toString()}function Eb(t){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t%12]}function He(t){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(t)}Object.defineProperty(Db,"__esModule",{value:!0});var Ie=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,i={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(e){var r=t.exec(e),o=r[1],a=r[2];return i[o.toLowerCase()]+12*(parseInt(a,10)+1)}}(),n=new WeakMap,Ke=function(){function t(t,i,e){n.set(this,e),this.midi=t.midi,this.velocity=t.velocity,this.noteOffVelocity=i.velocity,this.ticks=t.ticks,this.durationTicks=i.ticks-t.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return Fe(this.midi)},set:function(t){this.midi=Ie(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(t){var i=t-this.octave;this.midi+=12*i},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return Eb(this.midi)},set:function(t){this.midi=12*(this.octave+1)+He(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var t=n.get(this);return t.ticksToSeconds(this.ticks+this.durationTicks)-t.ticksToSeconds(this.ticks)},set:function(t){var i=n.get(this).secondsToTicks(this.time+t);this.durationTicks=i-this.ticks},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return n.get(this).ticksToSeconds(this.ticks)},set:function(t){var i=n.get(this);this.ticks=i.secondsToTicks(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){return n.get(this).ticksToMeasures(this.ticks)},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}(),Gb=Ke;Db.Note=Gb;var Hb={};Object.defineProperty(Hb,"__esModule",{value:!0});var J=new WeakMap,Oe=function(){function e(e,t){var n=this;if(this.name="",this.notes=[],this.controlChanges=sb(),this.pitchBends=[],J.set(this,t),e){var r=e.find(function(e){return"trackName"===e.type});this.name=r?r.text:""}if(this.instrument=new ia(e,this),this.channel=0,e){for(var i=e.filter(function(e){return"noteOn"===e.type}),a=e.filter(function(e){return"noteOff"===e.type}),o=function(){var e=i.shift();s.channel=e.channel;var t=a.findIndex(function(t){return t.noteNumber===e.noteNumber&&t.absoluteTime>=e.absoluteTime});if(-1!==t){var n=a.splice(t,1)[0];s.addNote({durationTicks:n.absoluteTime-e.absoluteTime,midi:e.noteNumber,noteOffVelocity:n.velocity/127,ticks:e.absoluteTime,velocity:e.velocity/127})}},s=this;i.length;)o();e.filter(function(e){return"controller"===e.type}).forEach(function(e){n.addCC({number:e.controllerType,ticks:e.absoluteTime,value:e.value/127})}),e.filter(function(e){return"pitchBend"===e.type}).forEach(function(e){n.addPitchBend({ticks:e.absoluteTime,value:e.value/Math.pow(2,13)})})}}return e.prototype.addNote=function(e){var t=J.get(this),n=new Gb({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},t);return Object.assign(n,e),F(this.notes,n,"ticks"),this},e.prototype.addCC=function(e){var t=J.get(this),n=new qb({controllerType:e.number},t);return delete e.number,Object.assign(n,e),Array.isArray(this.controlChanges[n.number])||(this.controlChanges[n.number]=[]),F(this.controlChanges[n.number],n,"ticks"),this},e.prototype.addPitchBend=function(e){var t=J.get(this),n=new vb({},t);return Object.assign(n,e),F(this.pitchBends,n,"ticks"),this},Object.defineProperty(e.prototype,"duration",{get:function(){var e=this.notes[this.notes.length-1];return e?e.time+e.duration:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){var e=this.notes[this.notes.length-1];return e?e.ticks+e.durationTicks:0},enumerable:!0,configurable:!0}),e.prototype.fromJSON=function(e){var t=this;for(var n in this.name=e.name,this.channel=e.channel,this.instrument=new ia(void 0,this),this.instrument.fromJSON(e.instrument),e.controlChanges)e.controlChanges[n]&&e.controlChanges[n].forEach(function(e){t.addCC({number:e.number,ticks:e.ticks,value:e.value})});e.notes.forEach(function(e){t.addNote({durationTicks:e.durationTicks,midi:e.midi,ticks:e.ticks,velocity:e.velocity})})},e.prototype.toJSON=function(){for(var e={},t=0;t<127;t++)this.controlChanges.hasOwnProperty(t)&&(e[t]=this.controlChanges[t].map(function(e){return e.toJSON()}));return{channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(e){return e.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(e){return e.toJSON()})}},e}(),L=Oe;Hb.Track=L;var e={},Re=e&&e.__awaiter||function(r,e,t,a){return new(t||(t=Promise))(function(n,o){function i(r){try{u(a.next(r))}catch(e){o(e)}}function c(r){try{u(a.throw(r))}catch(e){o(e)}}function u(r){var e;r.done?n(r.value):(e=r.value,e instanceof t?e:new t(function(r){r(e)})).then(i,c)}u((a=a.apply(r,e||[])).next())})},Se=e&&e.__generator||function(r,e){var t,a,n,o,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,a&&(n=2&o[0]?a.return:o[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,o[1])).done)return n;switch(a=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,a=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){i.label=o[1];break}if(6===o[0]&&i.label<n[1]){i.label=n[1],n=o;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(o);break}n[2]&&i.ops.pop(),i.trys.pop();continue;}o=e.call(r,i)}catch(c){o=[6,c],a=0}finally{t=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}};Object.defineProperty(e,"__esModule",{value:!0});var Te=function(){function r(r){var e=this,t=null;r&&(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),(t=qd(r)).tracks.forEach(function(r){var e=0;r.forEach(function(r){e+=r.deltaTime,r.absoluteTime=e})}),t.tracks=Ve(t.tracks)),this.header=new aa(t),this.tracks=[],r&&(this.tracks=t.tracks.map(function(r){return new L(r,e.header)}),1===t.header.format&&0===this.tracks[0].duration&&this.tracks.shift())}return r.fromUrl=function(e){return Re(this,void 0,void 0,function(){var t;return Se(this,function(a){switch(a.label){case 0:return[4,fetch(e)];case 1:return(t=a.sent()).ok?[4,t.arrayBuffer()]:[3,3];case 2:return[2,new r(a.sent())];case 3:throw new Error("could not load "+e);}})})},Object.defineProperty(r.prototype,"name",{get:function(){return this.header.name},set:function(r){this.header.name=r},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"duration",{get:function(){var r=this.tracks.map(function(r){return r.duration});return Math.max.apply(Math,r)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"durationTicks",{get:function(){var r=this.tracks.map(function(r){return r.durationTicks});return Math.max.apply(Math,r)},enumerable:!0,configurable:!0}),r.prototype.addTrack=function(){var r=new L(void 0,this.header);return this.tracks.push(r),r},r.prototype.toArray=function(){return kb(this)},r.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(r){return r.toJSON()})}},r.prototype.fromJSON=function(r){var e=this;this.header=new aa,this.header.fromJSON(r.header),this.tracks=r.tracks.map(function(r){var t=new L(void 0,e.header);return t.fromJSON(r),t})},r.prototype.clone=function(){var e=new r;return e.fromJSON(this.toJSON()),e},r}(),Lb=Te;function Ve(r){for(var e=[],t=0;t<r.length;t++)for(var a=e.length,n=new Map,o=Array(16).fill(0),i=0,c=r[t];i<c.length;i++){var u=c[i],s=a,$=u.channel;if(void 0!==$){"programChange"===u.type&&(o[$]=u.programNumber);var f=o[$]+" "+$;n.has(f)?s=n.get(f):(s=a+n.size,n.set(f,s))}e[s]||e.push([]),e[s].push(u)}return e}e.Midi=Lb;const We={anim:100,pad:1,margin:0,hlOn:{fill:"#E83015"},bgOn:{fill:"#CCCCCC"},bgOff:{fill:"#CCCCCC"},fgOn:{fill:"#E83015"},fgOff:{fill:"#fff"},floor:1},Xe=["filter",{id:"blur"},["feGaussianBlur",{in:"SourceGraphic",stdDeviation:".25"}]],Y=(t={})=>{const s=Object.assign(Object.assign({r:5},We),t),{r:e,pad:i,margin:n,glyph:a,floor:c}=s,g=e*Math.pow(.5,2),l=e+i,r=l+n,$=2*l+2*n,o={width:$,height:$*c},b={transition:`all ${s.anim}ms ease-out`},O={cx:r,cy:r},f=Object.assign(Object.assign(Object.assign({},s.hlOn),O),{r:l}),j=Object.assign(Object.assign(Object.assign({},s.bgOn),O),{style:b,r:e}),T=Object.assign(Object.assign({},j),s.bgOff),p=Object.assign(Object.assign(Object.assign({},s.fgOn),O),{style:b,r:g}),G=Object.assign(Object.assign({},p),s.fgOff),Y=Object.assign(Object.assign({},s.fgOn),{x:"50%",y:"50%","text-anchor":"middle","alignment-baseline":"central",font:"bold sans-serif","font-size":.5*$,style:b}),h=Object.assign(Object.assign({},Y),s.fgOff);return(t,s,e,i)=>["svg",Object.assign(Object.assign({},o),s),Xe,["g",["circle",i?f:{}],["circle",e?j:T],a?["text",e?Y:h,a]:["circle",e?p:G]]]};const Ze=Ee({element:"h2",attribs:{class:"#000"}});const Nb=(t,s,e={})=>(i,n)=>["a",Object.assign(Object.assign({},e),{onclick:t,disabled:n}),s];const _e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],af=g(b($=>nd($)),h(),_e);let Ob=g(ca({raw:b($=>$),tonicMidi:b($=>Ha($.tonic+"2")%12),majorKey:b($=>$.tonic),minorKey:b($=>Wc($.minorRelative).toLowerCase()),normalizedMidis:b($=>g(b($=>Ha($+"2")%12),W(),$.scale))}),h(),af);const Pb=[...De(!1,12)],f=new Ca({enabledMidi:!1,midiDevices:[],midiFile:"DROP MIDI FILE HERE...",keyState:Pb,highlights:new Set,size:[window.innerWidth,window.innerHeight],viewConfig:{showMinor:!0,showSmall:!0}}),y=$=>{f.resetIn(["keyState",$],!f.deref().keyState[$])},Sb=()=>{f.resetIn(["keyState"],Pb)},Tb=$=>{f.resetIn(["highlights"],$)};window.addEventListener("resize",()=>{f.resetIn(["size"],[window.innerWidth,window.innerHeight])});const Ub={class:"mr3 pv2 ph2 bg-black white f4"},jf=()=>{const $=Nb(()=>Sb(),"Clear",Ub),e=Nb(()=>void f.resetIn(["keyState"],[...ba(12,Be([!0,!1],[.5,.5]))]),"Random",Ub);return()=>["div.mv4",[$],[e]]},sa={anim:0,r:16,pad:2},lf=Object.assign(Object.assign({},sa),{glyph:"C"}),mf=Object.assign(Object.assign({},sa),{bgOn:{fill:"#000"},bgOff:{fill:"#000"},floor:2}),nf=$=>{const e=f.deref();return()=>["div.mb4",...e.keyState.map((i,t)=>[4===t?"div.dib.mr4":"div.dib",[0===t?Y(Object.assign(Object.assign({},lf),$)):new Set([2,4,5,7,9,11]).has(t)?Y(Object.assign(Object.assign({},sa),$)):Y(Object.assign(Object.assign({},mf),$)),{class:"pointer mr0",onclick:()=>y(t)},i,e.highlights.has(t)]])]},of={w:16,h:8,pad:2,margin:0},pf=Je(Object.assign(Object.assign({},of),{vertical:!1})),qf=$=>{f.resetIn(["viewConfig",$],!f.deref().viewConfig[$])},md=($,e)=>{const i=f.deref().viewConfig;return["div",Object.entries(i).map(([$,i])=>["div.mv2",[e,{class:"pointer mr2",onclick:()=>qf($)},i],$])]},ld=($,e)=>{const i=f.deref().viewConfig,t={width:e,height:e/35,rx:5,fill:"#e2e2e2"};return()=>["div.dib",...$.map(($,r)=>["div.mv2.mr2",{onmouseover:()=>Tb($.normalizedMidis),onmouseout:()=>void Tb(new Set)},["div.flex",["div",$.majorKey,i.showSmall?["small"," maj"]:[]],i.showMinor?["div",["span.red"," \u30FB "],$.minorKey,i.showSmall?["small"," min"]:[]]:[]],["div",["svg",{width:1.1*e,height:e/35},["g",["rect",t],$.common.size?["rect",Object.assign(Object.assign({},t),{width:$.similarity*e,fill:"#000"})]:[]]]]])]},Sa=()=>{var $iFCn$$interop$default=U(s);$iFCn$$interop$default.d.inputs.forEach($=>$.addListener("noteon","all",e=>{y(e.note.number%12),console.log(`Received 'noteon' message (${e.note.name+e.note.octave}) from ${$.name}`)}))},ed=$=>{var $iFCn$$interop$default=U(s);"All Devices"!==$?($iFCn$$interop$default.d.inputs.forEach($=>$.removeListener()),$iFCn$$interop$default.d.getInputByName($).addListener("noteon","all",e=>{y(e.note.number%12),console.log(`Received 'noteon' message (${e.note.name+e.note.octave}) from ${$}`)})):Sa()};var Ka=U(s);Ka.d.enable($=>{$?console.log("WebMidi could not be enabled.",$):(console.log("WebMidi enabled!"),f.resetIn(["enabledMidi"],!0),f.resetIn(["midiDevices"],Ka.d.inputs.map($=>$.name)),Sa())});const Rc=$=>{const e=$.enabledMidi;let i=$.midiDevices;return i.length>0&&i.unshift("All Devices"),()=>["div",e?["span.mid-gray.bg-washed-green.pa1","Web MIDI is available"]:["span.mid-gray.bg-washed-red.pa1","Web MIDI is unavailable"],["span.ml2",i.length>1?[$c,{onchange:$=>ed($.target.value)},g(b($=>[$,$]),h(),new Set(i))]:[]]]},N=$=>{$.preventDefault(),$.stopPropagation()},xe=$=>{N($);const e=$.dataTransfer.files;if(e&&e.length>0){const $=new FileReader,i=e[0];$.onload=$=>{if("audio/midi"===i.type){f.resetIn(["midiFile"],i.name);let e=new Lb($.target.result).tracks;e.sort(($,e)=>e.notes.length-$.notes.length);const t=e[0],r=g(b($=>$[0]%12),h(),ba(7,_b(t.notes.map($=>$.midi))));Sb(),r.forEach($=>y($))}else f.resetIn(["midiFile"],"INVALID MIDI FILE..."),setTimeout(()=>f.resetIn(["midiFile"],"DROP MIDI FILE HERE..."),500)},$.readAsArrayBuffer(i)}},oe=$=>{const e=$.midiFile,i=$.size,t=Math.min(400,.9*i[0]);return()=>["div.mt2.mb4.ba.b--dotted.bw1.dib.pa4.v-mid.tc",{ondrop:$=>{$.target.classList.remove("dragover"),xe($)},ondragenter:$=>{$.target.classList.add("dragover"),N($)},ondragleave:$=>{$.target.classList.remove("dragover"),N($)},ondragover:$=>N($),style:{width:`${t}px`}},e]},Af=Yc(()=>{const $=f.deref(),e=$.keyState,i=$.size,t=Math.min(36,.9*i[0]/13),r=Math.min(400,.9*i[0]);let B=g(b($=>e[$]?$:null),W(),Sd(12)),d=g(b($=>na($.normalizedMidis,B)),h(),Ob),a=g(ca({majorKey:b($=>$[0].majorKey),minorKey:b($=>$[0].minorKey),normalizedMidis:b($=>$[0].normalizedMidis),common:b($=>$[1]),similarity:b($=>$[1].size/B.size+(B.has($[0].tonicMidi)?.1:0))}),h(),he(Ob,d));return a=a.sort(($,e)=>e.similarity-$.similarity),["div",[Ze,"OP-Z KEY FINDER"],Rc($),jf,["div.mb2",nf({r:t/2*(8/9),pad:t/2*(1/9)}),ld(a,r)],oe($),["div.db",["details",["summary","View Config"],[md,pf]]]]});return{"B6dB":{}};});