var lr="production";function Ye(t,e,o,n){var s=arguments.length,u=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,o):n,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(t,e,o,n);else for(var i=t.length-1;i>=0;i--)(r=t[i])&&(u=(s<3?r(u):s>3?r(e,o,u):r(e,o))||u);return s>3&&u&&Object.defineProperty(e,o,u),u}var qe=(t,e={})=>{let o=Reflect.ownKeys(t),n=Reflect.ownKeys(e),s=Symbol("isa");function u(r){for(let i of o){let a=Object.getOwnPropertyDescriptor(r.prototype,i);!a||a.configurable?Object.defineProperty(r.prototype,i,{value:t[i],writable:!0}):console.log(`not patching: ${r.name}.${i.toString()}`)}return Object.defineProperty(r.prototype,s,{value:!0}),r}for(let r of n)Object.defineProperty(u,r,{value:e[r],enumerable:e.propertyIsEnumerable(r)});return Object.defineProperty(u,Symbol.hasInstance,{value:r=>!!r[s]}),u};var Te=(t,e=o=>o!==void 0?": "+o:"")=>class extends Error{constructor(o){super(t(o)+e(o))}};var q=Array.isArray;var ae=t=>typeof t=="string";var Hn=qe({addWatch(t,e){return this._watches=this._watches||{},this._watches[t]?!1:(this._watches[t]=e,!0)},removeWatch(t){if(!!this._watches)return this._watches[t]?(delete this._watches[t],!0):!1},notifyWatches(t,e){if(!this._watches)return;let o=this._watches;for(let n in o)o[n](n,t,e)}}),Ln=t=>t&&(t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Int8Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Uint8ClampedArray),Vn=Te(()=>"illegal state"),zn=t=>{throw new Vn(t)},Je=t=>q(t)?t:ae(t)?t.length>0?t.split("."):[]:t!=null?[t]:[],mr=t=>Qe(t);function Qe(t){let e=Je(t),[o,n,s,u]=e;switch(e.length){case 0:return r=>r;case 1:return r=>r!=null?r[o]:void 0;case 2:return r=>r!=null&&(r=r[o])!=null?r[n]:void 0;case 3:return r=>r!=null&&(r=r[o])!=null&&(r=r[n])!=null?r[s]:void 0;case 4:return r=>r!=null&&(r=r[o])!=null&&(r=r[n])!=null&&(r=r[s])!=null?r[u]:void 0;default:return r=>{let i=e.length-1,a=r;for(let c=0;a!=null&&c<=i;c++)a=a[e[c]];return a}}}var hr=t=>Ne(t);function Ne(t){let e=Je(t),[o,n,s,u]=e;switch(e.length){case 0:return(i,a)=>a;case 1:return(i,a)=>(i=ue(i),i[o]=a,i);case 2:return(i,a)=>{let c;return i=ue(i),i[o]=c=ue(i[o]),c[n]=a,i};case 3:return(i,a)=>{let c,f;return i=ue(i),i[o]=c=ue(i[o]),c[n]=f=ue(c[n]),f[s]=a,i};case 4:return(i,a)=>{let c,f,m;return i=ue(i),i[o]=c=ue(i[o]),c[n]=f=ue(c[n]),f[s]=m=ue(f[s]),m[u]=a,i};default:let r;for(let i=e.length;--i>=0;)r=Wn(e[i],r);return r}}var ue=t=>q(t)||Ln(t)?t.slice():Object.assign({},t),Wn=(t,e)=>(o,n)=>(o=ue(o),o[t]=e?e(o[t],n):n,o),ke=(t,e,o,...n)=>Kn(t,e,o,...n);function Kn(t,e,o,...n){return Ne(e)(t,o.apply(null,(n.unshift(Qe(e)(t)),n)))}var Xe=(t,e,o)=>Ne(e)(t,o),ve=class{constructor(e,o){o&&!o(e)&&zn("initial state value did not validate"),this._value=e,this.valid=o}get value(){return this._value}set value(e){this.reset(e)}deref(){return this._value}equiv(e){return this===e}reset(e){let o=this._value;return this.valid&&!this.valid(e)?o:(this._value=e,this.notifyWatches(o,e),e)}resetIn(e,o){return this.reset(Xe(this._value,e,o))}resetInUnsafe(e,o){return this.reset(Xe(this._value,e,o))}swap(e,...o){return this.reset(e.apply(null,[this._value,...o]))}swapIn(e,o,...n){return this.reset(ke(this._value,e,o,...n))}swapInUnsafe(e,o,...n){return this.reset(ke(this._value,e,o,...n))}addWatch(e,o){}removeWatch(e){}notifyWatches(e,o){}release(){return delete this._watches,delete this._value,!0}};ve=Ye([Hn],ve);var dr=Object.getPrototypeOf({}),Ze="function",pr="string",te=(t,e)=>{let o;if(t===e)return!0;if(t!=null){if(typeof t.equiv===Ze)return t.equiv(e)}else return t==e;if(e!=null){if(typeof e.equiv===Ze)return e.equiv(t)}else return t==e;return typeof t===pr||typeof e===pr?!1:(o=Object.getPrototypeOf(t),(o==null||o===dr)&&(o=Object.getPrototypeOf(e),o==null||o===dr)?Ht(t,e):typeof t!==Ze&&t.length!==void 0&&typeof e!==Ze&&e.length!==void 0?Ut(t,e):t instanceof Set&&e instanceof Set?Bt(t,e):t instanceof Map&&e instanceof Map?Gt(t,e):t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():t instanceof RegExp&&e instanceof RegExp?t.toString()===e.toString():t!==t&&e!==e)},Ut=(t,e,o=te)=>{let n=t.length;if(n===e.length)for(;--n>=0&&o(t[n],e[n]););return n<0},Bt=(t,e,o=te)=>t.size===e.size&&o([...t.keys()].sort(),[...e.keys()].sort()),Gt=(t,e,o=te)=>t.size===e.size&&o([...t].sort(),[...e].sort()),Ht=(t,e,o=te)=>{if(Object.keys(t).length!==Object.keys(e).length)return!1;for(let n in t)if(!e.hasOwnProperty(n)||!o(t[n],e[n]))return!1;return!0};var $n=0,Yn=()=>$n++;function Lt(t,e,o,n,s){return new yr(t,e,o,n,s)}var yr=class{constructor(e,o,n,s=!0,u=te){this.parent=e,this.id=`view-${Yn()}`,this.tx=n||(a=>a),this.path=Je(o),this.isDirty=!0,this.isLazy=s;let r=mr(this.path),i=this.parent.deref();this.unprocessed=i?r(i):void 0,s||(this.state=this.tx(this.unprocessed),this.unprocessed=void 0),e.addWatch(this.id,(a,c,f)=>{let m=c&&r(c),l=f&&r(f);u(l,m)||(s?this.unprocessed=l:this.state=this.tx(l),this.isDirty=!0)})}get value(){return this.deref()}deref(){return this.isDirty&&(this.isLazy&&(this.state=this.tx(this.unprocessed),this.unprocessed=void 0),this.isDirty=!1),this.state}changed(){return this.isDirty}view(){return this.isDirty&&this.isLazy?this.tx(this.unprocessed):this.state}release(){return this.unprocessed=void 0,this.isLazy||(this.state=this.tx(void 0)),this.isDirty=!0,this.parent.removeWatch(this.id)}};var Se=Symbol(),Re=()=>{},gr="*";var Fe=t=>typeof t=="function";var qn=Te(()=>"illegal argument(s)"),pe=t=>{throw new qn(t)};var de=(t,e)=>t!=null&&typeof t[e]=="function";var Jn=t=>t!=null&&typeof t.deref=="function",et=t=>Jn(t)?t.deref():t,br=t=>t!=null&&typeof t!="string"&&typeof t[Symbol.iterator]=="function",vr=Object.getPrototypeOf,Qn=t=>{let e;return t!=null&&typeof t=="object"&&((e=vr(t))===null||vr(e)===null)},tt,rt,Xn=[],Zn=[],eo=t=>tt&&tt.length>=t?tt:tt=new Int32Array(t),to=t=>rt&&rt.length>=t?rt:rt=new Int32Array(t),Sr=(t,e,o,n,s)=>{let u=e.length,r=t.linear;if(t.distance=u,s!=="only-distance"){for(let i=0,a=0;i<u;i++,a+=3)r[a]=n,r[a+1]=i,r[a+2]=e[i];if(s==="full"){let i=t[o];for(let a=0;a<u;a++)i[a]=e[a]}}return t},oo=(t,e,o="full",n=te)=>{let s={distance:0,adds:{},dels:{},const:{},linear:[]};if(t===e||t==null&&e==null)return s;if(t==null||t.length===0)return Sr(s,e,"adds",1,o);if(e==null||e.length===0)return Sr(s,t,"dels",-1,o);let u=t.length>=e.length,r,i,a,c;u?(r=e,i=t):(r=t,i=e),a=r.length,c=i.length;let f=a+1,m=c-a,l=m+f,h=a+c+3,d=to(h).fill(-1,0,h),y=eo(h).fill(-1,0,h),v=Xn,b=Zn,g=(D,k,H)=>{let W,U;k>H?(W=d[D-1],U=k):(W=d[D+1],U=H);let V=U-(D-f);for(;V<a&&U<c&&n(r[V],i[U]);)V++,U++;d[D]=b.length/3,b.push(V,U,W),y[D]=U},w=-1,O;do{for(w++,O=-w+f;O<l;O++)g(O,y[O-1]+1,y[O+1]);for(O=l+w;O>l;O--)g(O,y[O-1]+1,y[O+1]);g(l,y[l-1]+1,y[l+1])}while(y[l]!==c);if(s.distance=m+2*w,o!=="only-distance"){for(w=d[l]*3;w>=0;)v.push(w),w=b[w+2]*3;o==="full"?ro(v,b,s,r,i,u):no(v,b,s,r,i,u,o==="only-distance-linear")}return v.length=0,b.length=0,s},ro=(t,e,o,n,s,u)=>{let r=o.linear,i=o.const,a=t.length,c=0,f=0,m,l,h,d;for(u?(m=o.dels,l=o.adds,h=-1,d=1):(m=o.adds,l=o.dels,h=1,d=-1);--a>=0;){let y=t[a],v=e[y],b=e[y+1],g=b-v;for(;c<v||f<b;){let w=f-c;g>w?(r.push(h,f,m[f]=s[f]),f++):g<w?(r.push(d,c,l[c]=n[c]),c++):(r.push(0,c,i[c]=n[c]),c++,f++)}}},no=(t,e,o,n,s,u,r)=>{let i=o.linear,a=u?-1:1,c=u?1:-1,f=t.length,m=0,l=0;for(;--f>=0;){let h=t[f],d=e[h],y=e[h+1],v=y-d;for(;m<d||l<y;){let b=l-m;v>b?(i.push(a,l,s[l]),l++):v<b?(i.push(c,m,n[m]),m++):(r&&i.push(0,m,n[m]),m++,l++)}}},ao=(t,e,o="full",n=te)=>t===e?{distance:0}:o==="only-distance"?io(t,e,n):so(t,e,n),io=(t,e,o)=>{t||(t={}),e||(e={});let n=0;for(let s in t){let u=e[s];(u===void 0||!o(t[s],u))&&n++}for(let s in e)!(s in t)&&n++;return{distance:n}},so=(t,e,o)=>{t||(t={}),e||(e={});let n=0,s=[],u=[],r=[];for(let i in t){let a=e[i];a===void 0?(u.push(i),n++):o(t[i],a)||(r.push(i,a),n++)}for(let i in e)i in t||(s.push(i),n++);return{distance:n,adds:s,dels:u,edits:r}},nt=Array.isArray,uo=Math.max,Er=Object.getPrototypeOf({}),ot="function",it="string",Ir=(()=>{let t=new Array(2048);for(let e=2,o=t.length;e<o;e++)t[e]=e-2;return t})(),co=t=>{if(t<=Ir.length)return Ir.slice(0,t);let e=new Array(t);for(;--t>=2;)e[t]=t-2;return e},Mr=(t,e,o,n,s,u=0)=>{let r=s[1];if(r.__skip)return;if(r.__diff===!1){Ue(n),e.replaceChild(t,o,u,s);return}let i=n[1];if(i&&i.__skip){e.replaceChild(t,o,u,s,!1);return}let a=r.__impl;if(a&&a!==e)return a.diffTree(t,a,o,n,s,u);let c=oo(n,s,"only-distance-linear",Be);if(c.distance===0)return;let f=c.linear,m=e.getChild(o,u),l,h,d;if(f[0]!==0||n[1].key!==r.key){Ue(n),e.replaceChild(t,o,u,s);return}if((d=n.__release)&&d!==s.__release&&Ue(n),f[3]!==0&&(mo(e,m,n[1],s[1]),c.distance===2))return;let y=f.length,v=n.length-1,b=ho(f),g=co(v+1);for(l=6;l<y;l+=3)h=f[l],!!h&&(h===-1?fo(t,e,m,n,s,f,l,b,g,v):lo(t,e,m,f,l,b,g,v));(d=s.__init)&&d!=n.__init&&d.apply(s,[m,...s.__args])},fo=(t,e,o,n,s,u,r,i,a,c)=>{let f=u[r+2];if(nt(f)){let m=f[1].key;if(m!==void 0&&i[m][2]!==void 0){let l=i[m];m=l[0],Mr(t,e,o,n[m],s[l[2]],a[m])}else{let l=u[r+1];Ue(f),e.removeChild(o,a[l]),po(a,c,l)}}else typeof f===it&&e.setContent(o,"")},lo=(t,e,o,n,s,u,r,i)=>{let a=n[s+2];if(typeof a===it)e.setContent(o,a);else if(nt(a)){let c=a[1].key;if(c===void 0||u[c][0]===void 0){let f=n[s+1];e.createTree(t,o,a,r[f]),yo(r,i,f)}}},po=(t,e,o)=>{for(;e>o;e--)t[e]=uo(t[e]-1,0)},yo=(t,e,o)=>{for(;e>=o;e--)t[e]++},mo=(t,e,o,n)=>{let s=ao(o,n,"full",te);t.removeAttribs(e,s.dels,o);let u=Se,r,i,a;for(a=s.edits,r=a.length;(r-=2)>=0;)i=a[r],i[0]==="o"&&i[1]==="n"&&t.removeAttribs(e,[i],o),i!=="value"?t.setAttrib(e,i,a[r+1],n):u=a[r+1];for(a=s.adds,r=a.length;--r>=0;)i=a[r],i!=="value"?t.setAttrib(e,i,n[i],n):u=n[i];u!==Se&&t.setAttrib(e,"value",u,n)},Ue=t=>{if(nt(t)){let e;if((e=t[1])&&e.__release===!1)return;for(t.__release&&(t.__release.apply(t.__this,t.__args),delete t.__release),e=t.length;--e>=2;)Ue(t[e])}},ho=t=>{let e,o,n,s={};for(let u=t.length;(u-=3)>=0;)o=t[u+2],nt(o)&&(e=o[1].key)!==void 0&&(n=s[e],!n&&(s[e]=n=[,,]),n[t[u]+1]=t[u+1]);return s},Be=(t,e)=>{let o;if(t===e)return!0;if(t!=null){if(typeof t.equiv===ot)return t.equiv(e)}else return t==e;if(e!=null){if(typeof e.equiv===ot)return e.equiv(t)}else return t==e;return typeof t===it||typeof e===it?!1:(o=Object.getPrototypeOf(t),(o==null||o===Er)&&(o=Object.getPrototypeOf(e),o==null||o===Er)?!(t.__diff===!1||e.__diff===!1)&&Ht(t,e,Be):typeof t!==ot&&t.length!==void 0&&typeof e!==ot&&e.length!==void 0?Ut(t,e,Be):t instanceof Set&&e instanceof Set?Bt(t,e,Be):t instanceof Map&&e instanceof Map?Gt(t,e,Be):t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():t instanceof RegExp&&e instanceof RegExp?t.toString()===e.toString():t!==t&&e!==e)},go={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},bo=/^([^\s\.#]+)(?:#([^\s\.#]+))?(?:\.([^\s#]+))?$/,Ca=new RegExp(`[${Object.keys(go).join("")}]`,"g"),vo={button:1,option:1,script:1,style:1,text:1,textarea:1,title:1},Vt=t=>t.split(" ").reduce((e,o)=>(e[o]=!0,e),{}),So=Vt("animate animateColor animateMotion animateTransform circle clipPath color-profile defs desc discard ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter font foreignObject g image line linearGradient marker mask metadata mpath path pattern polygon polyline radialGradient rect set stop style svg switch symbol text textPath title tref tspan use view"),Pa=Vt("area base br col command embed hr img input keygen link meta param source stop track use wbr ?xml"),xa=Vt("animate circle ellipse line path polygon polyline rect"),wr=(t,e)=>{if(e=et(e),e==null)return t;if(ae(e))return t+" "+e;let o=new Set(t.split(" "));for(let n in e)et(e[n])?o.add(n):o.delete(n);return[...o].join(" ")},Eo=(t,e,o)=>{e&&(t.id=e);let n=et(t.class);return o?(o=o.replace(/\./g," "),t.class=n?wr(o,n):o):n&&(t.class=ae(n)?n:wr("",n)),t},Io=t=>{let e="",o;for(let n in t)o=et(t[n]),Fe(o)&&(o=o(t)),o!=null&&(e+=`${n}:${o};`);return e},Mo=(t,e)=>{if(t==null||!e||!e.length)return t;let o=Object.assign({},t);for(let n of e){let s=o[n];de(s,"deref")&&(o[n]=s.deref())}return o},wo=t=>Object.keys(t).reduce((e,o)=>(e.push(`${o}: ${t[o]}`),e),[]).join(" "),To="http://www.w3.org/2000/svg",st=q,Tr=br,_r=ae,Or=(t,e)=>e.__init&&e.__init.apply(e.__this,[t,...e.__args]),at=(t,e,o,n,s,u=!0)=>{if(st(n)){let r=n[0];if(typeof r=="function")return at(t,e,o,r.apply(null,[t.ctx,...n.slice(1)]),s);let i=n[1];if(i.__impl)return i.__impl.createTree(t,o,n,s,u);let a=e.createElement(o,r,i,s);if(n.length>2){let c=n.length;for(let f=2;f<c;f++)at(t,e,a,n[f],void 0,u)}return u&&Or(a,n),a}if(Tr(n)){let r=[];for(let i of n)r.push(at(t,e,o,i,s,u));return r}return n==null?o:e.createTextElement(o,n)},ut=(t,e,o,n,s=0)=>{if(st(n)){let u=e.getChild(o,s);typeof n[0]=="function"&&ut(t,e,o,n[0].apply(null,[t.ctx,...n.slice(1)]),s);let r=n[1];if(r.__impl)return r.__impl.hydrateTree(t,o,n,s);Or(u,n);for(let i in r)i[0]==="o"&&i[1]==="n"&&e.setAttrib(u,i,r[i]);for(let i=n.length,a=2;a<i;a++)ut(t,e,u,n[a],a-2)}else if(Tr(n))for(let u of n)ut(t,e,o,u,s),s++},Oo=(t,e,o,n)=>{let s=So[e]?document.createElementNS(To,e):document.createElement(e);return o&&_o(s,o),Ar(t,s,n)},Ao=(t,e,o)=>Ar(t,document.createTextNode(e),o),Ar=(t,e,o)=>t?o===void 0?t.appendChild(e):t.insertBefore(e,t.children[o]):e,Do=(t,e)=>t.children[e],Co=(t,e,o,n,s,u=!0)=>(e.removeChild(o,n),e.createTree(t,o,s,n,u)),Po=(t,e)=>t.textContent=e,_o=(t,e)=>{for(let o in e)Dr(t,o,e[o],e);return t},Dr=(t,e,o,n)=>{if(e.startsWith("__"))return;let s=e[0]==="o"&&e[1]==="n";if(!s&&typeof o=="function"&&(o=o(n)),o!==void 0&&o!==!1)switch(e){case"style":jo(t,o);break;case"value":xo(t,o);break;case"prefix":t.setAttribute(e,_r(o)?o:wo(o));break;case"accesskey":t.accessKey=o;break;case"contenteditable":t.contentEditable=o;break;case"tabindex":t.tabIndex=o;break;case"align":case"autocapitalize":case"checked":case"dir":case"draggable":case"hidden":case"id":case"lang":case"namespaceURI":case"scrollTop":case"scrollLeft":case"title":t[e]=o;break;default:s?No(t,e.substr(2),o):t.setAttribute(e,o===!0?"":o)}else t[e]!=null?t[e]=null:t.removeAttribute(e);return t},xo=(t,e)=>{let o;switch(t.type){case"text":case"textarea":case"password":case"search":case"number":case"email":case"url":case"tel":case"date":case"datetime-local":case"time":case"week":case"month":if((o=t.value)!==void 0&&typeof e=="string"){let n=e.length-(o.length-(t.selectionStart||0));t.value=e,t.selectionStart=t.selectionEnd=n;break}default:t.value=e}},Ro=(t,e,o)=>{for(let n=e.length;--n>=0;){let s=e[n];s[0]==="o"&&s[1]==="n"?ko(t,s.substr(2),o[s]):t.hasAttribute(s)?t.removeAttribute(s):t[s]=null}},jo=(t,e)=>(t.setAttribute("style",Io(e)),t),No=(t,e,o)=>_r(o)?t.setAttribute("on"+e,o):st(o)?t.addEventListener(e,...o):t.addEventListener(e,o),ko=(t,e,o)=>st(o)?t.removeEventListener(e,...o):t.removeEventListener(e,o),Fo=(t,e)=>{let o=t.children[e];o!==void 0&&t.removeChild(o)},ct=q,Uo=br,Bo=Qn,Go=(t,e)=>{let o=t[0],n=Bo(t[1]),s,u,r;return(typeof o!="string"||!(s=bo.exec(o)))&&pe(`${o} is not a valid tag name`),u=s[1],o===u&&n&&(!e||t[1].key)?t:(r=Eo(n?Object.assign({},t[1]):{},s[2],s[3]),r.__skip&&t.length<3?[u,r]:[u,r,...t.slice(n?2:1)])},Ho=(t,e)=>ye(e,t,t.ctx,[0],t.keys!==!1,t.span!==!1),ye=(t,e,o,n,s,u)=>{if(t!=null){if(ct(t)){if(t.length===0)return;let r,i=t[1],a;if(i&&(a=i.__impl)&&(a=a.normalizeTree))return a(e,t);let c=t[0];if(typeof c=="function")return ye(c.apply(null,[o,...t.slice(1)]),e,o,n,s,u);if(typeof c.render=="function"){let f=[o,...t.slice(1)];return r=ye(c.render.apply(c,f),e,o,n,s,u),ct(r)&&(r.__this=c,r.__init=c.init,r.__release=c.release,r.__args=f),r}return r=Go(t,s),i=r[1],i.__normalize===!1?r:(s&&i.key===void 0&&(i.key=n.join("-")),r.length>2?Lo(r,i,e,o,n,s,u):r)}return typeof t=="function"?ye(t(o),e,o,n,s,u):typeof t.toHiccup=="function"?ye(t.toHiccup(e.ctx),e,o,n,s,u):typeof t.deref=="function"?ye(t.deref(),e,o,n,s,u):u?["span",s?{key:n.join("-")}:{},t.toString()]:t.toString()}},Lo=(t,e,o,n,s,u,r)=>{let i=t[0],a=[i,e];r=r&&!vo[i];for(let c=2,f=2,m=0,l=t.length;c<l;c++){let h=t[c];if(h!=null){let d=ct(h);if(d&&ct(h[0])||!d&&Uo(h))for(let y of h)y=ye(y,o,n,s.concat(m),u,r),y!==void 0&&(a[f++]=y),m++;else h=ye(h,o,n,s.concat(m),u,r),h!==void 0&&(a[f++]=h),m++}}return a},Vo={createTree(t,e,o,n,s){return at(t,this,e,o,n,s)},hydrateTree(t,e,o,n){return ut(t,this,e,o,n)},diffTree(t,e,o,n,s){Mr(t,this,e,o,n,s)},normalizeTree:Ho,getElementById(t){return document.getElementById(t)},getChild:Do,createElement:Oo,createTextElement:Ao,replaceChild(t,e,o,n,s){Co(t,this,e,o,n,s)},removeChild:Fo,setContent:Po,removeAttribs:Ro,setAttrib:Dr},zo=(t,e)=>ae(t)?e.getElementById(t):t,Cr=(t,e={},o=Vo)=>{let n=Object.assign({root:"app"},e),s=[],u=!0,r=zo(n.root,o),i=()=>{if(u){n.ctx=Mo(e.ctx,n.autoDerefKeys);let a=o.normalizeTree(n,t);a!=null&&(n.hydrate?(o.hydrateTree(n,r,a),n.hydrate=!1):o.diffTree(n,r,s,a),s=a),u&&requestAnimationFrame(i)}};return requestAnimationFrame(i),()=>u=!1};var zt;(function(t){t[t.FINE=0]="FINE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.SEVERE=4]="SEVERE",t[t.NONE=5]="NONE"})(zt||(zt={}));var Wo=Object.freeze({level:zt.NONE,fine(){},debug(){},info(){},warn(){},severe(){}}),Ko=t=>t instanceof Promise,Yo=(t,e)=>$o(t,e);function $o(t,e){let o=Qe(t),n=Ne(t);return(s,...u)=>n(s,e.apply(null,(u.unshift(o(s)),u)))}var ge="--set-value",qo="--update-value",Ge="--toggle-value",Wt="--cancel",Jo="--dispatch",Kt="--dispatch-async",Z="--dispatch-now",$t="--delay",Qo="--fetch",oe="--state",Xo="--redo",Zo="--undo",_e=Wo,Pr=class{constructor(e,o){this.handlers={},this.effects={},this.eventQueue=[],this.priorities=[],this.addBuiltIns(),e&&this.addHandlers(e),o&&this.addEffects(o)}addBuiltIns(){this.addEffects({[Jo]:[e=>this.dispatch(e),-999],[Kt]:[([e,o,n,s],u,r)=>{let i=this.effects[e];if(i){let a=i(o,u,r);Ko(a)?a.then(c=>this.dispatch([n,c])).catch(c=>this.dispatch([s,c])):_e.warn("async effect did not return Promise")}else _e.warn(`skipping invalid async effect: ${e}`)},-999],[$t]:[([e,o])=>new Promise(n=>setTimeout(()=>n(o),e)),1e3],[Qo]:[e=>fetch(e).then(o=>{if(!o.ok)throw new Error(o.statusText);return o}),1e3]})}addHandler(e,o){let n=this.interceptorsFromSpec(o);n.length>0?(this.handlers[e]&&(this.removeHandler(e),_e.warn(`overriding handler for ID: ${e}`)),this.handlers[e]=n):pe(`no handlers in spec for ID: ${e}`)}addHandlers(e){for(let o in e)this.addHandler(o,e[o])}addEffect(e,o,n=1){this.effects[e]&&(this.removeEffect(e),_e.warn(`overriding effect for ID: ${e}`)),this.effects[e]=o;let s=[e,n],u=this.priorities;for(let r=0;r<u.length;r++)if(s[1]<u[r][1]){u.splice(r,0,s);return}u.push(s)}addEffects(e){for(let o in e){let n=e[o];q(n)?this.addEffect(o,n[0],n[1]):this.addEffect(o,n)}}instrumentWith(e,o){let n=e.map(xr),s=this.handlers;for(let u of o||Object.keys(s)){let r=s[u];r&&(s[u]=n.concat(r))}}removeHandler(e){delete this.handlers[e]}removeHandlers(e){for(let o of e)this.removeHandler(o)}removeEffect(e){delete this.effects[e];let o=this.priorities;for(let n=o.length-1;n>=0;n--)if(e===o[n][0]){o.splice(n,1);return}}removeEffects(e){for(let o of e)this.removeEffect(o)}context(){return this.currCtx}dispatch(...e){this.eventQueue.push(...e)}dispatchNow(...e){(this.currQueue||this.eventQueue).push(...e)}dispatchLater(e,o=17){setTimeout(()=>this.dispatch(e),o)}processQueue(e){if(this.eventQueue.length>0){this.currQueue=[...this.eventQueue],this.eventQueue.length=0,e=this.currCtx=e||{};for(let o of this.currQueue)this.processEvent(e,o);return this.currQueue=this.currCtx=void 0,this.processEffects(e),!0}return!1}processEvent(e,o){let n=this.handlers[o[0]];if(!n){_e.warn(`missing handler for event type: ${o[0].toString()}`);return}!this.processForward(e,n,o)||this.processReverse(e,n,o)}processForward(e,o,n){let s=!1;for(let u=0,r=o.length;u<r&&!e[Wt];u++){let i=o[u];i.pre&&this.mergeEffects(e,i.pre(e[oe],n,this,e)),s=s||!!i.post}return s}processReverse(e,o,n){for(let s=o.length;--s>=0&&!e[Wt];){let u=o[s];u.post&&this.mergeEffects(e,u.post(e[oe],n,this,e))}}processEffects(e){let o=this.effects;for(let n of this.priorities){let s=n[0],u=e[s];u!==void 0&&this.processEffect(e,o,s,u)}}processEffect(e,o,n,s){let u=o[n];if(n!==oe)for(let r of s)u(r,this,e);else u(s,this,e)}mergeEffects(e,o){if(!!o)for(let n in o){let s=o[n];if(s!=null)if(n===oe||n===Wt)e[n]=s;else if(n===Z)if(q(s[0]))for(let u of s)u&&this.dispatchNow(u);else this.dispatchNow(s);else if(e[n]||(e[n]=[]),q(s[0]))for(let u of s)u!==void 0&&e[n].push(u);else e[n].push(s)}}interceptorsFromSpec(e){return q(e)?e.map(xr):Fe(e)?[{pre:e}]:[e]}},Yt=class extends Pr{constructor(e,o,n){super(o,n);this.state=e||new ve({})}deref(){return this.state.deref()}addBuiltIns(){super.addBuiltIns(),this.addHandlers({[ge]:(e,[o,[n,s]])=>({[oe]:Xe(e,n,s)}),[qo]:(e,[o,[n,s,...u]])=>({[oe]:ke(e,n,s,...u)}),[Ge]:(e,[o,n])=>({[oe]:ke(e,n,s=>!s)}),[Zo]:jr("undo"),[Xo]:jr("redo")}),this.addEffects({[oe]:[e=>this.state.reset(e),-1e3]})}processQueue(e){if(this.eventQueue.length>0){let o=this.state.deref();this.currQueue=[...this.eventQueue],this.eventQueue.length=0,e=this.currCtx=Object.assign(Object.assign({},e),{[oe]:o});for(let n of this.currQueue)this.processEvent(e,n);return this.currQueue=this.currCtx=void 0,this.processEffects(e),this.state.deref()!==o}return!1}},xr=t=>Fe(t)?{pre:t}:t,jr=t=>(e,[o,n],s,u)=>{let r=n?n[0]:"history";if(de(u[r],t)){let i=u[r][t]();return{[oe]:s.state.deref(),[Z]:n?i!==void 0?n[1]:n[2]:void 0}}else _e.warn("no history in context")},Nr=(t,e)=>console.log("event:",e),kr=(t,e)=>{let o=hr(t);return(n,[s,u])=>({[oe]:o(n,e?e(u):u)})},Rr=(t,e)=>{let o=Yo(t,e);return(n,[s,...u])=>({[oe]:o(n,...u)})};var ei={},Oe=(()=>{try{return ei.env.UMBRELLA_ASSERTS==="1"}catch(t){}return!1})()?(t,e="assertion failed")=>{if(typeof t=="function"&&!t()||!t)throw new Error(typeof e=="function"?e():e)}:Re,ti=Te(()=>"illegal arity"),Ee=t=>{throw new ti(t)};var Fr=(t,e)=>{if(!!t){for(let o=0,n=t.length,s;o<n;o++)if(s=t[o],s[0].call(s[1],e),e.canceled)return}},ri=qe({addListener(t,e,o){let n=(this._listeners=this._listeners||{})[t];return!n&&(n=this._listeners[t]=[]),this.__listener(n,e,o)===-1?(n.push([e,o]),!0):!1},removeListener(t,e,o){let n;if(!(n=this._listeners))return!1;let s=n[t];if(s){let u=this.__listener(s,e,o);if(u!==-1)return s.splice(u,1),!s.length&&delete n[t],!0}return!1},notify(t){let e;if(!(e=this._listeners))return!1;t.target===void 0&&(t.target=this),Fr(e[t.id],t),Fr(e[gr],t)},__listener(t,e,o){let n=t.length;for(;--n>=0;){let s=t[n];if(s[0]===e&&s[1]===o)break}return n}}),Ae="route-changed",qt=class{constructor(e){if(e.authenticator=e.authenticator||((o,n,s)=>({id:o.id,title:o.title,params:s})),e.prefix=e.prefix===void 0?"/":e.prefix,e.separator=e.separator||"/",this.config=e,Oe(this.routeForID(this.config.defaultRouteID)!==void 0,`missing config for default route: '${this.config.defaultRouteID}'`),e.initialRouteID){let o=this.routeForID(e.initialRouteID);Oe(o!==void 0,`missing config for initial route: ${this.config.initialRouteID}`),Oe(!ni(o),"initial route MUST not be parametric")}}addListener(e,o,n){}removeListener(e,o,n){}notify(e){}start(){if(this.config.initialRouteID){let e=this.routeForID(this.config.initialRouteID);this.current={id:e.id,title:e.title,params:{}},this.notify({id:Ae,value:this.current})}}route(e){e.charAt(0)==="#"&&(e=e.substr(1)),e=e.substr(this.config.prefix.length);let o=this.matchRoutes(e);if(!o){if(!this.handleRouteFailure())return;let n=this.routeForID(this.config.defaultRouteID);o={id:n.id,title:n.title,params:{}}}return te(o,this.current)||(this.current=o,this.notify({id:Ae,value:o})),o}format(...e){let[o,n,s]=e,u;switch(e.length){case 3:u={id:o,params:n};break;case 2:ae(o)?u={id:o,params:n}:(s=n,u=o);break;case 1:u=ae(o)?{id:o}:o;break;default:Ee(e.length)}let r=this.routeForID(u.id);if(r){let i=u.params||{};return(s?"#":"")+this.config.prefix+r.match.map(a=>a.charAt(0)==="?"?(a=i[a.substr(1)])!=null?a:"NULL":a).join(this.config.separator)}else pe(`invalid route ID: ${u.id}`)}routeForID(e){return this.config.routes.find(o=>o.id===e)}matchRoutes(e){let o=this.config.routes,n=e.split(this.config.separator);for(let s=0,u=o.length;s<u;s++){let r=this.matchRoute(n,o[s]);if(r)return r}}matchRoute(e,o){let n=o.match,s=n.length;if(e.length===s){let u={};for(let r=0;r<s;r++){let i=n[r];if(i.charAt(0)==="?")u[i.substr(1)]=e[r];else if(e[r]!==i)return}return o.validate&&!this.validateRouteParams(u,o.validate)?void 0:o.auth?this.config.authenticator(o,e,u):{id:o.id,title:o.title,params:u}}}validateRouteParams(e,o){for(let n in o)if(e[n]!==void 0){let s=o[n];if(s.coerce&&(e[n]=s.coerce(e[n])),s.check&&!s.check(e[n]))return!1}return!0}handleRouteFailure(){return!0}};qt=Ye([ri],qt);var ni=t=>t.match.some(e=>e.charAt(0)==="?"),Jt=class extends qt{constructor(e){super(e);this.useFragment=e.useFragment!==!1,this.ignoreHashChange=!1}start(){if(window.addEventListener("popstate",this.handlePopChange()),this.useFragment&&window.addEventListener("hashchange",this.handleHashChange()),this.config.initialRouteID){let e=this.routeForID(this.config.initialRouteID);this.route(this.format({id:e.id,title:e.title}))}else this.route(this.useFragment?location.hash:location.pathname)}release(){window.removeEventListener("popstate",this.popHandler),this.useFragment&&window.removeEventListener("hashchange",this.hashHandler)}route(e,o=!0){let n=this.current,s=super.route(e);return s&&!te(s,n)&&(this.currentPath=this.format(s),o&&history.pushState(this.currentPath,s.title||window.document.title||"",this.currentPath)),s}routeTo(e){this.useFragment&&(location.hash=e),this.route(e)}format(...e){let o;switch(e.length){case 2:o={id:e[0],params:e[1]};break;case 1:o=ae(e[0])?{id:e[0]}:e[0];break;default:Ee(e.length)}return super.format(o,this.useFragment)}handlePopChange(){return this.popHandler=this.popHandler||(e=>{this.route(e.state||(this.useFragment?location.hash:location.pathname),!1)}).bind(this)}handleHashChange(){return this.hashHandler=this.hashHandler||(e=>{if(!this.ignoreHashChange){let o=e.newURL.substr(e.newURL.indexOf("#"));o!==this.currentPath&&this.route(o,!1)}}).bind(this)}handleRouteFailure(){return this.ignoreHashChange=!0,location.hash=this.format({id:this.routeForID(this.config.defaultRouteID).id}),this.ignoreHashChange=!1,!0}};var oi=([t,e,o],n)=>["option",{value:t,disabled:!!o,selected:t===n},e],Ur=(t,e,o,n)=>["select",e,...o.map(s=>oi(s,n))],Br=t=>{let e=Object.assign({element:"h1",attribs:{},subElement:"small",subAttribs:{}},t);return(o,n,s)=>[e.element,e.attribs,n,s?[e.subElement,e.subAttribs,s]:void 0]},ii={anim:100,pad:1,margin:0,vertical:!1,bgOn:{fill:"#000"},bgOff:{fill:"#999"},fgOn:{fill:"#fff"},fgOff:{fill:"#fff"}},Gr=(t={})=>{let e=Object.assign(Object.assign({w:10,h:10},ii),t),{w:o,h:n,pad:s,margin:u,vertical:r}=e,i=u*2,a=s+u,c=r?o+s*2:(o+s)*2,f=r?(n+s)*2:n+s*2,m={width:c+i,height:f+i},l={transition:`all ${e.anim}ms ease-out`},h=Object.assign(Object.assign({},e.bgOn),{width:c,height:f,x:u,y:u}),d=Object.assign(Object.assign({},h),e.bgOff),y=Object.assign(Object.assign(Object.assign({},r?{x:a,y:a}:{x:c+u-s-o,y:a}),e.fgOn),{style:l,width:o,height:n}),v=Object.assign(Object.assign(Object.assign({},y),r?{y:f+u-s-n}:{x:a}),e.fgOff);return(b,g,w)=>["svg",Object.assign(Object.assign({},m),g),["rect",w?h:d],["rect",w?y:v]]};var si=t=>t!=null&&typeof t!="function"&&t.length!==void 0,ft=t=>t!=null&&typeof t[Symbol.iterator]=="function",He=t=>de(t,"xform")?t.xform():t,De=class{constructor(e){this.value=e}deref(){return this.value}},ai=t=>new De(t),Ie=t=>t instanceof De,ui=t=>t instanceof De?t:new De(t),lt=t=>t instanceof De?t.deref():t,ci=t=>t.length===2?[void 0,t[1]]:t.length===3?[t[1],t[2]]:Ee(t.length);function mi(...t){let e=t[0],o=e[0],n=e[1],s=e[2];t=ci(t);let u=t[0]==null?o():t[0],r=t[1];return lt(n(de(r,"$reduce")?r.$reduce(s,u):si(r)?fi(s,u,r):li(s,u,r)))}var fi=(t,e,o)=>{for(let n=0,s=o.length;n<s;n++)if(e=t(e,o[n]),Ie(e)){e=e.deref();break}return e},li=(t,e,o)=>{for(let n of o)if(e=t(e,n),Ie(e)){e=e.deref();break}return e},hi=(t,e)=>[t,o=>o,e];function J(t){return t?[...t]:hi(()=>[],(e,o)=>(e.push(o),e))}function*di(t,e){let o=He(t)(J()),n=o[1],s=o[2];for(let u of e){let r=s([],u);if(Ie(r)){yield*lt(n(r.deref()));return}r.length&&(yield*r)}yield*lt(n([]))}function*Qt(t,e){let o=He(t)([Re,Re,(n,s)=>s])[2];for(let n of e){let s=o(Se,n);if(Ie(s)){s=lt(s.deref()),s!==Se&&(yield s);return}s!==Se&&(yield s)}}var Hr=(t,e,o=Qt)=>{let n=e.length-1;return ft(e[n])?e.length>1?o(t.apply(null,e.slice(0,n)),e[n]):o(t(),e[0]):void 0},Xt=(t,e)=>[t[0],t[1],e];function F(t,e){return ft(e)?Qt(F(t),e):o=>{let n=o[2];return Xt(o,(s,u)=>n(s,t(u)))}}function Q(...t){return pi(Q,mi,t)}var pi=(t,e,o)=>{let n,s;switch(o.length){case 4:s=o[3],n=o[2];break;case 3:s=o[2];break;case 2:return F(u=>t(o[0],o[1],u));default:Ee(o.length)}return e(He(o[0])(o[1]),n,s)},yi=t=>{let{1:e,2:o}=He(t)(J()),n=!1;return s=>{if(!n){let u=o([],s);return n=Ie(u),n&&(u=e(u.deref())),u.length===1?u[0]:u.length>0?u:void 0}}};function Lr(...t){let[e,o,n,s,u,r,i,a,c,f]=t;switch(t.length){case 0:Ee(0);case 1:return e;case 2:return(...l)=>e(o(...l));case 3:return(...l)=>e(o(n(...l)));case 4:return(...l)=>e(o(n(s(...l))));case 5:return(...l)=>e(o(n(s(u(...l)))));case 6:return(...l)=>e(o(n(s(u(r(...l))))));case 7:return(...l)=>e(o(n(s(u(r(i(...l)))))));case 8:return(...l)=>e(o(n(s(u(r(i(a(...l))))))));case 9:return(...l)=>e(o(n(s(u(r(i(a(c(...l)))))))));case 10:default:let m=(...l)=>e(o(n(s(u(r(i(a(c(f(...l))))))))));return t.length===10?m:Lr(m,...t.slice(10))}}function gi(...t){let[e,o,n,s,u,r,i,a]=t;switch(t.length){case 1:return c=>[e(c)];case 2:return c=>[e(c),o(c)];case 3:return c=>[e(c),o(c),n(c)];case 4:return c=>[e(c),o(c),n(c),s(c)];case 5:return c=>[e(c),o(c),n(c),s(c),u(c)];case 6:return c=>[e(c),o(c),n(c),s(c),u(c),r(c)];case 7:return c=>[e(c),o(c),n(c),s(c),u(c),r(c),i(c)];case 8:return c=>[e(c),o(c),n(c),s(c),u(c),r(c),i(c),a(c)];default:return c=>{let f=new Array(t.length);for(let m=t.length;--m>=0;)f[m]=t[m](c);return f}}}function Zt(t,e,o){return new Vr(t,e,o)}var Vr=class{constructor(e,o,n){e===void 0?(e=0,o=Infinity):o===void 0&&(o=e,e=0),n=n===void 0?e<o?1:-1:n,this.from=e,this.to=o,this.step=n}*[Symbol.iterator](){let{from:e,to:o,step:n}=this;if(n>0)for(;e<o;)yield e,e+=n;else if(n<0)for(;e>o;)yield e,e+=n}$reduce(e,o){let n=this.step;if(n>0)for(let s=this.from,u=this.to;s<u&&!Ie(o);s+=n)o=e(o,s);else for(let s=this.from,u=this.to;s>u&&!Ie(o);s+=n)o=e(o,s);return o}};function*zr(...t){let e=t.map(o=>o[Symbol.iterator]());for(;;){let o=[];for(let n of e){let s=n.next();if(s.done)return;o.push(s.value)}yield o}}function mt(t,e){return ft(e)?Qt(mt(t),e):o=>{let n=o[2];return Xt(o,(s,u)=>t(u)?n(s,u):s)}}var bi=t=>((t==null||!t[Symbol.iterator])&&pe(`value is not iterable: ${t}`),t),vi=t=>q(t)?t:[...bi(t)],Wr=1/4294967295,Kr=class{float(e=1){return this.int()*Wr*e}norm(e=1){return(this.int()*Wr-.5)*2*e}minmax(e,o){return this.float()*(o-e)+e}},er=Math.random,$r=class extends Kr{int(){return er()*4294967296>>>0}float(e=1){return er()*e}norm(e=1){return(er()-.5)*2*e}},Yr=new $r,Si=(t,e,o=Yr)=>{let n=t.length;Oe(n>0,"no choices given");let s=e?t.map((r,i)=>[e[i],r]).sort((r,i)=>i[0]-r[0]):t.map(r=>[1,r]),u=s.reduce((r,i)=>r+i[0],0);return u<=0&&console.warn("total weights <= 0"),()=>{let r=o.float(u),i=u;for(let a=0;a<n;a++)if(i-=s[a][0],i<=r)return s[a][1]}};function Le(...t){return t=t.map(He),Lr.apply(null,t)}function Ce(t,e){return ft(e)?di(Ce(t),e):o=>{let n=o[2],s=t;return Xt(o,(u,r)=>--s>0?n(u,r):s===0?ui(n(u,r)):ai(u))}}function Ei(...t){return F(gi.apply(null,t.map(yi)))}var Ii=t=>{let e=Object.keys(t),[o,n,s]=e,[u,r,i]=e.map(a=>t[a]);switch(e.length){case 3:return a=>{let c={},f;return f=a[i],f!==void 0&&(c[s]=f),f=a[r],f!==void 0&&(c[n]=f),f=a[u],f!==void 0&&(c[o]=f),c};case 2:return a=>{let c={},f;return f=a[r],f!==void 0&&(c[n]=f),f=a[u],f!==void 0&&(c[o]=f),c};case 1:return a=>{let c={},f=a[u];return f!==void 0&&(c[o]=f),c};default:return a=>{let c,f,m={};for(let l=e.length-1;l>=0;l--)c=e[l],f=a[t[c]],f!==void 0&&(m[c]=f);return m}}};function qr(...t){let e=t.length>2&&Hr(qr,t);if(e)return e;let o=t[0];if(q(o)&&(o=o.reduce((n,s,u)=>(n[s]=u,n),{})),t[1]){let n=Object.keys(o);return F(s=>Q(Le(F(u=>[u,s[o[u]]]),mt(u=>u[1]!==void 0)),t[1],n))}else return F(Ii(o))}function ht(...t){let e=Hr(ht,t);if(e)return e;let[o,n]=t,s=Object.keys(o);return Le(Ei.apply(null,s.map(u=>o[u])),qr(s,n))}function*Mi(t,e=Infinity){for(;e-- >0;)yield t()}var dt=(t,e,o=Yr)=>Mi(e?Si(vi(t),e,o):()=>t[o.float(t.length)|0]);function*Jr(t,e=Infinity){for(;e-- >0;)yield t}var ce=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Qr(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function X(t,e,o){return o={path:e,exports:{},require:function(n,s){return wi(n,s??o.path)}},t(o,o.exports),o.exports}function wi(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var Ti=X(function(t){(function(e){function o(){if(o.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");(o.prototype._singleton=this)._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._nrpnBuffer=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],this._nrpnEventsEnabled=!0,this._nrpnTypes=["entry","increment","decrement"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,nrpn:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_NRPN_MESSAGES:{value:{entrymsb:6,entrylsb:38,increment:96,decrement:97,paramlsb:98,parammsb:99,nullactiveparameter:127},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1},octaveOffset:{value:0,writable:!0,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return this.interface!==void 0}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this.interface||!this.interface.sysexEnabled)}.bind(this)},nrpnEventsEnabled:{enumerable:!0,get:function(){return!!this._nrpnEventsEnabled}.bind(this),set:function(r){return this._nrpnEventsEnabled=r,this._nrpnEventsEnabled}},nrpnTypes:{enumerable:!0,get:function(){return this._nrpnTypes}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}var n=new o;function s(r){var i=this;this._userHandlers={channel:{},system:{}},this._midiInput=r,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return i._midiInput.connection}},id:{enumerable:!0,get:function(){return i._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return i._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return i._midiInput.name}},state:{enumerable:!0,get:function(){return i._midiInput.state}},type:{enumerable:!0,get:function(){return i._midiInput.type}}}),this._initializeUserHandlers(),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}function u(r){var i=this;this._midiOutput=r,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return i._midiOutput.connection}},id:{enumerable:!0,get:function(){return i._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return i._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return i._midiOutput.name}},state:{enumerable:!0,get:function(){return i._midiOutput.state}},type:{enumerable:!0,get:function(){return i._midiOutput.type}}})}o.prototype.enable=function(r,i){this.enabled||(this.supported?navigator.requestMIDIAccess({sysex:i}).then(function(a){var c,f=[],m=[];this.interface=a,this._resetInterfaceUserHandlers(),this.interface.onstatechange=function(b){f.push(b)};for(var l=a.inputs.values(),h=l.next();h&&!h.done;h=l.next())m.push(h.value.open());for(var d=a.outputs.values(),y=d.next();y&&!y.done;y=d.next())m.push(y.value.open());function v(){clearTimeout(c),this._updateInputsAndOutputs(),this.interface.onstatechange=this._onInterfaceStateChange.bind(this),typeof r=="function"&&r.call(this),f.forEach(function(b){this._onInterfaceStateChange(b)}.bind(this))}c=setTimeout(v.bind(this),200),Promise&&Promise.all(m).catch(function(b){}).then(v.bind(this))}.bind(this),function(a){typeof r=="function"&&r.call(this,a)}.bind(this)):typeof r=="function"&&r(new Error("The Web MIDI API is not supported by your browser.")))},o.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this.enabled&&(this.removeListener(),this.inputs.forEach(function(r){r.removeListener()})),this.interface&&(this.interface.onstatechange=void 0),this.interface=void 0,this._inputs=[],this._outputs=[],this._nrpnEventsEnabled=!0,this._resetInterfaceUserHandlers()},o.prototype.addListener=function(r,i){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if(typeof i!="function")throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(r)))throw new TypeError("The specified event type is not supported.");return this._userHandlers[r].push(i),this},o.prototype.hasListener=function(r,i){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if(typeof i!="function")throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(r)))throw new TypeError("The specified event type is not supported.");for(var a=0;a<this._userHandlers[r].length;a++)if(this._userHandlers[r][a]===i)return!0;return!1},o.prototype.removeListener=function(r,i){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(i!==void 0&&typeof i!="function")throw new TypeError("The 'listener' parameter must be a function.");if(0<=this._midiInterfaceEvents.indexOf(r))if(i)for(var a=0;a<this._userHandlers[r].length;a++)this._userHandlers[r][a]===i&&this._userHandlers[r].splice(a,1);else this._userHandlers[r]=[];else{if(r!==void 0)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},o.prototype.toMIDIChannels=function(r){var i;if(r==="all"||r===void 0)i=["all"];else{if(r==="none")return i=[];i=Array.isArray(r)?r:[r]}return-1<i.indexOf("all")&&(i=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),i.map(function(a){return parseInt(a)}).filter(function(a){return 1<=a&&a<=16})},o.prototype.getInputById=function(r){if(!this.enabled)throw new Error("WebMidi is not enabled.");r=String(r);for(var i=0;i<this.inputs.length;i++)if(this.inputs[i].id===r)return this.inputs[i];return!1},o.prototype.getOutputById=function(r){if(!this.enabled)throw new Error("WebMidi is not enabled.");r=String(r);for(var i=0;i<this.outputs.length;i++)if(this.outputs[i].id===r)return this.outputs[i];return!1},o.prototype.getInputByName=function(r){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.inputs.length;i++)if(~this.inputs[i].name.indexOf(r))return this.inputs[i];return!1},o.prototype.getOctave=function(r){if(r!=null&&0<=r&&r<=127)return Math.floor(Math.floor(r)/12-1)+Math.floor(n.octaveOffset)},o.prototype.getOutputByName=function(r){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.outputs.length;i++)if(~this.outputs[i].name.indexOf(r))return this.outputs[i];return!1},o.prototype.guessNoteNumber=function(r){var i=!1;if(r&&r.toFixed&&0<=r&&r<=127?i=Math.round(r):0<=parseInt(r)&&parseInt(r)<=127?i=parseInt(r):(typeof r=="string"||r instanceof String)&&(i=this.noteNameToNumber(r)),i===!1)throw new Error("Invalid input value ("+r+").");return i},o.prototype.noteNameToNumber=function(r){typeof r!="string"&&(r="");var i=r.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!i)throw new RangeError("Invalid note name.");var a=n._semitones[i[1].toUpperCase()],c=12*(parseInt(i[3])+1-Math.floor(n.octaveOffset))+a;if(-1<i[2].toLowerCase().indexOf("b")?c-=i[2].length:-1<i[2].toLowerCase().indexOf("#")&&(c+=i[2].length),c<0||127<c)throw new RangeError("Invalid note name or note outside valid range.");return c},o.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},o.prototype._updateInputs=function(){for(var r=0;r<this._inputs.length;r++){for(var i=!0,a=this.interface.inputs.values(),c=a.next();c&&!c.done;c=a.next())if(this._inputs[r]._midiInput===c.value){i=!1;break}i&&this._inputs.splice(r,1)}this.interface&&this.interface.inputs.forEach(function(f){for(var m=!0,l=0;l<this._inputs.length;l++)this._inputs[l]._midiInput===f&&(m=!1);m&&this._inputs.push(new s(f))}.bind(this))},o.prototype._updateOutputs=function(){for(var r=0;r<this._outputs.length;r++){for(var i=!0,a=this.interface.outputs.values(),c=a.next();c&&!c.done;c=a.next())if(this._outputs[r]._midiOutput===c.value){i=!1;break}i&&this._outputs.splice(r,1)}this.interface&&this.interface.outputs.forEach(function(f){for(var m=!0,l=0;l<this._outputs.length;l++)this._outputs[l]._midiOutput===f&&(m=!1);m&&this._outputs.push(new u(f))}.bind(this))},o.prototype._onInterfaceStateChange=function(r){this._updateInputsAndOutputs();var i={timestamp:r.timeStamp,type:r.port.state};this.interface&&r.port.state==="connected"?r.port.type==="output"?i.port=this.getOutputById(r.port.id):r.port.type==="input"&&(i.port=this.getInputById(r.port.id)):i.port={connection:"closed",id:r.port.id,manufacturer:r.port.manufacturer,name:r.port.name,state:r.port.state,type:r.port.type},this._userHandlers[r.port.state].forEach(function(a){a(i)})},o.prototype._resetInterfaceUserHandlers=function(){for(var r=0;r<this._midiInterfaceEvents.length;r++)this._userHandlers[this._midiInterfaceEvents[r]]=[]},s.prototype.on=s.prototype.addListener=function(r,i,a){var c=this;if(i===void 0&&(i="all"),Array.isArray(i)||(i=[i]),i.forEach(function(m){if(m!=="all"&&!(1<=m&&m<=16))throw new RangeError("The 'channel' parameter is invalid.")}),typeof a!="function")throw new TypeError("The 'listener' parameter must be a function.");if(n.MIDI_SYSTEM_MESSAGES[r]!==void 0)this._userHandlers.system[r]||(this._userHandlers.system[r]=[]),this._userHandlers.system[r].push(a);else{if(n.MIDI_CHANNEL_MESSAGES[r]===void 0)throw new TypeError("The specified event type is not supported.");if(-1<i.indexOf("all")){i=[];for(var f=1;f<=16;f++)i.push(f)}this._userHandlers.channel[r]||(this._userHandlers.channel[r]=[]),i.forEach(function(m){c._userHandlers.channel[r][m]||(c._userHandlers.channel[r][m]=[]),c._userHandlers.channel[r][m].push(a)})}return this},s.prototype.hasListener=function(r,i,a){var c=this;if(typeof a!="function")throw new TypeError("The 'listener' parameter must be a function.");if(i===void 0&&(i="all"),i.constructor!==Array&&(i=[i]),n.MIDI_SYSTEM_MESSAGES[r]!==void 0){for(var f=0;f<this._userHandlers.system[r].length;f++)if(this._userHandlers.system[r][f]===a)return!0}else if(n.MIDI_CHANNEL_MESSAGES[r]!==void 0){if(-1<i.indexOf("all")){i=[];for(var m=1;m<=16;m++)i.push(m)}return!!this._userHandlers.channel[r]&&i.every(function(l){var h=c._userHandlers.channel[r][l];return h&&-1<h.indexOf(a)})}return!1},s.prototype.removeListener=function(r,i,a){var c=this;if(a!==void 0&&typeof a!="function")throw new TypeError("The 'listener' parameter must be a function.");if(i===void 0&&(i="all"),i.constructor!==Array&&(i=[i]),n.MIDI_SYSTEM_MESSAGES[r]!==void 0)if(a===void 0)this._userHandlers.system[r]=[];else for(var f=0;f<this._userHandlers.system[r].length;f++)this._userHandlers.system[r][f]===a&&this._userHandlers.system[r].splice(f,1);else if(n.MIDI_CHANNEL_MESSAGES[r]!==void 0){if(-1<i.indexOf("all")){i=[];for(var m=1;m<=16;m++)i.push(m)}if(!this._userHandlers.channel[r])return this;i.forEach(function(l){var h=c._userHandlers.channel[r][l];if(h)if(a===void 0)c._userHandlers.channel[r][l]=[];else for(var d=0;d<h.length;d++)h[d]===a&&h.splice(d,1)})}else{if(r!==void 0)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},s.prototype._initializeUserHandlers=function(){for(var r in n.MIDI_CHANNEL_MESSAGES)Object.prototype.hasOwnProperty.call(n.MIDI_CHANNEL_MESSAGES,r)&&(this._userHandlers.channel[r]={});for(var i in n.MIDI_SYSTEM_MESSAGES)Object.prototype.hasOwnProperty.call(n.MIDI_SYSTEM_MESSAGES,i)&&(this._userHandlers.system[i]=[])},s.prototype._onMidiMessage=function(r){if(0<this._userHandlers.system.midimessage.length){var i={target:this,data:r.data,timestamp:r.timeStamp,type:"midimessage"};this._userHandlers.system.midimessage.forEach(function(a){a(i)})}r.data[0]<240?(this._parseChannelEvent(r),this._parseNrpnEvent(r)):r.data[0]<=255&&this._parseSystemEvent(r)},s.prototype._parseNrpnEvent=function(r){var i,a,c=r.data[0]>>4,f=15&r.data[0],m=1+f;if(1<r.data.length&&(i=r.data[1],a=2<r.data.length?r.data[2]:void 0),n.nrpnEventsEnabled&&c===n.MIDI_CHANNEL_MESSAGES.controlchange&&(i>=n.MIDI_NRPN_MESSAGES.increment&&i<=n.MIDI_NRPN_MESSAGES.parammsb||i===n.MIDI_NRPN_MESSAGES.entrymsb||i===n.MIDI_NRPN_MESSAGES.entrylsb)){var l={target:this,type:"controlchange",data:r.data,timestamp:r.timeStamp,channel:m,controller:{number:i,name:this.getCcNameByNumber(i)},value:a};if(l.controller.number===n.MIDI_NRPN_MESSAGES.parammsb&&l.value!=n.MIDI_NRPN_MESSAGES.nullactiveparameter)n._nrpnBuffer[f]=[],n._nrpnBuffer[f][0]=l;else if(n._nrpnBuffer[f].length===1&&l.controller.number===n.MIDI_NRPN_MESSAGES.paramlsb)n._nrpnBuffer[f].push(l);else if(n._nrpnBuffer[f].length!==2||l.controller.number!==n.MIDI_NRPN_MESSAGES.increment&&l.controller.number!==n.MIDI_NRPN_MESSAGES.decrement&&l.controller.number!==n.MIDI_NRPN_MESSAGES.entrymsb)if(n._nrpnBuffer[f].length===3&&n._nrpnBuffer[f][2].number===n.MIDI_NRPN_MESSAGES.entrymsb&&l.controller.number===n.MIDI_NRPN_MESSAGES.entrylsb)n._nrpnBuffer[f].push(l);else if(3<=n._nrpnBuffer[f].length&&n._nrpnBuffer[f].length<=4&&l.controller.number===n.MIDI_NRPN_MESSAGES.parammsb&&l.value===n.MIDI_NRPN_MESSAGES.nullactiveparameter)n._nrpnBuffer[f].push(l);else if(4<=n._nrpnBuffer[f].length&&n._nrpnBuffer[f].length<=5&&l.controller.number===n.MIDI_NRPN_MESSAGES.paramlsb&&l.value===n.MIDI_NRPN_MESSAGES.nullactiveparameter){n._nrpnBuffer[f].push(l);var h=[];n._nrpnBuffer[f].forEach(function(g){h.push(g.data)});var d=n._nrpnBuffer[f][0].value<<7|n._nrpnBuffer[f][1].value,y=n._nrpnBuffer[f][2].value;n._nrpnBuffer[f].length===6&&(y=n._nrpnBuffer[f][2].value<<7|n._nrpnBuffer[f][3].value);var v="";switch(n._nrpnBuffer[f][2].controller.number){case n.MIDI_NRPN_MESSAGES.entrymsb:v=n._nrpnTypes[0];break;case n.MIDI_NRPN_MESSAGES.increment:v=n._nrpnTypes[1];break;case n.MIDI_NRPN_MESSAGES.decrement:v=n._nrpnTypes[2];break;default:throw new Error("The NPRN type was unidentifiable.")}var b={timestamp:l.timestamp,channel:l.channel,type:"nrpn",data:h,controller:{number:d,type:v,name:"Non-Registered Parameter "+d},value:y};n._nrpnBuffer[f]=[],this._userHandlers.channel[b.type]&&this._userHandlers.channel[b.type][b.channel]&&this._userHandlers.channel[b.type][b.channel].forEach(function(g){g(b)})}else n._nrpnBuffer[f]=[];else n._nrpnBuffer[f].push(l)}},s.prototype._parseChannelEvent=function(r){var i,a,c=r.data[0]>>4,f=1+(15&r.data[0]);1<r.data.length&&(i=r.data[1],a=2<r.data.length?r.data[2]:void 0);var m={target:this,data:r.data,timestamp:r.timeStamp,channel:f};c===n.MIDI_CHANNEL_MESSAGES.noteoff||c===n.MIDI_CHANNEL_MESSAGES.noteon&&a===0?(m.type="noteoff",m.note={number:i,name:n._notes[i%12],octave:n.getOctave(i)},m.velocity=a/127,m.rawVelocity=a):c===n.MIDI_CHANNEL_MESSAGES.noteon?(m.type="noteon",m.note={number:i,name:n._notes[i%12],octave:n.getOctave(i)},m.velocity=a/127,m.rawVelocity=a):c===n.MIDI_CHANNEL_MESSAGES.keyaftertouch?(m.type="keyaftertouch",m.note={number:i,name:n._notes[i%12],octave:n.getOctave(i)},m.value=a/127):c===n.MIDI_CHANNEL_MESSAGES.controlchange&&0<=i&&i<=119?(m.type="controlchange",m.controller={number:i,name:this.getCcNameByNumber(i)},m.value=a):c===n.MIDI_CHANNEL_MESSAGES.channelmode&&120<=i&&i<=127?(m.type="channelmode",m.controller={number:i,name:this.getChannelModeByNumber(i)},m.value=a):c===n.MIDI_CHANNEL_MESSAGES.programchange?(m.type="programchange",m.value=i):c===n.MIDI_CHANNEL_MESSAGES.channelaftertouch?(m.type="channelaftertouch",m.value=i/127):c===n.MIDI_CHANNEL_MESSAGES.pitchbend?(m.type="pitchbend",m.value=((a<<7)+i-8192)/8192):m.type="unknownchannelmessage",this._userHandlers.channel[m.type]&&this._userHandlers.channel[m.type][f]&&this._userHandlers.channel[m.type][f].forEach(function(l){l(m)})},s.prototype.getCcNameByNumber=function(r){if(!(0<=(r=Math.floor(r))&&r<=119))throw new RangeError("The control change number must be between 0 and 119.");for(var i in n.MIDI_CONTROL_CHANGE_MESSAGES)if(Object.prototype.hasOwnProperty.call(n.MIDI_CONTROL_CHANGE_MESSAGES,i)&&r===n.MIDI_CONTROL_CHANGE_MESSAGES[i])return i},s.prototype.getChannelModeByNumber=function(r){if(!(120<=(r=Math.floor(r))&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var i in n.MIDI_CHANNEL_MODE_MESSAGES)if(Object.prototype.hasOwnProperty.call(n.MIDI_CHANNEL_MODE_MESSAGES,i)&&r===n.MIDI_CHANNEL_MODE_MESSAGES[i])return i},s.prototype._parseSystemEvent=function(r){var i=r.data[0],a={target:this,data:r.data,timestamp:r.timeStamp};i===n.MIDI_SYSTEM_MESSAGES.sysex?a.type="sysex":i===n.MIDI_SYSTEM_MESSAGES.timecode?a.type="timecode":i===n.MIDI_SYSTEM_MESSAGES.songposition?a.type="songposition":i===n.MIDI_SYSTEM_MESSAGES.songselect?(a.type="songselect",a.song=r.data[1]):i===n.MIDI_SYSTEM_MESSAGES.tuningrequest?a.type="tuningrequest":i===n.MIDI_SYSTEM_MESSAGES.clock?a.type="clock":i===n.MIDI_SYSTEM_MESSAGES.start?a.type="start":i===n.MIDI_SYSTEM_MESSAGES.continue?a.type="continue":i===n.MIDI_SYSTEM_MESSAGES.stop?a.type="stop":i===n.MIDI_SYSTEM_MESSAGES.activesensing?a.type="activesensing":i===n.MIDI_SYSTEM_MESSAGES.reset?a.type="reset":a.type="unknownsystemmessage",this._userHandlers.system[a.type]&&this._userHandlers.system[a.type].forEach(function(c){c(a)})},u.prototype.send=function(r,i,a){if(!(128<=r&&r<=255))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");i===void 0&&(i=[]),Array.isArray(i)||(i=[i]);var c=[];return i.forEach(function(f){var m=Math.floor(f);if(!(0<=m&&m<=255))throw new RangeError("Data bytes must be integers between 0 (0x00) and 255 (0xFF).");c.push(m)}),this._midiOutput.send([r].concat(c),parseFloat(a)||0),this},u.prototype.sendSysex=function(r,i,a){if(!n.sysexEnabled)throw new Error("Sysex message support must first be activated.");return a=a||{},r=[].concat(r),i.forEach(function(c){if(c<0||127<c)throw new RangeError("The data bytes of a sysex message must be integers between 0 (0x00) and 127 (0x7F).")}),i=r.concat(i,n.MIDI_SYSTEM_MESSAGES.sysexend),this.send(n.MIDI_SYSTEM_MESSAGES.sysex,i,this._parseTimeParameter(a.time)),this},u.prototype.sendTimecodeQuarterFrame=function(r,i){return i=i||{},this.send(n.MIDI_SYSTEM_MESSAGES.timecode,r,this._parseTimeParameter(i.time)),this},u.prototype.sendSongPosition=function(r,i){i=i||{};var a=(r=Math.floor(r)||0)>>7&127,c=127&r;return this.send(n.MIDI_SYSTEM_MESSAGES.songposition,[a,c],this._parseTimeParameter(i.time)),this},u.prototype.sendSongSelect=function(r,i){if(i=i||{},!(0<=(r=Math.floor(r))&&r<=127))throw new RangeError("The song number must be between 0 and 127.");return this.send(n.MIDI_SYSTEM_MESSAGES.songselect,[r],this._parseTimeParameter(i.time)),this},u.prototype.sendTuningRequest=function(r){return r=r||{},this.send(n.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(r.time)),this},u.prototype.sendClock=function(r){return r=r||{},this.send(n.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(r.time)),this},u.prototype.sendStart=function(r){return r=r||{},this.send(n.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(r.time)),this},u.prototype.sendContinue=function(r){return r=r||{},this.send(n.MIDI_SYSTEM_MESSAGES.continue,void 0,this._parseTimeParameter(r.time)),this},u.prototype.sendStop=function(r){return r=r||{},this.send(n.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(r.time)),this},u.prototype.sendActiveSensing=function(r){return r=r||{},this.send(n.MIDI_SYSTEM_MESSAGES.activesensing,[],this._parseTimeParameter(r.time)),this},u.prototype.sendReset=function(r){return r=r||{},this.send(n.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(r.time)),this},u.prototype.stopNote=function(r,i,a){if(r==="all")return this.sendChannelMode("allnotesoff",0,i,a);var c=64;return(a=a||{}).rawVelocity?!isNaN(a.velocity)&&0<=a.velocity&&a.velocity<=127&&(c=a.velocity):!isNaN(a.velocity)&&0<=a.velocity&&a.velocity<=1&&(c=127*a.velocity),this._convertNoteToArray(r).forEach(function(f){n.toMIDIChannels(i).forEach(function(m){this.send((n.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(m-1),[f,Math.round(c)],this._parseTimeParameter(a.time))}.bind(this))}.bind(this)),this},u.prototype.playNote=function(r,i,a){var c,f=64;if((a=a||{}).rawVelocity?!isNaN(a.velocity)&&0<=a.velocity&&a.velocity<=127&&(f=a.velocity):!isNaN(a.velocity)&&0<=a.velocity&&a.velocity<=1&&(f=127*a.velocity),c=this._parseTimeParameter(a.time),this._convertNoteToArray(r).forEach(function(l){n.toMIDIChannels(i).forEach(function(h){this.send((n.MIDI_CHANNEL_MESSAGES.noteon<<4)+(h-1),[l,Math.round(f)],c)}.bind(this))}.bind(this)),!isNaN(a.duration)){a.duration<=0&&(a.duration=0);var m=64;a.rawVelocity?!isNaN(a.release)&&0<=a.release&&a.release<=127&&(m=a.release):!isNaN(a.release)&&0<=a.release&&a.release<=1&&(m=127*a.release),this._convertNoteToArray(r).forEach(function(l){n.toMIDIChannels(i).forEach(function(h){this.send((n.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(h-1),[l,Math.round(m)],(c||n.time)+a.duration)}.bind(this))}.bind(this))}return this},u.prototype.sendKeyAftertouch=function(r,i,a,c){var f=this;if(c=c||{},i<1||16<i)throw new RangeError("The channel must be between 1 and 16.");(isNaN(a)||a<0||1<a)&&(a=.5);var m=Math.round(127*a);return this._convertNoteToArray(r).forEach(function(l){n.toMIDIChannels(i).forEach(function(h){f.send((n.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(h-1),[l,m],f._parseTimeParameter(c.time))})}),this},u.prototype.sendControlChange=function(r,i,a,c){if(c=c||{},typeof r=="string"){if((r=n.MIDI_CONTROL_CHANGE_MESSAGES[r])===void 0)throw new TypeError("Invalid controller name.")}else if(!(0<=(r=Math.floor(r))&&r<=119))throw new RangeError("Controller numbers must be between 0 and 119.");if(!(0<=(i=Math.floor(i)||0)&&i<=127))throw new RangeError("Controller value must be between 0 and 127.");return n.toMIDIChannels(a).forEach(function(f){this.send((n.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(f-1),[r,i],this._parseTimeParameter(c.time))}.bind(this)),this},u.prototype._selectRegisteredParameter=function(r,i,a){var c=this;if(r[0]=Math.floor(r[0]),!(0<=r[0]&&r[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(r[1]=Math.floor(r[1]),!(0<=r[1]&&r[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return n.toMIDIChannels(i).forEach(function(){c.sendControlChange(101,r[0],i,{time:a}),c.sendControlChange(100,r[1],i,{time:a})}),this},u.prototype._selectNonRegisteredParameter=function(r,i,a){var c=this;if(r[0]=Math.floor(r[0]),!(0<=r[0]&&r[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(r[1]=Math.floor(r[1]),!(0<=r[1]&&r[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return n.toMIDIChannels(i).forEach(function(){c.sendControlChange(99,r[0],i,{time:a}),c.sendControlChange(98,r[1],i,{time:a})}),this},u.prototype._setCurrentRegisteredParameter=function(r,i,a){var c=this;if((r=[].concat(r))[0]=Math.floor(r[0]),!(0<=r[0]&&r[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return n.toMIDIChannels(i).forEach(function(){c.sendControlChange(6,r[0],i,{time:a})}),r[1]=Math.floor(r[1]),0<=r[1]&&r[1]<=127&&n.toMIDIChannels(i).forEach(function(){c.sendControlChange(38,r[1],i,{time:a})}),this},u.prototype._deselectRegisteredParameter=function(r,i){var a=this;return n.toMIDIChannels(r).forEach(function(){a.sendControlChange(101,127,r,{time:i}),a.sendControlChange(100,127,r,{time:i})}),this},u.prototype.setRegisteredParameter=function(r,i,a,c){var f=this;if(c=c||{},!Array.isArray(r)){if(!n.MIDI_REGISTERED_PARAMETER[r])throw new Error("The specified parameter is not available.");r=n.MIDI_REGISTERED_PARAMETER[r]}return n.toMIDIChannels(a).forEach(function(){f._selectRegisteredParameter(r,a,c.time),f._setCurrentRegisteredParameter(i,a,c.time),f._deselectRegisteredParameter(a,c.time)}),this},u.prototype.setNonRegisteredParameter=function(r,i,a,c){var f=this;if(c=c||{},!(0<=r[0]&&r[0]<=127&&0<=r[1]&&r[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return i=[].concat(i),n.toMIDIChannels(a).forEach(function(){f._selectNonRegisteredParameter(r,a,c.time),f._setCurrentRegisteredParameter(i,a,c.time),f._deselectRegisteredParameter(a,c.time)}),this},u.prototype.incrementRegisteredParameter=function(r,i,a){var c=this;if(a=a||{},!Array.isArray(r)){if(!n.MIDI_REGISTERED_PARAMETER[r])throw new Error("The specified parameter is not available.");r=n.MIDI_REGISTERED_PARAMETER[r]}return n.toMIDIChannels(i).forEach(function(){c._selectRegisteredParameter(r,i,a.time),c.sendControlChange(96,0,i,{time:a.time}),c._deselectRegisteredParameter(i,a.time)}),this},u.prototype.decrementRegisteredParameter=function(r,i,a){if(a=a||{},!Array.isArray(r)){if(!n.MIDI_REGISTERED_PARAMETER[r])throw new TypeError("The specified parameter is not available.");r=n.MIDI_REGISTERED_PARAMETER[r]}return n.toMIDIChannels(i).forEach(function(){this._selectRegisteredParameter(r,i,a.time),this.sendControlChange(97,0,i,{time:a.time}),this._deselectRegisteredParameter(i,a.time)}.bind(this)),this},u.prototype.setPitchBendRange=function(r,i,a,c){var f=this;if(c=c||{},!(0<=(r=Math.floor(r)||0)&&r<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(i=Math.floor(i)||0)&&i<=127))throw new RangeError("The cents value must be between 0 and 127");return n.toMIDIChannels(a).forEach(function(){f.setRegisteredParameter("pitchbendrange",[r,i],a,{time:c.time})}),this},u.prototype.setModulationRange=function(r,i,a,c){var f=this;if(c=c||{},!(0<=(r=Math.floor(r)||0)&&r<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(i=Math.floor(i)||0)&&i<=127))throw new RangeError("The cents value must be between 0 and 127");return n.toMIDIChannels(a).forEach(function(){f.setRegisteredParameter("modulationrange",[r,i],a,{time:c.time})}),this},u.prototype.setMasterTuning=function(r,i,a){var c=this;if(a=a||{},(r=parseFloat(r)||0)<=-65||64<=r)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var f=Math.floor(r)+64,m=r-Math.floor(r),l=(m=Math.round((m+1)/2*16383))>>7&127,h=127&m;return n.toMIDIChannels(i).forEach(function(){c.setRegisteredParameter("channelcoarsetuning",f,i,{time:a.time}),c.setRegisteredParameter("channelfinetuning",[l,h],i,{time:a.time})}),this},u.prototype.setTuningProgram=function(r,i,a){var c=this;if(a=a||{},!(0<=(r=Math.floor(r))&&r<=127))throw new RangeError("The program value must be between 0 and 127");return n.toMIDIChannels(i).forEach(function(){c.setRegisteredParameter("tuningprogram",r,i,{time:a.time})}),this},u.prototype.setTuningBank=function(r,i,a){var c=this;if(a=a||{},!(0<=(r=Math.floor(r)||0)&&r<=127))throw new RangeError("The bank value must be between 0 and 127");return n.toMIDIChannels(i).forEach(function(){c.setRegisteredParameter("tuningbank",r,i,{time:a.time})}),this},u.prototype.sendChannelMode=function(r,i,a,c){if(c=c||{},typeof r=="string"){if(!(r=n.MIDI_CHANNEL_MODE_MESSAGES[r]))throw new TypeError("Invalid channel mode message name.")}else if(!(120<=(r=Math.floor(r))&&r<=127))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if((i=Math.floor(i)||0)<0||127<i)throw new RangeError("Value must be an integer between 0 and 127.");return n.toMIDIChannels(a).forEach(function(f){this.send((n.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(f-1),[r,i],this._parseTimeParameter(c.time))}.bind(this)),this},u.prototype.sendProgramChange=function(r,i,a){var c=this;if(a=a||{},r=Math.floor(r),isNaN(r)||r<0||127<r)throw new RangeError("Program numbers must be between 0 and 127.");return n.toMIDIChannels(i).forEach(function(f){c.send((n.MIDI_CHANNEL_MESSAGES.programchange<<4)+(f-1),[r],c._parseTimeParameter(a.time))}),this},u.prototype.sendChannelAftertouch=function(r,i,a){var c=this;a=a||{},r=parseFloat(r),(isNaN(r)||r<0||1<r)&&(r=.5);var f=Math.round(127*r);return n.toMIDIChannels(i).forEach(function(m){c.send((n.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(m-1),[f],c._parseTimeParameter(a.time))}),this},u.prototype.sendPitchBend=function(r,i,a){var c=this;if(a=a||{},isNaN(r)||r<-1||1<r)throw new RangeError("Pitch bend value must be between -1 and 1.");var f=Math.round((r+1)/2*16383),m=f>>7&127,l=127&f;return n.toMIDIChannels(i).forEach(function(h){c.send((n.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(h-1),[l,m],c._parseTimeParameter(a.time))}),this},u.prototype._parseTimeParameter=function(r){var i,a=parseFloat(r);return typeof r=="string"&&r.substring(0,1)==="+"?a&&0<a&&(i=n.time+a):a>n.time&&(i=a),i},u.prototype._convertNoteToArray=function(r){var i=[];return Array.isArray(r)||(r=[r]),r.forEach(function(a){i.push(n.guessNoteNumber(a))}),i},t.exports?t.exports=n:e.WebMidi||(e.WebMidi=n)})(ce)}),Pe=Ti;var Xr="route-to",pt="toggle-debug",Me="toggle-key-state",we="set-key-state",yt="reset-key-state",gt="set-random-key-state",Ve="set-highlights",bt="reset-highlights",vt="set-size",St="toggle-view-config",Et="set-midi-devices";var be="set-midi-file",It="set-midi-file-error",Zr="set-comparison";var en=t=>{Pe.inputs.forEach(e=>e.addListener("noteon","all",o=>{t.dispatch([Me,o.note.number%12]),console.log(`Received 'noteon' message (${o.note.name+o.note.octave}) from ${e.name}`)}))},tn=t=>{Pe.enable(e=>{if(e){console.log("WebMidi could not be enabled.",e);return}else console.log("WebMidi enabled!"),t.dispatch([Et,Pe.inputs.map(o=>o.name)]);en(t)})},_i=(t,e)=>{if(Pe.inputs.forEach(o=>o.removeListener()),e==="All Devices"){en(t);return}else{let o=Pe.getInputByName(e);o&&o.addListener("noteon","all",n=>{t.dispatch([Me,n.note.number%12]),console.log(`Received 'noteon' message (${n.note.name+n.note.octave}) from ${e}`)})}},rn=t=>{let e=t.views,o=t.ui.midiDevicesStatus,n=t.bus;return()=>{let s=e.enabledMidi.deref(),u=e.midiDevices.deref();return["div",["span",o.content[Number(s)],""],["span",o.dropdown.root,u.length>=1?[Ur,{...o.dropdown.selection,onchange:r=>_i(n,r.target.value)},Q(F(r=>[r,r]),J(),["All Devices",...u])]:"Web MIDI unavailable"]]}};function nn(t,e,o,n){return["a",{...o,onclick:s=>{s.preventDefault(),t.bus.dispatch(e)}},n]}function on(t,e,o){return["div#debug",t.ui.column.debug[e],[nn,[pt],t.ui.debugToggle,e?"close":"open"],["pre",t.ui.code,o]]}var tr="route-to";var Mt=lr,rr=class{constructor(e){this.config=e,this.state=new ve(e.initialState||{}),this.ctx={bus:new Yt(this.state,e.events,e.effects),views:{},ui:e.ui},this.addViews(this.config.views),this.router=new Jt(e.router),this.router.addListener(Ae,o=>this.ctx.bus.dispatch([Ae,o.value])),this.ctx.bus.addHandlers({[Ae]:kr("route"),[Xr]:(o,[n,s])=>({[tr]:s})}),this.ctx.bus.addEffect(tr,([o,n])=>this.router.routeTo(this.router.format(o,n))),Mt&&Mt==="development"&&this.ctx.bus.instrumentWith([Nr]),this.addViews({route:"route",routeComponent:["route.id",o=>(this.config.components[o]||(()=>["div",`missing component for route: ${o}`]))(this.ctx)]})}addViews(e){let o=this.ctx.views;for(let n in e){let s=e[n];o[n]=q(s)?Lt(this.state,s[0],s[1]):Lt(this.state,s)}}start(){tn(this.ctx.bus),window.addEventListener("resize",()=>{this.ctx.bus.dispatch([vt])}),this.router.start(),Cr(()=>{if(this.ctx.bus.processQueue())return this.rootComponent()},{root:this.config.domRoot,ctx:this.ctx})}rootComponent(){let e=this.ctx.views.debug.deref(),o=this.ctx.ui;return["div",o.root,Mt&&Mt==="development"?[["div",o.column.content[e],this.ctx.views.routeComponent],[on,e,this.ctx.views.json]]:["div",this.ctx.views.routeComponent]]}};var nr=(t,e,o={})=>(n,s)=>["a",{...o,onclick:t,disabled:s},e];var sn=t=>{let e=t.ui,o=nr(s=>{s.preventDefault(),t.bus.dispatch([yt])},"CLEAR",e.toolbar.button),n=nr(s=>{s.preventDefault(),t.bus.dispatch([gt])},"RANDOM",e.toolbar.button);return()=>["div",e.toolbar.root,[o],[n]]};var Oi={anim:100,pad:1,margin:0,hlOn:{fill:"#E83015"},bgOn:{fill:"#CCCCCC"},bgOff:{fill:"#CCCCCC"},fgOn:{fill:"#E83015"},fgOff:{fill:"#fff"},floor:1},Ai=["filter",{id:"blur"},["feGaussianBlur",{in:"SourceGraphic",stdDeviation:".25"}]],wt=(t={})=>{let e={r:5,...Oi,...t},{r:o,pad:n,margin:s,glyph:u,floor:r}=e,i=.5,a=o*i**2,c=s*2,f=o+n,m=f+s,h=f*2+c,d={width:h,height:h*r},y={transition:`all ${e.anim}ms ease-out`},v={cx:m,cy:m},b={...e.hlOn,...v,r:f},g={...e.bgOn,...v,style:y,r:o},w={...g,...e.bgOff},O={...e.fgOn,...v,style:y,r:a},D={...O,...e.fgOff},k={...e.fgOn,x:"50%",y:"50%","text-anchor":"middle","alignment-baseline":"central",font:"bold font-sans","font-size":h*i,style:y},H={...k,...e.fgOff};return(W,U,V,Y)=>["svg",{...d,...U},Ai,["g",["circle",Y?b:{}],["circle",V?g:w],u?["text",V?k:H,u]:["circle",V?O:D]]]};var or={anim:0,r:16,pad:2},Di={...or,glyph:"C"},Ci={...or,bgOn:{fill:"#000"},bgOff:{fill:"#000"}},Pi=(t,e)=>[1,3,6,8,10].includes(t)?e.minor:t===4?e.e:e.major,an=t=>{let e=t.views,o=t.ui,n=e.size.deref(),s=Math.min(18*2,n[0]*.9/13),u={r:s/2*(8/9),pad:s/2*(1/9)},r=e.highlights.deref();return["div.mb-4",...e.keyState.deref().map((i,a)=>["div",Pi(a,o.toggleGroup.key),[a===0?wt({...Di,...u}):[2,4,5,7,9,11].includes(a)?wt({...or,...u}):wt({...Ci,...u}),{onclick:c=>{c.preventDefault(),t.bus.dispatch([Me,a])}},i,r.includes(a)]])]};var xi=t=>t[Symbol.iterator]();function*ir(t,e){let o={},n=xi(t),s;for(;s=n.next(),!s.done;){let u=e?e(s.value):s.value,r=JSON.stringify(u),i=o[r];i?i[1]++:o[r]=[u,1]}yield*Object.keys(o).map(u=>o[u])}var ji=t=>t instanceof Map;function Ni(t,e){if(ji(t))for(let o of e)t.set(o[0],o[1]);else for(let o of e)t.add(o);return t}var ki=(t,e)=>de(t,"empty")?t.empty():new(t[Symbol.species]||e),sr=(t,e,o)=>{if(o=o||ki(t,Set),t===e)return Ni(o,t);if(e.size<t.size)return sr(e,t,o);for(let n of e)t.has(n)&&o.add(n);return o};var Tt=(t,e)=>Array(Math.abs(e)+1).join(t);function _t(t){return t!==null&&typeof t=="object"&&typeof t.name=="string"}function Ot(t){return t!==null&&typeof t=="object"&&typeof t.step=="number"&&typeof t.alt=="number"}var un=[0,2,4,-1,1,3,5],cn=un.map(t=>Math.floor(t*7/12));function fn(t){let{step:e,alt:o,oct:n,dir:s=1}=t,u=un[e]+7*o;if(n===void 0)return[s*u];let r=n-cn[e]-4*o;return[s*u,s*r]}var Ri=[3,0,4,1,5,2,6];function Ui(t){let[e,o,n]=t,s=Ri[Fi(e)],u=Math.floor((e+1)/7);if(o===void 0)return{step:s,alt:u,dir:n};let r=o+4*u+cn[s];return{step:s,alt:u,oct:r,dir:n}}function Fi(t){let e=(t+1)%7;return e<0?7+e:e}var ln={empty:!0,name:"",pc:"",acc:""},mn=new Map,Bi=t=>"CDEFGAB".charAt(t),At=t=>t<0?Tt("b",-t):Tt("#",t),ar=t=>t[0]==="b"?-t.length:t.length;function ie(t){let e=mn.get(t);if(e)return e;let o=typeof t=="string"?Gi(t):Ot(t)?ie(Hi(t)):_t(t)?ie(t.name):ln;return mn.set(t,o),o}var Li=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function Vi(t){let e=Li.exec(t);return[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]}function zi(t){return ie(Ui(t))}var Wi=(t,e)=>(t%e+e)%e,ur=[0,2,4,5,7,9,11];function Gi(t){let e=Vi(t);if(e[0]===""||e[3]!=="")return ln;let o=e[0],n=e[1],s=e[2],u=(o.charCodeAt(0)+3)%7,r=ar(n),i=s.length?+s:void 0,a=fn({step:u,alt:r,oct:i}),c=o+n+s,f=o+n,m=(ur[u]+r+120)%12,l=i===void 0?Wi(ur[u]+r,12)-12*99:ur[u]+r+12*(i+1),h=l>=0&&l<=127?l:null,d=i===void 0?null:Math.pow(2,(l-69)/12)*440;return{empty:!1,acc:n,alt:r,chroma:m,coord:a,freq:d,height:l,letter:o,midi:h,name:c,oct:i,pc:f,step:u}}function Hi(t){let{step:e,alt:o,oct:n}=t,s=Bi(e);if(!s)return"";let u=s+At(o);return n||n===0?u+n:u}var cr={empty:!0,name:"",acc:""},Ki="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",$i="(AA|A|P|M|m|d|dd)([-+]?\\d+)",Yi=new RegExp("^"+Ki+"|"+$i+"$");function qi(t){let e=Yi.exec(`${t}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var hn={};function ze(t){return typeof t=="string"?hn[t]||(hn[t]=Ji(t)):Ot(t)?ze(Qi(t)):_t(t)?ze(t.name):cr}var dn=[0,2,4,5,7,9,11],pn="PMMPPMM";function Ji(t){let e=qi(t);if(e[0]==="")return cr;let o=+e[0],n=e[1],s=(Math.abs(o)-1)%7,u=pn[s];if(u==="M"&&n==="P")return cr;let r=u==="M"?"majorable":"perfectable",i=""+o+n,a=o<0?-1:1,c=o===8||o===-8?o:a*(s+1),f=Xi(r,n),m=Math.floor((Math.abs(o)-1)/7),l=a*(dn[s]+f+12*m),h=(a*(dn[s]+f)%12+12)%12,d=fn({step:s,alt:f,oct:m,dir:a});return{empty:!1,name:i,num:o,q:n,step:s,alt:f,dir:a,type:r,simple:c,semitones:l,chroma:h,coord:d,oct:m}}function Xi(t,e){return e==="M"&&t==="majorable"||e==="P"&&t==="perfectable"?0:e==="m"&&t==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(t==="perfectable"?e.length:e.length+1):0}function Qi(t){let{step:e,alt:o,oct:n=0,dir:s}=t;if(!s)return"";let u=e+1+7*n,r=s<0?"-":"",i=pn[e]==="M"?"majorable":"perfectable";return r+u+Zi(i,o)}function Zi(t,e){return e===0?t==="majorable"?"M":"P":e===-1&&t==="majorable"?"m":e>0?Tt("A",e):Tt("d",t==="perfectable"?e:e+1)}function Dt(t,e){let o=ie(t),n=ze(e);if(o.empty||n.empty)return"";let s=o.coord,u=n.coord,r=s.length===1?[s[0]+u[0]]:[s[0]+u[0],s[1]+u[1]];return zi(r).name}var yn={empty:!0,name:"",chordType:""},gn={};function We(t){return typeof t=="string"?gn[t]||(gn[t]=ts(t)):typeof t=="number"?We(fr[t]||""):Ot(t)?es(t):_t(t)?We(t.name):yn}function es(t){return We(At(t.alt)+fr[t.step])}var rs=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/;function ns(t){return rs.exec(t)||["","","",""]}var os="I II III IV V VI VII",fr=os.split(" ");function ts(t){let[e,o,n,s]=ns(t);if(!n)return yn;let u=n.toUpperCase(),r=fr.indexOf(u),i=ar(o),a=1;return{empty:!1,name:e,roman:n,interval:ze({step:r,alt:i,dir:a}).name,acc:o,chordType:s,alt:i,step:r,major:n===u,oct:0,dir:a}}var fe=Object.freeze([]),is={type:"major",tonic:"",alteration:0,keySignature:""},ss={tonic:"",grades:fe,intervals:fe,scale:fe,chords:fe,chordsHarmonicFunction:fe,chordScales:fe},as={...is,...ss,type:"major",minorRelative:"",scale:fe,secondaryDominants:fe,secondaryDominantsMinorRelative:fe,substituteDominants:fe,substituteDominantsMinorRelative:fe},bn=(t,e,o="")=>e.map((n,s)=>`${t[s]}${o}${n}`);function us(t,e,o,n){return s=>{let u=t.map(i=>We(i).interval||""),r=u.map(i=>Dt(s,i));return{tonic:s,grades:t,intervals:u,scale:r,chords:bn(r,e),chordsHarmonicFunction:o.slice(),chordScales:bn(r,n," ")}}}var cs=(t,e)=>{let o=ie(t),n=ie(e);return o.empty||n.empty?0:n.coord[0]-o.coord[0]},fs=us("I II III IV V VI VII".split(" "),"maj7 m7 m7 maj7 7 m7 m7b5".split(" "),"T SD T SD D T D".split(" "),"major,dorian,phrygian,lydian,mixolydian,minor,locrian".split(","));function vn(t){let e=ie(t).pc;if(!e)return as;let o=fs(e),n=cs("C",e),s=u=>{let r=We(u);return r.empty?"":Dt(t,r.interval)+r.chordType};return{...o,type:"major",minorRelative:Dt(e,"-3m"),alteration:n,keySignature:At(n),secondaryDominants:"- VI7 VII7 I7 II7 III7 -".split(" ").map(s),secondaryDominantsMinorRelative:"- IIIm7b5 IV#m7 Vm7 VIm7 VIIm7b5 -".split(" ").map(s),substituteDominants:"- bIII7 IV7 bV7 bVI7 bVII7 -".split(" ").map(s),substituteDominantsMinorRelative:"- IIIm7 Im7 IIbm7 VIm7 IVm7 -".split(" ").map(s)}}function ls(t){return+t>=0&&+t<=127}function Ct(t){if(ls(t))return+t;let e=ie(t);return e.empty?null:e.midi}var ms="C C# D D# E F F# G G# A A# B".split(" "),hs="C Db D Eb E F Gb G Ab A Bb B".split(" ");function Sn(t,e={}){if(isNaN(t)||t===-Infinity||t===Infinity)return"";t=Math.round(t);let n=(e.sharps===!0?ms:hs)[t%12];if(e.pitchClass)return n;let s=Math.floor(t/12)-1;return n+s}var ds=ie,En=t=>{let e=ds(t);return e.empty?"":Sn(e.midi||e.chroma,{sharps:e.alt>0,pitchClass:e.midi===null})};function gs(t){var e=new ee(t),o=e.readChunk();if(o.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+o.id+"'";for(var n=ps(o.data),s=[],u=0;!e.eof()&&u<n.numTracks;u++){var r=e.readChunk();if(r.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+r.id+"'";var i=ys(r.data);s.push(i)}return{header:n,tracks:s}}function ps(t){var e=new ee(t),o=e.readUInt16(),n=e.readUInt16(),s={format:o,numTracks:n},u=e.readUInt16();return u&32768?(s.framesPerSecond=256-(u>>8),s.ticksPerFrame=u&255):s.ticksPerBeat=u,s}function ys(t){for(var e=new ee(t),o=[];!e.eof();){var n=u();o.push(n)}return o;var s;function u(){var r={};r.deltaTime=e.readVarInt();var i=e.readUInt8();if((i&240)==240)if(i===255){r.meta=!0;var a=e.readUInt8(),c=e.readVarInt();switch(a){case 0:if(r.type="sequenceNumber",c!==2)throw"Expected length for sequenceNumber event is 2, got "+c;return r.number=e.readUInt16(),r;case 1:return r.type="text",r.text=e.readString(c),r;case 2:return r.type="copyrightNotice",r.text=e.readString(c),r;case 3:return r.type="trackName",r.text=e.readString(c),r;case 4:return r.type="instrumentName",r.text=e.readString(c),r;case 5:return r.type="lyrics",r.text=e.readString(c),r;case 6:return r.type="marker",r.text=e.readString(c),r;case 7:return r.type="cuePoint",r.text=e.readString(c),r;case 32:if(r.type="channelPrefix",c!=1)throw"Expected length for channelPrefix event is 1, got "+c;return r.channel=e.readUInt8(),r;case 33:if(r.type="portPrefix",c!=1)throw"Expected length for portPrefix event is 1, got "+c;return r.port=e.readUInt8(),r;case 47:if(r.type="endOfTrack",c!=0)throw"Expected length for endOfTrack event is 0, got "+c;return r;case 81:if(r.type="setTempo",c!=3)throw"Expected length for setTempo event is 3, got "+c;return r.microsecondsPerBeat=e.readUInt24(),r;case 84:if(r.type="smpteOffset",c!=5)throw"Expected length for smpteOffset event is 5, got "+c;var f=e.readUInt8(),m={0:24,32:25,64:29,96:30};return r.frameRate=m[f&96],r.hour=f&31,r.min=e.readUInt8(),r.sec=e.readUInt8(),r.frame=e.readUInt8(),r.subFrame=e.readUInt8(),r;case 88:if(r.type="timeSignature",c!=4)throw"Expected length for timeSignature event is 4, got "+c;return r.numerator=e.readUInt8(),r.denominator=1<<e.readUInt8(),r.metronome=e.readUInt8(),r.thirtyseconds=e.readUInt8(),r;case 89:if(r.type="keySignature",c!=2)throw"Expected length for keySignature event is 2, got "+c;return r.key=e.readInt8(),r.scale=e.readUInt8(),r;case 127:return r.type="sequencerSpecific",r.data=e.readBytes(c),r;default:return r.type="unknownMeta",r.data=e.readBytes(c),r.metatypeByte=a,r}}else if(i==240){r.type="sysEx";var c=e.readVarInt();return r.data=e.readBytes(c),r}else if(i==247){r.type="endSysEx";var c=e.readVarInt();return r.data=e.readBytes(c),r}else throw"Unrecognised MIDI event type byte: "+i;else{var l;if((i&128)==0){if(s===null)throw"Running status byte encountered before status byte";l=i,i=s,r.running=!0}else l=e.readUInt8(),s=i;var h=i>>4;switch(r.channel=i&15,h){case 8:return r.type="noteOff",r.noteNumber=l,r.velocity=e.readUInt8(),r;case 9:var d=e.readUInt8();return r.type=d===0?"noteOff":"noteOn",r.noteNumber=l,r.velocity=d,d===0&&(r.byte9=!0),r;case 10:return r.type="noteAftertouch",r.noteNumber=l,r.amount=e.readUInt8(),r;case 11:return r.type="controller",r.controllerType=l,r.value=e.readUInt8(),r;case 12:return r.type="programChange",r.programNumber=l,r;case 13:return r.type="channelAftertouch",r.amount=l,r;case 14:return r.type="pitchBend",r.value=l+(e.readUInt8()<<7)-8192,r;default:throw"Unrecognised MIDI event type: "+h}}}}function ee(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}ee.prototype.eof=function(){return this.pos>=this.bufferLen};ee.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t};ee.prototype.readInt8=function(){var t=this.readUInt8();return t&128?t-256:t};ee.prototype.readUInt16=function(){var t=this.readUInt8(),e=this.readUInt8();return(t<<8)+e};ee.prototype.readInt16=function(){var t=this.readUInt16();return t&32768?t-65536:t};ee.prototype.readUInt24=function(){var t=this.readUInt8(),e=this.readUInt8(),o=this.readUInt8();return(t<<16)+(e<<8)+o};ee.prototype.readInt24=function(){var t=this.readUInt24();return t&8388608?t-16777216:t};ee.prototype.readUInt32=function(){var t=this.readUInt8(),e=this.readUInt8(),o=this.readUInt8(),n=this.readUInt8();return(t<<24)+(e<<16)+(o<<8)+n};ee.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e};ee.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)};ee.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(e&128)t+=e&127,t<<=7;else return t+e}return t};ee.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32(),o=this.readBytes(e);return{id:t,length:e,data:o}};var bs=gs;function Es(t,e){if(typeof t!="object")throw"Invalid MIDI data";e=e||{};var o=t.header||{},n=t.tracks||[],s,u=n.length,r=new $;for(vs(r,o,u),s=0;s<u;s++)Ss(r,n[s],e);return r.buffer}function vs(t,e,o){var n=e.format==null?1:e.format,s=128;e.timeDivision?s=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?s=-(e.framesPerSecond&255)<<8|e.ticksPerFrame&255:e.ticksPerBeat&&(s=e.ticksPerBeat&32767);var u=new $;u.writeUInt16(n),u.writeUInt16(o),u.writeUInt16(s),t.writeChunk("MThd",u.buffer)}function Ss(t,e,o){var n=new $,s,u=e.length,r=null;for(s=0;s<u;s++)(o.running===!1||!o.running&&!e[s].running)&&(r=null),r=Is(n,e[s],r,o.useByte9ForNoteOff);t.writeChunk("MTrk",n.buffer)}function Is(t,e,o,n){var s=e.type,u=e.deltaTime,r=e.text||"",i=e.data||[],a=null;switch(t.writeVarInt(u),s){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(r.length),t.writeString(r);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(r.length),t.writeString(r);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(r.length),t.writeString(r);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(r.length),t.writeString(r);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(r.length),t.writeString(r);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(r.length),t.writeString(r);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(r.length),t.writeString(r);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var c={24:0,25:32,29:64,30:96},f=e.hour&31|c[e.frameRate];t.writeUInt8(f),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var m=Math.floor(Math.log(e.denominator)/Math.LN2)&255;t.writeUInt8(m),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(i.length),t.writeBytes(i);break;case"unknownMeta":e.metatypeByte!=null&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(i.length),t.writeBytes(i));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(i.length),t.writeBytes(i);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(i.length),t.writeBytes(i);break;case"noteOff":var l=n!==!1&&e.byte9||n&&e.velocity==0?144:128;a=l|e.channel,a!==o&&t.writeUInt8(a),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":a=144|e.channel,a!==o&&t.writeUInt8(a),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":a=160|e.channel,a!==o&&t.writeUInt8(a),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":a=176|e.channel,a!==o&&t.writeUInt8(a),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":a=192|e.channel,a!==o&&t.writeUInt8(a),t.writeUInt8(e.programNumber);break;case"channelAftertouch":a=208|e.channel,a!==o&&t.writeUInt8(a),t.writeUInt8(e.amount);break;case"pitchBend":a=224|e.channel,a!==o&&t.writeUInt8(a);var h=8192+e.value,d=h&127,y=h>>7&127;t.writeUInt8(d),t.writeUInt8(y);break;default:throw"Unrecognized event type: "+s}return a}function $(){this.buffer=[]}$.prototype.writeUInt8=function(t){this.buffer.push(t&255)};$.prototype.writeInt8=$.prototype.writeUInt8;$.prototype.writeUInt16=function(t){var e=t>>8&255,o=t&255;this.writeUInt8(e),this.writeUInt8(o)};$.prototype.writeInt16=$.prototype.writeUInt16;$.prototype.writeUInt24=function(t){var e=t>>16&255,o=t>>8&255,n=t&255;this.writeUInt8(e),this.writeUInt8(o),this.writeUInt8(n)};$.prototype.writeInt24=$.prototype.writeUInt24;$.prototype.writeUInt32=function(t){var e=t>>24&255,o=t>>16&255,n=t>>8&255,s=t&255;this.writeUInt8(e),this.writeUInt8(o),this.writeUInt8(n),this.writeUInt8(s)};$.prototype.writeInt32=$.prototype.writeUInt32;$.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))};$.prototype.writeString=function(t){var e,o=t.length,n=[];for(e=0;e<o;e++)n.push(t.codePointAt(e));this.writeBytes(n)};$.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,o=[];for(o.push(e&127),e>>=7;e;){var n=e&127|128;o.push(n),e>>=7}this.writeBytes(o.reverse())}};$.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)};var Ms=Es,ws=bs,Ts=Ms,In={parseMidi:ws,writeMidi:Ts},xe=X(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});function o(s,u,r){r===void 0&&(r="ticks");var i=0,a=s.length,c=a;if(a>0&&s[a-1][r]<=u)return a-1;for(;i<c;){var f=Math.floor(i+(c-i)/2),m=s[f],l=s[f+1];if(m[r]===u){for(var h=f;h<s.length;h++){var d=s[h];d[r]===u&&(f=h)}return f}else{if(m[r]<u&&l[r]>u)return f;m[r]>u?c=f:m[r]<u&&(i=f+1)}}return-1}e.search=o;function n(s,u,r){if(r===void 0&&(r="ticks"),s.length){var i=o(s,u[r],r);s.splice(i+1,0,u)}else s.push(u)}e.insert=n}),Pt=X(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var o=new WeakMap;e.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var n=function(){function s(u){var r=this;this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",o.set(this,480),u&&(o.set(this,u.header.ticksPerBeat),u.tracks.forEach(function(i){return i.forEach(function(a){a.meta&&(a.type==="timeSignature"?r.timeSignatures.push({ticks:a.absoluteTime,timeSignature:[a.numerator,a.denominator]}):a.type==="setTempo"?r.tempos.push({bpm:6e7/a.microsecondsPerBeat,ticks:a.absoluteTime}):a.type==="keySignature"&&r.keySignatures.push({key:e.keySignatureKeys[a.key+7],scale:a.scale===0?"major":"minor",ticks:a.absoluteTime}))})}),u.tracks[0].forEach(function(i){i.meta&&(i.type==="trackName"?r.name=i.text:(i.type==="text"||i.type==="cuePoint"||i.type==="marker"||i.type==="lyrics")&&r.meta.push({text:i.text,ticks:i.absoluteTime,type:i.type}))}),this.update())}return s.prototype.update=function(){var u=this,r=0,i=0;this.tempos.sort(function(a,c){return a.ticks-c.ticks}),this.tempos.forEach(function(a,c){var f=c>0?u.tempos[c-1].bpm:u.tempos[0].bpm,m=a.ticks/u.ppq-i,l=60/f*m;a.time=l+r,r=a.time,i+=m}),this.timeSignatures.sort(function(a,c){return a.ticks-c.ticks}),this.timeSignatures.forEach(function(a,c){var f=c>0?u.timeSignatures[c-1]:u.timeSignatures[0],m=(a.ticks-f.ticks)/u.ppq,l=m/f.timeSignature[0]/(f.timeSignature[1]/4);f.measures=f.measures||0,a.measures=l+f.measures})},s.prototype.ticksToSeconds=function(u){var r=xe.search(this.tempos,u);if(r!==-1){var i=this.tempos[r],a=i.time,c=(u-i.ticks)/this.ppq;return a+60/i.bpm*c}else{var f=u/this.ppq;return 60/120*f}},s.prototype.ticksToMeasures=function(u){var r=xe.search(this.timeSignatures,u);if(r!==-1){var i=this.timeSignatures[r],a=(u-i.ticks)/this.ppq;return i.measures+a/(i.timeSignature[0]/i.timeSignature[1])/4}else return u/this.ppq/4},Object.defineProperty(s.prototype,"ppq",{get:function(){return o.get(this)},enumerable:!0,configurable:!0}),s.prototype.secondsToTicks=function(u){var r=xe.search(this.tempos,u,"time");if(r!==-1){var i=this.tempos[r],a=i.time,c=u-a,f=c/(60/i.bpm);return Math.round(i.ticks+f*this.ppq)}else{var m=u/(60/120);return Math.round(m*this.ppq)}},s.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(u){return{bpm:u.bpm,ticks:u.ticks}}),timeSignatures:this.timeSignatures}},s.prototype.fromJSON=function(u){this.name=u.name,this.tempos=u.tempos.map(function(r){return Object.assign({},r)}),this.timeSignatures=u.timeSignatures.map(function(r){return Object.assign({},r)}),this.keySignatures=u.keySignatures.map(function(r){return Object.assign({},r)}),this.meta=u.meta.map(function(r){return Object.assign({},r)}),o.set(this,u.ppq),this.update()},s.prototype.setTempo=function(u){this.tempos=[{bpm:u,ticks:0}],this.update()},s}();e.Header=n}),xt=_s,Os=Mn,Ds=As,Cs=wn;function _s(t){if(!Array.isArray(t))throw new TypeError("Expected value to be an array");return Mn(t)}function Mn(t){return Tn(t,[])}function As(t,e){if(!Array.isArray(t))throw new TypeError("Expected value to be an array");return wn(t,e)}function wn(t,e){if(typeof e!="number")throw new TypeError("Expected the depth to be a number");return _n(t,[],e)}function Tn(t,e){for(var o=0;o<t.length;o++){var n=t[o];Array.isArray(n)?Tn(n,e):e.push(n)}return e}function _n(t,e,o){o--;for(var n=0;n<t.length;n++){var s=t[n];o>-1&&Array.isArray(s)?_n(s,e,o):e.push(s)}return e}xt.from=Os;xt.depth=Ds;xt.fromDepth=Cs;var Ps=X(function(t,e){var o=ce&&ce.__spreadArrays||function(){for(var g=0,w=0,O=arguments.length;w<O;w++)g+=arguments[w].length;for(var D=Array(g),k=0,w=0;w<O;w++)for(var H=arguments[w],W=0,U=H.length;W<U;W++,k++)D[k]=H[W];return D},n=ce&&ce.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(e,"__esModule",{value:!0});var s=n(xt);function u(g,w){return[{absoluteTime:g.ticks,channel:w,deltaTime:0,noteNumber:g.midi,type:"noteOn",velocity:Math.floor(g.velocity*127)},{absoluteTime:g.ticks+g.durationTicks,channel:w,deltaTime:0,noteNumber:g.midi,type:"noteOff",velocity:Math.floor(g.noteOffVelocity*127)}]}function r(g){return s.default(g.notes.map(function(w){return u(w,g.channel)}))}function i(g,w){return{absoluteTime:g.ticks,channel:w,controllerType:g.number,deltaTime:0,type:"controller",value:Math.floor(g.value*127)}}function a(g){for(var w=[],O=0;O<127;O++)g.controlChanges.hasOwnProperty(O)&&g.controlChanges[O].forEach(function(D){w.push(i(D,g.channel))});return w}function c(g,w){return{absoluteTime:g.ticks,channel:w,deltaTime:0,type:"pitchBend",value:g.value}}function f(g){var w=[];return g.pitchBends.forEach(function(O){w.push(c(O,g.channel))}),w}function m(g){return{absoluteTime:0,channel:g.channel,deltaTime:0,programNumber:g.instrument.number,type:"programChange"}}function l(g){return{absoluteTime:0,deltaTime:0,meta:!0,text:g,type:"trackName"}}function h(g){return{absoluteTime:g.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/g.bpm),type:"setTempo"}}function d(g){return{absoluteTime:g.ticks,deltaTime:0,denominator:g.timeSignature[1],meta:!0,metronome:24,numerator:g.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function y(g){var w=Pt.keySignatureKeys.indexOf(g.key);return{absoluteTime:g.ticks,deltaTime:0,key:w+7,meta:!0,scale:g.scale==="major"?0:1,type:"keySignature"}}function v(g){return{absoluteTime:g.ticks,deltaTime:0,meta:!0,text:g.text,type:g.type}}function b(g){var w={header:{format:1,numTracks:g.tracks.length+1,ticksPerBeat:g.header.ppq},tracks:o([o([{absoluteTime:0,deltaTime:0,meta:!0,text:g.header.name,type:"trackName"}],g.header.keySignatures.map(function(O){return y(O)}),g.header.meta.map(function(O){return v(O)}),g.header.tempos.map(function(O){return h(O)}),g.header.timeSignatures.map(function(O){return d(O)}))],g.tracks.map(function(O){return o([l(O.name),m(O)],r(O),a(O),f(O))}))};return w.tracks=w.tracks.map(function(O){O=O.sort(function(k,H){return k.absoluteTime-H.absoluteTime});var D=0;return O.forEach(function(k){k.deltaTime=k.absoluteTime-D,D=k.absoluteTime,delete k.absoluteTime}),O.push({deltaTime:0,meta:!0,type:"endOfTrack"}),O}),new Uint8Array(In.writeMidi(w))}e.encode=b}),Ke=X(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},e.controlChangeIds=Object.keys(e.controlChangeNames).reduce(function(u,r){return u[e.controlChangeNames[r]]=r,u},{});var o=new WeakMap,n=new WeakMap,s=function(){function u(r,i){o.set(this,i),n.set(this,r.controllerType),this.ticks=r.absoluteTime,this.value=r.value}return Object.defineProperty(u.prototype,"number",{get:function(){return n.get(this)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"name",{get:function(){return e.controlChangeNames[this.number]?e.controlChangeNames[this.number]:null},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"time",{get:function(){var r=o.get(this);return r.ticksToSeconds(this.ticks)},set:function(r){var i=o.get(this);this.ticks=i.secondsToTicks(r)},enumerable:!0,configurable:!0}),u.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},u}();e.ControlChange=s}),xs=X(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});function o(){return new Proxy({},{get:function(n,s){if(n[s])return n[s];if(Ke.controlChangeIds.hasOwnProperty(s))return n[Ke.controlChangeIds[s]]},set:function(n,s,u){return Ke.controlChangeIds.hasOwnProperty(s)?n[Ke.controlChangeIds[s]]=u:n[s]=u,!0}})}e.createControlChanges=o}),js=X(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var o=new WeakMap,n=function(){function s(u,r){o.set(this,r),this.ticks=u.absoluteTime,this.value=u.value}return Object.defineProperty(s.prototype,"time",{get:function(){var u=o.get(this);return u.ticksToSeconds(this.ticks)},set:function(u){var r=o.get(this);this.ticks=r.secondsToTicks(u)},enumerable:!0,configurable:!0}),s.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},s}();e.PitchBend=n}),jt=X(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],e.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],e.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}}),On=X(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var o=new WeakMap,n=function(){function s(u,r){if(this.number=0,o.set(this,r),this.number=0,u){var i=u.find(function(a){return a.type==="programChange"});i&&(this.number=i.programNumber)}}return Object.defineProperty(s.prototype,"name",{get:function(){return this.percussion?jt.DrumKitByPatchID[this.number]:jt.instrumentByPatchID[this.number]},set:function(u){var r=jt.instrumentByPatchID.indexOf(u);r!==-1&&(this.number=r)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"family",{get:function(){return this.percussion?"drums":jt.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"percussion",{get:function(){var u=o.get(this);return u.channel===9},enumerable:!0,configurable:!0}),s.prototype.toJSON=function(){return{family:this.family,name:this.name,number:this.number}},s.prototype.fromJSON=function(u){this.number=u.number},s}();e.Instrument=n}),Ns=X(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});function o(a){var c=Math.floor(a/12)-1;return n(a)+c.toString()}function n(a){var c=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],f=a%12;return c[f]}function s(a){var c=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return c.indexOf(a)}var u=function(){var a=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,c={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(f){var m=a.exec(f),l=m[1],h=m[2],d=c[l.toLowerCase()];return d+(parseInt(h,10)+1)*12}}(),r=new WeakMap,i=function(){function a(c,f,m){r.set(this,m),this.midi=c.midi,this.velocity=c.velocity,this.noteOffVelocity=f.velocity,this.ticks=c.ticks,this.durationTicks=f.ticks-c.ticks}return Object.defineProperty(a.prototype,"name",{get:function(){return o(this.midi)},set:function(c){this.midi=u(c)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(c){var f=c-this.octave;this.midi+=f*12},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"pitch",{get:function(){return n(this.midi)},set:function(c){this.midi=12*(this.octave+1)+s(c)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){var c=r.get(this);return c.ticksToSeconds(this.ticks+this.durationTicks)-c.ticksToSeconds(this.ticks)},set:function(c){var f=r.get(this),m=f.secondsToTicks(this.time+c);this.durationTicks=m-this.ticks},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"time",{get:function(){var c=r.get(this);return c.ticksToSeconds(this.ticks)},set:function(c){var f=r.get(this);this.ticks=f.secondsToTicks(c)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bars",{get:function(){var c=r.get(this);return c.ticksToMeasures(this.ticks)},enumerable:!0,configurable:!0}),a.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},a}();e.Note=i}),Nt=X(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var o=new WeakMap,n=function(){function s(u,r){var i=this;if(this.name="",this.notes=[],this.controlChanges=xs.createControlChanges(),this.pitchBends=[],o.set(this,r),u){var a=u.find(function(v){return v.type==="trackName"});this.name=a?a.text:""}if(this.instrument=new On.Instrument(u,this),this.channel=0,u){for(var c=u.filter(function(v){return v.type==="noteOn"}),f=u.filter(function(v){return v.type==="noteOff"}),m=function(){var v=c.shift();l.channel=v.channel;var b=f.findIndex(function(w){return w.noteNumber===v.noteNumber&&w.absoluteTime>=v.absoluteTime});if(b!==-1){var g=f.splice(b,1)[0];l.addNote({durationTicks:g.absoluteTime-v.absoluteTime,midi:v.noteNumber,noteOffVelocity:g.velocity/127,ticks:v.absoluteTime,velocity:v.velocity/127})}},l=this;c.length;)m();var h=u.filter(function(v){return v.type==="controller"});h.forEach(function(v){i.addCC({number:v.controllerType,ticks:v.absoluteTime,value:v.value/127})});var d=u.filter(function(v){return v.type==="pitchBend"});d.forEach(function(v){i.addPitchBend({ticks:v.absoluteTime,value:v.value/Math.pow(2,13)})});var y=u.find(function(v){return v.type==="endOfTrack"});this.endOfTrackTicks=y!==void 0?y.absoluteTime:void 0}}return s.prototype.addNote=function(u){var r=o.get(this),i=new Ns.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},r);return Object.assign(i,u),xe.insert(this.notes,i,"ticks"),this},s.prototype.addCC=function(u){var r=o.get(this),i=new Ke.ControlChange({controllerType:u.number},r);return delete u.number,Object.assign(i,u),Array.isArray(this.controlChanges[i.number])||(this.controlChanges[i.number]=[]),xe.insert(this.controlChanges[i.number],i,"ticks"),this},s.prototype.addPitchBend=function(u){var r=o.get(this),i=new js.PitchBend({},r);return Object.assign(i,u),xe.insert(this.pitchBends,i,"ticks"),this},Object.defineProperty(s.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var u=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,r=0;r<this.notes.length-1;r++){var i=this.notes[r].time+this.notes[r].duration;u<i&&(u=i)}return u},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var u=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,r=0;r<this.notes.length-1;r++){var i=this.notes[r].ticks+this.notes[r].durationTicks;u<i&&(u=i)}return u},enumerable:!0,configurable:!0}),s.prototype.fromJSON=function(u){var r=this;this.name=u.name,this.channel=u.channel,this.instrument=new On.Instrument(void 0,this),this.instrument.fromJSON(u.instrument),u.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=u.endOfTrackTicks);for(var i in u.controlChanges)u.controlChanges[i]&&u.controlChanges[i].forEach(function(a){r.addCC({number:a.number,ticks:a.ticks,value:a.value})});u.notes.forEach(function(a){r.addNote({durationTicks:a.durationTicks,midi:a.midi,ticks:a.ticks,velocity:a.velocity})})},s.prototype.toJSON=function(){for(var u={},r=0;r<127;r++)this.controlChanges.hasOwnProperty(r)&&(u[r]=this.controlChanges[r].map(function(a){return a.toJSON()}));var i={channel:this.channel,controlChanges:u,pitchBends:this.pitchBends.map(function(a){return a.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(a){return a.toJSON()})};return this.endOfTrackTicks!==void 0&&(i.endOfTrackTicks=this.endOfTrackTicks),i},s}();e.Track=n}),ks=X(function(t,e){var o=ce&&ce.__awaiter||function(a,c,f,m){function l(h){return h instanceof f?h:new f(function(d){d(h)})}return new(f||(f=Promise))(function(h,d){function y(g){try{b(m.next(g))}catch(w){d(w)}}function v(g){try{b(m.throw(g))}catch(w){d(w)}}function b(g){g.done?h(g.value):l(g.value).then(y,v)}b((m=m.apply(a,c||[])).next())})},n=ce&&ce.__generator||function(a,c){var f={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},m,l,h,d;return d={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function y(b){return function(g){return v([b,g])}}function v(b){if(m)throw new TypeError("Generator is already executing.");for(;f;)try{if(m=1,l&&(h=b[0]&2?l.return:b[0]?l.throw||((h=l.return)&&h.call(l),0):l.next)&&!(h=h.call(l,b[1])).done)return h;switch(l=0,h&&(b=[b[0]&2,h.value]),b[0]){case 0:case 1:h=b;break;case 4:return f.label++,{value:b[1],done:!1};case 5:f.label++,l=b[1],b=[0];continue;case 7:b=f.ops.pop(),f.trys.pop();continue;default:if(h=f.trys,!(h=h.length>0&&h[h.length-1])&&(b[0]===6||b[0]===2)){f=0;continue}if(b[0]===3&&(!h||b[1]>h[0]&&b[1]<h[3])){f.label=b[1];break}if(b[0]===6&&f.label<h[1]){f.label=h[1],h=b;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(b);break}h[2]&&f.ops.pop(),f.trys.pop();continue}b=c.call(a,f)}catch(g){b=[6,g],l=0}finally{m=h=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}};Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function a(c){var f=this,m=null;c&&(c instanceof ArrayBuffer&&(c=new Uint8Array(c)),m=In.parseMidi(c),m.tracks.forEach(function(l){var h=0;l.forEach(function(d){h+=d.deltaTime,d.absoluteTime=h})}),m.tracks=i(m.tracks)),this.header=new Pt.Header(m),this.tracks=[],c&&(this.tracks=m.tracks.map(function(l){return new Nt.Track(l,f.header)}),m.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return a.fromUrl=function(c){return o(this,void 0,void 0,function(){var f,m;return n(this,function(l){switch(l.label){case 0:return[4,fetch(c)];case 1:return f=l.sent(),f.ok?[4,f.arrayBuffer()]:[3,3];case 2:return m=l.sent(),[2,new a(m)];case 3:throw new Error("could not load "+c)}})})},Object.defineProperty(a.prototype,"name",{get:function(){return this.header.name},set:function(c){this.header.name=c},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){var c=this.tracks.map(function(f){return f.duration});return Math.max.apply(Math,c)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"durationTicks",{get:function(){var c=this.tracks.map(function(f){return f.durationTicks});return Math.max.apply(Math,c)},enumerable:!0,configurable:!0}),a.prototype.addTrack=function(){var c=new Nt.Track(void 0,this.header);return this.tracks.push(c),c},a.prototype.toArray=function(){return Ps.encode(this)},a.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(c){return c.toJSON()})}},a.prototype.fromJSON=function(c){var f=this;this.header=new Pt.Header,this.header.fromJSON(c.header),this.tracks=c.tracks.map(function(m){var l=new Nt.Track(void 0,f.header);return l.fromJSON(m),l})},a.prototype.clone=function(){var c=new a;return c.fromJSON(this.toJSON()),c},a}();e.Midi=s;var u=Nt;e.Track=u.Track;var r=Pt;e.Header=r.Header;function i(a){for(var c=[],f=0;f<a.length;f++)for(var m=c.length,l=new Map,h=Array(16).fill(0),d=0,y=a[f];d<y.length;d++){var v=y[d],b=m,g=v.channel;if(g!==void 0){v.type==="programChange"&&(h[g]=v.programNumber);var w=h[g],O=w+" "+g;l.has(O)?b=l.get(O):(b=m+l.size,l.set(O,b))}c[b]||c.push([]),c[b].push(v)}return c}}),An=ks.Midi;var Rs=X(function(t,e){(function(n,s){t.exports=s()})(window,function(){return function(o){var n={};function s(u){if(n[u])return n[u].exports;var r=n[u]={i:u,l:!1,exports:{}};return o[u].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=o,s.c=n,s.d=function(u,r,i){s.o(u,r)||Object.defineProperty(u,r,{enumerable:!0,get:i})},s.r=function(u){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},s.t=function(u,r){if(r&1&&(u=s(u)),r&8||r&4&&typeof u=="object"&&u&&u.__esModule)return u;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:u}),r&2&&typeof u!="string")for(var a in u)s.d(i,a,function(c){return u[c]}.bind(null,a));return i},s.n=function(u){var r=u&&u.__esModule?function(){return u.default}:function(){return u};return s.d(r,"a",r),r},s.o=function(u,r){return Object.prototype.hasOwnProperty.call(u,r)},s.p="",s(s.s="./src/index.js")}({"./node_modules/assert/assert.js":function(o,n,s){(function(u){var r=s("./node_modules/object-assign/index.js");function i(E,p){if(E===p)return 0;for(var I=E.length,_=p.length,A=0,B=Math.min(I,_);A<B;++A)if(E[A]!==p[A]){I=E[A],_=p[A];break}return I<_?-1:_<I?1:0}function a(E){return u.Buffer&&typeof u.Buffer.isBuffer=="function"?u.Buffer.isBuffer(E):!!(E!=null&&E._isBuffer)}var c=s("./node_modules/node-libs-browser/node_modules/util/util.js"),f=Object.prototype.hasOwnProperty,m=Array.prototype.slice,l=function(){return function(){}.name==="foo"}();function h(E){return Object.prototype.toString.call(E)}function d(E){return a(E)||typeof u.ArrayBuffer!="function"?!1:typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(E):E?!!(E instanceof DataView||E.buffer&&E.buffer instanceof ArrayBuffer):!1}var y=o.exports=k,v=/\s*function\s+([^\(\s]*)\s*/;function b(E){if(!!c.isFunction(E)){if(l)return E.name;var p=E.toString(),I=p.match(v);return I&&I[1]}}y.AssertionError=function(p){this.name="AssertionError",this.actual=p.actual,this.expected=p.expected,this.operator=p.operator,p.message?(this.message=p.message,this.generatedMessage=!1):(this.message=O(this),this.generatedMessage=!0);var I=p.stackStartFunction||D;if(Error.captureStackTrace)Error.captureStackTrace(this,I);else{var _=new Error;if(_.stack){var A=_.stack,B=b(I),L=A.indexOf(`
`+B);if(L>=0){var z=A.indexOf(`
`,L+1);A=A.substring(z+1)}this.stack=A}}},c.inherits(y.AssertionError,Error);function g(E,p){return typeof E=="string"?E.length<p?E:E.slice(0,p):E}function w(E){if(l||!c.isFunction(E))return c.inspect(E);var p=b(E),I=p?": "+p:"";return"[Function"+I+"]"}function O(E){return g(w(E.actual),128)+" "+E.operator+" "+g(w(E.expected),128)}function D(E,p,I,_,A){throw new y.AssertionError({message:I,actual:E,expected:p,operator:_,stackStartFunction:A})}y.fail=D;function k(E,p){E||D(E,!0,p,"==",y.ok)}y.ok=k,y.equal=function(p,I,_){p!=I&&D(p,I,_,"==",y.equal)},y.notEqual=function(p,I,_){p==I&&D(p,I,_,"!=",y.notEqual)},y.deepEqual=function(p,I,_){H(p,I,!1)||D(p,I,_,"deepEqual",y.deepEqual)},y.deepStrictEqual=function(p,I,_){H(p,I,!0)||D(p,I,_,"deepStrictEqual",y.deepStrictEqual)};function H(E,p,I,_){if(E===p)return!0;if(a(E)&&a(p))return i(E,p)===0;if(c.isDate(E)&&c.isDate(p))return E.getTime()===p.getTime();if(c.isRegExp(E)&&c.isRegExp(p))return E.source===p.source&&E.global===p.global&&E.multiline===p.multiline&&E.lastIndex===p.lastIndex&&E.ignoreCase===p.ignoreCase;if((E===null||typeof E!="object")&&(p===null||typeof p!="object"))return I?E===p:E==p;if(d(E)&&d(p)&&h(E)===h(p)&&!(E instanceof Float32Array||E instanceof Float64Array))return i(new Uint8Array(E.buffer),new Uint8Array(p.buffer))===0;if(a(E)!==a(p))return!1;_=_||{actual:[],expected:[]};var A=_.actual.indexOf(E);return A!==-1&&A===_.expected.indexOf(p)?!0:(_.actual.push(E),_.expected.push(p),U(E,p,I,_))}function W(E){return Object.prototype.toString.call(E)=="[object Arguments]"}function U(E,p,I,_){if(E==null||p===null||p===void 0)return!1;if(c.isPrimitive(E)||c.isPrimitive(p))return E===p;if(I&&Object.getPrototypeOf(E)!==Object.getPrototypeOf(p))return!1;var A=W(E),B=W(p);if(A&&!B||!A&&B)return!1;if(A)return E=m.call(E),p=m.call(p),H(E,p,I);var L=me(E),z=me(p),he,K;if(L.length!==z.length)return!1;for(L.sort(),z.sort(),K=L.length-1;K>=0;K--)if(L[K]!==z[K])return!1;for(K=L.length-1;K>=0;K--)if(he=L[K],!H(E[he],p[he],I,_))return!1;return!0}y.notDeepEqual=function(p,I,_){H(p,I,!1)&&D(p,I,_,"notDeepEqual",y.notDeepEqual)},y.notDeepStrictEqual=V;function V(E,p,I){H(E,p,!0)&&D(E,p,I,"notDeepStrictEqual",V)}y.strictEqual=function(p,I,_){p!==I&&D(p,I,_,"===",y.strictEqual)},y.notStrictEqual=function(p,I,_){p===I&&D(p,I,_,"!==",y.notStrictEqual)};function Y(E,p){if(!E||!p)return!1;if(Object.prototype.toString.call(p)=="[object RegExp]")return p.test(E);try{if(E instanceof p)return!0}catch(I){}return Error.isPrototypeOf(p)?!1:p.call({},E)===!0}function se(E){var p;try{E()}catch(I){p=I}return p}function re(E,p,I,_){var A;if(typeof p!="function")throw new TypeError('"block" argument must be a function');typeof I=="string"&&(_=I,I=null),A=se(p),_=(I&&I.name?" ("+I.name+").":".")+(_?" "+_:"."),E&&!A&&D(A,I,"Missing expected exception"+_);var B=typeof _=="string",L=!E&&c.isError(A),z=!E&&A&&!I;if((L&&B&&Y(A,I)||z)&&D(A,I,"Got unwanted exception"+_),E&&A&&I&&!Y(A,I)||!E&&A)throw A}y.throws=function(E,p,I){re(!0,E,p,I)},y.doesNotThrow=function(E,p,I){re(!1,E,p,I)},y.ifError=function(E){if(E)throw E};function le(E,p){E||D(E,!0,p,"==",le)}y.strict=r(le,y,{equal:y.strictEqual,deepEqual:y.deepStrictEqual,notEqual:y.notStrictEqual,notDeepEqual:y.notDeepStrictEqual}),y.strict.strict=y.strict;var me=Object.keys||function(E){var p=[];for(var I in E)f.call(E,I)&&p.push(I);return p}}).call(this,s("./node_modules/webpack-stream/node_modules/webpack/buildin/global.js"))},"./node_modules/dct/index.js":function(o,n,s){o.exports=s("./node_modules/dct/src/dct.js")},"./node_modules/dct/src/dct.js":function(o,n){var s=null,u=function(i){s=s||{},s[i]=new Array(i*i);for(var a=Math.PI/i,c=0;c<i;c++)for(var f=0;f<i;f++)s[i][f+c*i]=Math.cos(a*(f+.5)*c)};function r(i,a){var c=i.length;a=a||2,(!s||!s[c])&&u(c);var f=i.map(function(){return 0});return f.map(function(m,l){return a*i.reduce(function(h,d,y,v){return h+d*s[c][y+l*c]},0)})}o.exports=r},"./node_modules/fftjs/dist/fft.js":function(o,n,s){var u=s("./node_modules/fftjs/dist/utils.js"),r=function(c){var f={};c.real===void 0||c.imag===void 0?f=u.constructComplexArray(c):(f.real=c.real.slice(),f.imag=c.imag.slice());var m=f.real.length,l=Math.log2(m);if(Math.round(l)!=l)throw new Error("Input size must be a power of 2.");if(f.real.length!=f.imag.length)throw new Error("Real and imaginary components must have the same length.");for(var h=u.bitReverseArray(m),d={real:[],imag:[]},y=0;y<m;y++)d.real[h[y]]=f.real[y],d.imag[h[y]]=f.imag[y];for(var v=0;v<m;v++)f.real[v]=d.real[v],f.imag[v]=d.imag[v];for(var b=1;b<=l;b++)for(var g=Math.pow(2,b),w=0;w<g/2;w++)for(var O=u.euler(w,g),D=0;D<m/g;D++){var k=g*D+w,H=g*D+w+g/2,W={real:f.real[k],imag:f.imag[k]},U={real:f.real[H],imag:f.imag[H]},V=u.multiply(O,U),Y=u.subtract(W,V);f.real[H]=Y.real,f.imag[H]=Y.imag;var se=u.add(V,W);f.real[k]=se.real,f.imag[k]=se.imag}return f},i=function(c){if(c.real===void 0||c.imag===void 0)throw new Error("IFFT only accepts a complex input.");for(var f=c.real.length,m={real:[],imag:[]},l=0;l<f;l++){var h={real:c.real[l],imag:c.imag[l]},d=u.conj(h);m.real[l]=d.real,m.imag[l]=d.imag}var y=r(m);return m.real=y.real.map(function(v){return v/f}),m.imag=y.imag.map(function(v){return v/f}),m};o.exports={fft:r,ifft:i}},"./node_modules/fftjs/dist/utils.js":function(o,n,s){function u(y){if(Array.isArray(y)){for(var v=0,b=Array(y.length);v<y.length;v++)b[v]=y[v];return b}else return Array.from(y)}var r={},i={},a=function(v){var b={};b.real=v.real===void 0?v.slice():v.real.slice();var g=b.real.length;return i[g]===void 0&&(i[g]=Array.apply(null,Array(g)).map(Number.prototype.valueOf,0)),b.imag=i[g].slice(),b},c=function(v){if(r[v]===void 0){for(var b=(v-1).toString(2).length,g="0".repeat(b),w={},O=0;O<v;O++){var D=O.toString(2);D=g.substr(D.length)+D,D=[].concat(u(D)).reverse().join(""),w[O]=parseInt(D,2)}r[v]=w}return r[v]},f=function(v,b){return{real:v.real*b.real-v.imag*b.imag,imag:v.real*b.imag+v.imag*b.real}},m=function(v,b){return{real:v.real+b.real,imag:v.imag+b.imag}},l=function(v,b){return{real:v.real-b.real,imag:v.imag-b.imag}},h=function(v,b){var g=-2*Math.PI*v/b;return{real:Math.cos(g),imag:Math.sin(g)}},d=function(v){return v.imag*=-1,v};o.exports={bitReverseArray:c,multiply:f,add:m,subtract:l,euler:h,conj:d,constructComplexArray:a}},"./node_modules/node-libs-browser/node_modules/util/node_modules/inherits/inherits_browser.js":function(o,n){typeof Object.create=="function"?o.exports=function(u,r){u.super_=r,u.prototype=Object.create(r.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}})}:o.exports=function(u,r){u.super_=r;var i=function(){};i.prototype=r.prototype,u.prototype=new i,u.prototype.constructor=u}},"./node_modules/node-libs-browser/node_modules/util/support/isBufferBrowser.js":function(o,n){o.exports=function(u){return u&&typeof u=="object"&&typeof u.copy=="function"&&typeof u.fill=="function"&&typeof u.readUInt8=="function"}},"./node_modules/node-libs-browser/node_modules/util/util.js":function(o,n,s){(function(u){var r=Object.getOwnPropertyDescriptors||function(M){for(var T=Object.keys(M),P={},R=0;R<T.length;R++)P[T[R]]=Object.getOwnPropertyDescriptor(M,T[R]);return P},i=/%[sdj%]/g;n.format=function(S){if(!U(S)){for(var M=[],T=0;T<arguments.length;T++)M.push(f(arguments[T]));return M.join(" ")}for(var T=1,P=arguments,R=P.length,C=String(S).replace(i,function(N){if(N==="%%")return"%";if(T>=R)return N;switch(N){case"%s":return String(P[T++]);case"%d":return Number(P[T++]);case"%j":try{return JSON.stringify(P[T++])}catch(G){return"[Circular]"}default:return N}}),j=P[T];T<R;j=P[++T])k(j)||!re(j)?C+=" "+j:C+=" "+f(j);return C},n.deprecate=function(S,M){if(typeof u!="undefined"&&u.noDeprecation===!0)return S;if(typeof u=="undefined")return function(){return n.deprecate(S,M).apply(this,arguments)};var T=!1;function P(){if(!T){if(u.throwDeprecation)throw new Error(M);u.traceDeprecation?console.trace(M):console.error(M),T=!0}return S.apply(this,arguments)}return P};var a={},c;n.debuglog=function(S){if(Y(c)&&(c=u.env.NODE_DEBUG||""),S=S.toUpperCase(),!a[S])if(new RegExp("\\b"+S+"\\b","i").test(c)){var M=u.pid;a[S]=function(){var T=n.format.apply(n,arguments);console.error("%s %d: %s",S,M,T)}}else a[S]=function(){};return a[S]};function f(S,M){var T={seen:[],stylize:l};return arguments.length>=3&&(T.depth=arguments[2]),arguments.length>=4&&(T.colors=arguments[3]),D(M)?T.showHidden=M:M&&n._extend(T,M),Y(T.showHidden)&&(T.showHidden=!1),Y(T.depth)&&(T.depth=2),Y(T.colors)&&(T.colors=!1),Y(T.customInspect)&&(T.customInspect=!0),T.colors&&(T.stylize=m),d(T,S,T.depth)}n.inspect=f,f.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},f.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function m(S,M){var T=f.styles[M];return T?"["+f.colors[T][0]+"m"+S+"["+f.colors[T][1]+"m":S}function l(S,M){return S}function h(S){var M={};return S.forEach(function(T,P){M[T]=!0}),M}function d(S,M,T){if(S.customInspect&&M&&E(M.inspect)&&M.inspect!==n.inspect&&!(M.constructor&&M.constructor.prototype===M)){var P=M.inspect(T,S);return U(P)||(P=d(S,P,T)),P}var R=y(S,M);if(R)return R;var C=Object.keys(M),j=h(C);if(S.showHidden&&(C=Object.getOwnPropertyNames(M)),me(M)&&(C.indexOf("message")>=0||C.indexOf("description")>=0))return v(M);if(C.length===0){if(E(M)){var N=M.name?": "+M.name:"";return S.stylize("[Function"+N+"]","special")}if(se(M))return S.stylize(RegExp.prototype.toString.call(M),"regexp");if(le(M))return S.stylize(Date.prototype.toString.call(M),"date");if(me(M))return v(M)}var G="",ne=!1,$e=["{","}"];if(O(M)&&(ne=!0,$e=["[","]"]),E(M)){var Bn=M.name?": "+M.name:"";G=" [Function"+Bn+"]"}if(se(M)&&(G=" "+RegExp.prototype.toString.call(M)),le(M)&&(G=" "+Date.prototype.toUTCString.call(M)),me(M)&&(G=" "+v(M)),C.length===0&&(!ne||M.length==0))return $e[0]+G+$e[1];if(T<0)return se(M)?S.stylize(RegExp.prototype.toString.call(M),"regexp"):S.stylize("[Object]","special");S.seen.push(M);var Ft;return ne?Ft=b(S,M,T,j,C):Ft=C.map(function(Gn){return g(S,M,T,j,Gn,ne)}),S.seen.pop(),w(Ft,G,$e)}function y(S,M){if(Y(M))return S.stylize("undefined","undefined");if(U(M)){var T="'"+JSON.stringify(M).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return S.stylize(T,"string")}if(W(M))return S.stylize(""+M,"number");if(D(M))return S.stylize(""+M,"boolean");if(k(M))return S.stylize("null","null")}function v(S){return"["+Error.prototype.toString.call(S)+"]"}function b(S,M,T,P,R){for(var C=[],j=0,N=M.length;j<N;++j)L(M,String(j))?C.push(g(S,M,T,P,String(j),!0)):C.push("");return R.forEach(function(G){G.match(/^\d+$/)||C.push(g(S,M,T,P,G,!0))}),C}function g(S,M,T,P,R,C){var j,N,G;if(G=Object.getOwnPropertyDescriptor(M,R)||{value:M[R]},G.get?G.set?N=S.stylize("[Getter/Setter]","special"):N=S.stylize("[Getter]","special"):G.set&&(N=S.stylize("[Setter]","special")),L(P,R)||(j="["+R+"]"),N||(S.seen.indexOf(G.value)<0?(k(T)?N=d(S,G.value,null):N=d(S,G.value,T-1),N.indexOf(`
`)>-1&&(C?N=N.split(`
`).map(function(ne){return"  "+ne}).join(`
`).substr(2):N=`
`+N.split(`
`).map(function(ne){return"   "+ne}).join(`
`))):N=S.stylize("[Circular]","special")),Y(j)){if(C&&R.match(/^\d+$/))return N;j=JSON.stringify(""+R),j.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(j=j.substr(1,j.length-2),j=S.stylize(j,"name")):(j=j.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),j=S.stylize(j,"string"))}return j+": "+N}function w(S,M,T){var P=S.reduce(function(R,C){return C.indexOf(`
`)>=0,R+C.replace(/\u001b\[\d\d?m/g,"").length+1},0);return P>60?T[0]+(M===""?"":M+`
 `)+" "+S.join(`,
  `)+" "+T[1]:T[0]+M+" "+S.join(", ")+" "+T[1]}function O(S){return Array.isArray(S)}n.isArray=O;function D(S){return typeof S=="boolean"}n.isBoolean=D;function k(S){return S===null}n.isNull=k;function H(S){return S==null}n.isNullOrUndefined=H;function W(S){return typeof S=="number"}n.isNumber=W;function U(S){return typeof S=="string"}n.isString=U;function V(S){return typeof S=="symbol"}n.isSymbol=V;function Y(S){return S===void 0}n.isUndefined=Y;function se(S){return re(S)&&I(S)==="[object RegExp]"}n.isRegExp=se;function re(S){return typeof S=="object"&&S!==null}n.isObject=re;function le(S){return re(S)&&I(S)==="[object Date]"}n.isDate=le;function me(S){return re(S)&&(I(S)==="[object Error]"||S instanceof Error)}n.isError=me;function E(S){return typeof S=="function"}n.isFunction=E;function p(S){return S===null||typeof S=="boolean"||typeof S=="number"||typeof S=="string"||typeof S=="symbol"||typeof S=="undefined"}n.isPrimitive=p,n.isBuffer=s("./node_modules/node-libs-browser/node_modules/util/support/isBufferBrowser.js");function I(S){return Object.prototype.toString.call(S)}function _(S){return S<10?"0"+S.toString(10):S.toString(10)}var A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function B(){var S=new Date,M=[_(S.getHours()),_(S.getMinutes()),_(S.getSeconds())].join(":");return[S.getDate(),A[S.getMonth()],M].join(" ")}n.log=function(){console.log("%s - %s",B(),n.format.apply(n,arguments))},n.inherits=s("./node_modules/node-libs-browser/node_modules/util/node_modules/inherits/inherits_browser.js"),n._extend=function(S,M){if(!M||!re(M))return S;for(var T=Object.keys(M),P=T.length;P--;)S[T[P]]=M[T[P]];return S};function L(S,M){return Object.prototype.hasOwnProperty.call(S,M)}var z=typeof Symbol!="undefined"?Symbol("util.promisify.custom"):void 0;n.promisify=function(M){if(typeof M!="function")throw new TypeError('The "original" argument must be of type Function');if(z&&M[z]){var T=M[z];if(typeof T!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(T,z,{value:T,enumerable:!1,writable:!1,configurable:!0}),T}function T(){for(var P,R,C=new Promise(function(G,ne){P=G,R=ne}),j=[],N=0;N<arguments.length;N++)j.push(arguments[N]);j.push(function(G,ne){G?R(G):P(ne)});try{M.apply(this,j)}catch(G){R(G)}return C}return Object.setPrototypeOf(T,Object.getPrototypeOf(M)),z&&Object.defineProperty(T,z,{value:T,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(T,r(M))},n.promisify.custom=z;function he(S,M){if(!S){var T=new Error("Promise was rejected with a falsy value");T.reason=S,S=T}return M(S)}function K(S){if(typeof S!="function")throw new TypeError('The "original" argument must be of type Function');function M(){for(var T=[],P=0;P<arguments.length;P++)T.push(arguments[P]);var R=T.pop();if(typeof R!="function")throw new TypeError("The last argument must be of type Function");var C=this,j=function(){return R.apply(C,arguments)};S.apply(this,T).then(function(N){u.nextTick(j,null,N)},function(N){u.nextTick(he,N,j)})}return Object.setPrototypeOf(M,Object.getPrototypeOf(S)),Object.defineProperties(M,r(S)),M}n.callbackify=K}).call(this,s("./node_modules/process/browser.js"))},"./node_modules/object-assign/index.js":function(o,n,s){var u=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function a(f){if(f==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(f)}function c(){try{if(!Object.assign)return!1;var f=new String("abc");if(f[5]="de",Object.getOwnPropertyNames(f)[0]==="5")return!1;for(var m={},l=0;l<10;l++)m["_"+String.fromCharCode(l)]=l;var h=Object.getOwnPropertyNames(m).map(function(y){return m[y]});if(h.join("")!=="0123456789")return!1;var d={};return"abcdefghijklmnopqrst".split("").forEach(function(y){d[y]=y}),Object.keys(Object.assign({},d)).join("")==="abcdefghijklmnopqrst"}catch(y){return!1}}o.exports=c()?Object.assign:function(f,m){for(var l,h=a(f),d,y=1;y<arguments.length;y++){l=Object(arguments[y]);for(var v in l)r.call(l,v)&&(h[v]=l[v]);if(u){d=u(l);for(var b=0;b<d.length;b++)i.call(l,d[b])&&(h[d[b]]=l[d[b]])}}return h}},"./node_modules/process/browser.js":function(o,n){var s=o.exports={},u,r;function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?u=setTimeout:u=i}catch(w){u=i}try{typeof clearTimeout=="function"?r=clearTimeout:r=a}catch(w){r=a}})();function c(w){if(u===setTimeout)return setTimeout(w,0);if((u===i||!u)&&setTimeout)return u=setTimeout,setTimeout(w,0);try{return u(w,0)}catch(O){try{return u.call(null,w,0)}catch(D){return u.call(this,w,0)}}}function f(w){if(r===clearTimeout)return clearTimeout(w);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(w);try{return r(w)}catch(O){try{return r.call(null,w)}catch(D){return r.call(this,w)}}}var m=[],l=!1,h,d=-1;function y(){!l||!h||(l=!1,h.length?m=h.concat(m):d=-1,m.length&&v())}function v(){if(!l){var w=c(y);l=!0;for(var O=m.length;O;){for(h=m,m=[];++d<O;)h&&h[d].run();d=-1,O=m.length}h=null,l=!1,f(w)}}s.nextTick=function(w){var O=new Array(arguments.length-1);if(arguments.length>1)for(var D=1;D<arguments.length;D++)O[D-1]=arguments[D];m.push(new b(w,O)),m.length===1&&!l&&c(v)};function b(w,O){this.fun=w,this.array=O}b.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={};function g(){}s.on=g,s.addListener=g,s.once=g,s.off=g,s.removeListener=g,s.removeAllListeners=g,s.emit=g,s.prependListener=g,s.prependOnceListener=g,s.listeners=function(w){return[]},s.binding=function(w){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(w){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},"./node_modules/webpack-stream/node_modules/webpack/buildin/global.js":function(o,n){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch(u){typeof window=="object"&&(s=window)}o.exports=s},"./src/extractors/chroma.js":function(o,n,s){s.r(n);function u(l){return c(l)||a(l)||i(l)||r()}function r(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function i(l,h){if(!!l){if(typeof l=="string")return f(l,h);var d=Object.prototype.toString.call(l).slice(8,-1);if(d==="Object"&&l.constructor&&(d=l.constructor.name),d==="Map"||d==="Set")return Array.from(l);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return f(l,h)}}function a(l){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(l))return Array.from(l)}function c(l){if(Array.isArray(l))return f(l)}function f(l,h){(h==null||h>l.length)&&(h=l.length);for(var d=0,y=new Array(h);d<h;d++)y[d]=l[d];return y}function m(l){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?m=function(d){return typeof d}:m=function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},m(l)}n.default=function(l){if(m(l.ampSpectrum)!=="object")throw new TypeError("Valid ampSpectrum is required to generate chroma");if(m(l.chromaFilterBank)!=="object")throw new TypeError("Valid chromaFilterBank is required to generate chroma");var h=l.chromaFilterBank.map(function(y,v){return l.ampSpectrum.reduce(function(b,g,w){return b+g*y[w]},0)}),d=Math.max.apply(Math,u(h));return d?h.map(function(y){return y/d}):h}},"./src/extractors/energy.js":function(o,n,s){s.r(n);var u=s("./node_modules/assert/assert.js");function r(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?r=function(c){return typeof c}:r=function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},r(i)}n.default=function(){if(r(arguments[0].signal)!=="object")throw new TypeError;for(var i=0,a=0;a<arguments[0].signal.length;a++)i+=Math.pow(Math.abs(arguments[0].signal[a]),2);return i}},"./src/extractors/extractorUtilities.js":function(o,n,s){s.r(n),s.d(n,"mu",function(){return u});function u(r,i){for(var a=0,c=0,f=0;f<i.length;f++)a+=Math.pow(f,r)*Math.abs(i[f]),c+=i[f];return a/c}},"./src/extractors/loudness.js":function(o,n,s){s.r(n);function u(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?u=function(a){return typeof a}:u=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},u(r)}n.default=function(r){if(u(r.ampSpectrum)!=="object"||u(r.barkScale)!=="object")throw new TypeError;var i=24,a=new Float32Array(i),c=0,f=r.ampSpectrum,m=new Int32Array(i+1);m[0]=0;for(var l=r.barkScale[f.length-1]/i,h=1,d=0;d<f.length;d++)for(;r.barkScale[d]>l;)m[h++]=d,l=h*r.barkScale[f.length-1]/i;m[i]=f.length-1;for(var y=0;y<i;y++){for(var v=0,b=m[y];b<m[y+1];b++)v+=f[b];a[y]=Math.pow(v,.23)}for(var g=0;g<a.length;g++)c+=a[g];return{specific:a,total:c}}},"./src/extractors/mfcc.js":function(o,n,s){s.r(n);var u=s("./src/extractors/powerSpectrum.js"),r=s("./src/utilities.js");function i(c){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?i=function(m){return typeof m}:i=function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},i(c)}var a=s("./node_modules/dct/index.js");n.default=function(c){if(i(c.ampSpectrum)!=="object")throw new TypeError("Valid ampSpectrum is required to generate MFCC");if(i(c.melFilterBank)!=="object")throw new TypeError("Valid melFilterBank is required to generate MFCC");var f=Math.min(40,Math.max(1,c.numberOfMFCCCoefficients||13)),m=Object(u.default)(c),l=c.melFilterBank.length,h=Array(l);if(l<f)throw new Error("Insufficient filter bank for requested number of coefficients");for(var d=new Float32Array(l),y=0;y<d.length;y++){h[y]=new Float32Array(c.bufferSize/2),d[y]=0;for(var v=0;v<c.bufferSize/2;v++)h[y][v]=c.melFilterBank[y][v]*m[v],d[y]+=h[y][v];d[y]=Math.log(d[y]+1)}var b=Array.prototype.slice.call(d),g=a(b).slice(0,f);return g}},"./src/extractors/perceptualSharpness.js":function(o,n,s){s.r(n);var u=s("./src/extractors/loudness.js");function r(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?r=function(c){return typeof c}:r=function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},r(i)}n.default=function(){if(r(arguments[0].signal)!=="object")throw new TypeError;for(var i=Object(u.default)(arguments[0]),a=i.specific,c=0,f=0;f<a.length;f++)f<15?c+=(f+1)*a[f+1]:c+=.066*Math.exp(.171*(f+1));return c*=.11/i.total,c}},"./src/extractors/perceptualSpread.js":function(o,n,s){s.r(n);var u=s("./src/extractors/loudness.js");function r(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?r=function(c){return typeof c}:r=function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},r(i)}n.default=function(){if(r(arguments[0].signal)!=="object")throw new TypeError;for(var i=Object(u.default)(arguments[0]),a=0,c=0;c<i.specific.length;c++)i.specific[c]>a&&(a=i.specific[c]);var f=Math.pow((i.total-a)/i.total,2);return f}},"./src/extractors/powerSpectrum.js":function(o,n,s){s.r(n);function u(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?u=function(a){return typeof a}:u=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},u(r)}n.default=function(){if(u(arguments[0].ampSpectrum)!=="object")throw new TypeError;for(var r=new Float32Array(arguments[0].ampSpectrum.length),i=0;i<r.length;i++)r[i]=Math.pow(arguments[0].ampSpectrum[i],2);return r}},"./src/extractors/rms.js":function(o,n,s){s.r(n);function u(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?u=function(a){return typeof a}:u=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},u(r)}n.default=function(r){if(u(r.signal)!=="object")throw new TypeError;for(var i=0,a=0;a<r.signal.length;a++)i+=Math.pow(r.signal[a],2);return i=i/r.signal.length,i=Math.sqrt(i),i}},"./src/extractors/spectralCentroid.js":function(o,n,s){s.r(n);var u=s("./src/extractors/extractorUtilities.js");function r(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?r=function(c){return typeof c}:r=function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},r(i)}n.default=function(){if(r(arguments[0].ampSpectrum)!=="object")throw new TypeError;return Object(u.mu)(1,arguments[0].ampSpectrum)}},"./src/extractors/spectralFlatness.js":function(o,n,s){s.r(n);function u(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?u=function(a){return typeof a}:u=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},u(r)}n.default=function(){if(u(arguments[0].ampSpectrum)!=="object")throw new TypeError;for(var r=0,i=0,a=0;a<arguments[0].ampSpectrum.length;a++)r+=Math.log(arguments[0].ampSpectrum[a]),i+=arguments[0].ampSpectrum[a];return Math.exp(r/arguments[0].ampSpectrum.length)*arguments[0].ampSpectrum.length/i}},"./src/extractors/spectralFlux.js":function(o,n,s){s.r(n);function u(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?u=function(a){return typeof a}:u=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},u(r)}n.default=function(r){if(u(r.signal)!=="object"||u(r.previousSignal)!="object")throw new TypeError;for(var i=0,a=-(r.bufferSize/2);a<signal.length/2-1;a++)x=Math.abs(r.signal[a])-Math.abs(r.previousSignal[a]),i+=(x+Math.abs(x))/2;return i}},"./src/extractors/spectralKurtosis.js":function(o,n,s){s.r(n);var u=s("./src/extractors/extractorUtilities.js");function r(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?r=function(c){return typeof c}:r=function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},r(i)}n.default=function(){if(r(arguments[0].ampSpectrum)!=="object")throw new TypeError;var i=arguments[0].ampSpectrum,a=Object(u.mu)(1,i),c=Object(u.mu)(2,i),f=Object(u.mu)(3,i),m=Object(u.mu)(4,i),l=-3*Math.pow(a,4)+6*a*c-4*a*f+m,h=Math.pow(Math.sqrt(c-Math.pow(a,2)),4);return l/h}},"./src/extractors/spectralRolloff.js":function(o,n,s){s.r(n);function u(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?u=function(a){return typeof a}:u=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},u(r)}n.default=function(){if(u(arguments[0].ampSpectrum)!=="object")throw new TypeError;for(var r=arguments[0].ampSpectrum,i=arguments[0].sampleRate/(2*(r.length-1)),a=0,c=0;c<r.length;c++)a+=r[c];for(var f=.99*a,m=r.length-1;a>f&&m>=0;)a-=r[m],--m;return(m+1)*i}},"./src/extractors/spectralSkewness.js":function(o,n,s){s.r(n);var u=s("./src/extractors/extractorUtilities.js");function r(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?r=function(c){return typeof c}:r=function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},r(i)}n.default=function(i){if(r(i.ampSpectrum)!=="object")throw new TypeError;var a=Object(u.mu)(1,i.ampSpectrum),c=Object(u.mu)(2,i.ampSpectrum),f=Object(u.mu)(3,i.ampSpectrum),m=2*Math.pow(a,3)-3*a*c+f,l=Math.pow(Math.sqrt(c-Math.pow(a,2)),3);return m/l}},"./src/extractors/spectralSlope.js":function(o,n,s){s.r(n);function u(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?u=function(a){return typeof a}:u=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},u(r)}n.default=function(r){if(u(r.ampSpectrum)!=="object")throw new TypeError;for(var i=0,a=0,c=new Float32Array(r.ampSpectrum.length),f=0,m=0,l=0;l<r.ampSpectrum.length;l++){i+=r.ampSpectrum[l];var h=l*r.sampleRate/r.bufferSize;c[l]=h,f+=h*h,a+=h,m+=h*r.ampSpectrum[l]}return(r.ampSpectrum.length*m-a*i)/(i*(f-Math.pow(a,2)))}},"./src/extractors/spectralSpread.js":function(o,n,s){s.r(n);var u=s("./src/extractors/extractorUtilities.js");function r(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?r=function(c){return typeof c}:r=function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},r(i)}n.default=function(i){if(r(i.ampSpectrum)!=="object")throw new TypeError;return Math.sqrt(Object(u.mu)(2,i.ampSpectrum)-Math.pow(Object(u.mu)(1,i.ampSpectrum),2))}},"./src/extractors/zcr.js":function(o,n,s){s.r(n);function u(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?u=function(a){return typeof a}:u=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},u(r)}n.default=function(){if(u(arguments[0].signal)!=="object")throw new TypeError;for(var r=0,i=1;i<arguments[0].signal.length;i++)(arguments[0].signal[i-1]>=0&&arguments[0].signal[i]<0||arguments[0].signal[i-1]<0&&arguments[0].signal[i]>=0)&&r++;return r}},"./src/featureExtractors.js":function(o,n,s){s.r(n),s.d(n,"buffer",function(){return k}),s.d(n,"complexSpectrum",function(){return H}),s.d(n,"amplitudeSpectrum",function(){return W});var u=s("./src/extractors/rms.js");s.d(n,"rms",function(){return u.default});var r=s("./src/extractors/energy.js");s.d(n,"energy",function(){return r.default});var i=s("./src/extractors/spectralSlope.js");s.d(n,"spectralSlope",function(){return i.default});var a=s("./src/extractors/spectralCentroid.js");s.d(n,"spectralCentroid",function(){return a.default});var c=s("./src/extractors/spectralRolloff.js");s.d(n,"spectralRolloff",function(){return c.default});var f=s("./src/extractors/spectralFlatness.js");s.d(n,"spectralFlatness",function(){return f.default});var m=s("./src/extractors/spectralSpread.js");s.d(n,"spectralSpread",function(){return m.default});var l=s("./src/extractors/spectralSkewness.js");s.d(n,"spectralSkewness",function(){return l.default});var h=s("./src/extractors/spectralKurtosis.js");s.d(n,"spectralKurtosis",function(){return h.default});var d=s("./src/extractors/zcr.js");s.d(n,"zcr",function(){return d.default});var y=s("./src/extractors/loudness.js");s.d(n,"loudness",function(){return y.default});var v=s("./src/extractors/perceptualSpread.js");s.d(n,"perceptualSpread",function(){return v.default});var b=s("./src/extractors/perceptualSharpness.js");s.d(n,"perceptualSharpness",function(){return b.default});var g=s("./src/extractors/mfcc.js");s.d(n,"mfcc",function(){return g.default});var w=s("./src/extractors/chroma.js");s.d(n,"chroma",function(){return w.default});var O=s("./src/extractors/powerSpectrum.js");s.d(n,"powerSpectrum",function(){return O.default});var D=s("./src/extractors/spectralFlux.js");s.d(n,"spectralFlux",function(){return D.default});var k=function(V){return V.signal},H=function(V){return V.complexSpectrum},W=function(V){return V.ampSpectrum}},"./src/index.js":function(o,n,s){o.exports=s("./src/main.js").default},"./src/main.js":function(o,n,s){s.r(n);var u=s("./src/utilities.js"),r=s("./src/featureExtractors.js"),i=s("./node_modules/fftjs/dist/fft.js"),a=s("./src/meyda-wa.js");function c(h,d,y){return d in h?Object.defineProperty(h,d,{value:y,enumerable:!0,configurable:!0,writable:!0}):h[d]=y,h}function f(h){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?f=function(y){return typeof y}:f=function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},f(h)}var m={audioContext:null,spn:null,bufferSize:512,sampleRate:44100,melBands:26,chromaBands:12,callback:null,windowingFunction:"hanning",featureExtractors:r,EXTRACTION_STARTED:!1,numberOfMFCCCoefficients:13,_featuresToExtract:[],windowing:u.applyWindow,_errors:{notPow2:new Error("Meyda: Buffer size must be a power of 2, e.g. 64 or 512"),featureUndef:new Error("Meyda: No features defined."),invalidFeatureFmt:new Error("Meyda: Invalid feature format"),invalidInput:new Error("Meyda: Invalid input."),noAC:new Error("Meyda: No AudioContext specified."),noSource:new Error("Meyda: No source node specified.")},createMeydaAnalyzer:function(d){return new a.MeydaAnalyzer(d,Object.assign({},m))},extract:function(d,y,v){var b=this;if(y){if(f(y)!="object")throw this._errors.invalidInput;if(d){if(!u.isPowerOfTwo(y.length))throw this._errors.notPow2}else throw this._errors.featureUndef}else throw this._errors.invalidInput;(typeof this.barkScale=="undefined"||this.barkScale.length!=this.bufferSize)&&(this.barkScale=u.createBarkScale(this.bufferSize,this.sampleRate,this.bufferSize)),(typeof this.melFilterBank=="undefined"||this.barkScale.length!=this.bufferSize||this.melFilterBank.length!=this.melBands)&&(this.melFilterBank=u.createMelFilterBank(Math.max(this.melBands,this.numberOfMFCCCoefficients),this.sampleRate,this.bufferSize)),(typeof this.chromaFilterBank=="undefined"||this.chromaFilterBank.length!=this.chromaBands)&&(this.chromaFilterBank=u.createChromaFilterBank(this.chromaBands,this.sampleRate,this.bufferSize)),typeof y.buffer=="undefined"?this.signal=u.arrayToTyped(y):this.signal=y;var g=l(y,this.windowingFunction,this.bufferSize);if(this.signal=g.windowedSignal,this.complexSpectrum=g.complexSpectrum,this.ampSpectrum=g.ampSpectrum,v){var w=l(v,this.windowingFunction,this.bufferSize);this.previousSignal=w.windowedSignal,this.previousComplexSpectrum=w.complexSpectrum,this.previousAmpSpectrum=w.ampSpectrum}var O=function(k){return b.featureExtractors[k]({ampSpectrum:b.ampSpectrum,chromaFilterBank:b.chromaFilterBank,complexSpectrum:b.complexSpectrum,signal:b.signal,bufferSize:b.bufferSize,sampleRate:b.sampleRate,barkScale:b.barkScale,melFilterBank:b.melFilterBank,previousSignal:b.previousSignal,previousAmpSpectrum:b.previousAmpSpectrum,previousComplexSpectrum:b.previousComplexSpectrum,numberOfMFCCCoefficients:b.numberOfMFCCCoefficients})};if(f(d)==="object")return d.reduce(function(D,k){return Object.assign({},D,c({},k,O(k)))},{});if(typeof d=="string")return O(d);throw this._errors.invalidFeatureFmt}},l=function(d,y,v){var b={};typeof d.buffer=="undefined"?b.signal=u.arrayToTyped(d):b.signal=d,b.windowedSignal=u.applyWindow(b.signal,y),b.complexSpectrum=Object(i.fft)(b.windowedSignal),b.ampSpectrum=new Float32Array(v/2);for(var g=0;g<v/2;g++)b.ampSpectrum[g]=Math.sqrt(Math.pow(b.complexSpectrum.real[g],2)+Math.pow(b.complexSpectrum.imag[g],2));return b};n.default=m,typeof window!="undefined"&&(window.Meyda=m)},"./src/meyda-wa.js":function(o,n,s){s.r(n),s.d(n,"MeydaAnalyzer",function(){return f});var u=s("./src/utilities.js"),r=s("./src/featureExtractors.js");function i(m,l){if(!(m instanceof l))throw new TypeError("Cannot call a class as a function")}function a(m,l){for(var h=0;h<l.length;h++){var d=l[h];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(m,d.key,d)}}function c(m,l,h){return l&&a(m.prototype,l),h&&a(m,h),m}var f=function(){function m(l,h){var d=this;if(i(this,m),this._m=h,l.audioContext){if(l.bufferSize&&!u.isPowerOfTwo(l.bufferSize))throw this._m._errors.notPow2;if(!l.source)throw this._m._errors.noSource}else throw this._m.errors.noAC;this._m.audioContext=l.audioContext,this._m.bufferSize=l.bufferSize||this._m.bufferSize||256,this._m.hopSize=l.hopSize||this._m.hopSize||this._m.bufferSize,this._m.sampleRate=l.sampleRate||this._m.audioContext.sampleRate||44100,this._m.callback=l.callback,this._m.windowingFunction=l.windowingFunction||"hanning",this._m.featureExtractors=r,this._m.EXTRACTION_STARTED=l.startImmediately||!1,this._m.channel=typeof l.channel=="number"?l.channel:0,this._m.inputs=l.inputs||1,this._m.outputs=l.outputs||1,this._m.numberOfMFCCCoefficients=l.numberOfMFCCCoefficients||this._m.numberOfMFCCCoefficients||13,this._m.spn=this._m.audioContext.createScriptProcessor(this._m.bufferSize,this._m.inputs,this._m.outputs),this._m.spn.connect(this._m.audioContext.destination),this._m._featuresToExtract=l.featureExtractors||[],this._m.barkScale=u.createBarkScale(this._m.bufferSize,this._m.sampleRate,this._m.bufferSize),this._m.melFilterBank=u.createMelFilterBank(Math.max(this._m.melBands,this._m.numberOfMFCCCoefficients),this._m.sampleRate,this._m.bufferSize),this._m.inputData=null,this._m.previousInputData=null,this._m.frame=null,this._m.previousFrame=null,this.setSource(l.source),this._m.spn.onaudioprocess=function(y){if(d._m.inputData!==null&&(d._m.previousInputData=d._m.inputData),d._m.inputData=y.inputBuffer.getChannelData(d._m.channel),d._m.previousInputData){var v=new Float32Array(d._m.previousInputData.length+d._m.inputData.length-d._m.hopSize);v.set(d._m.previousInputData.slice(d._m.hopSize)),v.set(d._m.inputData,d._m.previousInputData.length-d._m.hopSize)}else var v=d._m.inputData;var b=u.frame(v,d._m.bufferSize,d._m.hopSize);b.forEach(function(g){d._m.frame=g;var w=d._m.extract(d._m._featuresToExtract,d._m.frame,d._m.previousFrame);typeof d._m.callback=="function"&&d._m.EXTRACTION_STARTED&&d._m.callback(w),d._m.previousFrame=d._m.frame})}}return c(m,[{key:"start",value:function(h){this._m._featuresToExtract=h||this._m._featuresToExtract,this._m.EXTRACTION_STARTED=!0}},{key:"stop",value:function(){this._m.EXTRACTION_STARTED=!1}},{key:"setSource",value:function(h){this._m.source&&this._m.source.disconnect(this._m.spn),this._m.source=h,this._m.source.connect(this._m.spn)}},{key:"setChannel",value:function(h){h<=this._m.inputs?this._m.channel=h:console.error("Channel ".concat(h," does not exist. Make sure you've provided a value for 'inputs' that is greater than ").concat(h," when instantiating the MeydaAnalyzer"))}},{key:"get",value:function(h){return this._m.inputData?this._m.extract(h||this._m._featuresToExtract,this._m.inputData,this._m.previousInputData):null}}]),m}()},"./src/utilities.js":function(o,n,s){s.r(n),s.d(n,"isPowerOfTwo",function(){return h}),s.d(n,"error",function(){return d}),s.d(n,"pointwiseBufferMult",function(){return y}),s.d(n,"applyWindow",function(){return v}),s.d(n,"createBarkScale",function(){return b}),s.d(n,"typedToArray",function(){return g}),s.d(n,"arrayToTyped",function(){return w}),s.d(n,"_normalize",function(){return O}),s.d(n,"normalize",function(){return D}),s.d(n,"normalizeToOne",function(){return k}),s.d(n,"mean",function(){return H}),s.d(n,"melToFreq",function(){return V}),s.d(n,"freqToMel",function(){return Y}),s.d(n,"createMelFilterBank",function(){return se}),s.d(n,"hzToOctaves",function(){return re}),s.d(n,"normalizeByColumn",function(){return le}),s.d(n,"createChromaFilterBank",function(){return me}),s.d(n,"frame",function(){return E});var u=s("./src/windowing.js");function r(p){return f(p)||c(p)||a(p)||i()}function i(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function a(p,I){if(!!p){if(typeof p=="string")return m(p,I);var _=Object.prototype.toString.call(p).slice(8,-1);if(_==="Object"&&p.constructor&&(_=p.constructor.name),_==="Map"||_==="Set")return Array.from(p);if(_==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_))return m(p,I)}}function c(p){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(p))return Array.from(p)}function f(p){if(Array.isArray(p))return m(p)}function m(p,I){(I==null||I>p.length)&&(I=p.length);for(var _=0,A=new Array(I);_<I;_++)A[_]=p[_];return A}var l={};function h(p){for(;p%2==0&&p>1;)p/=2;return p===1}function d(p){throw new Error("Meyda: "+p)}function y(p,I){for(var _=[],A=0;A<Math.min(p.length,I.length);A++)_[A]=p[A]*I[A];return _}function v(p,I){if(I!=="rect"){if((I===""||!I)&&(I="hanning"),l[I]||(l[I]={}),!l[I][p.length])try{l[I][p.length]=u[I](p.length)}catch(_){throw new Error("Invalid windowing function")}p=y(p,l[I][p.length])}return p}function b(p,I,_){for(var A=new Float32Array(p),B=0;B<A.length;B++)A[B]=B*I/_,A[B]=13*Math.atan(A[B]/1315.8)+3.5*Math.atan(Math.pow(A[B]/7518,2));return A}function g(p){return Array.prototype.slice.call(p)}function w(p){return Float32Array.from(p)}function O(p,I){return p/I}function D(p,I){return p.map(function(_){return O(_,I)})}function k(p){var I=Math.max.apply(null,p);return p.map(function(_){return _/I})}function H(p){return p.reduce(function(I,_){return I+_})/p.length}function W(p){var I=700*(Math.exp(p/1125)-1);return I}function U(p){var I=1125*Math.log(1+p/700);return I}function V(p){return W(p)}function Y(p){return U(p)}function se(p,I,_){for(var A=new Float32Array(p+2),B=new Float32Array(p+2),L=0,z=I/2,he=U(L),K=U(z),S=K-he,M=S/(p+1),T=Array(p+2),P=0;P<A.length;P++)A[P]=P*M,B[P]=W(A[P]),T[P]=Math.floor((_+1)*B[P]/I);for(var R=Array(p),C=0;C<R.length;C++){R[C]=Array.apply(null,new Array(_/2+1)).map(Number.prototype.valueOf,0);for(var j=T[C];j<T[C+1];j++)R[C][j]=(j-T[C])/(T[C+1]-T[C]);for(var N=T[C+1];N<T[C+2];N++)R[C][N]=(T[C+2]-N)/(T[C+2]-T[C+1])}return R}function re(p,I){return Math.log2(16*p/I)}function le(p){var I=p[0].map(function(){return 0}),_=p.reduce(function(A,B){return B.forEach(function(L,z){A[z]+=Math.pow(L,2)}),A},I).map(Math.sqrt);return p.map(function(A,B){return A.map(function(L,z){return L/(_[z]||1)})})}function me(p,I,_){var A=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5,B=arguments.length>4&&arguments[4]!==void 0?arguments[4]:2,L=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,z=arguments.length>6&&arguments[6]!==void 0?arguments[6]:440,he=Math.floor(_/2)+1,K=new Array(_).fill(0).map(function(C,j){return p*re(I*j/_,z)});K[0]=K[1]-1.5*p;var S=K.slice(1).map(function(C,j){return Math.max(C-K[j])},1).concat([1]),M=Math.round(p/2),T=new Array(p).fill(0).map(function(C,j){return K.map(function(N){return(10*p+M+N-j)%p-M})}),P=T.map(function(C,j){return C.map(function(N,G){return Math.exp(-.5*Math.pow(2*T[j][G]/S[G],2))})});if(P=le(P),B){var R=K.map(function(C){return Math.exp(-.5*Math.pow((C/p-A)/B,2))});P=P.map(function(C){return C.map(function(j,N){return j*R[N]})})}return L&&(P=[].concat(r(P.slice(3)),r(P.slice(0,3)))),P.map(function(C){return C.slice(0,he)})}function E(p,I,_){if(p.length<I)throw new Error("Buffer is too short for frame length");if(_<1)throw new Error("Hop length cannot be less that 1");if(I<1)throw new Error("Frame length cannot be less that 1");var A=1+Math.floor((p.length-I)/_);return new Array(A).fill(0).map(function(B,L){return p.slice(L*_,L*_+I)})}},"./src/windowing.js":function(o,n,s){s.r(n),s.d(n,"blackman",function(){return u}),s.d(n,"sine",function(){return r}),s.d(n,"hanning",function(){return i}),s.d(n,"hamming",function(){return a});function u(c){for(var f=new Float32Array(c),m=2*Math.PI/(c-1),l=2*m,h=0;h<c/2;h++)f[h]=.42-.5*Math.cos(h*m)+.08*Math.cos(h*l);for(var d=c/2;d>0;d--)f[c-d]=f[d-1];return f}function r(c){for(var f=Math.PI/(c-1),m=new Float32Array(c),l=0;l<c;l++)m[l]=Math.sin(f*l);return m}function i(c){for(var f=new Float32Array(c),m=0;m<c;m++)f[m]=.5-.5*Math.cos(2*Math.PI*m/(c-1));return f}function a(c){for(var f=new Float32Array(c),m=0;m<c;m++)f[m]=.54-.46*Math.cos(2*Math.PI*(m/c-1));return f}}})})}),Fs=Qr(Rs),Dn=Fs;var Us=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Bs=Q(F(t=>vn(t)),J(),Us),Cn=Q(ht({raw:F(t=>t),tonicMidi:F(t=>Ct(t.tonic+"2")%12),majorKey:F(t=>t.tonic),minorKey:F(t=>En(t.minorRelative).toLowerCase()),normalizedMidis:F(t=>Q(F(e=>Ct(e+"2")%12),J(),t.scale))}),J(),Bs),Pn=t=>{let e=Q(Le(F(s=>t[s]?s:null),mt(s=>s!==null)),J(),Zt(12)),o=Q(Le(F(s=>sr(new Set(s.normalizedMidis),new Set(e))),F(s=>Array.from(s))),J(),Cn),n=Q(ht({majorKey:F(s=>s[0].majorKey),minorKey:F(s=>s[0].minorKey),normalizedMidis:F(s=>s[0].normalizedMidis),common:F(s=>s[1]),similarity:F(s=>s[1].length/e.length+(e.includes(s[0].tonicMidi)?.1:0))}),J(),zr(Cn,o));return n=n.sort((s,u)=>u.similarity-s.similarity),n},je=[...Jr(!1,12)],dc=[...Ce(12,dt([!0,!1],[.5,.5]))],xn=t=>{let o=new An(t).tracks;o.sort((u,r)=>r.notes.length-u.notes.length);let n=o[0],s=Q(F(u=>u[0]%12),J(),Ce(7,ir(n.notes.map(u=>u.midi))));return Array.from(new Set(s))},Gs=()=>{try{return new AudioContext}catch{}},Hs=async(t,e)=>{try{return await t.decodeAudioData(e)}catch{return new Promise((o,n)=>{t.decodeAudioData(e,o,n)})}},Ls=t=>Math.pow(2,Math.round(Math.log(t)/Math.log(2))),jn=async t=>{let e=1,o=Gs(),n=await Hs(o,t),s=n.getChannelData(0),u=Ls(n.sampleRate/e),r=Math.floor(s.length/u),i=Q(F(c=>Dn.extract("chroma",s.slice(c*u,(c+1)*u))),J(),Zt(r)),a=Q(F(c=>c.indexOf(1)),J(),i);return Q(F(c=>c[0]),J(),Q(F(c=>c),J(),ir(a)).sort((c,f)=>f[1]-c[1])).slice(0,7)};var Nn=t=>{let e=t.views,o=t.ui,n=e.size.deref(),s=Math.min(400*1.1,n[0]*.9),u=e.viewConfig.deref(),r=Pn(e.keyState.deref()),i=.1,a=35,c={width:s,height:s/a,rx:5,fill:"#e2e2e2"};return["div",o.keyGroup.root,...r.map((f,m)=>["div",{...o.keyGroup.block,onmouseover:l=>{l.preventDefault(),t.bus.dispatch([Ve,f.normalizedMidis])},onmouseleave:l=>{l.preventDefault(),t.bus.dispatch([bt])}},["div.flex",["div",f.majorKey,u.showSmall?["small"," maj"]:[]],u.showMinor?["div",["span.text-red-600","  "],f.minorKey,u.showSmall?["small"," min"]:[]]:[]],["div",["svg",{width:s*(1+i),height:s/a},["g",["rect",c],f.common.length>0?["rect",{...c,width:(f.similarity-i)*s,fill:"#000"}]:[]]]]])]};var kt=t=>{t.preventDefault()},Vs=(t,e)=>{kt(e);let o=e.dataTransfer.files;if(o&&o.length>0){let n=new FileReader,s=o[0];n.onload=async u=>{if(s.type==="audio/midi"){t.dispatch([be,s.name]);let r=xn(u.target.result);t.dispatch([we,je.map((i,a)=>!!r.includes(a))])}else if(s.type==="audio/aac"||s.type==="audio/mpeg"||s.type==="audio/wav"){t.dispatch([be,s.name]);let r=await jn(u.target.result);t.dispatch([we,je.map((i,a)=>!!r.includes(a))])}else t.dispatch([It])},n.readAsArrayBuffer(s)}},kn=t=>{let e=t.bus,o=t.views,n=t.ui.fileDropZone,s=o.midiFile.deref(),u=o.size.deref(),r=Math.min(400*1.1,u[0]*.9);return["div",{...n.root,ondrop:i=>{i.target.classList.remove("nm-inset-gray-200-sm"),Vs(e,i)},ondragenter:i=>{i.target.classList.add("nm-inset-gray-200-sm"),kt(i)},ondragleave:i=>{i.target.classList.remove("nm-inset-gray-200-sm"),kt(i)},ondragover:i=>kt(i),style:{width:`${r}px`}},s]};var zs={w:16,h:8,pad:2,margin:0},Ws=Gr({...zs,vertical:!1}),Rn=t=>{let e=t.views,o=t.ui.viewConfigToggleGroup,n=e.viewConfig.deref();return["div",Object.entries(n).map(([s,u])=>["div",o.block,[Ws,{onclick:()=>t.bus.dispatch([St,s])},u],["span",o.caption,s]])]};var Ks=Br({element:"h2",attribs:{class:"text-2xl font-extrabold mb-4"}}),Fn=t=>()=>["div",[Ks,"OP-Z KEY FINDER"],["div.pb-4",rn],["div.pb-4",sn],["div.mb-4",[an],[Nn]],[kn],["div.block",["details",["summary","View Config"],[Rn]]]];var Rt={id:"home",match:["home"]};var Un={router:{useFragment:!0,defaultRouteID:Rt.id,routes:[Rt]},events:{[pt]:Rr("debug",t=>t^1),[Me]:[(t,[e,o])=>({[Z]:[Ge,["keyState",o]]})],[we]:[(t,[e,o])=>({[Z]:[ge,["keyState",o]]})],[yt]:[()=>({[Z]:[we,je]})],[gt]:[()=>({[Z]:[we,[...Ce(12,dt([!0,!1],[.5,.5]))]]})],[Ve]:[(t,[e,o])=>({[Z]:[ge,["highlights",o]]})],[bt]:[()=>({[Z]:[Ve,[]]})],[vt]:[()=>({[Z]:[ge,["size",[window.innerWidth,window.innerHeight]]]})],[St]:[(t,[e,o])=>({[Z]:[Ge,["viewConfig",o]]})],[Et]:[(t,[e,o])=>({[Z]:[[Ge,"enabledMidi"],[ge,["midiDevices",o]]]})],[be]:[(t,[e,o])=>({[Z]:[[ge,["midiFile",o]]]})],[It]:[()=>({[Z]:[be,"INVALID MIDI FILE..."],[Kt]:[$t,[500,"DROP MIDI/AUDIO FILE HERE..."],be,be]})],[Zr]:[(t,[e,o])=>({[Z]:[[ge,["comparison",o]]]})]},effects:{},components:{[Rt.id]:Fn},domRoot:"app",initialState:{enabledMidi:!1,midiDevices:[],midiFile:"DROP MIDI/AUDIO FILE HERE...",keyState:je,highlights:[],size:[window.innerWidth,window.innerHeight],viewConfig:{showMinor:!0,showSmall:!0},route:{},debug:1},views:{enabledMidi:"enabledMidi",midiDevices:"midiDevices",midiFile:"midiFile",keyState:"keyState",highlights:"highlights",size:"size",viewConfig:"viewConfig",json:["",t=>JSON.stringify(t,null,2)],debug:"debug"},ui:{root:{class:"clearfix flex flex-row font-sans m-0"},midiDevicesStatus:{content:[{class:"gray-500 p-1 bg-red-200 rounded-full"},{class:"gray-500 p-1 bg-green-200 rounded-full"}],dropdown:{root:{class:"ml-2 rounded-full nm-flat-gray-200 p-2 font-medium uppercase"},selection:{class:"bg-transparent font-medium uppercase"}}},toolbar:{root:{class:"my-4"},button:{class:"cursor-pointer mr-3 px-8 py-2 text-md font-medium nm-flat-gray-200 hover:nm-flat-gray-200-lg active:nm-inset-gray-200-sm rounded-full uppercase transition duration-200 ease-in-out transform"}},toggleGroup:{root:{class:""},key:{major:{class:"inline-block cursor-pointer nm-flat-gray-200 hover:nm-flat-gray-200-lg active:nm-inset-gray-200-lg rounded-full"},e:{class:"inline-block cursor-pointer nm-flat-gray-200 hover:nm-flat-gray-200-lg active:nm-inset-gray-200-lg rounded-full mr-8"},minor:{class:"inline-block cursor-pointer nm-flat-gray-200 hover:nm-flat-gray-200-lg active:nm-inset-gray-200-lg rounded-full mb-8"}}},keyGroup:{root:{class:"inline-block"},block:{class:"my-2 mr-2"}},fileDropZone:{root:{class:"mt-2 mb-8 border-dotted border-2 inline-block p-8 text-center font-medium nm-flat-gray-200-lg"}},code:{class:"m-0 ml-8 p-2 text-xs bg-gray-100 font-mono overflow-x-hidden"},column:{content:[{class:"float-left w-full m-4"},{class:"float-left w-5/6 m-4"}],debug:[{class:"float-right m-4 close"},{class:"float-right m-4 open"}]},debugToggle:{class:"toggle cursor-pointer tracking-wider"},viewConfigToggleGroup:{block:{class:"cursor-pointer my-2 flex justify-start items-center"},caption:{class:"ml-2"}}}};new rr(Un).start();
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
//# sourceMappingURL=index.js.map
