var xr=Object.defineProperty,Or=Object.defineProperties;var Dr=Object.getOwnPropertyDescriptors;var Tt=Object.getOwnPropertySymbols;var Pr=Object.prototype.hasOwnProperty,Fr=Object.prototype.propertyIsEnumerable;var At=(t,e,r)=>e in t?xr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ve=(t,e)=>{for(var r in e||(e={}))Pr.call(e,r)&&At(t,r,e[r]);if(Tt)for(var r of Tt(e))Fr.call(e,r)&&At(t,r,e[r]);return t},Ye=(t,e)=>Or(t,Dr(e));/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function kt(t,e,r,i){var o=arguments.length,u=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(t,e,r,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(u=(o<3?n(u):o>3?n(e,r,u):n(e,r))||u);return o>3&&u&&Object.defineProperty(e,r,u),u}const Rr=t=>t!=null&&typeof t.deref=="function",Ie=t=>Rr(t)?t.deref():t;var Je;(function(t){t[t.FINE=0]="FINE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.SEVERE=4]="SEVERE",t[t.NONE=5]="NONE"})(Je||(Je={}));const ae=Symbol(),Qe=()=>{},Ur="*",Se=(()=>{try{return{}.UMBRELLA_ASSERTS==="1"}catch{}return!1})()?(t,e="assertion failed")=>{if(typeof t=="function"&&!t()||!t)throw new Error(typeof e=="function"?e():e)}:Qe,Br=Object.freeze({level:Je.NONE,fine(){},debug(){},info(){},warn(){},severe(){}}),Ct=(t,e={})=>{const r=Reflect.ownKeys(t),i=Reflect.ownKeys(e),o=Symbol("isa");function u(n){for(let s of r){const a=Object.getOwnPropertyDescriptor(n.prototype,s);!a||a.configurable?Object.defineProperty(n.prototype,s,{value:t[s],writable:!0}):console.log(`not patching: ${n.name}.${s.toString()}`)}return Object.defineProperty(n.prototype,o,{value:!0}),n}for(let n of i)Object.defineProperty(u,n,{value:e[n],enumerable:e.propertyIsEnumerable(n)});return Object.defineProperty(u,Symbol.hasInstance,{value:n=>!!n[o]}),u},Nt=(t,e)=>{if(!!t){for(let r=0,i=t.length,o;r<i;r++)if(o=t[r],o[0].call(o[1],e),e.canceled)return}},Hr=Ct({addListener(t,e,r){let i=(this._listeners=this._listeners||{})[t];return!i&&(i=this._listeners[t]=[]),this.__listener(i,e,r)===-1?(i.push([e,r]),!0):!1},removeListener(t,e,r){let i;if(!(i=this._listeners))return!1;const o=i[t];if(o){const u=this.__listener(o,e,r);if(u!==-1)return o.splice(u,1),!o.length&&delete i[t],!0}return!1},notify(t){let e;if(!(e=this._listeners))return!1;t.target===void 0&&(t.target=this),Nt(e[t.id],t),Nt(e[Ur],t)},__listener(t,e,r){let i=t.length;for(;--i>=0;){const o=t[i];if(o[0]===e&&o[1]===r)break}return i}}),Gr=Ct({addWatch(t,e){return this._watches=this._watches||{},this._watches[t]?!1:(this._watches[t]=e,!0)},removeWatch(t){if(!!this._watches)return this._watches[t]?(delete this._watches[t],!0):!1},notifyWatches(t,e){if(!this._watches)return;const r=this._watches;for(let i in r)r[i](i,t,e)}}),Xe=(t,e=r=>r!==void 0?": "+r:"")=>class extends Error{constructor(r){super(t(r)+e(r))}},jr=Xe(()=>"illegal argument(s)"),Ee=t=>{throw new jr(t)},Lr=Xe(()=>"illegal arity"),ue=t=>{throw new Lr(t)},Vr=Xe(()=>"illegal state"),$r=t=>{throw new Vr(t)},Ke=t=>typeof t=="function",ce=(t,e)=>t!=null&&typeof t[e]=="function",Y=Array.isArray,zr=t=>t!=null&&typeof t!="function"&&t.length!==void 0,Z=t=>typeof t=="string",we=t=>t!=null&&typeof t[Symbol.iterator]=="function",qr=t=>t instanceof Map,xt=t=>t!=null&&typeof t!="string"&&typeof t[Symbol.iterator]=="function",Ot=Object.getPrototypeOf,Wr=t=>{let e;return t!=null&&typeof t=="object"&&((e=Ot(t))===null||Ot(e)===null)},Yr=t=>t instanceof Promise,Jr=t=>t&&(t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Int8Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Uint8ClampedArray),Ze=t=>Y(t)?t:Z(t)?t.length>0?t.split("."):[]:t!=null?[t]:[],Qr=t=>et(t);function et(t){const e=Ze(t),[r,i,o,u]=e;switch(e.length){case 0:return n=>n;case 1:return n=>n!=null?n[r]:void 0;case 2:return n=>n!=null&&(n=n[r])!=null?n[i]:void 0;case 3:return n=>n!=null&&(n=n[r])!=null&&(n=n[i])!=null?n[o]:void 0;case 4:return n=>n!=null&&(n=n[r])!=null&&(n=n[i])!=null&&(n=n[o])!=null?n[u]:void 0;default:return n=>{const s=e.length-1;let a=n;for(let c=0;a!=null&&c<=s;c++)a=a[e[c]];return a}}}const Xr=t=>Me(t);function Me(t){const e=Ze(t),[r,i,o,u]=e;switch(e.length){case 0:return(s,a)=>a;case 1:return(s,a)=>(s=z(s),s[r]=a,s);case 2:return(s,a)=>{let c;return s=z(s),s[r]=c=z(s[r]),c[i]=a,s};case 3:return(s,a)=>{let c,f;return s=z(s),s[r]=c=z(s[r]),c[i]=f=z(c[i]),f[o]=a,s};case 4:return(s,a)=>{let c,f,m;return s=z(s),s[r]=c=z(s[r]),c[i]=f=z(c[i]),f[o]=m=z(f[o]),m[u]=a,s};default:let n;for(let s=e.length;--s>=0;)n=Kr(e[s],n);return n}}const z=t=>Y(t)||Jr(t)?t.slice():Object.assign({},t),Kr=(t,e)=>(r,i)=>(r=z(r),r[t]=e?e(r[t],i):i,r),Te=(t,e,r,...i)=>Zr(t,e,r,...i);function Zr(t,e,r,...i){return Me(e)(t,r.apply(null,(i.unshift(et(e)(t)),i)))}const tt=(t,e,r)=>Me(e)(t,r),en=(t,e)=>tn(t,e);function tn(t,e){const r=et(t),i=Me(t);return(o,...u)=>i(o,e.apply(null,(u.unshift(r(o)),u)))}let rt=class{constructor(e,r){r&&!r(e)&&$r("initial state value did not validate"),this._value=e,this.valid=r}get value(){return this._value}set value(e){this.reset(e)}deref(){return this._value}equiv(e){return this===e}reset(e){const r=this._value;return this.valid&&!this.valid(e)?r:(this._value=e,this.notifyWatches(r,e),e)}resetIn(e,r){return this.reset(tt(this._value,e,r))}resetInUnsafe(e,r){return this.reset(tt(this._value,e,r))}swap(e,...r){return this.reset(e.apply(null,[this._value,...r]))}swapIn(e,r,...i){return this.reset(Te(this._value,e,r,...i))}swapInUnsafe(e,r,...i){return this.reset(Te(this._value,e,r,...i))}addWatch(e,r){}removeWatch(e){}notifyWatches(e,r){}release(){return delete this._watches,delete this._value,!0}};rt=kt([Gr],rt);let rn=0;const nn=()=>rn++,Dt=Object.getPrototypeOf({}),Ae="function",Pt="string",J=(t,e)=>{let r;if(t===e)return!0;if(t!=null){if(typeof t.equiv===Ae)return t.equiv(e)}else return t==e;if(e!=null){if(typeof e.equiv===Ae)return e.equiv(t)}else return t==e;return typeof t===Pt||typeof e===Pt?!1:(r=Object.getPrototypeOf(t),(r==null||r===Dt)&&(r=Object.getPrototypeOf(e),r==null||r===Dt)?Bt(t,e):typeof t!==Ae&&t.length!==void 0&&typeof e!==Ae&&e.length!==void 0?Ft(t,e):t instanceof Set&&e instanceof Set?Rt(t,e):t instanceof Map&&e instanceof Map?Ut(t,e):t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():t instanceof RegExp&&e instanceof RegExp?t.toString()===e.toString():t!==t&&e!==e)},Ft=(t,e,r=J)=>{let i=t.length;if(i===e.length)for(;--i>=0&&r(t[i],e[i]););return i<0},Rt=(t,e,r=J)=>t.size===e.size&&r([...t.keys()].sort(),[...e.keys()].sort()),Ut=(t,e,r=J)=>t.size===e.size&&r([...t].sort(),[...e].sort()),Bt=(t,e,r=J)=>{if(Object.keys(t).length!==Object.keys(e).length)return!1;for(let i in t)if(!e.hasOwnProperty(i)||!r(t[i],e[i]))return!1;return!0};function mo(t,e,r,i,o){return new sn(t,e,r,i,o)}class sn{constructor(e,r,i,o=!0,u=J){this.parent=e,this.id=`view-${nn()}`,this.tx=i||(a=>a),this.path=Ze(r),this.isDirty=!0,this.isLazy=o;const n=Qr(this.path),s=this.parent.deref();this.unprocessed=s?n(s):void 0,o||(this.state=this.tx(this.unprocessed),this.unprocessed=void 0),e.addWatch(this.id,(a,c,f)=>{const m=c&&n(c),h=f&&n(f);u(h,m)||(o?this.unprocessed=h:this.state=this.tx(h),this.isDirty=!0)})}get value(){return this.deref()}deref(){return this.isDirty&&(this.isLazy&&(this.state=this.tx(this.unprocessed),this.unprocessed=void 0),this.isDirty=!1),this.state}changed(){return this.isDirty}view(){return this.isDirty&&this.isLazy?this.tx(this.unprocessed):this.state}release(){return this.unprocessed=void 0,this.isLazy||(this.state=this.tx(void 0)),this.isDirty=!0,this.parent.removeWatch(this.id)}}let ke,Ce,on=[],an=[];const un=t=>ke&&ke.length>=t?ke:ke=new Int32Array(t),cn=t=>Ce&&Ce.length>=t?Ce:Ce=new Int32Array(t),Ht=(t,e,r,i,o)=>{const u=e.length,n=t.linear;if(t.distance=u,o!=="only-distance"){for(let s=0,a=0;s<u;s++,a+=3)n[a]=i,n[a+1]=s,n[a+2]=e[s];if(o==="full"){const s=t[r];for(let a=0;a<u;a++)s[a]=e[a]}}return t},fn=(t,e,r="full",i=J)=>{const o={distance:0,adds:{},dels:{},const:{},linear:[]};if(t===e||t==null&&e==null)return o;if(t==null||t.length===0)return Ht(o,e,"adds",1,r);if(e==null||e.length===0)return Ht(o,t,"dels",-1,r);const u=t.length>=e.length;let n,s,a,c;u?(n=e,s=t):(n=t,s=e),a=n.length,c=s.length;const f=a+1,m=c-a,h=m+f,_=a+c+3,v=cn(_).fill(-1,0,_),E=un(_).fill(-1,0,_),C=on,k=an,F=(G,be,_e)=>{let oe,j;be>_e?(oe=v[G-1],j=be):(oe=v[G+1],j=_e);let te=j-(G-f);for(;te<a&&j<c&&i(n[te],s[j]);)te++,j++;v[G]=k.length/3,k.push(te,j,oe),E[G]=j};let O=-1,R;do{for(O++,R=-O+f;R<h;R++)F(R,E[R-1]+1,E[R+1]);for(R=h+O;R>h;R--)F(R,E[R-1]+1,E[R+1]);F(h,E[h-1]+1,E[h+1])}while(E[h]!==c);if(o.distance=m+2*O,r!=="only-distance"){for(O=v[h]*3;O>=0;)C.push(O),O=k[O+2]*3;r==="full"?ln(C,k,o,n,s,u):hn(C,k,o,n,s,u,r==="only-distance-linear")}return C.length=0,k.length=0,o},ln=(t,e,r,i,o,u)=>{const n=r.linear,s=r.const;let a=t.length,c=0,f=0,m,h,_,v;for(u?(m=r.dels,h=r.adds,_=-1,v=1):(m=r.adds,h=r.dels,_=1,v=-1);--a>=0;){const E=t[a],C=e[E],k=e[E+1],F=k-C;for(;c<C||f<k;){const O=f-c;F>O?(n.push(_,f,m[f]=o[f]),f++):F<O?(n.push(v,c,h[c]=i[c]),c++):(n.push(0,c,s[c]=i[c]),c++,f++)}}},hn=(t,e,r,i,o,u,n)=>{const s=r.linear,a=u?-1:1,c=u?1:-1;let f=t.length,m=0,h=0;for(;--f>=0;){const _=t[f],v=e[_],E=e[_+1],C=E-v;for(;m<v||h<E;){const k=h-m;C>k?(s.push(a,h,o[h]),h++):C<k?(s.push(c,m,i[m]),m++):(n&&s.push(0,m,i[m]),m++,h++)}}},dn=(t,e,r="full",i=J)=>t===e?{distance:0}:r==="only-distance"?pn(t,e,i):mn(t,e,i),pn=(t,e,r)=>{t||(t={}),e||(e={});let i=0;for(let o in t){const u=e[o];(u===void 0||!r(t[o],u))&&i++}for(let o in e)!(o in t)&&i++;return{distance:i}},mn=(t,e,r)=>{t||(t={}),e||(e={});let i=0;const o=[],u=[],n=[];for(let s in t){const a=e[s];a===void 0?(u.push(s),i++):r(t[s],a)||(n.push(s,a),i++)}for(let s in e)s in t||(o.push(s),i++);return{distance:i,adds:o,dels:u,edits:n}},Ne=Array.isArray,gn=Math.max,Gt=Object.getPrototypeOf({}),xe="function",Oe="string",jt=(()=>{const t=new Array(2048);for(let e=2,r=t.length;e<r;e++)t[e]=e-2;return t})(),yn=t=>{if(t<=jt.length)return jt.slice(0,t);const e=new Array(t);for(;--t>=2;)e[t]=t-2;return e},Lt=(t,e,r,i,o,u=0)=>{const n=o[1];if(n.__skip)return;if(n.__diff===!1){fe(i),e.replaceChild(t,r,u,o);return}const s=i[1];if(s&&s.__skip){e.replaceChild(t,r,u,o,!1);return}let a=n.__impl;if(a&&a!==e)return a.diffTree(t,a,r,i,o,u);const c=fn(i,o,"only-distance-linear",le);if(c.distance===0)return;const f=c.linear,m=e.getChild(r,u);let h,_,v;if(f[0]!==0||i[1].key!==n.key){fe(i),e.replaceChild(t,r,u,o);return}if((v=i.__release)&&v!==o.__release&&fe(i),f[3]!==0&&(Sn(e,m,i[1],o[1]),c.distance===2))return;const E=f.length,C=i.length-1,k=En(f),F=yn(C+1);for(h=6;h<E;h+=3)_=f[h],!!_&&(_===-1?bn(t,e,m,i,o,f,h,k,F,C):_n(t,e,m,f,h,k,F,C));(v=o.__init)&&v!=i.__init&&v.apply(o,[m,...o.__args])},bn=(t,e,r,i,o,u,n,s,a,c)=>{const f=u[n+2];if(Ne(f)){let m=f[1].key;if(m!==void 0&&s[m][2]!==void 0){const h=s[m];m=h[0],Lt(t,e,r,i[m],o[h[2]],a[m])}else{const h=u[n+1];fe(f),e.removeChild(r,a[h]),vn(a,c,h)}}else typeof f===Oe&&e.setContent(r,"")},_n=(t,e,r,i,o,u,n,s)=>{const a=i[o+2];if(typeof a===Oe)e.setContent(r,a);else if(Ne(a)){const c=a[1].key;if(c===void 0||u[c][0]===void 0){const f=i[o+1];e.createTree(t,r,a,n[f]),In(n,s,f)}}},vn=(t,e,r)=>{for(;e>r;e--)t[e]=gn(t[e]-1,0)},In=(t,e,r)=>{for(;e>=r;e--)t[e]++},Sn=(t,e,r,i)=>{const o=dn(r,i,"full",J);t.removeAttribs(e,o.dels,r);let u=ae,n,s,a;for(a=o.edits,n=a.length;(n-=2)>=0;)s=a[n],s[0]==="o"&&s[1]==="n"&&t.removeAttribs(e,[s],r),s!=="value"?t.setAttrib(e,s,a[n+1],i):u=a[n+1];for(a=o.adds,n=a.length;--n>=0;)s=a[n],s!=="value"?t.setAttrib(e,s,i[s],i):u=i[s];u!==ae&&t.setAttrib(e,"value",u,i)},fe=t=>{if(Ne(t)){let e;if((e=t[1])&&e.__release===!1)return;for(t.__release&&(t.__release.apply(t.__this,t.__args),delete t.__release),e=t.length;--e>=2;)fe(t[e])}},En=t=>{let e,r,i;const o={};for(let u=t.length;(u-=3)>=0;)r=t[u+2],Ne(r)&&(e=r[1].key)!==void 0&&(i=o[e],!i&&(o[e]=i=[,,]),i[t[u]+1]=t[u+1]);return o},le=(t,e)=>{let r;if(t===e)return!0;if(t!=null){if(typeof t.equiv===xe)return t.equiv(e)}else return t==e;if(e!=null){if(typeof e.equiv===xe)return e.equiv(t)}else return t==e;return typeof t===Oe||typeof e===Oe?!1:(r=Object.getPrototypeOf(t),(r==null||r===Gt)&&(r=Object.getPrototypeOf(e),r==null||r===Gt)?!(t.__diff===!1||e.__diff===!1)&&Bt(t,e,le):typeof t!==xe&&t.length!==void 0&&typeof e!==xe&&e.length!==void 0?Ft(t,e,le):t instanceof Set&&e instanceof Set?Rt(t,e,le):t instanceof Map&&e instanceof Map?Ut(t,e,le):t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():t instanceof RegExp&&e instanceof RegExp?t.toString()===e.toString():t!==t&&e!==e)},wn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},Mn=/^([^\s\.#]+)(?:#([^\s\.#]+))?(?:\.([^\s#]+))?$/;new RegExp(`[${Object.keys(wn).join("")}]`,"g");const Tn={button:1,option:1,script:1,style:1,text:1,textarea:1,title:1},nt=t=>t.split(" ").reduce((e,r)=>(e[r]=!0,e),{}),An=nt("animate animateColor animateMotion animateTransform circle clipPath color-profile defs desc discard ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter font foreignObject g image line linearGradient marker mask metadata mpath path pattern polygon polyline radialGradient rect set stop style svg switch symbol text textPath title tref tspan use view");nt("area base br col command embed hr img input keygen link meta param source stop track use wbr ?xml");nt("animate circle ellipse line path polygon polyline rect");const Vt=(t,e)=>{if(e=Ie(e),e==null)return t;if(Z(e))return t+" "+e;const r=new Set(t.split(" "));for(let i in e)Ie(e[i])?r.add(i):r.delete(i);return[...r].join(" ")},kn=(t,e,r)=>{e&&(t.id=e);let i=Ie(t.class);return r?(r=r.replace(/\./g," "),t.class=i?Vt(r,i):r):i&&(t.class=Z(i)?i:Vt("",i)),t},Cn=t=>{let e="",r;for(let i in t)r=Ie(t[i]),Ke(r)&&(r=r(t)),r!=null&&(e+=`${i}:${r};`);return e},Nn=(t,e)=>{if(t==null||!e||!e.length)return t;const r=Object.assign({},t);for(let i of e){const o=r[i];ce(o,"deref")&&(r[i]=o.deref())}return r},xn=t=>Object.keys(t).reduce((e,r)=>(e.push(`${r}: ${t[r]}`),e),[]).join(" "),On="http://www.w3.org/2000/svg",De=Y,$t=xt,zt=Z,qt=(t,e)=>e.__init&&e.__init.apply(e.__this,[t,...e.__args]),Pe=(t,e,r,i,o,u=!0)=>{if(De(i)){const n=i[0];if(typeof n=="function")return Pe(t,e,r,n.apply(null,[t.ctx,...i.slice(1)]),o);const s=i[1];if(s.__impl)return s.__impl.createTree(t,r,i,o,u);const a=e.createElement(r,n,s,o);if(i.length>2){const c=i.length;for(let f=2;f<c;f++)Pe(t,e,a,i[f],void 0,u)}return u&&qt(a,i),a}if($t(i)){const n=[];for(let s of i)n.push(Pe(t,e,r,s,o,u));return n}return i==null?r:e.createTextElement(r,i)},Fe=(t,e,r,i,o=0)=>{if(De(i)){const u=e.getChild(r,o);typeof i[0]=="function"&&Fe(t,e,r,i[0].apply(null,[t.ctx,...i.slice(1)]),o);const n=i[1];if(n.__impl)return n.__impl.hydrateTree(t,r,i,o);qt(u,i);for(let s in n)s[0]==="o"&&s[1]==="n"&&e.setAttrib(u,s,n[s]);for(let s=i.length,a=2;a<s;a++)Fe(t,e,u,i[a],a-2)}else if($t(i))for(let u of i)Fe(t,e,r,u,o),o++},Dn=(t,e,r,i)=>{const o=An[e]?document.createElementNS(On,e):document.createElement(e);return r&&Bn(o,r),Wt(t,o,i)},Pn=(t,e,r)=>Wt(t,document.createTextNode(e),r),Wt=(t,e,r)=>t?r===void 0?t.appendChild(e):t.insertBefore(e,t.children[r]):e,Fn=(t,e)=>t.children[e],Rn=(t,e,r,i,o,u=!0)=>(e.removeChild(r,i),e.createTree(t,r,o,i,u)),Un=(t,e)=>t.textContent=e,Bn=(t,e)=>{for(let r in e)Yt(t,r,e[r],e);return t},Yt=(t,e,r,i)=>{if(e.startsWith("__"))return;const o=e[0]==="o"&&e[1]==="n";if(!o&&typeof r=="function"&&(r=r(i)),r!==void 0&&r!==!1)switch(e){case"style":jn(t,r);break;case"value":Hn(t,r);break;case"prefix":t.setAttribute(e,zt(r)?r:xn(r));break;case"accesskey":t.accessKey=r;break;case"contenteditable":t.contentEditable=r;break;case"tabindex":t.tabIndex=r;break;case"align":case"autocapitalize":case"checked":case"dir":case"draggable":case"hidden":case"id":case"lang":case"namespaceURI":case"scrollTop":case"scrollLeft":case"title":t[e]=r;break;default:o?Ln(t,e.substr(2),r):t.setAttribute(e,r===!0?"":r)}else t[e]!=null?t[e]=null:t.removeAttribute(e);return t},Hn=(t,e)=>{let r;switch(t.type){case"text":case"textarea":case"password":case"search":case"number":case"email":case"url":case"tel":case"date":case"datetime-local":case"time":case"week":case"month":if((r=t.value)!==void 0&&typeof e=="string"){const i=e.length-(r.length-(t.selectionStart||0));t.value=e,t.selectionStart=t.selectionEnd=i;break}default:t.value=e}},Gn=(t,e,r)=>{for(let i=e.length;--i>=0;){const o=e[i];o[0]==="o"&&o[1]==="n"?Vn(t,o.substr(2),r[o]):t.hasAttribute(o)?t.removeAttribute(o):t[o]=null}},jn=(t,e)=>(t.setAttribute("style",Cn(e)),t),Ln=(t,e,r)=>zt(r)?t.setAttribute("on"+e,r):De(r)?t.addEventListener(e,...r):t.addEventListener(e,r),Vn=(t,e,r)=>De(r)?t.removeEventListener(e,...r):t.removeEventListener(e,r),$n=(t,e)=>{const r=t.children[e];r!==void 0&&t.removeChild(r)},Re=Y,zn=xt,qn=Wr,Wn=(t,e)=>{let r=t[0],i=qn(t[1]),o,u,n;return(typeof r!="string"||!(o=Mn.exec(r)))&&Ee(`${r} is not a valid tag name`),u=o[1],r===u&&i&&(!e||t[1].key)?t:(n=kn(i?Object.assign({},t[1]):{},o[2],o[3]),n.__skip&&t.length<3?[u,n]:[u,n,...t.slice(i?2:1)])},Yn=(t,e)=>ee(e,t,t.ctx,[0],t.keys!==!1,t.span!==!1),ee=(t,e,r,i,o,u)=>{if(t!=null){if(Re(t)){if(t.length===0)return;let n,s=t[1],a;if(s&&(a=s.__impl)&&(a=a.normalizeTree))return a(e,t);const c=t[0];if(typeof c=="function")return ee(c.apply(null,[r,...t.slice(1)]),e,r,i,o,u);if(typeof c.render=="function"){const f=[r,...t.slice(1)];return n=ee(c.render.apply(c,f),e,r,i,o,u),Re(n)&&(n.__this=c,n.__init=c.init,n.__release=c.release,n.__args=f),n}return n=Wn(t,o),s=n[1],s.__normalize===!1?n:(o&&s.key===void 0&&(s.key=i.join("-")),n.length>2?Jn(n,s,e,r,i,o,u):n)}return typeof t=="function"?ee(t(r),e,r,i,o,u):typeof t.toHiccup=="function"?ee(t.toHiccup(e.ctx),e,r,i,o,u):typeof t.deref=="function"?ee(t.deref(),e,r,i,o,u):u?["span",o?{key:i.join("-")}:{},t.toString()]:t.toString()}},Jn=(t,e,r,i,o,u,n)=>{const s=t[0],a=[s,e];n=n&&!Tn[s];for(let c=2,f=2,m=0,h=t.length;c<h;c++){let _=t[c];if(_!=null){const v=Re(_);if(v&&Re(_[0])||!v&&zn(_))for(let E of _)E=ee(E,r,i,o.concat(m),u,n),E!==void 0&&(a[f++]=E),m++;else _=ee(_,r,i,o.concat(m),u,n),_!==void 0&&(a[f++]=_),m++}}return a},Qn={createTree(t,e,r,i,o){return Pe(t,this,e,r,i,o)},hydrateTree(t,e,r,i){return Fe(t,this,e,r,i)},diffTree(t,e,r,i,o){Lt(t,this,e,r,i,o)},normalizeTree:Yn,getElementById(t){return document.getElementById(t)},getChild:Fn,createElement:Dn,createTextElement:Pn,replaceChild(t,e,r,i,o){Rn(t,this,e,r,i,o)},removeChild:$n,setContent:Un,removeAttribs:Gn,setAttrib:Yt},Xn=(t,e)=>Z(t)?e.getElementById(t):t,go=(t,e={},r=Qn)=>{const i=Object.assign({root:"app"},e);let o=[],u=!0;const n=Xn(i.root,r),s=()=>{if(u){i.ctx=Nn(e.ctx,i.autoDerefKeys);const a=r.normalizeTree(i,t);a!=null&&(i.hydrate?(r.hydrateTree(i,n,a),i.hydrate=!1):r.diffTree(i,n,o,a),o=a),u&&requestAnimationFrame(s)}};return requestAnimationFrame(s),()=>u=!1},Kn="--set-value",Zn="--update-value",ei="--toggle-value",it="--cancel",ti="--dispatch",ri="--dispatch-async",Jt="--dispatch-now",ni="--delay",ii="--fetch",L="--state",si="--redo",oi="--undo";let ne=Br;class ai{constructor(e,r){this.handlers={},this.effects={},this.eventQueue=[],this.priorities=[],this.addBuiltIns(),e&&this.addHandlers(e),r&&this.addEffects(r)}addBuiltIns(){this.addEffects({[ti]:[e=>this.dispatch(e),-999],[ri]:[([e,r,i,o],u,n)=>{const s=this.effects[e];if(s){const a=s(r,u,n);Yr(a)?a.then(c=>this.dispatch([i,c])).catch(c=>this.dispatch([o,c])):ne.warn("async effect did not return Promise")}else ne.warn(`skipping invalid async effect: ${e}`)},-999],[ni]:[([e,r])=>new Promise(i=>setTimeout(()=>i(r),e)),1e3],[ii]:[e=>fetch(e).then(r=>{if(!r.ok)throw new Error(r.statusText);return r}),1e3]})}addHandler(e,r){const i=this.interceptorsFromSpec(r);i.length>0?(this.handlers[e]&&(this.removeHandler(e),ne.warn(`overriding handler for ID: ${e}`)),this.handlers[e]=i):Ee(`no handlers in spec for ID: ${e}`)}addHandlers(e){for(let r in e)this.addHandler(r,e[r])}addEffect(e,r,i=1){this.effects[e]&&(this.removeEffect(e),ne.warn(`overriding effect for ID: ${e}`)),this.effects[e]=r;const o=[e,i],u=this.priorities;for(let n=0;n<u.length;n++)if(o[1]<u[n][1]){u.splice(n,0,o);return}u.push(o)}addEffects(e){for(let r in e){const i=e[r];Y(i)?this.addEffect(r,i[0],i[1]):this.addEffect(r,i)}}instrumentWith(e,r){const i=e.map(Qt),o=this.handlers;for(let u of r||Object.keys(o)){const n=o[u];n&&(o[u]=i.concat(n))}}removeHandler(e){delete this.handlers[e]}removeHandlers(e){for(let r of e)this.removeHandler(r)}removeEffect(e){delete this.effects[e];const r=this.priorities;for(let i=r.length-1;i>=0;i--)if(e===r[i][0]){r.splice(i,1);return}}removeEffects(e){for(let r of e)this.removeEffect(r)}context(){return this.currCtx}dispatch(...e){this.eventQueue.push(...e)}dispatchNow(...e){(this.currQueue||this.eventQueue).push(...e)}dispatchLater(e,r=17){setTimeout(()=>this.dispatch(e),r)}processQueue(e){if(this.eventQueue.length>0){this.currQueue=[...this.eventQueue],this.eventQueue.length=0,e=this.currCtx=e||{};for(let r of this.currQueue)this.processEvent(e,r);return this.currQueue=this.currCtx=void 0,this.processEffects(e),!0}return!1}processEvent(e,r){const i=this.handlers[r[0]];if(!i){ne.warn(`missing handler for event type: ${r[0].toString()}`);return}!this.processForward(e,i,r)||this.processReverse(e,i,r)}processForward(e,r,i){let o=!1;for(let u=0,n=r.length;u<n&&!e[it];u++){const s=r[u];s.pre&&this.mergeEffects(e,s.pre(e[L],i,this,e)),o=o||!!s.post}return o}processReverse(e,r,i){for(let o=r.length;--o>=0&&!e[it];){const u=r[o];u.post&&this.mergeEffects(e,u.post(e[L],i,this,e))}}processEffects(e){const r=this.effects;for(let i of this.priorities){const o=i[0],u=e[o];u!==void 0&&this.processEffect(e,r,o,u)}}processEffect(e,r,i,o){const u=r[i];if(i!==L)for(let n of o)u(n,this,e);else u(o,this,e)}mergeEffects(e,r){if(!!r)for(let i in r){const o=r[i];if(o!=null)if(i===L||i===it)e[i]=o;else if(i===Jt)if(Y(o[0]))for(let u of o)u&&this.dispatchNow(u);else this.dispatchNow(o);else if(e[i]||(e[i]=[]),Y(o[0]))for(let u of o)u!==void 0&&e[i].push(u);else e[i].push(o)}}interceptorsFromSpec(e){return Y(e)?e.map(Qt):Ke(e)?[{pre:e}]:[e]}}class yo extends ai{constructor(e,r,i){super(r,i);this.state=e||new rt({})}deref(){return this.state.deref()}addBuiltIns(){super.addBuiltIns(),this.addHandlers({[Kn]:(e,[r,[i,o]])=>({[L]:tt(e,i,o)}),[Zn]:(e,[r,[i,o,...u]])=>({[L]:Te(e,i,o,...u)}),[ei]:(e,[r,i])=>({[L]:Te(e,i,o=>!o)}),[oi]:Xt("undo"),[si]:Xt("redo")}),this.addEffects({[L]:[e=>this.state.reset(e),-1e3]})}processQueue(e){if(this.eventQueue.length>0){const r=this.state.deref();this.currQueue=[...this.eventQueue],this.eventQueue.length=0,e=this.currCtx=Object.assign(Object.assign({},e),{[L]:r});for(let i of this.currQueue)this.processEvent(e,i);return this.currQueue=this.currCtx=void 0,this.processEffects(e),this.state.deref()!==r}return!1}}const Qt=t=>Ke(t)?{pre:t}:t,Xt=t=>(e,[r,i],o,u)=>{const n=i?i[0]:"history";if(ce(u[n],t)){const s=u[n][t]();return{[L]:o.state.deref(),[Jt]:i?s!==void 0?i[1]:i[2]:void 0}}else ne.warn("no history in context")},bo=(t,e)=>{const r=Xr(t);return(i,[o,u])=>({[L]:r(i,e?e(u):u)})},_o=(t,e)=>{const r=en(t,e);return(i,[o,...u])=>({[L]:r(i,...u)})},Kt="route-changed";let st=class{constructor(e){if(e.authenticator=e.authenticator||((r,i,o)=>({id:r.id,title:r.title,params:o})),e.prefix=e.prefix===void 0?"/":e.prefix,e.separator=e.separator||"/",this.config=e,Se(this.routeForID(this.config.defaultRouteID)!==void 0,`missing config for default route: '${this.config.defaultRouteID}'`),e.initialRouteID){const r=this.routeForID(e.initialRouteID);Se(r!==void 0,`missing config for initial route: ${this.config.initialRouteID}`),Se(!ui(r),"initial route MUST not be parametric")}}addListener(e,r,i){}removeListener(e,r,i){}notify(e){}start(){if(this.config.initialRouteID){const e=this.routeForID(this.config.initialRouteID);this.current={id:e.id,title:e.title,params:{}},this.notify({id:Kt,value:this.current})}}route(e){e.charAt(0)==="#"&&(e=e.substr(1)),e=e.substr(this.config.prefix.length);let r=this.matchRoutes(e);if(!r){if(!this.handleRouteFailure())return;const i=this.routeForID(this.config.defaultRouteID);r={id:i.id,title:i.title,params:{}}}return J(r,this.current)||(this.current=r,this.notify({id:Kt,value:r})),r}format(...e){let[r,i,o]=e,u;switch(e.length){case 3:u={id:r,params:i};break;case 2:Z(r)?u={id:r,params:i}:(o=i,u=r);break;case 1:u=Z(r)?{id:r}:r;break;default:ue(e.length)}const n=this.routeForID(u.id);if(n){const s=u.params||{};return(o?"#":"")+this.config.prefix+n.match.map(a=>a.charAt(0)==="?"?(a=s[a.substr(1)])!=null?a:"NULL":a).join(this.config.separator)}else Ee(`invalid route ID: ${u.id}`)}routeForID(e){return this.config.routes.find(r=>r.id===e)}matchRoutes(e){const r=this.config.routes,i=e.split(this.config.separator);for(let o=0,u=r.length;o<u;o++){const n=this.matchRoute(i,r[o]);if(n)return n}}matchRoute(e,r){const i=r.match,o=i.length;if(e.length===o){const u={};for(let n=0;n<o;n++){const s=i[n];if(s.charAt(0)==="?")u[s.substr(1)]=e[n];else if(e[n]!==s)return}return r.validate&&!this.validateRouteParams(u,r.validate)?void 0:r.auth?this.config.authenticator(r,e,u):{id:r.id,title:r.title,params:u}}}validateRouteParams(e,r){for(let i in r)if(e[i]!==void 0){const o=r[i];if(o.coerce&&(e[i]=o.coerce(e[i])),o.check&&!o.check(e[i]))return!1}return!0}handleRouteFailure(){return!0}};st=kt([Hr],st);const ui=t=>t.match.some(e=>e.charAt(0)==="?");class Io extends st{constructor(e){super(e);this.useFragment=e.useFragment!==!1,this.ignoreHashChange=!1}start(){if(window.addEventListener("popstate",this.handlePopChange()),this.useFragment&&window.addEventListener("hashchange",this.handleHashChange()),this.config.initialRouteID){const e=this.routeForID(this.config.initialRouteID);this.route(this.format({id:e.id,title:e.title}))}else this.route(this.useFragment?location.hash:location.pathname)}release(){window.removeEventListener("popstate",this.popHandler),this.useFragment&&window.removeEventListener("hashchange",this.hashHandler)}route(e,r=!0){const i=this.current,o=super.route(e);return o&&!J(o,i)&&(this.currentPath=this.format(o),r&&history.pushState(this.currentPath,o.title||window.document.title||"",this.currentPath)),o}routeTo(e){this.useFragment&&(location.hash=e),this.route(e)}format(...e){let r;switch(e.length){case 2:r={id:e[0],params:e[1]};break;case 1:r=Z(e[0])?{id:e[0]}:e[0];break;default:ue(e.length)}return super.format(r,this.useFragment)}handlePopChange(){return this.popHandler=this.popHandler||(e=>{this.route(e.state||(this.useFragment?location.hash:location.pathname),!1)}).bind(this)}handleHashChange(){return this.hashHandler=this.hashHandler||(e=>{if(!this.ignoreHashChange){const r=e.newURL.substr(e.newURL.indexOf("#"));r!==this.currentPath&&this.route(r,!1)}}).bind(this)}handleRouteFailure(){return this.ignoreHashChange=!0,location.hash=this.format({id:this.routeForID(this.config.defaultRouteID).id}),this.ignoreHashChange=!1,!0}}const ci=([t,e,r],i)=>["option",{value:t,disabled:!!r,selected:t===i},e],So=(t,e,r,i)=>["select",e,...r.map(o=>ci(o,i))],he=t=>ce(t,"xform")?t.xform():t;class de{constructor(e){this.value=e}deref(){return this.value}}const fi=t=>new de(t),re=t=>t instanceof de,li=t=>t instanceof de?t:new de(t),Ue=t=>t instanceof de?t.deref():t,hi=t=>t.length===2?[void 0,t[1]]:t.length===3?[t[1],t[2]]:ue(t.length);function di(...t){const e=t[0],r=e[0],i=e[1],o=e[2];t=hi(t);const u=t[0]==null?r():t[0],n=t[1];return Ue(i(ce(n,"$reduce")?n.$reduce(o,u):zr(n)?pi(o,u,n):mi(o,u,n)))}const pi=(t,e,r)=>{for(let i=0,o=r.length;i<o;i++)if(e=t(e,r[i]),re(e)){e=e.deref();break}return e},mi=(t,e,r)=>{for(let i of r)if(e=t(e,i),re(e)){e=e.deref();break}return e},gi=(t,e)=>[t,r=>r,e];function Zt(t){return t?[...t]:gi(()=>[],(e,r)=>(e.push(r),e))}function*yi(t,e){const r=he(t)(Zt()),i=r[1],o=r[2];for(let u of e){const n=o([],u);if(re(n)){yield*Ue(i(n.deref()));return}n.length&&(yield*n)}yield*Ue(i([]))}function*ot(t,e){const r=he(t)([Qe,Qe,(i,o)=>o])[2];for(let i of e){let o=r(ae,i);if(re(o)){o=Ue(o.deref()),o!==ae&&(yield o);return}o!==ae&&(yield o)}}const er=(t,e,r=ot)=>{const i=e.length-1;return we(e[i])?e.length>1?r(t.apply(null,e.slice(0,i)),e[i]):r(t(),e[0]):void 0},at=(t,e)=>[t[0],t[1],e];function ie(t,e){return we(e)?ot(ie(t),e):r=>{const i=r[2];return at(r,(o,u)=>i(o,t(u)))}}function tr(...t){return bi(tr,di,t)}const bi=(t,e,r)=>{let i,o;switch(r.length){case 4:o=r[3],i=r[2];break;case 3:o=r[2];break;case 2:return ie(u=>t(r[0],r[1],u));default:ue(r.length)}return e(he(r[0])(r[1]),i,o)},_i=t=>{const{1:e,2:r}=he(t)(Zt());let i=!1;return o=>{if(!i){let u=r([],o);return i=re(u),i&&(u=e(u.deref())),u.length===1?u[0]:u.length>0?u:void 0}}};function rr(...t){let[e,r,i,o,u,n,s,a,c,f]=t;switch(t.length){case 0:ue(0);case 1:return e;case 2:return(...h)=>e(r(...h));case 3:return(...h)=>e(r(i(...h)));case 4:return(...h)=>e(r(i(o(...h))));case 5:return(...h)=>e(r(i(o(u(...h)))));case 6:return(...h)=>e(r(i(o(u(n(...h))))));case 7:return(...h)=>e(r(i(o(u(n(s(...h)))))));case 8:return(...h)=>e(r(i(o(u(n(s(a(...h))))))));case 9:return(...h)=>e(r(i(o(u(n(s(a(c(...h)))))))));case 10:default:const m=(...h)=>e(r(i(o(u(n(s(a(c(f(...h))))))))));return t.length===10?m:rr(m,...t.slice(10))}}function vi(...t){const[e,r,i,o,u,n,s,a]=t;switch(t.length){case 1:return c=>[e(c)];case 2:return c=>[e(c),r(c)];case 3:return c=>[e(c),r(c),i(c)];case 4:return c=>[e(c),r(c),i(c),o(c)];case 5:return c=>[e(c),r(c),i(c),o(c),u(c)];case 6:return c=>[e(c),r(c),i(c),o(c),u(c),n(c)];case 7:return c=>[e(c),r(c),i(c),o(c),u(c),n(c),s(c)];case 8:return c=>[e(c),r(c),i(c),o(c),u(c),n(c),s(c),a(c)];default:return c=>{let f=new Array(t.length);for(let m=t.length;--m>=0;)f[m]=t[m](c);return f}}}function Eo(t,e,r){return new Ii(t,e,r)}class Ii{constructor(e,r,i){e===void 0?(e=0,r=1/0):r===void 0&&(r=e,e=0),i=i===void 0?e<r?1:-1:i,this.from=e,this.to=r,this.step=i}*[Symbol.iterator](){let{from:e,to:r,step:i}=this;if(i>0)for(;e<r;)yield e,e+=i;else if(i<0)for(;e>r;)yield e,e+=i}$reduce(e,r){const i=this.step;if(i>0)for(let o=this.from,u=this.to;o<u&&!re(r);o+=i)r=e(r,o);else for(let o=this.from,u=this.to;o>u&&!re(r);o+=i)r=e(r,o);return r}}function*wo(...t){const e=t.map(r=>r[Symbol.iterator]());for(;;){const r=[];for(let i of e){let o=i.next();if(o.done)return;r.push(o.value)}yield r}}function nr(t,e){return we(e)?ot(nr(t),e):r=>{const i=r[2];return at(r,(o,u)=>t(u)?i(o,u):o)}}const Si=t=>((t==null||!t[Symbol.iterator])&&Ee(`value is not iterable: ${t}`),t),Ei=t=>Y(t)?t:[...Si(t)],ir=1/4294967295;class wi{float(e=1){return this.int()*ir*e}norm(e=1){return(this.int()*ir-.5)*2*e}minmax(e,r){return this.float()*(r-e)+e}}const ut=Math.random;class Mi extends wi{int(){return ut()*4294967296>>>0}float(e=1){return ut()*e}norm(e=1){return(ut()-.5)*2*e}}const sr=new Mi,Ti=(t,e,r=sr)=>{const i=t.length;Se(i>0,"no choices given");const o=e?t.map((n,s)=>[e[s]||0,n]).sort((n,s)=>s[0]-n[0]):t.map(n=>[1,n]),u=o.reduce((n,s)=>n+s[0],0);return u<=0&&console.warn("total weights <= 0"),()=>{const n=r.float(u);let s=u;for(let a=0;a<i;a++)if(s-=o[a][0],s<=n)return o[a][1]}};function or(...t){return t=t.map(he),rr.apply(null,t)}function Ai(t,e){return we(e)?yi(Ai(t),e):r=>{const i=r[2];let o=t;return at(r,(u,n)=>--o>0?i(u,n):o===0?li(i(u,n)):fi(u))}}function ki(...t){return ie(vi.apply(null,t.map(_i)))}const Ci=t=>{const e=Object.keys(t),[r,i,o]=e,[u,n,s]=e.map(a=>t[a]);switch(e.length){case 3:return a=>{const c={};let f;return f=a[s],f!==void 0&&(c[o]=f),f=a[n],f!==void 0&&(c[i]=f),f=a[u],f!==void 0&&(c[r]=f),c};case 2:return a=>{const c={};let f;return f=a[n],f!==void 0&&(c[i]=f),f=a[u],f!==void 0&&(c[r]=f),c};case 1:return a=>{const c={};let f=a[u];return f!==void 0&&(c[r]=f),c};default:return a=>{let c,f;const m={};for(let h=e.length-1;h>=0;h--)c=e[h],f=a[t[c]],f!==void 0&&(m[c]=f);return m}}};function ar(...t){const e=t.length>2&&er(ar,t);if(e)return e;let r=t[0];if(Y(r)&&(r=r.reduce((i,o,u)=>(i[o]=u,i),{})),t[1]){const i=Object.keys(r);return ie(o=>tr(or(ie(u=>[u,o[r[u]]]),nr(u=>u[1]!==void 0)),t[1],i))}else return ie(Ci(r))}function Ni(...t){const e=er(Ni,t);if(e)return e;const[r,i]=t,o=Object.keys(r);return or(ki.apply(null,o.map(u=>r[u])),ar(o,i))}function*xi(t,e=1/0){for(let r=0;r<e;r++)yield t(r)}const Mo=(t,e,r=sr)=>xi(e?Ti(Ei(t),e,r):()=>t[r.float(t.length)|0]);function*To(t,e=1/0){for(;e-- >0;)yield t}const Ao=t=>{const e=Object.assign({element:"h1",attribs:{},subElement:"small",subAttribs:{}},t);return(r,i,o)=>[e.element,e.attribs,i,o?[e.subElement,e.subAttribs,o]:void 0]},Oi={anim:100,pad:1,margin:0,vertical:!1,bgOn:{fill:"#000"},bgOff:{fill:"#999"},fgOn:{fill:"#fff"},fgOff:{fill:"#fff"}},ko=(t={})=>{const e=Object.assign(Object.assign({w:10,h:10},Oi),t),{w:r,h:i,pad:o,margin:u,vertical:n}=e,s=u*2,a=o+u,c=n?r+o*2:(r+o)*2,f=n?(i+o)*2:i+o*2,m={width:c+s,height:f+s},h={transition:`all ${e.anim}ms ease-out`},_=Object.assign(Object.assign({},e.bgOn),{width:c,height:f,x:u,y:u}),v=Object.assign(Object.assign({},_),e.bgOff),E=Object.assign(Object.assign(Object.assign({},n?{x:a,y:a}:{x:c+u-o-r,y:a}),e.fgOn),{style:h,width:r,height:i}),C=Object.assign(Object.assign(Object.assign({},E),n?{y:f+u-o-i}:{x:a}),e.fgOff);return(k,F,O)=>["svg",Object.assign(Object.assign({},m),F),["rect",O?_:v],["rect",O?E:C]]};var Q=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},ur={exports:{}};(function(t){(function(e){function r(){if(r.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");(r.prototype._singleton=this)._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._nrpnBuffer=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],this._nrpnEventsEnabled=!0,this._nrpnTypes=["entry","increment","decrement"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,nrpn:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_NRPN_MESSAGES:{value:{entrymsb:6,entrylsb:38,increment:96,decrement:97,paramlsb:98,parammsb:99,nullactiveparameter:127},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1},octaveOffset:{value:0,writable:!0,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return this.interface!==void 0}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this.interface||!this.interface.sysexEnabled)}.bind(this)},nrpnEventsEnabled:{enumerable:!0,get:function(){return!!this._nrpnEventsEnabled}.bind(this),set:function(n){return this._nrpnEventsEnabled=n,this._nrpnEventsEnabled}},nrpnTypes:{enumerable:!0,get:function(){return this._nrpnTypes}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}var i=new r;function o(n){var s=this;this._userHandlers={channel:{},system:{}},this._midiInput=n,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return s._midiInput.connection}},id:{enumerable:!0,get:function(){return s._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return s._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return s._midiInput.name}},state:{enumerable:!0,get:function(){return s._midiInput.state}},type:{enumerable:!0,get:function(){return s._midiInput.type}}}),this._initializeUserHandlers(),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}function u(n){var s=this;this._midiOutput=n,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return s._midiOutput.connection}},id:{enumerable:!0,get:function(){return s._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return s._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return s._midiOutput.name}},state:{enumerable:!0,get:function(){return s._midiOutput.state}},type:{enumerable:!0,get:function(){return s._midiOutput.type}}})}r.prototype.enable=function(n,s){this.enabled||(this.supported?navigator.requestMIDIAccess({sysex:s}).then(function(a){var c,f=[],m=[];this.interface=a,this._resetInterfaceUserHandlers(),this.interface.onstatechange=function(k){f.push(k)};for(var h=a.inputs.values(),_=h.next();_&&!_.done;_=h.next())m.push(_.value.open());for(var v=a.outputs.values(),E=v.next();E&&!E.done;E=v.next())m.push(E.value.open());function C(){clearTimeout(c),this._updateInputsAndOutputs(),this.interface.onstatechange=this._onInterfaceStateChange.bind(this),typeof n=="function"&&n.call(this),f.forEach(function(k){this._onInterfaceStateChange(k)}.bind(this))}c=setTimeout(C.bind(this),200),Promise&&Promise.all(m).catch(function(k){}).then(C.bind(this))}.bind(this),function(a){typeof n=="function"&&n.call(this,a)}.bind(this)):typeof n=="function"&&n(new Error("The Web MIDI API is not supported by your browser.")))},r.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this.enabled&&(this.removeListener(),this.inputs.forEach(function(n){n.removeListener()})),this.interface&&(this.interface.onstatechange=void 0),this.interface=void 0,this._inputs=[],this._outputs=[],this._nrpnEventsEnabled=!0,this._resetInterfaceUserHandlers()},r.prototype.addListener=function(n,s){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if(typeof s!="function")throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(n)))throw new TypeError("The specified event type is not supported.");return this._userHandlers[n].push(s),this},r.prototype.hasListener=function(n,s){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if(typeof s!="function")throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(n)))throw new TypeError("The specified event type is not supported.");for(var a=0;a<this._userHandlers[n].length;a++)if(this._userHandlers[n][a]===s)return!0;return!1},r.prototype.removeListener=function(n,s){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(s!==void 0&&typeof s!="function")throw new TypeError("The 'listener' parameter must be a function.");if(0<=this._midiInterfaceEvents.indexOf(n))if(s)for(var a=0;a<this._userHandlers[n].length;a++)this._userHandlers[n][a]===s&&this._userHandlers[n].splice(a,1);else this._userHandlers[n]=[];else{if(n!==void 0)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},r.prototype.toMIDIChannels=function(n){var s;if(n==="all"||n===void 0)s=["all"];else{if(n==="none")return s=[];s=Array.isArray(n)?n:[n]}return-1<s.indexOf("all")&&(s=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),s.map(function(a){return parseInt(a)}).filter(function(a){return 1<=a&&a<=16})},r.prototype.getInputById=function(n){if(!this.enabled)throw new Error("WebMidi is not enabled.");n=String(n);for(var s=0;s<this.inputs.length;s++)if(this.inputs[s].id===n)return this.inputs[s];return!1},r.prototype.getOutputById=function(n){if(!this.enabled)throw new Error("WebMidi is not enabled.");n=String(n);for(var s=0;s<this.outputs.length;s++)if(this.outputs[s].id===n)return this.outputs[s];return!1},r.prototype.getInputByName=function(n){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var s=0;s<this.inputs.length;s++)if(~this.inputs[s].name.indexOf(n))return this.inputs[s];return!1},r.prototype.getOctave=function(n){if(n!=null&&0<=n&&n<=127)return Math.floor(Math.floor(n)/12-1)+Math.floor(i.octaveOffset)},r.prototype.getOutputByName=function(n){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var s=0;s<this.outputs.length;s++)if(~this.outputs[s].name.indexOf(n))return this.outputs[s];return!1},r.prototype.guessNoteNumber=function(n){var s=!1;if(n&&n.toFixed&&0<=n&&n<=127?s=Math.round(n):0<=parseInt(n)&&parseInt(n)<=127?s=parseInt(n):(typeof n=="string"||n instanceof String)&&(s=this.noteNameToNumber(n)),s===!1)throw new Error("Invalid input value ("+n+").");return s},r.prototype.noteNameToNumber=function(n){typeof n!="string"&&(n="");var s=n.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!s)throw new RangeError("Invalid note name.");var a=i._semitones[s[1].toUpperCase()],c=12*(parseInt(s[3])+1-Math.floor(i.octaveOffset))+a;if(-1<s[2].toLowerCase().indexOf("b")?c-=s[2].length:-1<s[2].toLowerCase().indexOf("#")&&(c+=s[2].length),c<0||127<c)throw new RangeError("Invalid note name or note outside valid range.");return c},r.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},r.prototype._updateInputs=function(){for(var n=0;n<this._inputs.length;n++){for(var s=!0,a=this.interface.inputs.values(),c=a.next();c&&!c.done;c=a.next())if(this._inputs[n]._midiInput===c.value){s=!1;break}s&&this._inputs.splice(n,1)}this.interface&&this.interface.inputs.forEach(function(f){for(var m=!0,h=0;h<this._inputs.length;h++)this._inputs[h]._midiInput===f&&(m=!1);m&&this._inputs.push(new o(f))}.bind(this))},r.prototype._updateOutputs=function(){for(var n=0;n<this._outputs.length;n++){for(var s=!0,a=this.interface.outputs.values(),c=a.next();c&&!c.done;c=a.next())if(this._outputs[n]._midiOutput===c.value){s=!1;break}s&&this._outputs.splice(n,1)}this.interface&&this.interface.outputs.forEach(function(f){for(var m=!0,h=0;h<this._outputs.length;h++)this._outputs[h]._midiOutput===f&&(m=!1);m&&this._outputs.push(new u(f))}.bind(this))},r.prototype._onInterfaceStateChange=function(n){this._updateInputsAndOutputs();var s={timestamp:n.timeStamp,type:n.port.state};this.interface&&n.port.state==="connected"?n.port.type==="output"?s.port=this.getOutputById(n.port.id):n.port.type==="input"&&(s.port=this.getInputById(n.port.id)):s.port={connection:"closed",id:n.port.id,manufacturer:n.port.manufacturer,name:n.port.name,state:n.port.state,type:n.port.type},this._userHandlers[n.port.state].forEach(function(a){a(s)})},r.prototype._resetInterfaceUserHandlers=function(){for(var n=0;n<this._midiInterfaceEvents.length;n++)this._userHandlers[this._midiInterfaceEvents[n]]=[]},o.prototype.on=o.prototype.addListener=function(n,s,a){var c=this;if(s===void 0&&(s="all"),Array.isArray(s)||(s=[s]),s.forEach(function(m){if(m!=="all"&&!(1<=m&&m<=16))throw new RangeError("The 'channel' parameter is invalid.")}),typeof a!="function")throw new TypeError("The 'listener' parameter must be a function.");if(i.MIDI_SYSTEM_MESSAGES[n]!==void 0)this._userHandlers.system[n]||(this._userHandlers.system[n]=[]),this._userHandlers.system[n].push(a);else{if(i.MIDI_CHANNEL_MESSAGES[n]===void 0)throw new TypeError("The specified event type is not supported.");if(-1<s.indexOf("all")){s=[];for(var f=1;f<=16;f++)s.push(f)}this._userHandlers.channel[n]||(this._userHandlers.channel[n]=[]),s.forEach(function(m){c._userHandlers.channel[n][m]||(c._userHandlers.channel[n][m]=[]),c._userHandlers.channel[n][m].push(a)})}return this},o.prototype.hasListener=function(n,s,a){var c=this;if(typeof a!="function")throw new TypeError("The 'listener' parameter must be a function.");if(s===void 0&&(s="all"),s.constructor!==Array&&(s=[s]),i.MIDI_SYSTEM_MESSAGES[n]!==void 0){for(var f=0;f<this._userHandlers.system[n].length;f++)if(this._userHandlers.system[n][f]===a)return!0}else if(i.MIDI_CHANNEL_MESSAGES[n]!==void 0){if(-1<s.indexOf("all")){s=[];for(var m=1;m<=16;m++)s.push(m)}return!!this._userHandlers.channel[n]&&s.every(function(h){var _=c._userHandlers.channel[n][h];return _&&-1<_.indexOf(a)})}return!1},o.prototype.removeListener=function(n,s,a){var c=this;if(a!==void 0&&typeof a!="function")throw new TypeError("The 'listener' parameter must be a function.");if(s===void 0&&(s="all"),s.constructor!==Array&&(s=[s]),i.MIDI_SYSTEM_MESSAGES[n]!==void 0)if(a===void 0)this._userHandlers.system[n]=[];else for(var f=0;f<this._userHandlers.system[n].length;f++)this._userHandlers.system[n][f]===a&&this._userHandlers.system[n].splice(f,1);else if(i.MIDI_CHANNEL_MESSAGES[n]!==void 0){if(-1<s.indexOf("all")){s=[];for(var m=1;m<=16;m++)s.push(m)}if(!this._userHandlers.channel[n])return this;s.forEach(function(h){var _=c._userHandlers.channel[n][h];if(_)if(a===void 0)c._userHandlers.channel[n][h]=[];else for(var v=0;v<_.length;v++)_[v]===a&&_.splice(v,1)})}else{if(n!==void 0)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},o.prototype._initializeUserHandlers=function(){for(var n in i.MIDI_CHANNEL_MESSAGES)Object.prototype.hasOwnProperty.call(i.MIDI_CHANNEL_MESSAGES,n)&&(this._userHandlers.channel[n]={});for(var s in i.MIDI_SYSTEM_MESSAGES)Object.prototype.hasOwnProperty.call(i.MIDI_SYSTEM_MESSAGES,s)&&(this._userHandlers.system[s]=[])},o.prototype._onMidiMessage=function(n){if(0<this._userHandlers.system.midimessage.length){var s={target:this,data:n.data,timestamp:n.timeStamp,type:"midimessage"};this._userHandlers.system.midimessage.forEach(function(a){a(s)})}n.data[0]<240?(this._parseChannelEvent(n),this._parseNrpnEvent(n)):n.data[0]<=255&&this._parseSystemEvent(n)},o.prototype._parseNrpnEvent=function(n){var s,a,c=n.data[0]>>4,f=15&n.data[0],m=1+f;if(1<n.data.length&&(s=n.data[1],a=2<n.data.length?n.data[2]:void 0),i.nrpnEventsEnabled&&c===i.MIDI_CHANNEL_MESSAGES.controlchange&&(s>=i.MIDI_NRPN_MESSAGES.increment&&s<=i.MIDI_NRPN_MESSAGES.parammsb||s===i.MIDI_NRPN_MESSAGES.entrymsb||s===i.MIDI_NRPN_MESSAGES.entrylsb)){var h={target:this,type:"controlchange",data:n.data,timestamp:n.timeStamp,channel:m,controller:{number:s,name:this.getCcNameByNumber(s)},value:a};if(h.controller.number===i.MIDI_NRPN_MESSAGES.parammsb&&h.value!=i.MIDI_NRPN_MESSAGES.nullactiveparameter)i._nrpnBuffer[f]=[],i._nrpnBuffer[f][0]=h;else if(i._nrpnBuffer[f].length===1&&h.controller.number===i.MIDI_NRPN_MESSAGES.paramlsb)i._nrpnBuffer[f].push(h);else if(i._nrpnBuffer[f].length!==2||h.controller.number!==i.MIDI_NRPN_MESSAGES.increment&&h.controller.number!==i.MIDI_NRPN_MESSAGES.decrement&&h.controller.number!==i.MIDI_NRPN_MESSAGES.entrymsb)if(i._nrpnBuffer[f].length===3&&i._nrpnBuffer[f][2].number===i.MIDI_NRPN_MESSAGES.entrymsb&&h.controller.number===i.MIDI_NRPN_MESSAGES.entrylsb)i._nrpnBuffer[f].push(h);else if(3<=i._nrpnBuffer[f].length&&i._nrpnBuffer[f].length<=4&&h.controller.number===i.MIDI_NRPN_MESSAGES.parammsb&&h.value===i.MIDI_NRPN_MESSAGES.nullactiveparameter)i._nrpnBuffer[f].push(h);else if(4<=i._nrpnBuffer[f].length&&i._nrpnBuffer[f].length<=5&&h.controller.number===i.MIDI_NRPN_MESSAGES.paramlsb&&h.value===i.MIDI_NRPN_MESSAGES.nullactiveparameter){i._nrpnBuffer[f].push(h);var _=[];i._nrpnBuffer[f].forEach(function(F){_.push(F.data)});var v=i._nrpnBuffer[f][0].value<<7|i._nrpnBuffer[f][1].value,E=i._nrpnBuffer[f][2].value;i._nrpnBuffer[f].length===6&&(E=i._nrpnBuffer[f][2].value<<7|i._nrpnBuffer[f][3].value);var C="";switch(i._nrpnBuffer[f][2].controller.number){case i.MIDI_NRPN_MESSAGES.entrymsb:C=i._nrpnTypes[0];break;case i.MIDI_NRPN_MESSAGES.increment:C=i._nrpnTypes[1];break;case i.MIDI_NRPN_MESSAGES.decrement:C=i._nrpnTypes[2];break;default:throw new Error("The NPRN type was unidentifiable.")}var k={timestamp:h.timestamp,channel:h.channel,type:"nrpn",data:_,controller:{number:v,type:C,name:"Non-Registered Parameter "+v},value:E};i._nrpnBuffer[f]=[],this._userHandlers.channel[k.type]&&this._userHandlers.channel[k.type][k.channel]&&this._userHandlers.channel[k.type][k.channel].forEach(function(F){F(k)})}else i._nrpnBuffer[f]=[];else i._nrpnBuffer[f].push(h)}},o.prototype._parseChannelEvent=function(n){var s,a,c=n.data[0]>>4,f=1+(15&n.data[0]);1<n.data.length&&(s=n.data[1],a=2<n.data.length?n.data[2]:void 0);var m={target:this,data:n.data,timestamp:n.timeStamp,channel:f};c===i.MIDI_CHANNEL_MESSAGES.noteoff||c===i.MIDI_CHANNEL_MESSAGES.noteon&&a===0?(m.type="noteoff",m.note={number:s,name:i._notes[s%12],octave:i.getOctave(s)},m.velocity=a/127,m.rawVelocity=a):c===i.MIDI_CHANNEL_MESSAGES.noteon?(m.type="noteon",m.note={number:s,name:i._notes[s%12],octave:i.getOctave(s)},m.velocity=a/127,m.rawVelocity=a):c===i.MIDI_CHANNEL_MESSAGES.keyaftertouch?(m.type="keyaftertouch",m.note={number:s,name:i._notes[s%12],octave:i.getOctave(s)},m.value=a/127):c===i.MIDI_CHANNEL_MESSAGES.controlchange&&0<=s&&s<=119?(m.type="controlchange",m.controller={number:s,name:this.getCcNameByNumber(s)},m.value=a):c===i.MIDI_CHANNEL_MESSAGES.channelmode&&120<=s&&s<=127?(m.type="channelmode",m.controller={number:s,name:this.getChannelModeByNumber(s)},m.value=a):c===i.MIDI_CHANNEL_MESSAGES.programchange?(m.type="programchange",m.value=s):c===i.MIDI_CHANNEL_MESSAGES.channelaftertouch?(m.type="channelaftertouch",m.value=s/127):c===i.MIDI_CHANNEL_MESSAGES.pitchbend?(m.type="pitchbend",m.value=((a<<7)+s-8192)/8192):m.type="unknownchannelmessage",this._userHandlers.channel[m.type]&&this._userHandlers.channel[m.type][f]&&this._userHandlers.channel[m.type][f].forEach(function(h){h(m)})},o.prototype.getCcNameByNumber=function(n){if(!(0<=(n=Math.floor(n))&&n<=119))throw new RangeError("The control change number must be between 0 and 119.");for(var s in i.MIDI_CONTROL_CHANGE_MESSAGES)if(Object.prototype.hasOwnProperty.call(i.MIDI_CONTROL_CHANGE_MESSAGES,s)&&n===i.MIDI_CONTROL_CHANGE_MESSAGES[s])return s},o.prototype.getChannelModeByNumber=function(n){if(!(120<=(n=Math.floor(n))&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var s in i.MIDI_CHANNEL_MODE_MESSAGES)if(Object.prototype.hasOwnProperty.call(i.MIDI_CHANNEL_MODE_MESSAGES,s)&&n===i.MIDI_CHANNEL_MODE_MESSAGES[s])return s},o.prototype._parseSystemEvent=function(n){var s=n.data[0],a={target:this,data:n.data,timestamp:n.timeStamp};s===i.MIDI_SYSTEM_MESSAGES.sysex?a.type="sysex":s===i.MIDI_SYSTEM_MESSAGES.timecode?a.type="timecode":s===i.MIDI_SYSTEM_MESSAGES.songposition?a.type="songposition":s===i.MIDI_SYSTEM_MESSAGES.songselect?(a.type="songselect",a.song=n.data[1]):s===i.MIDI_SYSTEM_MESSAGES.tuningrequest?a.type="tuningrequest":s===i.MIDI_SYSTEM_MESSAGES.clock?a.type="clock":s===i.MIDI_SYSTEM_MESSAGES.start?a.type="start":s===i.MIDI_SYSTEM_MESSAGES.continue?a.type="continue":s===i.MIDI_SYSTEM_MESSAGES.stop?a.type="stop":s===i.MIDI_SYSTEM_MESSAGES.activesensing?a.type="activesensing":s===i.MIDI_SYSTEM_MESSAGES.reset?a.type="reset":a.type="unknownsystemmessage",this._userHandlers.system[a.type]&&this._userHandlers.system[a.type].forEach(function(c){c(a)})},u.prototype.send=function(n,s,a){if(!(128<=n&&n<=255))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");s===void 0&&(s=[]),Array.isArray(s)||(s=[s]);var c=[];return s.forEach(function(f){var m=Math.floor(f);if(!(0<=m&&m<=255))throw new RangeError("Data bytes must be integers between 0 (0x00) and 255 (0xFF).");c.push(m)}),this._midiOutput.send([n].concat(c),parseFloat(a)||0),this},u.prototype.sendSysex=function(n,s,a){if(!i.sysexEnabled)throw new Error("Sysex message support must first be activated.");return a=a||{},n=[].concat(n),s.forEach(function(c){if(c<0||127<c)throw new RangeError("The data bytes of a sysex message must be integers between 0 (0x00) and 127 (0x7F).")}),s=n.concat(s,i.MIDI_SYSTEM_MESSAGES.sysexend),this.send(i.MIDI_SYSTEM_MESSAGES.sysex,s,this._parseTimeParameter(a.time)),this},u.prototype.sendTimecodeQuarterFrame=function(n,s){return s=s||{},this.send(i.MIDI_SYSTEM_MESSAGES.timecode,n,this._parseTimeParameter(s.time)),this},u.prototype.sendSongPosition=function(n,s){s=s||{};var a=(n=Math.floor(n)||0)>>7&127,c=127&n;return this.send(i.MIDI_SYSTEM_MESSAGES.songposition,[a,c],this._parseTimeParameter(s.time)),this},u.prototype.sendSongSelect=function(n,s){if(s=s||{},!(0<=(n=Math.floor(n))&&n<=127))throw new RangeError("The song number must be between 0 and 127.");return this.send(i.MIDI_SYSTEM_MESSAGES.songselect,[n],this._parseTimeParameter(s.time)),this},u.prototype.sendTuningRequest=function(n){return n=n||{},this.send(i.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(n.time)),this},u.prototype.sendClock=function(n){return n=n||{},this.send(i.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(n.time)),this},u.prototype.sendStart=function(n){return n=n||{},this.send(i.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(n.time)),this},u.prototype.sendContinue=function(n){return n=n||{},this.send(i.MIDI_SYSTEM_MESSAGES.continue,void 0,this._parseTimeParameter(n.time)),this},u.prototype.sendStop=function(n){return n=n||{},this.send(i.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(n.time)),this},u.prototype.sendActiveSensing=function(n){return n=n||{},this.send(i.MIDI_SYSTEM_MESSAGES.activesensing,[],this._parseTimeParameter(n.time)),this},u.prototype.sendReset=function(n){return n=n||{},this.send(i.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(n.time)),this},u.prototype.stopNote=function(n,s,a){if(n==="all")return this.sendChannelMode("allnotesoff",0,s,a);var c=64;return(a=a||{}).rawVelocity?!isNaN(a.velocity)&&0<=a.velocity&&a.velocity<=127&&(c=a.velocity):!isNaN(a.velocity)&&0<=a.velocity&&a.velocity<=1&&(c=127*a.velocity),this._convertNoteToArray(n).forEach(function(f){i.toMIDIChannels(s).forEach(function(m){this.send((i.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(m-1),[f,Math.round(c)],this._parseTimeParameter(a.time))}.bind(this))}.bind(this)),this},u.prototype.playNote=function(n,s,a){var c,f=64;if((a=a||{}).rawVelocity?!isNaN(a.velocity)&&0<=a.velocity&&a.velocity<=127&&(f=a.velocity):!isNaN(a.velocity)&&0<=a.velocity&&a.velocity<=1&&(f=127*a.velocity),c=this._parseTimeParameter(a.time),this._convertNoteToArray(n).forEach(function(h){i.toMIDIChannels(s).forEach(function(_){this.send((i.MIDI_CHANNEL_MESSAGES.noteon<<4)+(_-1),[h,Math.round(f)],c)}.bind(this))}.bind(this)),!isNaN(a.duration)){a.duration<=0&&(a.duration=0);var m=64;a.rawVelocity?!isNaN(a.release)&&0<=a.release&&a.release<=127&&(m=a.release):!isNaN(a.release)&&0<=a.release&&a.release<=1&&(m=127*a.release),this._convertNoteToArray(n).forEach(function(h){i.toMIDIChannels(s).forEach(function(_){this.send((i.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(_-1),[h,Math.round(m)],(c||i.time)+a.duration)}.bind(this))}.bind(this))}return this},u.prototype.sendKeyAftertouch=function(n,s,a,c){var f=this;if(c=c||{},s<1||16<s)throw new RangeError("The channel must be between 1 and 16.");(isNaN(a)||a<0||1<a)&&(a=.5);var m=Math.round(127*a);return this._convertNoteToArray(n).forEach(function(h){i.toMIDIChannels(s).forEach(function(_){f.send((i.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(_-1),[h,m],f._parseTimeParameter(c.time))})}),this},u.prototype.sendControlChange=function(n,s,a,c){if(c=c||{},typeof n=="string"){if((n=i.MIDI_CONTROL_CHANGE_MESSAGES[n])===void 0)throw new TypeError("Invalid controller name.")}else if(!(0<=(n=Math.floor(n))&&n<=119))throw new RangeError("Controller numbers must be between 0 and 119.");if(!(0<=(s=Math.floor(s)||0)&&s<=127))throw new RangeError("Controller value must be between 0 and 127.");return i.toMIDIChannels(a).forEach(function(f){this.send((i.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(f-1),[n,s],this._parseTimeParameter(c.time))}.bind(this)),this},u.prototype._selectRegisteredParameter=function(n,s,a){var c=this;if(n[0]=Math.floor(n[0]),!(0<=n[0]&&n[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(n[1]=Math.floor(n[1]),!(0<=n[1]&&n[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return i.toMIDIChannels(s).forEach(function(){c.sendControlChange(101,n[0],s,{time:a}),c.sendControlChange(100,n[1],s,{time:a})}),this},u.prototype._selectNonRegisteredParameter=function(n,s,a){var c=this;if(n[0]=Math.floor(n[0]),!(0<=n[0]&&n[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(n[1]=Math.floor(n[1]),!(0<=n[1]&&n[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return i.toMIDIChannels(s).forEach(function(){c.sendControlChange(99,n[0],s,{time:a}),c.sendControlChange(98,n[1],s,{time:a})}),this},u.prototype._setCurrentRegisteredParameter=function(n,s,a){var c=this;if((n=[].concat(n))[0]=Math.floor(n[0]),!(0<=n[0]&&n[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return i.toMIDIChannels(s).forEach(function(){c.sendControlChange(6,n[0],s,{time:a})}),n[1]=Math.floor(n[1]),0<=n[1]&&n[1]<=127&&i.toMIDIChannels(s).forEach(function(){c.sendControlChange(38,n[1],s,{time:a})}),this},u.prototype._deselectRegisteredParameter=function(n,s){var a=this;return i.toMIDIChannels(n).forEach(function(){a.sendControlChange(101,127,n,{time:s}),a.sendControlChange(100,127,n,{time:s})}),this},u.prototype.setRegisteredParameter=function(n,s,a,c){var f=this;if(c=c||{},!Array.isArray(n)){if(!i.MIDI_REGISTERED_PARAMETER[n])throw new Error("The specified parameter is not available.");n=i.MIDI_REGISTERED_PARAMETER[n]}return i.toMIDIChannels(a).forEach(function(){f._selectRegisteredParameter(n,a,c.time),f._setCurrentRegisteredParameter(s,a,c.time),f._deselectRegisteredParameter(a,c.time)}),this},u.prototype.setNonRegisteredParameter=function(n,s,a,c){var f=this;if(c=c||{},!(0<=n[0]&&n[0]<=127&&0<=n[1]&&n[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return s=[].concat(s),i.toMIDIChannels(a).forEach(function(){f._selectNonRegisteredParameter(n,a,c.time),f._setCurrentRegisteredParameter(s,a,c.time),f._deselectRegisteredParameter(a,c.time)}),this},u.prototype.incrementRegisteredParameter=function(n,s,a){var c=this;if(a=a||{},!Array.isArray(n)){if(!i.MIDI_REGISTERED_PARAMETER[n])throw new Error("The specified parameter is not available.");n=i.MIDI_REGISTERED_PARAMETER[n]}return i.toMIDIChannels(s).forEach(function(){c._selectRegisteredParameter(n,s,a.time),c.sendControlChange(96,0,s,{time:a.time}),c._deselectRegisteredParameter(s,a.time)}),this},u.prototype.decrementRegisteredParameter=function(n,s,a){if(a=a||{},!Array.isArray(n)){if(!i.MIDI_REGISTERED_PARAMETER[n])throw new TypeError("The specified parameter is not available.");n=i.MIDI_REGISTERED_PARAMETER[n]}return i.toMIDIChannels(s).forEach(function(){this._selectRegisteredParameter(n,s,a.time),this.sendControlChange(97,0,s,{time:a.time}),this._deselectRegisteredParameter(s,a.time)}.bind(this)),this},u.prototype.setPitchBendRange=function(n,s,a,c){var f=this;if(c=c||{},!(0<=(n=Math.floor(n)||0)&&n<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(s=Math.floor(s)||0)&&s<=127))throw new RangeError("The cents value must be between 0 and 127");return i.toMIDIChannels(a).forEach(function(){f.setRegisteredParameter("pitchbendrange",[n,s],a,{time:c.time})}),this},u.prototype.setModulationRange=function(n,s,a,c){var f=this;if(c=c||{},!(0<=(n=Math.floor(n)||0)&&n<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(s=Math.floor(s)||0)&&s<=127))throw new RangeError("The cents value must be between 0 and 127");return i.toMIDIChannels(a).forEach(function(){f.setRegisteredParameter("modulationrange",[n,s],a,{time:c.time})}),this},u.prototype.setMasterTuning=function(n,s,a){var c=this;if(a=a||{},(n=parseFloat(n)||0)<=-65||64<=n)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var f=Math.floor(n)+64,m=n-Math.floor(n),h=(m=Math.round((m+1)/2*16383))>>7&127,_=127&m;return i.toMIDIChannels(s).forEach(function(){c.setRegisteredParameter("channelcoarsetuning",f,s,{time:a.time}),c.setRegisteredParameter("channelfinetuning",[h,_],s,{time:a.time})}),this},u.prototype.setTuningProgram=function(n,s,a){var c=this;if(a=a||{},!(0<=(n=Math.floor(n))&&n<=127))throw new RangeError("The program value must be between 0 and 127");return i.toMIDIChannels(s).forEach(function(){c.setRegisteredParameter("tuningprogram",n,s,{time:a.time})}),this},u.prototype.setTuningBank=function(n,s,a){var c=this;if(a=a||{},!(0<=(n=Math.floor(n)||0)&&n<=127))throw new RangeError("The bank value must be between 0 and 127");return i.toMIDIChannels(s).forEach(function(){c.setRegisteredParameter("tuningbank",n,s,{time:a.time})}),this},u.prototype.sendChannelMode=function(n,s,a,c){if(c=c||{},typeof n=="string"){if(!(n=i.MIDI_CHANNEL_MODE_MESSAGES[n]))throw new TypeError("Invalid channel mode message name.")}else if(!(120<=(n=Math.floor(n))&&n<=127))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if((s=Math.floor(s)||0)<0||127<s)throw new RangeError("Value must be an integer between 0 and 127.");return i.toMIDIChannels(a).forEach(function(f){this.send((i.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(f-1),[n,s],this._parseTimeParameter(c.time))}.bind(this)),this},u.prototype.sendProgramChange=function(n,s,a){var c=this;if(a=a||{},n=Math.floor(n),isNaN(n)||n<0||127<n)throw new RangeError("Program numbers must be between 0 and 127.");return i.toMIDIChannels(s).forEach(function(f){c.send((i.MIDI_CHANNEL_MESSAGES.programchange<<4)+(f-1),[n],c._parseTimeParameter(a.time))}),this},u.prototype.sendChannelAftertouch=function(n,s,a){var c=this;a=a||{},n=parseFloat(n),(isNaN(n)||n<0||1<n)&&(n=.5);var f=Math.round(127*n);return i.toMIDIChannels(s).forEach(function(m){c.send((i.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(m-1),[f],c._parseTimeParameter(a.time))}),this},u.prototype.sendPitchBend=function(n,s,a){var c=this;if(a=a||{},isNaN(n)||n<-1||1<n)throw new RangeError("Pitch bend value must be between -1 and 1.");var f=Math.round((n+1)/2*16383),m=f>>7&127,h=127&f;return i.toMIDIChannels(s).forEach(function(_){c.send((i.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(_-1),[h,m],c._parseTimeParameter(a.time))}),this},u.prototype._parseTimeParameter=function(n){var s,a=parseFloat(n);return typeof n=="string"&&n.substring(0,1)==="+"?a&&0<a&&(s=i.time+a):a>i.time&&(s=a),s},u.prototype._convertNoteToArray=function(n){var s=[];return Array.isArray(n)||(n=[n]),n.forEach(function(a){s.push(i.guessNoteNumber(a))}),s},t.exports?t.exports=i:e.WebMidi||(e.WebMidi=i)})(Q)})(ur);var Co=ur.exports;const Di=t=>t[Symbol.iterator]();function*No(t,e){let r={},i=Di(t),o;for(;o=i.next(),!o.done;){let u=e?e(o.value):o.value,n=JSON.stringify(u),s=r[n];s?s[1]++:r[n]=[u,1]}yield*Object.keys(r).map(u=>r[u])}function Pi(t,e){if(qr(t))for(let r of e)t.set(r[0],r[1]);else for(let r of e)t.add(r);return t}const Fi=(t,e)=>ce(t,"empty")?t.empty():new(t[Symbol.species]||e),Ri=(t,e,r)=>{if(r=r||Fi(t,Set),t===e)return Pi(r,t);if(e.size<t.size)return Ri(e,t,r);for(let i of e)t.has(i)&&r.add(i);return r},Be=(t,e)=>Array(Math.abs(e)+1).join(t);function ct(t){return t!==null&&typeof t=="object"&&typeof t.name=="string"}function ft(t){return t!==null&&typeof t=="object"&&typeof t.step=="number"&&typeof t.alt=="number"}const cr=[0,2,4,-1,1,3,5],fr=cr.map(t=>Math.floor(t*7/12));function lr(t){const{step:e,alt:r,oct:i,dir:o=1}=t,u=cr[e]+7*r;if(i===void 0)return[o*u];const n=i-fr[e]-4*r;return[o*u,o*n]}const Ui=[3,0,4,1,5,2,6];function Bi(t){const[e,r,i]=t,o=Ui[Hi(e)],u=Math.floor((e+1)/7);if(r===void 0)return{step:o,alt:u,dir:i};const n=r+4*u+fr[o];return{step:o,alt:u,oct:n,dir:i}}function Hi(t){const e=(t+1)%7;return e<0?7+e:e}const hr={empty:!0,name:"",pc:"",acc:""},dr=new Map,Gi=t=>"CDEFGAB".charAt(t),lt=t=>t<0?Be("b",-t):Be("#",t),pr=t=>t[0]==="b"?-t.length:t.length;function X(t){const e=dr.get(t);if(e)return e;const r=typeof t=="string"?zi(t):ft(t)?X(qi(t)):ct(t)?X(t.name):hr;return dr.set(t,r),r}const ji=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function Li(t){const e=ji.exec(t);return[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]}function Vi(t){return X(Bi(t))}const $i=(t,e)=>(t%e+e)%e,ht=[0,2,4,5,7,9,11];function zi(t){const e=Li(t);if(e[0]===""||e[3]!=="")return hr;const r=e[0],i=e[1],o=e[2],u=(r.charCodeAt(0)+3)%7,n=pr(i),s=o.length?+o:void 0,a=lr({step:u,alt:n,oct:s}),c=r+i+o,f=r+i,m=(ht[u]+n+120)%12,h=s===void 0?$i(ht[u]+n,12)-12*99:ht[u]+n+12*(s+1),_=h>=0&&h<=127?h:null,v=s===void 0?null:Math.pow(2,(h-69)/12)*440;return{empty:!1,acc:i,alt:n,chroma:m,coord:a,freq:v,height:h,letter:r,midi:_,name:c,oct:s,pc:f,step:u}}function qi(t){const{step:e,alt:r,oct:i}=t,o=Gi(e);if(!o)return"";const u=o+lt(r);return i||i===0?u+i:u}const dt={empty:!0,name:"",acc:""},Wi="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",Yi="(AA|A|P|M|m|d|dd)([-+]?\\d+)",Ji=new RegExp("^"+Wi+"|"+Yi+"$");function Qi(t){const e=Ji.exec(`${t}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}const mr={};function He(t){return typeof t=="string"?mr[t]||(mr[t]=Xi(t)):ft(t)?He(Zi(t)):ct(t)?He(t.name):dt}const gr=[0,2,4,5,7,9,11],yr="PMMPPMM";function Xi(t){const e=Qi(t);if(e[0]==="")return dt;const r=+e[0],i=e[1],o=(Math.abs(r)-1)%7,u=yr[o];if(u==="M"&&i==="P")return dt;const n=u==="M"?"majorable":"perfectable",s=""+r+i,a=r<0?-1:1,c=r===8||r===-8?r:a*(o+1),f=Ki(n,i),m=Math.floor((Math.abs(r)-1)/7),h=a*(gr[o]+f+12*m),_=(a*(gr[o]+f)%12+12)%12,v=lr({step:o,alt:f,oct:m,dir:a});return{empty:!1,name:s,num:r,q:i,step:o,alt:f,dir:a,type:n,simple:c,semitones:h,chroma:_,coord:v,oct:m}}function Ki(t,e){return e==="M"&&t==="majorable"||e==="P"&&t==="perfectable"?0:e==="m"&&t==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(t==="perfectable"?e.length:e.length+1):0}function Zi(t){const{step:e,alt:r,oct:i=0,dir:o}=t;if(!o)return"";const u=e+1+7*i,n=u===0?e+1:u,s=o<0?"-":"",a=yr[e]==="M"?"majorable":"perfectable";return s+n+es(a,r)}function es(t,e){return e===0?t==="majorable"?"M":"P":e===-1&&t==="majorable"?"m":e>0?Be("A",e):Be("d",t==="perfectable"?e:e+1)}function pt(t,e){const r=X(t),i=He(e);if(r.empty||i.empty)return"";const o=r.coord,u=i.coord,n=o.length===1?[o[0]+u[0]]:[o[0]+u[0],o[1]+u[1]];return Vi(n).name}function ts(t){return+t>=0&&+t<=127}function xo(t){if(ts(t))return+t;const e=X(t);return e.empty?null:e.midi}const rs="C C# D D# E F F# G G# A A# B".split(" "),ns="C Db D Eb E F Gb G Ab A Bb B".split(" ");function is(t,e={}){if(isNaN(t)||t===-1/0||t===1/0)return"";t=Math.round(t);const i=(e.sharps===!0?rs:ns)[t%12];if(e.pitchClass)return i;const o=Math.floor(t/12)-1;return i+o}const ss=X,Oo=t=>{const e=ss(t);return e.empty?"":is(e.midi||e.chroma,{sharps:e.alt>0,pitchClass:e.midi===null})},br={empty:!0,name:"",chordType:""},_r={};function pe(t){return typeof t=="string"?_r[t]||(_r[t]=fs(t)):typeof t=="number"?pe(mt[t]||""):ft(t)?os(t):ct(t)?pe(t.name):br}function os(t){return pe(lt(t.alt)+mt[t.step])}const as=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/;function us(t){return as.exec(t)||["","","",""]}const cs="I II III IV V VI VII",mt=cs.split(" ");function fs(t){const[e,r,i,o]=us(t);if(!i)return br;const u=i.toUpperCase(),n=mt.indexOf(u),s=pr(r),a=1;return{empty:!1,name:e,roman:i,interval:He({step:n,alt:s,dir:a}).name,acc:r,chordType:o,alt:s,step:n,major:i===u,oct:0,dir:a}}const q=Object.freeze([]),ls={type:"major",tonic:"",alteration:0,keySignature:""},hs={tonic:"",grades:q,intervals:q,scale:q,chords:q,chordsHarmonicFunction:q,chordScales:q},ds=Ye(ve(ve({},ls),hs),{type:"major",minorRelative:"",scale:q,secondaryDominants:q,secondaryDominantsMinorRelative:q,substituteDominants:q,substituteDominantsMinorRelative:q}),vr=(t,e,r="")=>e.map((i,o)=>`${t[o]}${r}${i}`);function ps(t,e,r,i){return o=>{const u=t.map(s=>pe(s).interval||""),n=u.map(s=>pt(o,s));return{tonic:o,grades:t,intervals:u,scale:n,chords:vr(n,e),chordsHarmonicFunction:r.slice(),chordScales:vr(n,i," ")}}}const ms=(t,e)=>{const r=X(t),i=X(e);return r.empty||i.empty?0:i.coord[0]-r.coord[0]},gs=ps("I II III IV V VI VII".split(" "),"maj7 m7 m7 maj7 7 m7 m7b5".split(" "),"T SD T SD D T D".split(" "),"major,dorian,phrygian,lydian,mixolydian,minor,locrian".split(","));function Do(t){const e=X(t).pc;if(!e)return ds;const r=gs(e),i=ms("C",e),o=u=>{const n=pe(u);return n.empty?"":pt(t,n.interval)+n.chordType};return Ye(ve({},r),{type:"major",minorRelative:pt(e,"-3m"),alteration:i,keySignature:lt(i),secondaryDominants:"- VI7 VII7 I7 II7 III7 -".split(" ").map(o),secondaryDominantsMinorRelative:"- IIIm7b5 IV#m7 Vm7 VIm7 VIIm7b5 -".split(" ").map(o),substituteDominants:"- bIII7 IV7 bV7 bVI7 bVII7 -".split(" ").map(o),substituteDominantsMinorRelative:"- IIIm7 Im7 IIbm7 VIm7 IVm7 -".split(" ").map(o)})}var Ge={},je={};function ys(t){var e=new B(t),r=e.readChunk();if(r.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+r.id+"'";for(var i=bs(r.data),o=[],u=0;!e.eof()&&u<i.numTracks;u++){var n=e.readChunk();if(n.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+n.id+"'";var s=_s(n.data);o.push(s)}return{header:i,tracks:o}}function bs(t){var e=new B(t),r=e.readUInt16(),i=e.readUInt16(),o={format:r,numTracks:i},u=e.readUInt16();return u&32768?(o.framesPerSecond=256-(u>>8),o.ticksPerFrame=u&255):o.ticksPerBeat=u,o}function _s(t){for(var e=new B(t),r=[];!e.eof();){var i=u();r.push(i)}return r;var o;function u(){var n={};n.deltaTime=e.readVarInt();var s=e.readUInt8();if((s&240)==240)if(s===255){n.meta=!0;var a=e.readUInt8(),c=e.readVarInt();switch(a){case 0:if(n.type="sequenceNumber",c!==2)throw"Expected length for sequenceNumber event is 2, got "+c;return n.number=e.readUInt16(),n;case 1:return n.type="text",n.text=e.readString(c),n;case 2:return n.type="copyrightNotice",n.text=e.readString(c),n;case 3:return n.type="trackName",n.text=e.readString(c),n;case 4:return n.type="instrumentName",n.text=e.readString(c),n;case 5:return n.type="lyrics",n.text=e.readString(c),n;case 6:return n.type="marker",n.text=e.readString(c),n;case 7:return n.type="cuePoint",n.text=e.readString(c),n;case 32:if(n.type="channelPrefix",c!=1)throw"Expected length for channelPrefix event is 1, got "+c;return n.channel=e.readUInt8(),n;case 33:if(n.type="portPrefix",c!=1)throw"Expected length for portPrefix event is 1, got "+c;return n.port=e.readUInt8(),n;case 47:if(n.type="endOfTrack",c!=0)throw"Expected length for endOfTrack event is 0, got "+c;return n;case 81:if(n.type="setTempo",c!=3)throw"Expected length for setTempo event is 3, got "+c;return n.microsecondsPerBeat=e.readUInt24(),n;case 84:if(n.type="smpteOffset",c!=5)throw"Expected length for smpteOffset event is 5, got "+c;var f=e.readUInt8(),m={0:24,32:25,64:29,96:30};return n.frameRate=m[f&96],n.hour=f&31,n.min=e.readUInt8(),n.sec=e.readUInt8(),n.frame=e.readUInt8(),n.subFrame=e.readUInt8(),n;case 88:if(n.type="timeSignature",c!=4)throw"Expected length for timeSignature event is 4, got "+c;return n.numerator=e.readUInt8(),n.denominator=1<<e.readUInt8(),n.metronome=e.readUInt8(),n.thirtyseconds=e.readUInt8(),n;case 89:if(n.type="keySignature",c!=2)throw"Expected length for keySignature event is 2, got "+c;return n.key=e.readInt8(),n.scale=e.readUInt8(),n;case 127:return n.type="sequencerSpecific",n.data=e.readBytes(c),n;default:return n.type="unknownMeta",n.data=e.readBytes(c),n.metatypeByte=a,n}}else if(s==240){n.type="sysEx";var c=e.readVarInt();return n.data=e.readBytes(c),n}else if(s==247){n.type="endSysEx";var c=e.readVarInt();return n.data=e.readBytes(c),n}else throw"Unrecognised MIDI event type byte: "+s;else{var h;if((s&128)==0){if(o===null)throw"Running status byte encountered before status byte";h=s,s=o,n.running=!0}else h=e.readUInt8(),o=s;var _=s>>4;switch(n.channel=s&15,_){case 8:return n.type="noteOff",n.noteNumber=h,n.velocity=e.readUInt8(),n;case 9:var v=e.readUInt8();return n.type=v===0?"noteOff":"noteOn",n.noteNumber=h,n.velocity=v,v===0&&(n.byte9=!0),n;case 10:return n.type="noteAftertouch",n.noteNumber=h,n.amount=e.readUInt8(),n;case 11:return n.type="controller",n.controllerType=h,n.value=e.readUInt8(),n;case 12:return n.type="programChange",n.programNumber=h,n;case 13:return n.type="channelAftertouch",n.amount=h,n;case 14:return n.type="pitchBend",n.value=h+(e.readUInt8()<<7)-8192,n;default:throw"Unrecognised MIDI event type: "+_}}}}function B(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}B.prototype.eof=function(){return this.pos>=this.bufferLen};B.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t};B.prototype.readInt8=function(){var t=this.readUInt8();return t&128?t-256:t};B.prototype.readUInt16=function(){var t=this.readUInt8(),e=this.readUInt8();return(t<<8)+e};B.prototype.readInt16=function(){var t=this.readUInt16();return t&32768?t-65536:t};B.prototype.readUInt24=function(){var t=this.readUInt8(),e=this.readUInt8(),r=this.readUInt8();return(t<<16)+(e<<8)+r};B.prototype.readInt24=function(){var t=this.readUInt24();return t&8388608?t-16777216:t};B.prototype.readUInt32=function(){var t=this.readUInt8(),e=this.readUInt8(),r=this.readUInt8(),i=this.readUInt8();return(t<<24)+(e<<16)+(r<<8)+i};B.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e};B.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)};B.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(e&128)t+=e&127,t<<=7;else return t+e}return t};B.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32(),r=this.readBytes(e);return{id:t,length:e,data:r}};var vs=ys;function Is(t,e){if(typeof t!="object")throw"Invalid MIDI data";e=e||{};var r=t.header||{},i=t.tracks||[],o,u=i.length,n=new P;for(Ss(n,r,u),o=0;o<u;o++)Es(n,i[o],e);return n.buffer}function Ss(t,e,r){var i=e.format==null?1:e.format,o=128;e.timeDivision?o=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?o=-(e.framesPerSecond&255)<<8|e.ticksPerFrame&255:e.ticksPerBeat&&(o=e.ticksPerBeat&32767);var u=new P;u.writeUInt16(i),u.writeUInt16(r),u.writeUInt16(o),t.writeChunk("MThd",u.buffer)}function Es(t,e,r){var i=new P,o,u=e.length,n=null;for(o=0;o<u;o++)(r.running===!1||!r.running&&!e[o].running)&&(n=null),n=ws(i,e[o],n,r.useByte9ForNoteOff);t.writeChunk("MTrk",i.buffer)}function ws(t,e,r,i){var o=e.type,u=e.deltaTime,n=e.text||"",s=e.data||[],a=null;switch(t.writeVarInt(u),o){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(n.length),t.writeString(n);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(n.length),t.writeString(n);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(n.length),t.writeString(n);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(n.length),t.writeString(n);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(n.length),t.writeString(n);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(n.length),t.writeString(n);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(n.length),t.writeString(n);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var c={24:0,25:32,29:64,30:96},f=e.hour&31|c[e.frameRate];t.writeUInt8(f),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var m=Math.floor(Math.log(e.denominator)/Math.LN2)&255;t.writeUInt8(m),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(s.length),t.writeBytes(s);break;case"unknownMeta":e.metatypeByte!=null&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(s.length),t.writeBytes(s));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(s.length),t.writeBytes(s);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(s.length),t.writeBytes(s);break;case"noteOff":var h=i!==!1&&e.byte9||i&&e.velocity==0?144:128;a=h|e.channel,a!==r&&t.writeUInt8(a),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":a=144|e.channel,a!==r&&t.writeUInt8(a),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":a=160|e.channel,a!==r&&t.writeUInt8(a),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":a=176|e.channel,a!==r&&t.writeUInt8(a),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":a=192|e.channel,a!==r&&t.writeUInt8(a),t.writeUInt8(e.programNumber);break;case"channelAftertouch":a=208|e.channel,a!==r&&t.writeUInt8(a),t.writeUInt8(e.amount);break;case"pitchBend":a=224|e.channel,a!==r&&t.writeUInt8(a);var _=8192+e.value,v=_&127,E=_>>7&127;t.writeUInt8(v),t.writeUInt8(E);break;default:throw"Unrecognized event type: "+o}return a}function P(){this.buffer=[]}P.prototype.writeUInt8=function(t){this.buffer.push(t&255)};P.prototype.writeInt8=P.prototype.writeUInt8;P.prototype.writeUInt16=function(t){var e=t>>8&255,r=t&255;this.writeUInt8(e),this.writeUInt8(r)};P.prototype.writeInt16=P.prototype.writeUInt16;P.prototype.writeUInt24=function(t){var e=t>>16&255,r=t>>8&255,i=t&255;this.writeUInt8(e),this.writeUInt8(r),this.writeUInt8(i)};P.prototype.writeInt24=P.prototype.writeUInt24;P.prototype.writeUInt32=function(t){var e=t>>24&255,r=t>>16&255,i=t>>8&255,o=t&255;this.writeUInt8(e),this.writeUInt8(r),this.writeUInt8(i),this.writeUInt8(o)};P.prototype.writeInt32=P.prototype.writeUInt32;P.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))};P.prototype.writeString=function(t){var e,r=t.length,i=[];for(e=0;e<r;e++)i.push(t.codePointAt(e));this.writeBytes(i)};P.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,r=[];for(r.push(e&127),e>>=7;e;){var i=e&127|128;r.push(i),e>>=7}this.writeBytes(r.reverse())}};P.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)};var Ms=Is;je.parseMidi=vs;je.writeMidi=Ms;var gt={},Le={},me={};Object.defineProperty(me,"__esModule",{value:!0});function Ir(t,e,r){r===void 0&&(r="ticks");var i=0,o=t.length,u=o;if(o>0&&t[o-1][r]<=e)return o-1;for(;i<u;){var n=Math.floor(i+(u-i)/2),s=t[n],a=t[n+1];if(s[r]===e){for(var c=n;c<t.length;c++){var f=t[c];f[r]===e&&(n=c)}return n}else{if(s[r]<e&&a[r]>e)return n;s[r]>e?u=n:s[r]<e&&(i=n+1)}}return-1}me.search=Ir;function Ts(t,e,r){if(r===void 0&&(r="ticks"),t.length){var i=Ir(t,e[r],r);t.splice(i+1,0,e)}else t.push(e)}me.insert=Ts;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=me,r=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var i=function(){function o(u){var n=this;this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",r.set(this,480),u&&(r.set(this,u.header.ticksPerBeat),u.tracks.forEach(function(s){return s.forEach(function(a){a.meta&&(a.type==="timeSignature"?n.timeSignatures.push({ticks:a.absoluteTime,timeSignature:[a.numerator,a.denominator]}):a.type==="setTempo"?n.tempos.push({bpm:6e7/a.microsecondsPerBeat,ticks:a.absoluteTime}):a.type==="keySignature"&&n.keySignatures.push({key:t.keySignatureKeys[a.key+7],scale:a.scale===0?"major":"minor",ticks:a.absoluteTime}))})}),u.tracks[0].forEach(function(s){s.meta&&(s.type==="trackName"?n.name=s.text:(s.type==="text"||s.type==="cuePoint"||s.type==="marker"||s.type==="lyrics")&&n.meta.push({text:s.text,ticks:s.absoluteTime,type:s.type}))}),this.update())}return o.prototype.update=function(){var u=this,n=0,s=0;this.tempos.sort(function(a,c){return a.ticks-c.ticks}),this.tempos.forEach(function(a,c){var f=c>0?u.tempos[c-1].bpm:u.tempos[0].bpm,m=a.ticks/u.ppq-s,h=60/f*m;a.time=h+n,n=a.time,s+=m}),this.timeSignatures.sort(function(a,c){return a.ticks-c.ticks}),this.timeSignatures.forEach(function(a,c){var f=c>0?u.timeSignatures[c-1]:u.timeSignatures[0],m=(a.ticks-f.ticks)/u.ppq,h=m/f.timeSignature[0]/(f.timeSignature[1]/4);f.measures=f.measures||0,a.measures=h+f.measures})},o.prototype.ticksToSeconds=function(u){var n=e.search(this.tempos,u);if(n!==-1){var s=this.tempos[n],a=s.time,c=(u-s.ticks)/this.ppq;return a+60/s.bpm*c}else{var f=u/this.ppq;return 60/120*f}},o.prototype.ticksToMeasures=function(u){var n=e.search(this.timeSignatures,u);if(n!==-1){var s=this.timeSignatures[n],a=(u-s.ticks)/this.ppq;return s.measures+a/(s.timeSignature[0]/s.timeSignature[1])/4}else return u/this.ppq/4},Object.defineProperty(o.prototype,"ppq",{get:function(){return r.get(this)},enumerable:!0,configurable:!0}),o.prototype.secondsToTicks=function(u){var n=e.search(this.tempos,u,"time");if(n!==-1){var s=this.tempos[n],a=s.time,c=u-a,f=c/(60/s.bpm);return Math.round(s.ticks+f*this.ppq)}else{var m=u/(60/120);return Math.round(m*this.ppq)}},o.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(u){return{bpm:u.bpm,ticks:u.ticks}}),timeSignatures:this.timeSignatures}},o.prototype.fromJSON=function(u){this.name=u.name,this.tempos=u.tempos.map(function(n){return Object.assign({},n)}),this.timeSignatures=u.timeSignatures.map(function(n){return Object.assign({},n)}),this.keySignatures=u.keySignatures.map(function(n){return Object.assign({},n)}),this.meta=u.meta.map(function(n){return Object.assign({},n)}),r.set(this,u.ppq),this.update()},o.prototype.setTempo=function(u){this.tempos=[{bpm:u,ticks:0}],this.update()},o}();t.Header=i})(Le);var ge={exports:{}};ge.exports=As;ge.exports.from=Sr;ge.exports.depth=ks;ge.exports.fromDepth=Er;function As(t){if(!Array.isArray(t))throw new TypeError("Expected value to be an array");return Sr(t)}function Sr(t){return wr(t,[])}function ks(t,e){if(!Array.isArray(t))throw new TypeError("Expected value to be an array");return Er(t,e)}function Er(t,e){if(typeof e!="number")throw new TypeError("Expected the depth to be a number");return Mr(t,[],e)}function wr(t,e){for(var r=0;r<t.length;r++){var i=t[r];Array.isArray(i)?wr(i,e):e.push(i)}return e}function Mr(t,e,r){r--;for(var i=0;i<t.length;i++){var o=t[i];r>-1&&Array.isArray(o)?Mr(o,e,r):e.push(o)}return e}var yt=Q&&Q.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),o=0,e=0;e<r;e++)for(var u=arguments[e],n=0,s=u.length;n<s;n++,o++)i[o]=u[n];return i},Cs=Q&&Q.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(gt,"__esModule",{value:!0});var Ns=je,xs=Le,Os=Cs(ge.exports);function Ds(t,e){return[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(t.velocity*127)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(t.noteOffVelocity*127)}]}function Ps(t){return Os.default(t.notes.map(function(e){return Ds(e,t.channel)}))}function Fs(t,e){return{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:Math.floor(t.value*127)}}function Rs(t){for(var e=[],r=0;r<127;r++)t.controlChanges.hasOwnProperty(r)&&t.controlChanges[r].forEach(function(i){e.push(Fs(i,t.channel))});return e}function Us(t,e){return{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}}function Bs(t){var e=[];return t.pitchBends.forEach(function(r){e.push(Us(r,t.channel))}),e}function Hs(t){return{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}}function Gs(t){return{absoluteTime:0,deltaTime:0,meta:!0,text:t,type:"trackName"}}function js(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}function Ls(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function Vs(t){var e=xs.keySignatureKeys.indexOf(t.key);return{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:t.scale==="major"?0:1,type:"keySignature"}}function $s(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,text:t.text,type:t.type}}function zs(t){var e={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:yt([yt([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map(function(r){return Vs(r)}),t.header.meta.map(function(r){return $s(r)}),t.header.tempos.map(function(r){return js(r)}),t.header.timeSignatures.map(function(r){return Ls(r)}))],t.tracks.map(function(r){return yt([Gs(r.name),Hs(r)],Ps(r),Rs(r),Bs(r))}))};return e.tracks=e.tracks.map(function(r){r=r.sort(function(o,u){return o.absoluteTime-u.absoluteTime});var i=0;return r.forEach(function(o){o.deltaTime=o.absoluteTime-i,i=o.absoluteTime,delete o.absoluteTime}),r.push({deltaTime:0,meta:!0,type:"endOfTrack"}),r}),new Uint8Array(Ns.writeMidi(e))}gt.encode=zs;var Ve={},bt={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce(function(o,u){return o[t.controlChangeNames[u]]=u,o},{});var e=new WeakMap,r=new WeakMap,i=function(){function o(u,n){e.set(this,n),r.set(this,u.controllerType),this.ticks=u.absoluteTime,this.value=u.value}return Object.defineProperty(o.prototype,"number",{get:function(){return r.get(this)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"time",{get:function(){var u=e.get(this);return u.ticksToSeconds(this.ticks)},set:function(u){var n=e.get(this);this.ticks=n.secondsToTicks(u)},enumerable:!0,configurable:!0}),o.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},o}();t.ControlChange=i})(bt);var _t={};Object.defineProperty(_t,"__esModule",{value:!0});var $e=bt;function qs(){return new Proxy({},{get:function(t,e){if(t[e])return t[e];if($e.controlChangeIds.hasOwnProperty(e))return t[$e.controlChangeIds[e]]},set:function(t,e,r){return $e.controlChangeIds.hasOwnProperty(e)?t[$e.controlChangeIds[e]]=r:t[e]=r,!0}})}_t.createControlChanges=qs;var vt={};Object.defineProperty(vt,"__esModule",{value:!0});var It=new WeakMap,Ws=function(){function t(e,r){It.set(this,r),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(t.prototype,"time",{get:function(){var e=It.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var r=It.get(this);this.ticks=r.secondsToTicks(e)},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();vt.PitchBend=Ws;var St={},ye={};Object.defineProperty(ye,"__esModule",{value:!0});ye.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];ye.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];ye.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(St,"__esModule",{value:!0});var ze=ye,Tr=new WeakMap,Ys=function(){function t(e,r){if(this.number=0,Tr.set(this,r),this.number=0,e){var i=e.find(function(o){return o.type==="programChange"});i&&(this.number=i.programNumber)}}return Object.defineProperty(t.prototype,"name",{get:function(){return this.percussion?ze.DrumKitByPatchID[this.number]:ze.instrumentByPatchID[this.number]},set:function(e){var r=ze.instrumentByPatchID.indexOf(e);r!==-1&&(this.number=r)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"family",{get:function(){return this.percussion?"drums":ze.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"percussion",{get:function(){var e=Tr.get(this);return e.channel===9},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{family:this.family,name:this.name,number:this.number}},t.prototype.fromJSON=function(e){this.number=e.number},t}();St.Instrument=Ys;var Et={};Object.defineProperty(Et,"__esModule",{value:!0});function Js(t){var e=Math.floor(t/12)-1;return Ar(t)+e.toString()}function Ar(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],r=t%12;return e[r]}function Qs(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return e.indexOf(t)}var Xs=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(r){var i=t.exec(r),o=i[1],u=i[2],n=e[o.toLowerCase()];return n+(parseInt(u,10)+1)*12}}(),se=new WeakMap,Ks=function(){function t(e,r,i){se.set(this,i),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=r.velocity,this.ticks=e.ticks,this.durationTicks=r.ticks-e.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return Js(this.midi)},set:function(e){this.midi=Xs(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var r=e-this.octave;this.midi+=r*12},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return Ar(this.midi)},set:function(e){this.midi=12*(this.octave+1)+Qs(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var e=se.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var r=se.get(this),i=r.secondsToTicks(this.time+e);this.durationTicks=i-this.ticks},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var e=se.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var r=se.get(this);this.ticks=r.secondsToTicks(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){var e=se.get(this);return e.ticksToMeasures(this.ticks)},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}();Et.Note=Ks;Object.defineProperty(Ve,"__esModule",{value:!0});var wt=me,Zs=bt,eo=_t,to=vt,kr=St,ro=Et,qe=new WeakMap,no=function(){function t(e,r){var i=this;if(this.name="",this.notes=[],this.controlChanges=eo.createControlChanges(),this.pitchBends=[],qe.set(this,r),e){var o=e.find(function(h){return h.type==="trackName"});this.name=o?o.text:""}if(this.instrument=new kr.Instrument(e,this),this.channel=0,e){for(var u=e.filter(function(h){return h.type==="noteOn"}),n=e.filter(function(h){return h.type==="noteOff"}),s=function(){var h=u.shift();a.channel=h.channel;var _=n.findIndex(function(E){return E.noteNumber===h.noteNumber&&E.absoluteTime>=h.absoluteTime});if(_!==-1){var v=n.splice(_,1)[0];a.addNote({durationTicks:v.absoluteTime-h.absoluteTime,midi:h.noteNumber,noteOffVelocity:v.velocity/127,ticks:h.absoluteTime,velocity:h.velocity/127})}},a=this;u.length;)s();var c=e.filter(function(h){return h.type==="controller"});c.forEach(function(h){i.addCC({number:h.controllerType,ticks:h.absoluteTime,value:h.value/127})});var f=e.filter(function(h){return h.type==="pitchBend"});f.forEach(function(h){i.addPitchBend({ticks:h.absoluteTime,value:h.value/Math.pow(2,13)})});var m=e.find(function(h){return h.type==="endOfTrack"});this.endOfTrackTicks=m!==void 0?m.absoluteTime:void 0}}return t.prototype.addNote=function(e){var r=qe.get(this),i=new ro.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},r);return Object.assign(i,e),wt.insert(this.notes,i,"ticks"),this},t.prototype.addCC=function(e){var r=qe.get(this),i=new Zs.ControlChange({controllerType:e.number},r);return delete e.number,Object.assign(i,e),Array.isArray(this.controlChanges[i.number])||(this.controlChanges[i.number]=[]),wt.insert(this.controlChanges[i.number],i,"ticks"),this},t.prototype.addPitchBend=function(e){var r=qe.get(this),i=new to.PitchBend({},r);return Object.assign(i,e),wt.insert(this.pitchBends,i,"ticks"),this},Object.defineProperty(t.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,r=0;r<this.notes.length-1;r++){var i=this.notes[r].time+this.notes[r].duration;e<i&&(e=i)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,r=0;r<this.notes.length-1;r++){var i=this.notes[r].ticks+this.notes[r].durationTicks;e<i&&(e=i)}return e},enumerable:!0,configurable:!0}),t.prototype.fromJSON=function(e){var r=this;this.name=e.name,this.channel=e.channel,this.instrument=new kr.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),e.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=e.endOfTrackTicks);for(var i in e.controlChanges)e.controlChanges[i]&&e.controlChanges[i].forEach(function(o){r.addCC({number:o.number,ticks:o.ticks,value:o.value})});e.notes.forEach(function(o){r.addNote({durationTicks:o.durationTicks,midi:o.midi,ticks:o.ticks,velocity:o.velocity})})},t.prototype.toJSON=function(){for(var e={},r=0;r<127;r++)this.controlChanges.hasOwnProperty(r)&&(e[r]=this.controlChanges[r].map(function(o){return o.toJSON()}));var i={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(o){return o.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(o){return o.toJSON()})};return this.endOfTrackTicks!==void 0&&(i.endOfTrackTicks=this.endOfTrackTicks),i},t}();Ve.Track=no;var io=Q&&Q.__awaiter||function(t,e,r,i){function o(u){return u instanceof r?u:new r(function(n){n(u)})}return new(r||(r=Promise))(function(u,n){function s(f){try{c(i.next(f))}catch(m){n(m)}}function a(f){try{c(i.throw(f))}catch(m){n(m)}}function c(f){f.done?u(f.value):o(f.value).then(s,a)}c((i=i.apply(t,e||[])).next())})},so=Q&&Q.__generator||function(t,e){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},i,o,u,n;return n={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(n[Symbol.iterator]=function(){return this}),n;function s(c){return function(f){return a([c,f])}}function a(c){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(u=c[0]&2?o.return:c[0]?o.throw||((u=o.return)&&u.call(o),0):o.next)&&!(u=u.call(o,c[1])).done)return u;switch(o=0,u&&(c=[c[0]&2,u.value]),c[0]){case 0:case 1:u=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,o=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!u||c[1]>u[0]&&c[1]<u[3])){r.label=c[1];break}if(c[0]===6&&r.label<u[1]){r.label=u[1],u=c;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(c);break}u[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(f){c=[6,f],o=0}finally{i=u=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(Ge,"__esModule",{value:!0});var oo=je,ao=gt,Cr=Le,Mt=Ve,uo=function(){function t(e){var r=this,i=null;e&&(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),i=oo.parseMidi(e),i.tracks.forEach(function(o){var u=0;o.forEach(function(n){u+=n.deltaTime,n.absoluteTime=u})}),i.tracks=lo(i.tracks)),this.header=new Cr.Header(i),this.tracks=[],e&&(this.tracks=i.tracks.map(function(o){return new Mt.Track(o,r.header)}),i.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return t.fromUrl=function(e){return io(this,void 0,void 0,function(){var r,i;return so(this,function(o){switch(o.label){case 0:return[4,fetch(e)];case 1:return r=o.sent(),r.ok?[4,r.arrayBuffer()]:[3,3];case 2:return i=o.sent(),[2,new t(i)];case 3:throw new Error("could not load "+e)}})})},Object.defineProperty(t.prototype,"name",{get:function(){return this.header.name},set:function(e){this.header.name=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var e=this.tracks.map(function(r){return r.duration});return Math.max.apply(Math,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){var e=this.tracks.map(function(r){return r.durationTicks});return Math.max.apply(Math,e)},enumerable:!0,configurable:!0}),t.prototype.addTrack=function(){var e=new Mt.Track(void 0,this.header);return this.tracks.push(e),e},t.prototype.toArray=function(){return ao.encode(this)},t.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(e){return e.toJSON()})}},t.prototype.fromJSON=function(e){var r=this;this.header=new Cr.Header,this.header.fromJSON(e.header),this.tracks=e.tracks.map(function(i){var o=new Mt.Track(void 0,r.header);return o.fromJSON(i),o})},t.prototype.clone=function(){var e=new t;return e.fromJSON(this.toJSON()),e},t}(),Po=Ge.Midi=uo,co=Ve;Ge.Track=co.Track;var fo=Le;Ge.Header=fo.Header;function lo(t){for(var e=[],r=0;r<t.length;r++)for(var i=e.length,o=new Map,u=Array(16).fill(0),n=0,s=t[r];n<s.length;n++){var a=s[n],c=i,f=a.channel;if(f!==void 0){a.type==="programChange"&&(u[f]=a.programNumber);var m=u[f],h=m+" "+f;o.has(h)?c=o.get(h):(c=i+o.size,o.set(h,c))}e[c]||e.push([]),e[c].push(a)}return e}var Nr={exports:{}};(function(t,e){(function(r,i){t.exports=i()})(Q,function(){/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function r(d,l,g){if(g||arguments.length===2)for(var p,y=0,b=l.length;y<b;y++)!p&&y in l||(p||(p=Array.prototype.slice.call(l,0,y)),p[y]=l[y]);return d.concat(p||Array.prototype.slice.call(l))}var i=Object.freeze({__proto__:null,blackman:function(d){for(var l=new Float32Array(d),g=2*Math.PI/(d-1),p=2*g,y=0;y<d/2;y++)l[y]=.42-.5*Math.cos(y*g)+.08*Math.cos(y*p);for(y=Math.ceil(d/2);y>0;y--)l[d-y]=l[y-1];return l},sine:function(d){for(var l=Math.PI/(d-1),g=new Float32Array(d),p=0;p<d;p++)g[p]=Math.sin(l*p);return g},hanning:function(d){for(var l=new Float32Array(d),g=0;g<d;g++)l[g]=.5-.5*Math.cos(2*Math.PI*g/(d-1));return l},hamming:function(d){for(var l=new Float32Array(d),g=0;g<d;g++)l[g]=.54-.46*Math.cos(2*Math.PI*(g/d-1));return l}}),o={};function u(d){for(;d%2==0&&d>1;)d/=2;return d===1}function n(d,l){if(l!=="rect"){if(l!==""&&l||(l="hanning"),o[l]||(o[l]={}),!o[l][d.length])try{o[l][d.length]=i[l](d.length)}catch{throw new Error("Invalid windowing function")}d=function(g,p){for(var y=[],b=0;b<Math.min(g.length,p.length);b++)y[b]=g[b]*p[b];return y}(d,o[l][d.length])}return d}function s(d,l,g){for(var p=new Float32Array(d),y=0;y<p.length;y++)p[y]=y*l/g,p[y]=13*Math.atan(p[y]/1315.8)+3.5*Math.atan(Math.pow(p[y]/7518,2));return p}function a(d){return Float32Array.from(d)}function c(d){return 1125*Math.log(1+d/700)}function f(d,l,g){for(var p,y=new Float32Array(d+2),b=new Float32Array(d+2),w=l/2,A=c(0),M=(c(w)-A)/(d+1),I=new Array(d+2),S=0;S<y.length;S++)y[S]=S*M,b[S]=(p=y[S],700*(Math.exp(p/1125)-1)),I[S]=Math.floor((g+1)*b[S]/l);for(var N=new Array(d),T=0;T<N.length;T++){for(N[T]=new Array(g/2+1).fill(0),S=I[T];S<I[T+1];S++)N[T][S]=(S-I[T])/(I[T+1]-I[T]);for(S=I[T+1];S<I[T+2];S++)N[T][S]=(I[T+2]-S)/(I[T+2]-I[T+1])}return N}function m(d,l,g,p,y,b,w){p===void 0&&(p=5),y===void 0&&(y=2),b===void 0&&(b=!0),w===void 0&&(w=440);var A=Math.floor(g/2)+1,M=new Array(g).fill(0).map(function(D,U){return d*function(H,K){return Math.log2(16*H/K)}(l*U/g,w)});M[0]=M[1]-1.5*d;var I,S,N,T=M.slice(1).map(function(D,U){return Math.max(D-M[U])},1).concat([1]),W=Math.round(d/2),V=new Array(d).fill(0).map(function(D,U){return M.map(function(H){return(10*d+W+H-U)%d-W})}),$=V.map(function(D,U){return D.map(function(H,K){return Math.exp(-.5*Math.pow(2*V[U][K]/T[K],2))})});if(S=(I=$)[0].map(function(){return 0}),N=I.reduce(function(D,U){return U.forEach(function(H,K){D[K]+=Math.pow(H,2)}),D},S).map(Math.sqrt),$=I.map(function(D,U){return D.map(function(H,K){return H/(N[K]||1)})}),y){var We=M.map(function(D){return Math.exp(-.5*Math.pow((D/d-p)/y,2))});$=$.map(function(D){return D.map(function(U,H){return U*We[H]})})}return b&&($=r(r([],$.slice(3),!0),$.slice(0,3),!0)),$.map(function(D){return D.slice(0,A)})}function h(d,l){for(var g=0,p=0,y=0;y<l.length;y++)g+=Math.pow(y,d)*Math.abs(l[y]),p+=l[y];return g/p}function _(d){var l=d.ampSpectrum,g=d.barkScale,p=d.numberOfBarkBands,y=p===void 0?24:p;if(typeof l!="object"||typeof g!="object")throw new TypeError;var b=y,w=new Float32Array(b),A=0,M=l,I=new Int32Array(b+1);I[0]=0;for(var S=g[M.length-1]/b,N=1,T=0;T<M.length;T++)for(;g[T]>S;)I[N++]=T,S=N*g[M.length-1]/b;for(I[b]=M.length-1,T=0;T<b;T++){for(var W=0,V=I[T];V<I[T+1];V++)W+=M[V];w[T]=Math.pow(W,.23)}for(T=0;T<w.length;T++)A+=w[T];return{specific:w,total:A}}function v(d){var l=d.ampSpectrum;if(typeof l!="object")throw new TypeError;for(var g=new Float32Array(l.length),p=0;p<g.length;p++)g[p]=Math.pow(l[p],2);return g}var E=null,C=function(d,l){var g=d.length;return l=l||2,E&&E[g]||function(p){(E=E||{})[p]=new Array(p*p);for(var y=Math.PI/p,b=0;b<p;b++)for(var w=0;w<p;w++)E[p][w+b*p]=Math.cos(y*(w+.5)*b)}(g),d.map(function(){return 0}).map(function(p,y){return l*d.reduce(function(b,w,A,M){return b+w*E[g][A+y*g]},0)})},k=Object.freeze({__proto__:null,buffer:function(d){return d.signal},rms:function(d){var l=d.signal;if(typeof l!="object")throw new TypeError;for(var g=0,p=0;p<l.length;p++)g+=Math.pow(l[p],2);return g/=l.length,g=Math.sqrt(g)},energy:function(d){var l=d.signal;if(typeof l!="object")throw new TypeError;for(var g=0,p=0;p<l.length;p++)g+=Math.pow(Math.abs(l[p]),2);return g},complexSpectrum:function(d){return d.complexSpectrum},spectralSlope:function(d){var l=d.ampSpectrum,g=d.sampleRate,p=d.bufferSize;if(typeof l!="object")throw new TypeError;for(var y=0,b=0,w=new Float32Array(l.length),A=0,M=0,I=0;I<l.length;I++){y+=l[I];var S=I*g/p;w[I]=S,A+=S*S,b+=S,M+=S*l[I]}return(l.length*M-b*y)/(y*(A-Math.pow(b,2)))},spectralCentroid:function(d){var l=d.ampSpectrum;if(typeof l!="object")throw new TypeError;return h(1,l)},spectralRolloff:function(d){var l=d.ampSpectrum,g=d.sampleRate;if(typeof l!="object")throw new TypeError;for(var p=l,y=g/(2*(p.length-1)),b=0,w=0;w<p.length;w++)b+=p[w];for(var A=.99*b,M=p.length-1;b>A&&M>=0;)b-=p[M],--M;return(M+1)*y},spectralFlatness:function(d){var l=d.ampSpectrum;if(typeof l!="object")throw new TypeError;for(var g=0,p=0,y=0;y<l.length;y++)g+=Math.log(l[y]),p+=l[y];return Math.exp(g/l.length)*l.length/p},spectralSpread:function(d){var l=d.ampSpectrum;if(typeof l!="object")throw new TypeError;return Math.sqrt(h(2,l)-Math.pow(h(1,l),2))},spectralSkewness:function(d){var l=d.ampSpectrum;if(typeof l!="object")throw new TypeError;var g=h(1,l),p=h(2,l),y=h(3,l);return(2*Math.pow(g,3)-3*g*p+y)/Math.pow(Math.sqrt(p-Math.pow(g,2)),3)},spectralKurtosis:function(d){var l=d.ampSpectrum;if(typeof l!="object")throw new TypeError;var g=l,p=h(1,g),y=h(2,g),b=h(3,g),w=h(4,g);return(-3*Math.pow(p,4)+6*p*y-4*p*b+w)/Math.pow(Math.sqrt(y-Math.pow(p,2)),4)},amplitudeSpectrum:function(d){return d.ampSpectrum},zcr:function(d){var l=d.signal;if(typeof l!="object")throw new TypeError;for(var g=0,p=1;p<l.length;p++)(l[p-1]>=0&&l[p]<0||l[p-1]<0&&l[p]>=0)&&g++;return g},loudness:_,perceptualSpread:function(d){for(var l=_({ampSpectrum:d.ampSpectrum,barkScale:d.barkScale}),g=0,p=0;p<l.specific.length;p++)l.specific[p]>g&&(g=l.specific[p]);return Math.pow((l.total-g)/l.total,2)},perceptualSharpness:function(d){for(var l=_({ampSpectrum:d.ampSpectrum,barkScale:d.barkScale}),g=l.specific,p=0,y=0;y<g.length;y++)p+=y<15?(y+1)*g[y+1]:.066*Math.exp(.171*(y+1));return p*=.11/l.total},powerSpectrum:v,mfcc:function(d){var l=d.ampSpectrum,g=d.melFilterBank,p=d.numberOfMFCCCoefficients,y=d.bufferSize;if(typeof l!="object")throw new TypeError("Valid ampSpectrum is required to generate MFCC");if(typeof g!="object")throw new TypeError("Valid melFilterBank is required to generate MFCC");var b=Math.min(40,Math.max(1,p||13)),w=v({ampSpectrum:l}),A=g.length,M=Array(A);if(A<b)throw new Error("Insufficient filter bank for requested number of coefficients");for(var I=new Float32Array(A),S=0;S<I.length;S++){M[S]=new Float32Array(y/2),I[S]=0;for(var N=0;N<y/2;N++)M[S][N]=g[S][N]*w[N],I[S]+=M[S][N];I[S]=Math.log(I[S]+1)}var T=Array.prototype.slice.call(I);return C(T).slice(0,b)},chroma:function(d){var l=d.ampSpectrum,g=d.chromaFilterBank;if(typeof l!="object")throw new TypeError("Valid ampSpectrum is required to generate chroma");if(typeof g!="object")throw new TypeError("Valid chromaFilterBank is required to generate chroma");var p=g.map(function(b,w){return l.reduce(function(A,M,I){return A+M*b[I]},0)}),y=Math.max.apply(Math,p);return y?p.map(function(b){return b/y}):p},spectralFlux:function(d){var l=d.signal,g=d.previousSignal,p=d.bufferSize;if(typeof l!="object"||typeof g!="object")throw new TypeError;for(var y=0,b=-p/2;b<l.length/2-1;b++)x=Math.abs(l[b])-Math.abs(g[b]),y+=(x+Math.abs(x))/2;return y}});function F(d){if(Array.isArray(d)){for(var l=0,g=Array(d.length);l<d.length;l++)g[l]=d[l];return g}return Array.from(d)}var O={},R={},G={bitReverseArray:function(d){if(O[d]===void 0){for(var l=(d-1).toString(2).length,g="0".repeat(l),p={},y=0;y<d;y++){var b=y.toString(2);b=g.substr(b.length)+b,b=[].concat(F(b)).reverse().join(""),p[y]=parseInt(b,2)}O[d]=p}return O[d]},multiply:function(d,l){return{real:d.real*l.real-d.imag*l.imag,imag:d.real*l.imag+d.imag*l.real}},add:function(d,l){return{real:d.real+l.real,imag:d.imag+l.imag}},subtract:function(d,l){return{real:d.real-l.real,imag:d.imag-l.imag}},euler:function(d,l){var g=-2*Math.PI*d/l;return{real:Math.cos(g),imag:Math.sin(g)}},conj:function(d){return d.imag*=-1,d},constructComplexArray:function(d){var l={};l.real=d.real===void 0?d.slice():d.real.slice();var g=l.real.length;return R[g]===void 0&&(R[g]=Array.apply(null,Array(g)).map(Number.prototype.valueOf,0)),l.imag=R[g].slice(),l}},be=function(d){var l={};d.real===void 0||d.imag===void 0?l=G.constructComplexArray(d):(l.real=d.real.slice(),l.imag=d.imag.slice());var g=l.real.length,p=Math.log2(g);if(Math.round(p)!=p)throw new Error("Input size must be a power of 2.");if(l.real.length!=l.imag.length)throw new Error("Real and imaginary components must have the same length.");for(var y=G.bitReverseArray(g),b={real:[],imag:[]},w=0;w<g;w++)b.real[y[w]]=l.real[w],b.imag[y[w]]=l.imag[w];for(var A=0;A<g;A++)l.real[A]=b.real[A],l.imag[A]=b.imag[A];for(var M=1;M<=p;M++)for(var I=Math.pow(2,M),S=0;S<I/2;S++)for(var N=G.euler(S,I),T=0;T<g/I;T++){var W=I*T+S,V=I*T+S+I/2,$={real:l.real[W],imag:l.imag[W]},We={real:l.real[V],imag:l.imag[V]},D=G.multiply(N,We),U=G.subtract($,D);l.real[V]=U.real,l.imag[V]=U.imag;var H=G.add(D,$);l.real[W]=H.real,l.imag[W]=H.imag}return l},_e=be,oe=function(){function d(l,g){var p=this;if(this._m=g,!l.audioContext)throw this._m.errors.noAC;if(l.bufferSize&&!u(l.bufferSize))throw this._m._errors.notPow2;if(!l.source)throw this._m._errors.noSource;this._m.audioContext=l.audioContext,this._m.bufferSize=l.bufferSize||this._m.bufferSize||256,this._m.hopSize=l.hopSize||this._m.hopSize||this._m.bufferSize,this._m.sampleRate=l.sampleRate||this._m.audioContext.sampleRate||44100,this._m.callback=l.callback,this._m.windowingFunction=l.windowingFunction||"hanning",this._m.featureExtractors=k,this._m.EXTRACTION_STARTED=l.startImmediately||!1,this._m.channel=typeof l.channel=="number"?l.channel:0,this._m.inputs=l.inputs||1,this._m.outputs=l.outputs||1,this._m.numberOfMFCCCoefficients=l.numberOfMFCCCoefficients||this._m.numberOfMFCCCoefficients||13,this._m.numberOfBarkBands=l.numberOfBarkBands||this._m.numberOfBarkBands||24,this._m.spn=this._m.audioContext.createScriptProcessor(this._m.bufferSize,this._m.inputs,this._m.outputs),this._m.spn.connect(this._m.audioContext.destination),this._m._featuresToExtract=l.featureExtractors||[],this._m.barkScale=s(this._m.bufferSize,this._m.sampleRate,this._m.bufferSize),this._m.melFilterBank=f(Math.max(this._m.melBands,this._m.numberOfMFCCCoefficients),this._m.sampleRate,this._m.bufferSize),this._m.inputData=null,this._m.previousInputData=null,this._m.frame=null,this._m.previousFrame=null,this.setSource(l.source),this._m.spn.onaudioprocess=function(y){var b;p._m.inputData!==null&&(p._m.previousInputData=p._m.inputData),p._m.inputData=y.inputBuffer.getChannelData(p._m.channel),p._m.previousInputData?((b=new Float32Array(p._m.previousInputData.length+p._m.inputData.length-p._m.hopSize)).set(p._m.previousInputData.slice(p._m.hopSize)),b.set(p._m.inputData,p._m.previousInputData.length-p._m.hopSize)):b=p._m.inputData,function(w,A,M){if(w.length<A)throw new Error("Buffer is too short for frame length");if(M<1)throw new Error("Hop length cannot be less that 1");if(A<1)throw new Error("Frame length cannot be less that 1");var I=1+Math.floor((w.length-A)/M);return new Array(I).fill(0).map(function(S,N){return w.slice(N*M,N*M+A)})}(b,p._m.bufferSize,p._m.hopSize).forEach(function(w){p._m.frame=w;var A=p._m.extract(p._m._featuresToExtract,p._m.frame,p._m.previousFrame);typeof p._m.callback=="function"&&p._m.EXTRACTION_STARTED&&p._m.callback(A),p._m.previousFrame=p._m.frame})}}return d.prototype.start=function(l){this._m._featuresToExtract=l||this._m._featuresToExtract,this._m.EXTRACTION_STARTED=!0},d.prototype.stop=function(){this._m.EXTRACTION_STARTED=!1},d.prototype.setSource=function(l){this._m.source&&this._m.source.disconnect(this._m.spn),this._m.source=l,this._m.source.connect(this._m.spn)},d.prototype.setChannel=function(l){l<=this._m.inputs?this._m.channel=l:console.error("Channel "+l+" does not exist. Make sure you've provided a value for 'inputs' that is greater than "+l+" when instantiating the MeydaAnalyzer")},d.prototype.get=function(l){return this._m.inputData?this._m.extract(l||this._m._featuresToExtract,this._m.inputData,this._m.previousInputData):null},d}(),j={audioContext:null,spn:null,bufferSize:512,sampleRate:44100,melBands:26,chromaBands:12,callback:null,windowingFunction:"hanning",featureExtractors:k,EXTRACTION_STARTED:!1,numberOfMFCCCoefficients:13,numberOfBarkBands:24,_featuresToExtract:[],windowing:n,_errors:{notPow2:new Error("Meyda: Buffer size must be a power of 2, e.g. 64 or 512"),featureUndef:new Error("Meyda: No features defined."),invalidFeatureFmt:new Error("Meyda: Invalid feature format"),invalidInput:new Error("Meyda: Invalid input."),noAC:new Error("Meyda: No AudioContext specified."),noSource:new Error("Meyda: No source node specified.")},createMeydaAnalyzer:function(d){return new oe(d,Object.assign({},j))},listAvailableFeatureExtractors:function(){return Object.keys(this.featureExtractors)},extract:function(d,l,g){var p=this;if(!l)throw this._errors.invalidInput;if(typeof l!="object")throw this._errors.invalidInput;if(!d)throw this._errors.featureUndef;if(!u(l.length))throw this._errors.notPow2;this.barkScale!==void 0&&this.barkScale.length==this.bufferSize||(this.barkScale=s(this.bufferSize,this.sampleRate,this.bufferSize)),this.melFilterBank!==void 0&&this.barkScale.length==this.bufferSize&&this.melFilterBank.length==this.melBands||(this.melFilterBank=f(Math.max(this.melBands,this.numberOfMFCCCoefficients),this.sampleRate,this.bufferSize)),this.chromaFilterBank!==void 0&&this.chromaFilterBank.length==this.chromaBands||(this.chromaFilterBank=m(this.chromaBands,this.sampleRate,this.bufferSize)),"buffer"in l&&l.buffer===void 0?this.signal=a(l):this.signal=l;var y=te(l,this.windowingFunction,this.bufferSize);if(this.signal=y.windowedSignal,this.complexSpectrum=y.complexSpectrum,this.ampSpectrum=y.ampSpectrum,g){var b=te(g,this.windowingFunction,this.bufferSize);this.previousSignal=b.windowedSignal,this.previousComplexSpectrum=b.complexSpectrum,this.previousAmpSpectrum=b.ampSpectrum}var w=function(A){return p.featureExtractors[A]({ampSpectrum:p.ampSpectrum,chromaFilterBank:p.chromaFilterBank,complexSpectrum:p.complexSpectrum,signal:p.signal,bufferSize:p.bufferSize,sampleRate:p.sampleRate,barkScale:p.barkScale,melFilterBank:p.melFilterBank,previousSignal:p.previousSignal,previousAmpSpectrum:p.previousAmpSpectrum,previousComplexSpectrum:p.previousComplexSpectrum,numberOfMFCCCoefficients:p.numberOfMFCCCoefficients,numberOfBarkBands:p.numberOfBarkBands})};if(typeof d=="object")return d.reduce(function(A,M){var I;return Object.assign({},A,((I={})[M]=w(M),I))},{});if(typeof d=="string")return w(d);throw this._errors.invalidFeatureFmt}},te=function(d,l,g){var p={};d.buffer===void 0?p.signal=a(d):p.signal=d,p.windowedSignal=n(p.signal,l),p.complexSpectrum=_e(p.windowedSignal),p.ampSpectrum=new Float32Array(g/2);for(var y=0;y<g/2;y++)p.ampSpectrum[y]=Math.sqrt(Math.pow(p.complexSpectrum.real[y],2)+Math.pow(p.complexSpectrum.imag[y],2));return p};return typeof window!="undefined"&&(window.Meyda=j),j})})(Nr);var Fo=Nr.exports;export{rt as A,ei as B,Kn as C,ri as D,yo as E,Jt as F,ni as G,Io as H,Po as M,Co as W,Kt as a,mo as b,Ni as c,So as d,xo as e,Oo as f,Ai as g,Mo as h,Y as i,Do as j,Eo as k,or as l,ie as m,nr as n,Ri as o,Zt as p,No as q,To as r,go as s,tr as t,Fo as u,bo as v,ko as w,Ao as x,_o as y,wo as z};
